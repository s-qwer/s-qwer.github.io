<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>swx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="我的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="swx">
<meta property="og:url" content="https://s-qwer.github.io/page/6/index.html">
<meta property="og:site_name" content="swx">
<meta property="og:description" content="我的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="swx">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="swx" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">swx</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://s-qwer.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-8.4.网页前端之JS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:24:00.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/">网页前端之JS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>HTML是用来写网页的</p>
<p>CSS是美化页面的</p>
<p>JavaScript是WEB上强大的脚本语言</p>
<p>JAVA编程语言：独立写程序，独立运行。编译–运行</p>
<p>脚本语言：无法独立执行。必须嵌入到其他语言中结合使用。直接被浏览器解析执行</p>
<p>作用：控制页面特效展示</p>
<p>语言特征：JavaScript无需编译，直接被浏览器解释并执行</p>
<p>JavaScript无法单独执行，必须嵌入到HTML代码中执行</p>
<p>JavaScript的执行过程由上到下依次执行</p>
<p>注意：JavaScript没有访问系统文件的权限</p>
<p>JavaScript无需编译，由上到下依次解释执行，所以在保证可读性的情况下，允许使用链式编程</p>
<p>JavaScript和java没有任何直接关系</p>
<p>组成</p>
<p>ECMAScript（核心）：规定了JS的语法和基本对象</p>
<p>DOM 文档对象模型（标记型文档。HTML）：处理网页内容的方法和接口</p>
<p>BOM  浏览器对象模型：与浏览器交互的方法和接口</p>
<p>引入方式：</p>
<p>\1. 内部脚本：在当前页面内部写script标签，script内部即可书写JavaScript代码。</p>
<p>格式：</p>
<script type=”text/javascript”>

JavaScript的代码

</sctipt>

注意：script标签理论上可以书写在HTML文件的任意位置

\2. 外部引入：在HTML文档中，通过<script src=””>标签引入.js文件

格式：

<script type=”text/javascript” src=”demo.js”></script>

<p>注意：外部引用时，script标签内不能有script代码，即使写了也不会执行</p>
<p>开发规范规定，script标签的放置位置为：在结束标签</body>前</p>
<p>(在学习时，可以先放在head标签之中，最后在放到结束标签</body>前)</p>
<p>优点：保证html展示内容优先加载，最后加载脚本，增强用户体验性</p>
<p>JavaScript的语法及规则：alert相当于是System.out.println()</p>
<p>\1. 注释：<br>单行注释： //  Hbuilder快捷键：ctrl+/</p>
<p>多行注释：/**/  Hbuilder快捷键：ctrl+shift+/</p>
<p>\2. 变量：标示内存中的一块空间，用于存储数据，且数据是可变的。<br>声明：var 变量名；  变量赋予默认值，默认值为undefined</p>
<p>var 变量名=值；</p>
<p>注意：必须以字母或下划线开头，中间可以使数字，字符或下划线。</p>
<p>变量名不能包含空格等符号</p>
<p>不能使用JavaScript的关键字作为变量名，如：function、this、class</p>
<p>JavaScript严格区分大小写</p>
<p>基本数据类型：5类</p>
<p>string：字符串类型  “” ‘’ 都是字符串，JavaScript中没有单个字符</p>
<p>boolean：布尔类型  固定值为false和true</p>
<p>number：数字类型 任意数字</p>
<p>null：空 一个占位符</p>
<p>undefined：未定义类型  该类型只有一个固定值，即undefined，表示变量声明却未定义具体的值</p>
<p>注意：因为undefined是从null中派生出来的，所以undefined==null</p>
<p>JavaScript区别于java，是弱类型语言，变量的使用不用严格遵循规范，所以一个变量声明好之后，还可以赋予任意类型的值。</p>
<p>typeof() 可以分辨变量值属于哪种基本数据类型：undefined、string、boolean、number。 如果一个变量是引用类型或者null类型的话，会返回object。</p>
<p>ECMAScript实现之初的一个bug：null属于基本数据类型，然而typeof(null)返回的却是object</p>
<p>引用数据类型:引用数据类型通常叫做类（class），但在JavaScript中，因为不存在编译过程，所以没有类的概念，所处理的引用数据类型都是对象。</p>
<p>标准创建方式： var str= new String();  //和java相同</p>
<p>var str= new String;  //js独有的方式</p>
<p>\3. 运算符：与java基本一致<br>比较运算符：== 逻辑等。 仅仅对比值<br>                === 全等。对比值并且对比类型<br>逻辑运算符：没有&amp; |  只有三个</p>
<p>&amp;&amp;：and</p>
<p>||：  or</p>
<p>!：  not</p>
<p>\4. 正则对象<br>RegExp对象的创建方式：</p>
<p>var reg= new RegExp(“表达式”);  （开发中基本不用）</p>
<p>var reg=/^表达式$/；  直接量（开发中常用）</p>
<p>直接量中存在边界，即^代表开始，$代表结束</p>
<p>直接量方式的正则是对象，不是字符串，别用引号</p>
<p>使用正则对象：方法：compile：编译正则表达式  （不咋用）</p>
<p>exec：检索字符串中指定的值，返回找到的值，并确定其位置 （不咋用）</p>
<p>test方法： 正则对象.test(string);  用来校验字符串是否匹配正则，全部字符匹配返回true，有一个字符不匹配返回false</p>
<p>注意：/表达式/ 普通方式，只要有成立正则的字符存在，就返回true，除非全部字符不符合正则，返回false（检查不严格，适合字符串查找、替换）</p>
<p>/^表达式$/ 直接量方式，只要有无法成立正则表达式的字符存在，就返回false（检查严格，适合表单校验）</p>
<p>\5. JS数组对象<br>特性：JS数组可以看作java中的ArrayList集合。</p>
<p>数组中的每一个成员都没有类型限制，即可以存放任意类型。</p>
<p>数组的长度可以自动修改</p>
<p>四种创建方式：</p>
<p>（1）var arr=[1,2,3,”a”,true];  常用的js数组  （常用）</p>
<p>（2）var arr=new Array();  创建一个数组对象，数组长度默认为0 （常用）</p>
<p>（3）var arr= new Array(4);  数组长度是4，相当于开辟了长度为4的空间，每个元素是undefined。</p>
<p>（4）var arr =new Array(“a”,1,true);创建了一个数组，长度为3，元素是“a”,1,true<br>常用属性：length  设置或返回数组中元素的数目</p>
<p>常用方法： join（string）  把数组的所有元素放入一个字符串。元素通过指定的分隔符string进行分隔 （对原来的数组无影响）</p>
<p>pop（） 删除并返回数组的最后一个元素（原先数组无了）</p>
<p>push（新元素） 向数组的末尾添加一个或更多的元素，并返回新的长度（原先数组无了）</p>
<p>reverse（） 颠倒数组中元素的顺序（物理翻转，就是把元素下标进行互换）该方法的返回值就是翻转成功的新数组。（会对当前的数组进行操作，原来的数组无了）</p>
<p>\6. 全局函数(global)</p>
<p>undefined属于全局函数的属性，但是我们在使用的时候不用加global.undefined<br>（1）执行： eval（string）  计算JavaScript字符串，并把它作为脚本代码来执行</p>
<p>作用：增强程序的扩展性</p>
<p>注意：只可以传递原始数据类型string，传递string对象无作用。</p>
<p>（2）编码和解码</p>
<p>URL/URI编码：中文和特殊符号  %十六进制</p>
<p>作用：保证数据传递的完整性</p>
<p>encodeURI（string）  把字符串进行URI编码，返回值就是编码后的结果</p>
<p>decodeURI（string）  解码某个编码的URI</p>
<p>（3）URI和URL的区别</p>
<p>URI是统一资源标识符  标识资源详细名称  必须包含资源名</p>
<p>URL是统一资源定位器  定位资源的网络位置  必须包含http：//</p>
<p>资源：就是可以通过浏览器访问的信息统称为资源（图片、文本、HTML、CSS等等）</p>
<p>（4）字符串转数字</p>
<p>parseInt(string)  解析一个字符串并返回一个整数  小数点后面部分直接去掉</p>
<p>parseFloat(string)  解析一个字符串并返回一个浮点数</p>
<p>注意：如果字符串的某个字符从字面值上无法转为数字，那么从该字符开始停止转换，仅返回前面正确的转换值。</p>
<p>如果字符串的第一个字符就无法从字面值上转为数字，那么停止转换，返回NaN（Not A Number，一个数字类型的标识，表示不是一个正确的数字）</p>
<p>\7. 自定义函数/自定义方法</p>
<p>函数：如果一段代码需要被重复编写使用，那么我们为了方便统一编写使用，可以将其封装进一个函数（方法）中</p>
<p>作用：增强代码的复用性</p>
<p>格式： function 方法名(参数列表){</p>
<p>函数体</p>
<p>}</p>
<p>注意：JavaScript函数定义必须用小写的function</p>
<p>无需定义返回值类型，在function后面直接写方法名</p>
<p>参数的定义无需使用var关键字，否则会报错</p>
<p>函数体中，return可以不写，也可以return具体值，也可以仅仅写return</p>
<p>JavaScript函数调用执行完毕一定有返回值，值及类型根据return决定，如果未return具体值，则返回值为undefined</p>
<p>函数如果同名，JavaScript中不存在方法重载，只有方法相互覆盖，所以最后定义的函数覆盖之前的定义。</p>
<p>再调用时仅仅根据方法名来调用函数，即使实际参与函数与形参不匹配，也不会影响正常调用。</p>
<p>如果实参未赋值，就使用默认值undefined</p>
<p>\8. 自定义对象</p>
<p>①function构造函数：JavaScript中的引用数据类型都是对象，而对象在JavaScript中可以用函数来表示。（相当于java中创建某个class类）</p>
<p>无形参格式：function 对象名(){</p>
<p>函数体</p>
<p>}</p>
<p>例如：</p>
<p>声明一个Person对象：</p>
<p>function Person(){</p>
<p>this.name=”swx”;  // this 就是当前的Person对象</p>
<p>this.age=”23”;   //name  age是对象的属性</p>
<p>}</p>
<p>var p=new Person();  //创建了一个Person对象</p>
<p>alert(p.name);</p>
<p>为属性赋值：</p>
<p>（1）构造参数赋值：function Person(n,a){</p>
<p>this.name=n;  </p>
<p>this.age=a;  </p>
<p>}</p>
<p>var p=new Person(“swx”,”23”);</p>
<p>（2）创建对象后，调用属性进行赋值</p>
<p>p.name=”sss”;</p>
<p>属性定义方式：</p>
<p>（1）this关键字，在对象声明定义阶段，定义一个属性</p>
<p>（2）创建对象后，使用对象.属性 方式来动态定义属性</p>
<p>p.sex=”男”;  //为Person对象声明了一个新的属性sex并赋值为男</p>
<p>应用场景：适用于对象构建及代码复用</p>
<p>②对象直接量</p>
<p>开发中可以用一种简单的方式直接创建自定义的JavaScript对象，这种方式称为“对象直接量”</p>
<p>格式： var 对象名 = {属性名1：“属性值1”，属性名2：“属性值2”，属性名3：“属性值3”……};  //  不一定非要字符串了 可以直接数字18</p>
<p>该方式直接创建出实例对象，无需构建函数，无需再new创建实例对象，直接使用即可。</p>
<p>适用场景：适用于快速创建实例对象及数据封装</p>
<p>BOM对象 </p>
<p>BOM（Browser Object Model）浏览器对象模型</p>
<p>浏览器：IE、火狐、谷歌、360等任意浏览器</p>
<p>作用：用来执行浏览器的相关操作（例如：浏览器的地址，弹出消息等）</p>
<p>一般情况下，window代表了BOM对象</p>
<p>window对象是JavaScript的内置对象，使用window对象调用方法时可以省略window不写</p>
<p>（1）消息框</p>
<p>alert()  警告框，用来弹出警告消息 </p>
<p>注意：不同浏览器显示的组件样式不同，我们无需关注</p>
<p>confirm() 确认框 用于告知用户信息并收集用户的选择</p>
<p>有一个返回值，boolean类型</p>
<p>（2）定时器</p>
<p>循环定时器：调用一次就会创建并循环执行一个定时器</p>
<p>格式：setInterval(调用的方法名()，毫秒值);  </p>
<p>会有一个返回值，返回值就是这个定时器的id</p>
<p>取消：clearInterval(id);  取消id的定时器</p>
<p>一次性定时器：调用一次就会创建并执行一个计时器一次</p>
<p>格式：setTimeout(调用的方法名()，毫秒值);</p>
<p>也会有一个返回值，返回值就是这个定时器的id</p>
<p>取消：clearTimeout(定时器ID);  这个id在当前页面要求是唯一的。</p>
<p>（3）location对象</p>
<p>包含浏览器地址栏的信息</p>
<p>常用属性：href  设置或返回完整的URL  （直接调用会返回当前页面的URL，设置href属性=””;浏览器就会跳转到对应的路径，这里可以是html页面，也可以是外网路径，但必须要加https：//）</p>
<p>DOM对象</p>
<p>DOM（Document Object Model）文档对象模型</p>
<p>文档：标记型文档（HTML等）</p>
<p>DOM是将标记型文档中所有内容（标签、文本、属性）都封装成对象</p>
<p>通过操作对象的属性或者方法，来达到操作或者改变HTML展示效果的目的</p>
<p>HTML文件会加载并解析到内存中，会生成一张DOM树</p>
<p>DOM树：</p>
<p>每个标签都会被加载成DOM树上的一个元素节点对象</p>
<p>每个标签的属性会被加载成DOM树上的一个属性节点对象</p>
<p>每个标签的内容体会被加载成DOM树上的一个文本节点对象</p>
<p>整个DOM树，是一个文档节点对象，即DOM对象</p>
<p><em><strong>*一个HTML文档加载到内存中就会形成一个DOM对象*</strong></em></p>
<p>特点：必定会有一个根节点</p>
<p>每个节点都是节点对象</p>
<p>常见的节点关系：父子节点关系</p>
<p>文本节点对象没有子节点（叶子节点）</p>
<p>每个节点都有一个父节点，零到多个子节点</p>
<p>只有根节点没有父节点</p>
<p>获取元素对象的四种方式： document的相关方法，所以要用document调用</p>
<p>getElementById();  通过元素id获取对应元素对象 （可以通过id获取对应的元素对象，如果找不到，返回null）</p>
<p>getElementsByName();  通过元素的****name属性****获取符合要求的所有元素</p>
<p>getElementsByTagName();  通过元素的****元素名属性（标签名）****获取符合要求的所有元素</p>
<p>getElementsByClassName();  通过元素的****class属性****获取符合要求的所有元素</p>
<p>注意事项：</p>
<p>获取某个或某些元素节点对象，必须保证元素节点对象先被加载到内存中。（这就是为什么script标签为什么推荐放在</body>之前的原因，这就可以保证元素都被加载完了，再运行script标签时就能找到相应的标签）</p>
<p>元素对象常见属性：</p>
<p>value: 可以修改元素的值</p>
<p>元素对象.value  获取元素对象的value属性值</p>
<p>元素对象.value=属性值  设置元素对象的value属性值</p>
<p>className： 可以修改元素的样式</p>
<p> //本来是class，但是class是关键字，所以要用className</p>
<p>元素对象.className  获取元素对象的class属性值</p>
<p>元素对象.className=属性值  设置元素对象的class属性值</p>
<p>checked：  可以修改单选/复选的选中与否</p>
<p>元素对象.checked  获取元素对象的checked属性值</p>
<p>元素对象.checked=属性值  设置元素对象的checked属性值</p>
<p>HTML中checked=”checked”,JavaScript中返回true，false</p>
<p>innerHTML：  可以操作元素的内容体</p>
<p>元素对象.innerHTML  获取元素对象的内容体</p>
<p>元素对象.innerHTML=值  设置元素对象的内容体</p>
<p>追加内容体信息：  元素对象.innerHTML+=值</p>
<p>JS事件</p>
<p>通常鼠标或热键的动作称之为事件（Event）。</p>
<p>作用：通过JS事件，我们可以完成页面的指定特效</p>
<p>JS事件驱动机制：</p>
<p>事件源：专门产生事件的组件 </p>
<p>事件：由事件源所产生的动作或者事情 </p>
<p>监听器：专门处理事件源所产生的事件</p>
<p>注册/绑定监听器：让监听器时刻监听事件源是否有指定事件产生，如果事件源产生指定事件，则调用监听器处理</p>
<p>JS常见事件：  一般都是放在标签中，事件=“方法()”</p>
<p>\1. 点击事件（onclick）：由鼠标或热键点击元素组件时触发</p>
<p>\2. 焦点事件</p>
<p>焦点：即整个页面的注意力。  默认一个正常页面最多仅有一个焦点 （例如：文本框中闪烁的小竖线）</p>
<p>通常焦点也能反映出用户目前的关注点，或者正在操作的组件。</p>
<p>获取焦点事件（onfocus）：当元素组件获取焦点时触发</p>
<p>失去焦点事件（onblur）：元素组件失去焦点时触发</p>
<p>\3. 域内容改变事件（onchange）：元素组件的值发生改变时触发</p>
<p>\4. 加载完毕事件（onload）：元素组件加载完毕时触发</p>
<p>//以前有推荐script代码放在最后是因为要元素标签加载完在调取，现在有了这个方法，也可以让元素组件加载完再调取。</p>
<p>\5. 表单提交事件（onsubmit）：表单的提交按钮被点击时触发</p>
<p>注意：该事件需要返回boolean类型的值来执行  提交/阻止表单数据的操作</p>
<p>事件得到true，提交表单数据</p>
<p>事件得到false，阻止表单数据提交</p>
<p>在form标签处写。</p>
<p>用于表单的校验，也可以控制表单的提交  onsubmit=”return run1()” run1方法中必须要有返回值（可以进行表单校验，符合返回true，会提交表单；不符合返回false，表单提交会被阻止）</p>
<p>\6. 键位弹起事件（onkeyup）：在组件中输入某些内容时，键盘键位弹起时触发该事件（可以进行校验）</p>
<p>\7. 常用鼠标事件</p>
<p>鼠标移入事件（onmouseover）：鼠标移入某个元素组件时触发</p>
<p>鼠标移出事件（onmouseout）：鼠标移出某个元素组件时触发</p>
<p>JS事件的两种绑定方式：</p>
<p>\1. 元素事件句柄绑定：将事件以元素属性的方式写到标签内部，进而绑定对应函数</p>
<p>//可以绑定一个或者多个 无参、带参函数，如果是带参的话，外面是“”里面是’’。多个函数时，函数之间用“ ， ”隔开，顺序就是执行顺序。</p>
<p>优点：开发快捷；传参方便；可以绑定多个函数</p>
<p>缺点：JS和HTML代码高度糅合在一起，不利于多部门的项目开发维护</p>
<p>\2. DOM绑定方式：使用DOM的属性方式绑定事件</p>
<p>两种：（1）对象.事件属性  一次只能绑定一个函数，不能传递参数</p>
<p>window.onload=run1；</p>
<p>（2）匿名函数  可以绑定多个函数，可以传递参数</p>
<p>window.onload=function(){</p>
<p>//这个方法是页面加载的方法，可以在这里调取此页面的所有元素，获得元素后就可以继续使用匿名函数调取方法</p>
<p>run1();</p>
<p>run2();</p>
<p>}</p>
<p>优点：使得HTML代码和JS代码完全分离</p>
<p>缺点：不能传递参数；一个事件只能绑定一个函数。解决：匿名函数就可以，匿名函数内部就可以绑定多个函数</p>
<h3 id="Window-setInterval-方法"><a href="#Window-setInterval-方法" class="headerlink" title="Window setInterval() 方法"></a>Window setInterval() 方法</h3><p>setInterval() 方法可按照指定的周期（以毫秒计）来调用函数或计算表达式。</p>
<p>setInterval() 方法会不停地调用函数，直到 <a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/met-win-clearinterval.html">clearInterval()</a> 被调用或窗口被关闭。由 setInterval() 返回的 ID 值可用作 clearInterval() 方法的参数</p>
<p>如果你只想执行一次可以使用 <a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/met-win-settimeout.html">setTimeout()</a> 方法</p>
<h3 id="Window-clearInterval-方法"><a href="#Window-clearInterval-方法" class="headerlink" title="Window clearInterval() 方法"></a>Window clearInterval() 方法</h3><p>显示当前时间 ( setInterval() 函数会每秒执行一次函数，类似手表)。使用 clearInterval() 来停止执行:</p>
<p>clearInterval() 方法可取消由 setInterval() 函数设定的定时执行操作。</p>
<p>clearInterval() 方法的参数必须是由 setInterval() 返回的 ID 值。</p>
<p><strong>注意:</strong> 要使用 clearInterval() 方法, 在创建执行定时操作时要使用全局变量：</p>
<h3 id="if问题"><a href="#if问题" class="headerlink" title="if问题"></a>if问题</h3><p>在 JavaScript 里，不为空 “” 的字符串、不为 0 的数字、不为 null 的对象、不为 undefined 的对象属性、布尔型 true，单独作为判断式里的一个表达式时 JavaScript 通通认定为真（true），反之则为假（false）</p>
<p>原型和原型链</p>
<p>一、原型<br>①所有引用类型都有一个<code>__proto__</code>(隐式原型)属性，属性值是一个普通的对象<br>②所有函数都有一个prototype(原型)属性，属性值是一个普通的对象<br>③所有引用类型的<code>__proto__</code>属性指向它构造函数的prototype</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var a &#x3D; [1,2,3];</span><br><span class="line">a.__proto__ &#x3D;&#x3D;&#x3D; Array.prototype; &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>


<p>二、原型链<br>当访问一个对象的某个属性时，会先在这个对象本身属性上查找，如果没有找到，则会去它的<code>__proto__</code>隐式原型上查找，即它的构造函数的prototype，如果还没有找到就会再在构造函数的prototype的<code>__proto__</code>中查找，这样一层一层向上查找就会形成一个链式结构，我们称为原型链。</p>
<p>二、原型链<br>当访问一个对象的某个属性时，会先在这个对象本身属性上查找，如果没有找到，则会去它的__proto__隐式原型上查找，即它的构造函数的prototype，如果还没有找到就会再在构造函数的prototype的__proto__中查找，这样一层一层向上查找就会形成一个链式结构，我们称为原型链。</p>
<p>举例，有以下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function Parent(month)&#123;</span><br><span class="line">    this.month &#x3D; month;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var child &#x3D; new Parent(&#39;Ann&#39;);</span><br><span class="line"></span><br><span class="line">console.log(child.month); &#x2F;&#x2F; Ann</span><br><span class="line"></span><br><span class="line">console.log(child.father); &#x2F;&#x2F; undefined</span><br></pre></td></tr></table></figure>

<p>在child中查找某个属性时，会执行下面步骤：</p>
<p><img src="/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/20180620134143385" alt="这里写图片描述"></p>
<p>访问链路为：</p>
<p><img src="/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/20180620155400807" alt="这里写图片描述"></p>
<p>①一直往上层查找，直到到null还没有找到，则返回undefined<br>②<code>Object.prototype.__proto__</code> === null<br>③所有从原型或更高级原型中的得到、执行的方法，其中的this在执行时，指向当前这个触发事件执行的对象</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/" data-id="ckq1xbdss004upwwd5xyv8i0c" data-title="网页前端之JS" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-10.7.关于重构" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:16:25.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/">关于重构</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="什么是重构？"><a href="#什么是重构？" class="headerlink" title="什么是重构？"></a><strong>什么是重构？</strong></h1><p>Martin Fowler曾出版了两本有关重构的书籍，他认为：</p>
<p>重构指的是，在不改变代码的外部行为，只改善其内部结构的方式下，修改软件系统的过程。重构是一种有条理的清理代码的方式，可以最大程度地减少引入bug的机会。本质上，重构意味着在代码编写完成后，改进代码的设计。</p>
<h1 id="重构有什么好处？"><a href="#重构有什么好处？" class="headerlink" title="重构有什么好处？"></a><strong>重构有什么好处？</strong></h1><p>首先，重构可以将混乱、不正确和/或重复的代码转换成整洁的代码。它可以解决多位开发人员协同工作时可能引发的代码标准化问题。重构可以提高可读性，改善源代码的可维护性以及整体结构和功能。重构可以使代码更易于扩展和添加新功能。删除不必要的代码（比如重复代码）可以减少代码所使用的内存，并加快执行速度。 </p>
<p>例如，在2014年，Kickstarter的工程师面临着一个巨大的挑战：由于用户数量呈指迅速增长，导致查询性能下降。为此，他们将MySQL查询重构为Redis，减少了100毫秒的加载时间，从而减少了加载时间的差异并提高了网站的整体速度。</p>
<h1 id="技术负债与重构"><a href="#技术负债与重构" class="headerlink" title="技术负债与重构"></a><strong>技术负债与重构</strong></h1><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAughAuEz9WJKmOEboib3KY1y335WhibibfKKEic84Md2OlBMT0UxxICJs15MOBWP5zulrkg2x6icPO3ZqtA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>简而言之，重构是消除或减少技术负债的一种方式。</p>
<p>重构对于长期维持的代码质量、安全性和性能至关重要。如果没有定期的重构，开发人员就会承受巨大的技术负债。重构代码的机会越少，技术负债就会越多，开发新功能也会变得越来越难。</p>
<h1 id="重构的指标"><a href="#重构的指标" class="headerlink" title="重构的指标"></a><strong>重构的指标</strong></h1><p>我们可以通过各种指标，衡量重构代码的优先级。在指标的帮助下，我们可以有条不紊地计划重构，每一次都专心完成最重要的任务。</p>
<p>此外，你需要通过指标来衡量重构的效果。我们不仅需要重构低效的代码，而且还可以通过修改低效代码增加价值。为了获得真正的价值，你需要进行测试，包括单元测试和功能测试。除此之外，还有一些其他方面的指标，比如发现的bug数减少，以及降低循环复杂性（重构的目标是降低复杂性）。高度复杂的方法或功能（比如超过350行的方法或功能）就是良好的重构对象。</p>
<p>此外，我们还需要考虑，如何将重构融合到更广泛的团队目标或有关工作流和任务的里程碑中。</p>
<h1 id="代码重构示例"><a href="#代码重构示例" class="headerlink" title="代码重构示例"></a><strong>代码重构示例</strong></h1><p>代码重构的示例非常多，为了简洁起见，我们介绍以下几种：</p>
<p><strong>红色，绿色和重构</strong></p>
<p>重构与单元测试息息相关。最常见的形式之一就是敏捷方法固有的测试驱动开发（Test-Driven Development，即TDD）。你可以在编写代码之前先编写测试。从本质上来说，应该由测试来驱动程序，说明代码应该执行的操作。</p>
<p>红色，绿色和重构是测试驱动开发的一个示例：</p>
<ul>
<li>红色：编写没有实现代码的测试套件，必然会失败。</li>
<li>绿色：编写实现代码，刚刚好可以通过测试套件。</li>
<li>重构：寻找优化和改进代码的方法。</li>
</ul>
<p><strong>提取方法（又名提取函数）</strong></p>
<p>将代码片段从现有方法移到新方法中，而新方法的名称明确说明了其功能。这种技术有助于降低复杂性并提高代码的可读性。</p>
<p><strong>提取变量</strong> </p>
<p>如果遇到难以理解的表达式，或者该表达式在整个代码中重复了多次，则可以通过提取变量重构，将表达式或其中一部分放入一个复杂度较低且更易于理解的变量中。这样可以减少复杂性和代码重复。</p>
<p><strong>按抽象建立分支</strong></p>
<p>按抽象建立分支可以逐步对软件系统进行大规模地修改，而你则可以一边修改代码，一边定期发布系统。这种方法可以降低在分支上重构代码的复杂性，避免在合并代码时出现问题。</p>
<p><strong>方法组合</strong></p>
<p>代码过长不便于理解，而且也不方便修改。方法组合指的是一系列的操作，将方法改成顺序结构并删除重复的代码。这些操作包括内联方法、内联模板、用查询代替模板、拆分临时变量以及删除对参数的赋值等。</p>
<h1 id="重构代码的工具"><a href="#重构代码的工具" class="headerlink" title="重构代码的工具"></a><strong>重构代码的工具</strong></h1><p>你需要专业的重构工具吗？Martin Fowler表示，自动化的工具有帮助但不是必需的。他指出：</p>
<p>“许多语言都有IDE，可以自动执行许多常见的重构。这些是非常有价值的工具，可以帮助我更快地重构代码。但是，这些工具不是必不可少的，我经常在没有工具支持的情况下编写程序，每次只迈出一小步，并通过频繁的测试来发现错误。”</p>
<p>许多开发环境都可以自动化重构，一些常见的重构工具包括：</p>
<ul>
<li>Visual studio intellicode</li>
<li>Eclipse IDE</li>
<li>Spring Tool Suite 4</li>
<li>Rider</li>
<li>IntelliJ IDEA</li>
<li>SonarQube</li>
</ul>
<h1 id="重构与工程经理的难题"><a href="#重构与工程经理的难题" class="headerlink" title="重构与工程经理的难题"></a><strong>重构与工程经理的难题</strong></h1><p>为了解决引发重构需求的问题，首先我们需要弄清楚公司的运营方式。在着手重构之前，请先回答下列几个问题：</p>
<ul>
<li>哪些任务最优先？</li>
<li>开发的速度如何？</li>
<li>开发人员是否感觉到了快速交付代码的压力？</li>
<li>解决技术负债的流程都有哪些？</li>
<li>实施了哪些类型的代码审核？</li>
<li>团队成员是否具备适当的重构技能？</li>
<li>公司的文档标准是什么？</li>
</ul>
<p>如果不解决引发重构需求的根本问题，那么问题只会愈演愈糟。</p>
<h1 id="高级管理层对重构的支持"><a href="#高级管理层对重构的支持" class="headerlink" title="高级管理层对重构的支持"></a><strong>高级管理层对重构的支持</strong></h1><p>你们公司可能并没有在基础设施和维护上投入太多资金。</p>
<p>可能会有人说，应该将花费在重构上的时间投入到新功能开发上。</p>
<p>但是，我们仍然应该看一看重构的好处，以及它们与工作流程、客户、收入和业务增长的关系。重构得当可以改善代码，交付有效更新以及急需的功能，从而吸引新客户和回头客。即使在成功发布产品之后，软件公司也可以通过这种方式保持竞争力。 </p>
<p>为了获取高层管理的支持，还有一个更好的方法，即量化团队当前花费在修复原始代码中的错误或bug上的时间。具体一点，比如每天一个小时？每天两个小时？持续记录一个星期，你就会惊讶地发现原来团队每年需要花费数周或数月时间来修复遗留的代码。</p>
<h1 id="团队支持与重构：一个Sprint还是马拉松？"><a href="#团队支持与重构：一个Sprint还是马拉松？" class="headerlink" title="团队支持与重构：一个Sprint还是马拉松？"></a><strong>团队支持与重构：一个Sprint还是马拉松？</strong></h1><p>很难在团队内部开展重构工作？提及重构就会哀声载道？顺利开展重构的最重要的标志就是有计划、有目标以及有文档记录的行动。Ron Jeffries（极限编程的三大创始人之一）将重构比喻为清道：</p>
<p>“花些时间清出一条道来，那么下一次我们就可以直奔我们要构建的下一个功能，而无需绕过杂草和灌木丛。”</p>
<p>但是，他强调指出，糟糕的代码需要花费很长的时间来清理，而且重构应该经过深思熟虑：</p>
<p>“如果我们只改进手头的代码，而忽略目前不涉及的代码，那么以后必然会走回头路。”</p>
<p>在同一个Sprint中，我们经常发现后面的功能用到了我们之前清理过的代码。我们就会立即享受重构的好处。如果我们等积攒了一堆技术负债，再开始重构，那么我们享受的好处会延迟，甚至可能会在一些没大有用的地方浪费精力。</p>
<p>产品工程师兼首席技术官Andreas Klinger是Fix-it Friday的粉丝，他表示：</p>
<p>“Fix-it Friday的规则很简单：除非当前的项目十万火急，否则周五的工作就应该是重构。让工程师选择他们的工作。我们不应该因为微观管理而抹杀这种乐趣。有些人会尝试新的库。有些人会修复积压的bug。这两种工作都很好。我们尝试鼓励大家平衡这些任务。”</p>
<p>无论采用哪种方法，你都需要慎重思考，询问团队哪些代码最影响他们的效率。</p>
<ul>
<li>修复哪些代码对你的其他代码产生的影响最大？</li>
<li>解决哪些问题得到的回报最多？</li>
</ul>
<p>你不太可能找到一整块专门的时间来重构代码，重构代码必然会牺牲你花费在其他项目上的时间，但请不要低估定期坚持开展小范围的重构带来的影响。聚沙成塔，集腋成裘，最终你会获得丰厚的回报。</p>
<h1 id="文档与重构"><a href="#文档与重构" class="headerlink" title="文档与重构"></a><strong>文档与重构</strong></h1><p>标准化命名约定之类的文档可以让每个人都达成共识。Xerox的高级开发人员的研究发现，缺乏文档是重构最大的难题之一。</p>
<p>记录重构的工作内容不仅可以记录花费的时间，而且还可以为将来的团队成员提供说明。</p>
<p>最后，你还通过文档记录下自己的成功：重构带来的最大成功是什么？这些可以成为代码审核的考虑因素吗？</p>
<p><strong>需求案例</strong></p>
<p><strong>项目需求</strong></p>
<p>项目开发阶段，有一个关于下单发货的需求：如果今天下午 3 点前进行下单，那么发货时间是明天，如果今天下午 3 点后进行下单，那么发货时间是后天，如果被确定的时间是周日，那么在此时间上再加 1 天为发货时间。</p>
<p><strong>思考与重构</strong></p>
<p>我相信这个需求看似很简单，无论怎么写都可以完成。</p>
<p>很多人可能看到这个需求，就动手开始写 Calendar 或 Date 进行计算，从而完成需求。</p>
<p>而我给的建议是，仔细考虑如何写代码，然后再去写，不是说所有的时间操作都用 Calendar 或 Date 去解决，一定要看场景。</p>
<p>对于时间的计算我们要考虑 joda-time 这种类似的成熟时间计算框架来写代码，它会让代码更加简洁和易读。</p>
<p>请读者先考虑这个需求如何用 Java 代码完成，或先写一个你觉得完成这个代码的思路，再来看我下边的代码，这样，你的收获会更多一些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">final DateTime DISTRIBUTION_TIME_SPLIT_TIME &#x3D; new DateTime().withTime(15,0,0,0);</span><br><span class="line">private Date calculateDistributionTimeByOrderCreateTime(Date orderCreateTime)&#123;</span><br><span class="line">    DateTime orderCreateDateTime &#x3D; new DateTime(orderCreateTime);</span><br><span class="line">    Date tomorrow &#x3D; orderCreateDateTime.plusDays(1).toDate();</span><br><span class="line">    Date theDayAfterTomorrow &#x3D; orderCreateDateTime.plusDays(2).toDate();</span><br><span class="line">    return orderCreateDateTime.isAfter(DISTRIBUTION_TIME_SPLIT_TIME) ? wrapDistributionTime(theDayAfterTomorrow) : wrapDistributionTime(tomorrow);</span><br><span class="line">&#125;</span><br><span class="line">private Date wrapDistributionTime(Date distributionTime)&#123;</span><br><span class="line">    DateTime currentDistributionDateTime &#x3D; new DateTime(distributionTime);</span><br><span class="line">    DateTime plusOneDay &#x3D; currentDistributionDateTime.plusDays(1);</span><br><span class="line">    boolean isSunday &#x3D; (DateTimeConstants.SUNDAY &#x3D;&#x3D; currentDistributionDateTime.getDayOfWeek());</span><br><span class="line">    return isSunday ? plusOneDay.toDate() : currentDistributionDateTime.toDate() ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读这段代码的时候，你会发现，我将判断和有可能出现的不同结果都当做一个变量，最终做一个三目运算符的方式进行返回，这样的优雅和可读性显而易见，当然这样的代码不是一蹴而就的，我优化了 3 遍产生的以上代码。读者可根据自己的代码和我写的代码进行对比。</p>
<p><strong>提高方法</strong></p>
<p>如果你做了 3 年+的程序员，我相信像如上这样的需求，你很轻松就能完成，但是如果你想做一个会写 Java 的程序员，就好好的思考和重构代码吧。</p>
<p>写代码就如同写字一样，同样的字，大家都会写，但是写出来是否好看就不一定了。如果想把程序写好，就要不断的思考和重构，敢于尝试，敢于创新，不要因循守旧，一定要做一个优秀的 Java 程序员。</p>
<p>提高代码水平最好的方法就是有条理的重构！(注意：是有条理的重构)</p>
<p><strong>设计模式</strong></p>
<p>设计模式就是工具，而不是提现你是否是高水平程序员的一个指标。</p>
<p>我经常会看到某一个程序员兴奋的大喊，哪个程序哪个点我用到了设计模式，写的多么多么优秀，多么多么好。我仔细去翻阅的时候，却发现有很多是过度设计的。</p>
<p><strong>业务驱动技术 or 技术驱动业务</strong></p>
<p>业务驱动技术 or 技术驱动业务 ？ 其实这是一个一直在争论的话题，但是很多人不这么认为，我觉得就是大家不愿意承认罢了。我来和大家大概分析一下作为一个 Java 程序员，我们应该如何判断自己所处于的位置.</p>
<p><strong>业务驱动技术：</strong>如果你所在的项目是一个收益很小或者甚至没有收益的项目，请不要搞其他创新的东西，不要驱动业务要如何如何做，而是要熟知业务现在的痛点是什么？如何才能帮助业务盈利或者让项目更好，更顺利的进行。</p>
<p><strong>技术驱动业务：</strong>如果你所在的项目是一个很牛的项目，比如淘宝这类的项目，我可以在满足业务需求的情况下，和业务沟通，使用什么样的技术能更好的帮助业务创造收益，比如说下单的时候要进队列，可能几分钟之后订单状态才能处理完成，但是会让用户有更流畅的体验，赚取更多的访问流量，那么我相信业务愿意被技术驱动，会同意订单的延迟问题，这样便是技术驱动业务。</p>
<p>我相信大部分人还都处于业务驱动技术的方向吧。</p>
<p>所以你既然不能驱动业务，那就请拥抱业务变化吧。</p>
<p><strong>代码设计</strong></p>
<p>一直在做 Java 后端的项目，经常会有一些变动，我相信大家也都遇到过。</p>
<p>比如当我们写一段代码的时候，我们考虑将需求映射成代码的状态模式，突然有一天，状态模式里边又添加了很多行为变化的东西，这时候你就挠头了，你硬生生的将状态模式中添加过多行为和变化。</p>
<p>慢慢的你会发现这些状态模式，其实更像是一簇算法，应该使用策略模式，这时你应该已经晕头转向了。</p>
<p>说了这么多，我的意思是，只要你觉得合理，就请将状态模式改为策略模式吧，所有的模式并不是凭空想象出来的，都是基于重构。</p>
<p>Java 编程中没有银弹，请拥抱业务变化，一直思考重构，你就有一个更好的代码设计!</p>
<p><strong>你真的优秀吗？</strong></p>
<p>真不好意思，我取了一个这么无聊的标题。</p>
<p>国外流行一种编程方式，叫做结对编程，我相信国内很多公司都没有这么做，我就不在讲述结对编程带来的好处了，其实就是一边 code review，一边互相提高的一个过程。既然做不到这个，那如何让自己活在自己的世界中不断提高呢？</p>
<p>“平时开发的时候，做出的代码总认为是正确的，而且写法是完美的。”，我相信这是大部分人的心声，还回到刚刚的问题，如何在自己的世界中不断提高呢？</p>
<p>答案就是:</p>
<ol>
<li>多看成熟框架的源码</li>
<li>多回头看自己的代码</li>
<li>勤于重构</li>
</ol>
<p>你真的优秀吗？ 如果你每周都完成了学习源码，回头看自己代码，然后勤于重构，我认为你就真的很优秀了。</p>
<p>即使也许你只是刚刚入门，但是一直坚持，你就是一个真的会写java代码的程序员了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/" data-id="ckq1xbdra000ipwwdafxy8ywd" data-title="关于重构" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-13.2.MyBatis-Plus" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/13.2.MyBatis-Plus/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:06:36.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/13.2.MyBatis-Plus/">MyBatis-Plus</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>创建表</strong></p>
<p>创建user表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS user;</span><br><span class="line">CREATE TABLE user</span><br><span class="line">(</span><br><span class="line">id BIGINT(20) NOT NULL COMMENT &#39;主键ID&#39;,</span><br><span class="line">name VARCHAR(30) NULL DEFAULT NULL COMMENT &#39;姓名&#39;,</span><br><span class="line">age INT(11) NULL DEFAULT NULL COMMENT &#39;年龄&#39;,</span><br><span class="line">email VARCHAR(50) NULL DEFAULT NULL COMMENT &#39;邮箱&#39;,</span><br><span class="line">PRIMARY KEY (id)</span><br><span class="line">);</span><br><span class="line">INSERT INTO user (id, name, age, email) VALUES</span><br><span class="line">(1, &#39;Jone&#39;, 18, &#39;test1@baomidou.com&#39;),</span><br><span class="line">(2, &#39;Jack&#39;, 20, &#39;test2@baomidou.com&#39;),</span><br><span class="line">(3, &#39;Tom&#39;, 28, &#39;test3@baomidou.com&#39;),</span><br><span class="line">(4, &#39;Sandy&#39;, 21, &#39;test4@baomidou.com&#39;),</span><br><span class="line">(5, &#39;Billie&#39;, 24, &#39;test5@baomidou.com&#39;);</span><br></pre></td></tr></table></figure>

<p>注意：– 真实开发中往往都会有这四个字段，version（乐观锁）、deleted（逻辑删除）、gmt_create（创建时间）、gmt_modified（修改时间）</p>
<h2 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a><strong>导入依赖</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 数据库驱动 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!-- lombok --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!-- mybatis-plus --&gt;</span><br><span class="line">&lt;!-- mybatis-plus 是自己开发，并非官方的！--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;3.0.5&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>注意：尽量不要同时导入 mybatis 和 mybatis-plus！避免版本的差异造成无法预知的问题。</p>
<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a><strong>连接数据库</strong></h2><p><strong>创建application.yml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">  datasource:</span><br><span class="line"># 驱动不同 mysql 5  com.mysql.jdbc.Driver</span><br><span class="line"># mysql 8  com.mysql.cj.jdbc.Driver、需要增加时区的配置serverTimezone&#x3D;GMT%2B8</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis_plus?useSSL&#x3D;false&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;serverTimezone&#x3D;GMT%2B8</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br></pre></td></tr></table></figure>

<h2 id="业务代码"><a href="#业务代码" class="headerlink" title="业务代码"></a><strong>业务代码</strong></h2><p>实体类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class User &#123;</span><br><span class="line">  private Long id;</span><br><span class="line">  private String name;</span><br><span class="line">  private Integer age;</span><br><span class="line">  private String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line">import com.kuang.pojo.User;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line">&#x2F;&#x2F; 在对应的Mapper上面继承基本的类 BaseMapper</span><br><span class="line">@Repository &#x2F;&#x2F; 代表持久层</span><br><span class="line">public interface UserMapper extends BaseMapper&lt;User&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; 所有的CRUD操作都已经编写完成了</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意点，我们需要在主启动类上去扫描我们的mapper包下的所有接口 @MapperScan(“com.kwhua.mapper”)</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class MybatisPlusApplicationTests &#123;</span><br><span class="line">  &#x2F;&#x2F; 继承了BaseMapper，所有的方法都来自己父类</span><br><span class="line">  &#x2F;&#x2F; 我们也可以编写自己的扩展方法！</span><br><span class="line">  @Autowired</span><br><span class="line">  private UserMapper userMapper;</span><br><span class="line">  @Test</span><br><span class="line">  void contextLoads() &#123;</span><br><span class="line">    &#x2F;&#x2F; 参数是一个 Wrapper ，条件构造器，这里我们先设置条件为空，查询所有。</span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectList(null);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有数据输出</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNd39mhfXyvAy8u03NdNp1NAgCmCEu5xfzypoCFL4HacsnQVdibOTuMsw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a><strong>配置日志</strong></h2><p>我们所有的sql现在是不可见的，我们希望知道它是怎么执行的，所有我们要配置日志的输出 application.yml文件添加日志配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#配置日志</span><br><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br></pre></td></tr></table></figure>

<p>查看执行sql的日志信息</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNWAtgIoypYicbSibbbermgJwKE4NqZW8ibuRadvia1JT3drRFekkHW8z31A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Mybatis-plus的CRUD</p>
<p><strong>插入操作</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 测试插入</span><br><span class="line">    @Test</span><br><span class="line">    public void testInsert()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setName(&quot;kwhua_mybatis-plus_insertTest&quot;);</span><br><span class="line">        user.setAge(15);</span><br><span class="line">        user.setEmail(&quot;310697723@qq.com&quot;);</span><br><span class="line"></span><br><span class="line">        int result &#x3D; userMapper.insert(user); &#x2F;&#x2F; 帮我们自动生成id</span><br><span class="line">        System.out.println(result); &#x2F;&#x2F; 受影响的行数</span><br><span class="line">        System.out.println(user); &#x2F;&#x2F; 看到id会自动填充。&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNnzeO55n0wiaQpFIWIb2Q6GiccEmZbAdViaW59zoj74USUSibtbS8iaATicFg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>看到id会自动填充。数据库插入的id的默认值为：全局的唯一id</p>
<p><strong>主键生成策略</strong></p>
<p>1）主键自增 1、实体类字段上 @TableId(type = IdType.AUTO)</p>
<p>2、数据库id字段设置为自增！</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNJVYEX7ggBr7R68sD4CMmwX6KWEpicouS367k5Wx32ZByIHAAknXTQ5g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>3、再次测试（可以看到id值比上次插入的大1）id的生成策略源码解释</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNnPPia9sbGUd7U5eHHSicSoeq304ibYvWuEbkqI0a6JOfPpxChRMK85cww/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public enum IdType &#123;</span><br><span class="line">  AUTO(0), &#x2F;&#x2F; 数据库id自增</span><br><span class="line">  NONE(1), &#x2F;&#x2F; 未设置主键</span><br><span class="line">  INPUT(2), &#x2F;&#x2F; 手动输入</span><br><span class="line">  ID_WORKER(3), &#x2F;&#x2F; 默认的方式,全局唯一id</span><br><span class="line">  UUID(4), &#x2F;&#x2F; 全局唯一id uuid</span><br><span class="line">  ID_WORKER_STR(5); &#x2F;&#x2F;ID_WORKER 字符串表示法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdate()&#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        &#x2F;&#x2F; 通过条件自动拼接动态sql</span><br><span class="line">        user.setId(1302223874217295874L);</span><br><span class="line">        user.setName(&quot;kwhua_mybatis-plus_updateTest&quot;);</span><br><span class="line">        user.setAge(20);</span><br><span class="line">        &#x2F;&#x2F; 注意：updateById 但是参数是一个对象！</span><br><span class="line">        int i &#x3D; userMapper.updateById(user);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNxarNibicF6Syrs4OsUj68icoVicIJbE4o2PtqgkfgBXRhrRiaWNiagFhsKUQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="自动填充"><a href="#自动填充" class="headerlink" title="自动填充"></a><strong>自动填充</strong></h2><p>创建时间、修改时间！这两个字段操作都是自动化完成的，我们不希望手动更新！阿里巴巴开发手册：所有的数据库表都要配置上gmt_create、gmt_modified！而且需要自动化！</p>
<p>方式一：数据库级别（工作中一般不用）</p>
<p>1、在表中新增字段 gmt_create, gmt_modified</p>
<p>2、把实体类同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private Date gmtCreate;</span><br><span class="line">private Date gmtModified;</span><br></pre></td></tr></table></figure>

<p>3、再次查看</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNmGGT87q8MqCibewOQlvo1ngEuUT8HthbQZS54lic6a9x1PwmMBXWvroQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>方式二：代码级别 </p>
<p>1、删除数据库的默认值、更新操作！</p>
<p>2、实体类字段属性上需要增加注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 字段添加填充内容</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">private Date gmt_create;</span><br><span class="line"></span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT_UPDATE)</span><br><span class="line">private Date gmt_modified;</span><br></pre></td></tr></table></figure>

<p>3、编写处理器来处理这个注解即可！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Component &#x2F;&#x2F; 一定不要忘记把处理器加到IOC容器中！</span><br><span class="line">public class MyMetaObjectHandler implements MetaObjectHandler &#123;</span><br><span class="line">    &#x2F;&#x2F; 插入时的填充策略</span><br><span class="line">    @Override</span><br><span class="line">    public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">        log.info(&quot;start insert fill.....&quot;);</span><br><span class="line">        &#x2F;&#x2F; setFieldValByName(String fieldName, Object fieldVal, MetaObject metaObject</span><br><span class="line">        this.setFieldValByName(&quot;gmt_create&quot;,new Date(),metaObject);</span><br><span class="line">        this.setFieldValByName(&quot;gmt_modified&quot;,new Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 更新时的填充策略</span><br><span class="line">    @Override</span><br><span class="line">    public void updateFill(MetaObject metaObject) &#123;</span><br><span class="line">        log.info(&quot;start update fill.....&quot;);</span><br><span class="line">        this.setFieldValByName(&quot;gmt_modified&quot;,new Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、测试插入和更新，检查时间变化。</p>
<h2 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h2><p>乐观锁 : 顾名思义，十分乐观，它总是认为不会出现问题，无论干什么不去上锁！如果出现了问题， 再次更新值测试 悲观锁：顾名思义，十分悲观，它总是认为总是出现问题，无论干什么都会上锁！再去操作！</p>
<p>乐观锁实现方式：</p>
<p>取出记录时，获取当前version 更新时，带上这个version 执行更新时， set version = newVersion where version = oldVersion 如果version不对，就更新失败</p>
<p>乐观锁：1、先查询，获得版本号 version = 1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- A</span><br><span class="line">update user set name &#x3D; &quot;kwhua&quot;, version &#x3D; version + 1</span><br><span class="line">where id &#x3D; 2 and version &#x3D; 1</span><br><span class="line">-- B 线程抢先完成，这个时候 version &#x3D; 2，会导致 A 修改失败！</span><br><span class="line">update user set name &#x3D; &quot;kwhua&quot;, version &#x3D; version + 1</span><br><span class="line">where id &#x3D; 2 and version &#x3D; 1</span><br></pre></td></tr></table></figure>

<p>乐观锁测试</p>
<p>1、给数据库中增加version字段！</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyN3p8JtwPbTEibSpToMm1UllysCVd11fvPiazqe0Uh5z6JXRZNVh0D8WaQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>2、实体类加对应的字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Version &#x2F;&#x2F;乐观锁Version注解</span><br><span class="line">private Integer version;</span><br></pre></td></tr></table></figure>

<p>3、注册组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 扫描我们的 mapper 文件夹</span><br><span class="line">@MapperScan(&quot;com.kwhua.mapper&quot;)</span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">@Configuration &#x2F;&#x2F; 配置类</span><br><span class="line">public class MyBatisPlusConfig &#123;</span><br><span class="line">    &#x2F;&#x2F; 注册乐观锁插件</span><br><span class="line">    @Bean</span><br><span class="line">    public OptimisticLockerInterceptor optimisticLockerInterceptor() &#123;</span><br><span class="line">        return new OptimisticLockerInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>4、测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 测试乐观锁成功！</span><br><span class="line">@Test</span><br><span class="line">public void testOptimisticLocker()&#123;</span><br><span class="line">        &#x2F;&#x2F; 1、查询用户信息</span><br><span class="line">        User user &#x3D; userMapper.selectById(1L);</span><br><span class="line">        &#x2F;&#x2F; 2、修改用户信息</span><br><span class="line">        user.setName(&quot;kwhua&quot;);</span><br><span class="line">        user.setEmail(&quot;123456@qq.com&quot;);</span><br><span class="line">        &#x2F;&#x2F; 3、执行更新操作</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>version字段已经由1变成了2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 测试乐观锁失败！多线程下</span><br><span class="line">    @Test</span><br><span class="line">    public void testOptimisticLocker2()&#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 线程 1</span><br><span class="line">        User user &#x3D; userMapper.selectById(1L);</span><br><span class="line">        user.setName(&quot;kwhua111&quot;);</span><br><span class="line">        user.setEmail(&quot;123456@qq.com&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 模拟另外一个线程执行了插队操作</span><br><span class="line">        User user2 &#x3D; userMapper.selectById(1L);</span><br><span class="line">        user2.setName(&quot;kwhua222&quot;);</span><br><span class="line">        user2.setEmail(&quot;123456@qq.com&quot;);</span><br><span class="line">        userMapper.updateById(user2);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 自旋锁来多次尝试提交！</span><br><span class="line">        userMapper.updateById(user); &#x2F;&#x2F; 如果没有乐观锁就会覆盖插队线程的值！</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyN53MQicicnuXHhRx7JxKsXkUofruF0IMV5eR8ETE0CNb0ORicJREM6b32A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>可以看到线程1执行更新失败</p>
<h2 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a><strong>查询操作</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 测试查询</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectById()&#123;</span><br><span class="line">        User user &#x3D; userMapper.selectById(1L);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 测试批量查询！</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectByBatchId()&#123;</span><br><span class="line">        List&lt;User&gt; users &#x3D; userMapper.selectBatchIds(Arrays.asList(1, 2, 3));</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 按条件查询之一使用map操作</span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectByBatchIds()&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 自定义要查询</span><br><span class="line">        map.put(&quot;name&quot;,&quot;kwhua&quot;);</span><br><span class="line">        map.put(&quot;age&quot;,15);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users &#x3D; userMapper.selectByMap(map);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>1、配置拦截器组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 分页插件</span><br><span class="line">@Bean</span><br><span class="line">public PaginationInterceptor paginationInterceptor() &#123;</span><br><span class="line">  return  new PaginationInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、直接使用Page对象即可！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 测试分页查询</span><br><span class="line">@Test</span><br><span class="line">public void testPage()&#123;</span><br><span class="line">  &#x2F;&#x2F; 参数一：当前页</span><br><span class="line">  &#x2F;&#x2F; 参数二：页面大小</span><br><span class="line">  Page&lt;User&gt; page &#x3D; new Page&lt;&gt;(2,5);</span><br><span class="line">  userMapper.selectPage(page,null);</span><br><span class="line">  page.getRecords().forEach(System.out::println);</span><br><span class="line">  System.out.println(page.getTotal());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>物理删除</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 测试删除</span><br><span class="line">    @Test</span><br><span class="line">    public void testDeleteById()&#123;</span><br><span class="line">        userMapper.deleteById(1L);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 通过id批量删除</span><br><span class="line">    @Test</span><br><span class="line">    public void testDeleteBatchId()&#123;</span><br><span class="line">        userMapper.deleteBatchIds(Arrays.asList(2L,3L));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 通过map删除</span><br><span class="line">    @Test</span><br><span class="line">    public void testDeleteMap()&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;name&quot;,&quot;kwhua&quot;);</span><br><span class="line">        userMapper.deleteByMap(map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>逻辑删除</strong></p>
<p>物理删除 ：从数据库中直接移除 逻辑删除 ：在数据库中没有被移除，而是通过一个变量来让它失效！deleted = 0 =&gt; deleted = 1 管理员可以查看被删除的记录！防止数据的丢失，类似于回收站！</p>
<p>1、在数据表中增加一个 deleted 字段2、实体类中增加属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@TableLogic &#x2F;&#x2F;逻辑删除</span><br><span class="line"> private Integer deleted;</span><br></pre></td></tr></table></figure>

<p>3、配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 逻辑删除组件！</span><br><span class="line">    @Bean</span><br><span class="line">    public ISqlInjector sqlInjector() &#123;</span><br><span class="line">        return new LogicSqlInjector();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>配置文件配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      logic-delete-value: 1</span><br><span class="line">      logic-not-delete-value: 0</span><br></pre></td></tr></table></figure>

<p>4、测试 测试删除</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNFsMT0LDzBIqbdsSZrLqBAcD5zBKicibSfnmGZia3mwN5Z6fnv3ucacG4w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>字段值也从0修改成了1测试查询</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyN8jdp9vP4I9JvnL4X4SwUdSUwian9QjTeyb0wPuf4bYqhQQweDJKjqSw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="性能分析插件"><a href="#性能分析插件" class="headerlink" title="性能分析插件"></a><strong>性能分析插件</strong></h2><p>作用：性能分析拦截器，用于输出每条 SQL 语句及其执行时间 MP也提供性能分析插件，如果超过这个时间就停止运行！</p>
<p>1、导入插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * SQL执行效率插件</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    @Profile(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)&#x2F;&#x2F; 设置 dev test 环境开启，保证我们的效率</span><br><span class="line">    public PerformanceInterceptor performanceInterceptor() &#123;</span><br><span class="line">        PerformanceInterceptor performanceInterceptor &#x3D; new PerformanceInterceptor();</span><br><span class="line">        performanceInterceptor.setMaxTime(100); &#x2F;&#x2F;ms 设置sql执行的最大时间，如果超过了则不执行</span><br><span class="line">        performanceInterceptor.setFormat(true);</span><br><span class="line">        return performanceInterceptor;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNYAkkeVT0qqwKzUoFNd2fJsSaOBTtTI4ictBoF7dLVK9EpeibyPo0pKRQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>条件构造器(Wrapper)</strong></p>
<p>isNotNull .gt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void contextLoads() &#123;</span><br><span class="line">        &#x2F;&#x2F; 查询name不为空的用户，并且邮箱不为空的用户，年龄大于等于12</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper</span><br><span class="line">                .isNotNull(&quot;name&quot;) &#x2F;&#x2F;不为空</span><br><span class="line">                .isNotNull(&quot;email&quot;)</span><br><span class="line">                .ge(&quot;age&quot;,18);</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println); &#x2F;&#x2F; 和我们刚才学习的map对比一下</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNpcZDibJWvF44CkfnA2eVEbgMzIJCB6g9u0PiauVnmN54sU7Ctrm3edEA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>.eq</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void test2()&#123;</span><br><span class="line">        &#x2F;&#x2F; 查询名字kwhua</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.eq(&quot;name&quot;,&quot;kwhua&quot;);</span><br><span class="line">        User user &#x3D; userMapper.selectOne(wrapper); &#x2F;&#x2F; 查询一个数据用selectOne，查询多个结果使用List 或者 Map</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="代码自动生成器"><a href="#代码自动生成器" class="headerlink" title="代码自动生成器"></a><strong>代码自动生成器</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码自动生成器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">generateCode</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 需要构建一个 代码自动生成器 对象</span></span><br><span class="line">    AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line">    <span class="comment">// 配置策略</span></span><br><span class="line">    <span class="comment">// 1、全局配置</span></span><br><span class="line">    GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">    String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">    gc.setOutputDir(projectPath+<span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">    gc.setAuthor(<span class="string">&quot;kwhua&quot;</span>);<span class="comment">//作者名称</span></span><br><span class="line">    gc.setOpen(<span class="keyword">false</span>);</span><br><span class="line">    gc.setFileOverride(<span class="keyword">false</span>); <span class="comment">// 是否覆盖</span></span><br><span class="line">    gc.setIdType(IdType.ID_WORKER);</span><br><span class="line">    gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">    gc.setSwagger2(<span class="keyword">true</span>);<span class="comment">//实体属性 Swagger2 注解</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义文件命名，注意 %s 会自动填充表实体属性！</span></span><br><span class="line">    gc.setServiceName(<span class="string">&quot;%sService&quot;</span>); </span><br><span class="line">    gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">    gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">    gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">    gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">    gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、设置数据源</span></span><br><span class="line">    DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">    dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/kwhua_test?</span></span><br><span class="line"><span class="string">useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">    dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="comment">// dsc.setDriverName(&quot;com.mysql.jdbc.Driver&quot;); //mysql5.6以下的驱动</span></span><br><span class="line">    dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    dsc.setDbType(DbType.MYSQL);</span><br><span class="line">    mpg.setDataSource(dsc);</span><br><span class="line">    <span class="comment">//3、包的配置</span></span><br><span class="line">    PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">    pc.setParent(<span class="string">&quot;com.kwhua&quot;</span>); <span class="comment">//包名</span></span><br><span class="line">    pc.setModuleName(<span class="string">&quot;model&quot;</span>); <span class="comment">//模块名</span></span><br><span class="line">    pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">    pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">    pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">    pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">    mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4、策略配置</span></span><br><span class="line">    StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">    strategy.setInclude(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;course&quot;</span>); <span class="comment">// 设置要映射的表名</span></span><br><span class="line">    strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">    strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">    strategy.setEntityLombokModel(<span class="keyword">true</span>); <span class="comment">// 自动lombok；</span></span><br><span class="line">    strategy.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>);</span><br><span class="line">    <span class="comment">// 自动填充配置</span></span><br><span class="line">    TableFill gmtCreate = <span class="keyword">new</span> TableFill(<span class="string">&quot;gmt_create&quot;</span>, FieldFill.INSERT);</span><br><span class="line">    TableFill gmtModified = <span class="keyword">new</span> TableFill(<span class="string">&quot;gmt_modified&quot;</span>,FieldFill.INSERT_UPDATE);</span><br><span class="line">    ArrayList&lt;TableFill&gt; tableFills = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tableFills.add(gmtCreate);</span><br><span class="line">    tableFills.add(gmtModified);</span><br><span class="line">    strategy.setTableFillList(tableFills);</span><br><span class="line">    <span class="comment">// 乐观锁</span></span><br><span class="line">    strategy.setVersionFieldName(<span class="string">&quot;version&quot;</span>);</span><br><span class="line">    <span class="comment">//根据你的表名来建对应的类名，如果你的表名没有下划线，比如test，那么你就可以取消这一步</span></span><br><span class="line">    strategy.setTablePrefix(<span class="string">&quot;t_&quot;</span>);</span><br><span class="line">    strategy.setRestControllerStyle(<span class="keyword">true</span>); <span class="comment">//rest请求</span></span><br><span class="line">    <span class="comment">//自动转下划线，比如localhost:8080/hello_id_2</span></span><br><span class="line">    strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>); </span><br><span class="line">    mpg.setStrategy(strategy);</span><br><span class="line">    mpg.execute(); <span class="comment">//执行</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行主方法即可生成对应代码</p>
<p><a target="_blank" rel="noopener" href="https://www.codota.com/code/java/packages/com.baomidou.mybatisplus.extension.api">com.baomidou.mybatisplus.extension.api</a></p>
<p>统一返回结果集:R</p>
<h2 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h2><p>说明:</p>
<p>只对自动注入的sql起效:</p>
<ul>
<li>插入: 不作限制</li>
<li>查找: 追加where条件过滤掉已删除数据,且使用 wrapper.entity 生成的where条件会忽略该字段</li>
<li>更新: 追加where条件防止更新到已删除数据,且使用 wrapper.entity 生成的where条件会忽略该字段</li>
<li>删除: 转变为 更新</li>
</ul>
<p>例如:</p>
<ul>
<li>删除: <code>update user set deleted=1 where id = 1 and deleted=0</code></li>
<li>查找: <code>select id,name,deleted from user where deleted=0</code></li>
</ul>
<p>字段类型支持说明:</p>
<ul>
<li>支持所有数据类型(推荐使用 <code>Integer</code>,<code>Boolean</code>,<code>LocalDateTime</code>)</li>
<li>如果数据库字段使用<code>datetime</code>,逻辑未删除值和已删除值支持配置为字符串<code>null</code>,另一个值支持配置为函数来获取值如<code>now()</code></li>
</ul>
<p>附录:</p>
<ul>
<li>逻辑删除是为了方便数据恢复和保护数据本身价值等等的一种方案，但实际就是删除。</li>
<li>如果你需要频繁查出来看就不应使用逻辑删除，而是以一个状态去表示。</li>
</ul>
<p>使用方法：</p>
<h3 id="步骤1-配置com-baomidou-mybatisplus-core-config-GlobalConfig-DbConfig"><a href="#步骤1-配置com-baomidou-mybatisplus-core-config-GlobalConfig-DbConfig" class="headerlink" title="#步骤1: 配置com.baomidou.mybatisplus.core.config.GlobalConfig$DbConfig"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/logic-delete.html#%E6%AD%A5%E9%AA%A41-%E9%85%8D%E7%BD%AEcom-baomidou-mybatisplus-core-config-globalconfig-dbconfig">#</a>步骤1: 配置<code>com.baomidou.mybatisplus.core.config.GlobalConfig$DbConfig</code></h3><ul>
<li>例: application.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">flag</span>  <span class="comment"># 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2)</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值(默认为 1)</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值(默认为 0)</span></span><br></pre></td></tr></table></figure>

<h3 id="步骤2-实体类字段上加上-TableLogic注解"><a href="#步骤2-实体类字段上加上-TableLogic注解" class="headerlink" title="#步骤2: 实体类字段上加上@TableLogic注解"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/logic-delete.html#%E6%AD%A5%E9%AA%A42-%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AD%97%E6%AE%B5%E4%B8%8A%E5%8A%A0%E4%B8%8A-tablelogic%E6%B3%A8%E8%A7%A3">#</a>步骤2: 实体类字段上加上<code>@TableLogic</code>注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure>

<p>常见问题:</p>
<h4 id="1-如何-insert"><a href="#1-如何-insert" class="headerlink" title="#1. 如何 insert ?"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/logic-delete.html#_1-%E5%A6%82%E4%BD%95-insert">#</a>1. 如何 insert ?</h4><blockquote>
<ol>
<li>字段在数据库定义默认值(推荐)</li>
<li>insert 前自己 set 值</li>
<li>使用自动填充功能</li>
</ol>
</blockquote>
<h4 id="2-删除接口自动填充功能失效"><a href="#2-删除接口自动填充功能失效" class="headerlink" title="#2. 删除接口自动填充功能失效"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/logic-delete.html#_2-%E5%88%A0%E9%99%A4%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E5%8A%9F%E8%83%BD%E5%A4%B1%E6%95%88">#</a>2. 删除接口自动填充功能失效</h4><blockquote>
<ol>
<li>使用 <code>update</code> 方法并: <code>UpdateWrapper.set(column, value)</code>(推荐)</li>
<li>使用 <code>update</code> 方法并: <code>UpdateWrapper.setSql(&quot;column=value&quot;)</code></li>
<li>使用<a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/sql-injector.html">Sql注入器</a>注入<code>com.baomidou.mybatisplus.extension.injector.methods.LogicDeleteByIdWithFill</code>并使用(推荐)</li>
</ol>
</blockquote>
<h2 id="一、MyBatis-Plus"><a href="#一、MyBatis-Plus" class="headerlink" title="一、MyBatis-Plus"></a>一、MyBatis-Plus</h2><h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><p>　　MyBatis-Plus 是一个 Mybatis 增强版工具，在 MyBatis 上扩充了其他功能没有改变其基本功能，为了简化开发提交效率而存在。</p>
<p>官网文档地址：<br>　　<a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/">https://mp.baomidou.com/guide/</a></p>
<p>MyBatis-Plus 特性：<br>　　<a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/#%E7%89%B9%E6%80%A7">https://mp.baomidou.com/guide/#%E7%89%B9%E6%80%A7</a></p>
<h3 id="2、使用-SpringBoot-快速使用-MyBatis-Plus"><a href="#2、使用-SpringBoot-快速使用-MyBatis-Plus" class="headerlink" title="2、使用 SpringBoot 快速使用 MyBatis-Plus"></a>2、使用 SpringBoot 快速使用 MyBatis-Plus</h3><p>（1）准备工作<br>　　需要 Java 开发环境（JDK）以及相应的开发工具（IDE）。<br>　　需要 maven（用来下载相关依赖的 jar 包）。<br>　　需要 SpringBoot。<br>　　可以使用 IDEA 安装一个 mybatis-plus 插件。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182324596-297575739.png" alt="img"></p>
<p>（2）创建一个 SpringBoot 项目。<br>　　方式一：去官网 <a target="_blank" rel="noopener" href="https://start.spring.io/">https://start.spring.io/</a> 初始化一个，然后导入 IDE 工具即可。<br>　　方式二：直接使用 IDE 工具创建一个。 Spring Initializer。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182351692-1490253732.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182402784-1080563045.png" alt="img"></p>
<p>（3）添加 MyBatis-Plus 依赖（mybatis-plus-boot-starter）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>（4）为了测试开发，此处使用 mysql 8，需要引入 mysql 相关依赖。<br>　　为了简化代码，引入 lombok 依赖（减少 getter、setter 等方法）。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.18&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.18.10&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>（5）完整依赖文件（pom.xml）</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 https:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.2.6.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.lyh.test&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;test-mybatis-plus&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;name&gt;test-mybatis-plus&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;description&gt;测试 -- 测试 MyBatis-Plus 功能&lt;&#x2F;description&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;8.0.18&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.18.10&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;org.junit.vintage&lt;&#x2F;groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;junit-vintage-engine&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">            &lt;&#x2F;exclusions&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>（6）使用一个表进行测试。</p>
<p>　　仅供参考，可以定义 创建时间、修改时间等字段。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS testMyBatisPlus;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE testMyBatisPlus;</span><br><span class="line"></span><br><span class="line">USE testMyBatisPlus;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS user;</span><br><span class="line"></span><br><span class="line">CREATE TABLE user</span><br><span class="line">(</span><br><span class="line">    id BIGINT(20) NOT NULL COMMENT &#39;主键ID&#39;,</span><br><span class="line">    name VARCHAR(30) NULL DEFAULT NULL COMMENT &#39;姓名&#39;,</span><br><span class="line">    age INT(11) NULL DEFAULT NULL COMMENT &#39;年龄&#39;,</span><br><span class="line">    email VARCHAR(50) NULL DEFAULT NULL COMMENT &#39;邮箱&#39;,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO user (id, name, age, email) VALUES</span><br><span class="line">(1, &#39;Jone&#39;, 18, &#39;test1@baomidou.com&#39;),</span><br><span class="line">(2, &#39;Jack&#39;, 20, &#39;test2@baomidou.com&#39;),</span><br><span class="line">(3, &#39;Tom&#39;, 28, &#39;test3@baomidou.com&#39;),</span><br><span class="line">(4, &#39;Sandy&#39;, 21, &#39;test4@baomidou.com&#39;),</span><br><span class="line">(5, &#39;Billie&#39;, 24, &#39;test5@baomidou.com&#39;);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182613102-1729540101.png" alt="img"></p>
<p>（7）在 application.yml 文件中配置 mysql 数据源信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;testMyBatisPlus?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182640635-986081965.png" alt="img"></p>
<p>（8）编写表对应的 实体类。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class User &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    private String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182707965-401919746.png" alt="img"></p>
<p>（9）编写操作实体类的 Mapper 类。<br>　　直接继承 BaseMapper，这是 mybatis-plus 封装好的类。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package mapper;</span><br><span class="line"></span><br><span class="line">import bean.User;</span><br><span class="line">import com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"></span><br><span class="line">public interface UserMapper extends BaseMapper&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182736101-1311032320.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182747677-610854146.png" alt="img"></p>
<p>（10）实体类、Mapper 类都写好了，就可以使用了。<br>　　Step1：先得在启动类里扫描 Mapper 类，即添加 @MapperScan 注解</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.lyh.test.testmybatisplus;</span><br><span class="line"></span><br><span class="line">import org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@MapperScan(&quot;mapper&quot;)</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class TestMybatisPlusApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(TestMybatisPlusApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>　　Step2：写一个测试类测试一下。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.lyh.test.testmybatisplus;</span><br><span class="line"></span><br><span class="line">import bean.User;</span><br><span class="line">import mapper.UserMapper;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">class TestMybatisPlusApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testSelect() &#123;</span><br><span class="line">        System.out.println((&quot;----- selectAll method test ------&quot;));</span><br><span class="line">        List&lt;User&gt; userList &#x3D; userMapper.selectList(null);</span><br><span class="line">        for(User user:userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182838295-636931302.png" alt="img"></p>
<p>（11）总结：<br>　　通过以上简单操作，就能对 user 表进行 CRUD 操作，不需要去编写 xml 文件。<br>注：<br>　　若遇到 @Autowired 标记的变量出现 红色下划线，但是不影响 正常运行。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182900276-19452208.png" alt="img"></p>
<p>　　可以进入 Settings，找到 Inspection，并选择其中的 Spring Core -&gt; Code -&gt; Autowiring for Bean Class,将 Error 改为 Warning，即可。<br><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509182927553-240645059.png" alt="img"></p>
<p> 二、Mybatis-Plus 常用操作</p>
<h3 id="1、配置日志"><a href="#1、配置日志" class="headerlink" title="1、配置日志"></a>1、配置日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">【参考地址（两种方式配置日志）】</span><br><span class="line">    https:&#x2F;&#x2F;blog.csdn.net&#x2F;dfBeautifulLive&#x2F;article&#x2F;details&#x2F;100700365</span><br></pre></td></tr></table></figure>

<p>　　想要查看执行的 sql 语句，可以在 yml 文件中添加配置信息，如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br></pre></td></tr></table></figure>

<p>　　如下图所示：执行时会打印出 sql 语句。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183041633-571344925.png" alt="img"></p>
<h3 id="2、简单认识一下常用注解"><a href="#2、简单认识一下常用注解" class="headerlink" title="2、简单认识一下常用注解"></a>2、简单认识一下常用注解</h3><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">【@TableName 】</span><br><span class="line">    @TableName               用于定义表名</span><br><span class="line">注：</span><br><span class="line">    常用属性：</span><br><span class="line">        value                用于定义表名</span><br><span class="line"></span><br><span class="line">【@TableId】</span><br><span class="line">    @TableId                 用于定义表的主键</span><br><span class="line">注：</span><br><span class="line">    常用属性：</span><br><span class="line">        value           用于定义主键字段名</span><br><span class="line">        type            用于定义主键类型（主键策略 IdType）</span><br><span class="line"></span><br><span class="line">   主键策略：</span><br><span class="line">      IdType.AUTO          主键自增，系统分配，不需要手动输入</span><br><span class="line">      IdType.NONE          未设置主键</span><br><span class="line">      IdType.INPUT         需要自己输入 主键值。</span><br><span class="line">      IdType.ASSIGN_ID     系统分配 ID，用于数值型数据（Long，对应 mysql 中 BIGINT 类型）。</span><br><span class="line">      IdType.ASSIGN_UUID   系统分配 UUID，用于字符串型数据（String，对应 mysql 中 varchar(32) 类型）。</span><br><span class="line"></span><br><span class="line">【@TableField】  </span><br><span class="line">    @TableField            用于定义表的非主键字段。</span><br><span class="line">注：</span><br><span class="line">    常用属性：</span><br><span class="line">        value                用于定义非主键字段名</span><br><span class="line">        exist                用于指明是否为数据表的字段， true 表示是，false 为不是。</span><br><span class="line">        fill                 用于指定字段填充策略（FieldFill）。</span><br><span class="line">        </span><br><span class="line">    字段填充策略：（一般用于填充 创建时间、修改时间等字段）</span><br><span class="line">        FieldFill.DEFAULT         默认不填充</span><br><span class="line">        FieldFill.INSERT          插入时填充</span><br><span class="line">        FieldFill.UPDATE          更新时填充</span><br><span class="line">        FieldFill.INSERT_UPDATE   插入、更新时填充。</span><br><span class="line"></span><br><span class="line">【@TableLogic】</span><br><span class="line">    @TableLogic           用于定义表的字段进行逻辑删除（非物理删除）</span><br><span class="line">注：</span><br><span class="line">    常用属性：</span><br><span class="line">        value            用于定义未删除时字段的值</span><br><span class="line">        delval           用于定义删除时字段的值</span><br><span class="line">        </span><br><span class="line">【@Version】</span><br><span class="line">    @Version             用于字段实现乐观锁</span><br></pre></td></tr></table></figure>



<h3 id="3、代码生成器"><a href="#3、代码生成器" class="headerlink" title="3、代码生成器"></a>3、代码生成器</h3><p>（1）AutoGenerator 简介<br>　　AutoGenerator 是 MyBatis-Plus 的代码生成器，通过 AutoGenerator 可以快速生成 Entity、Mapper、Mapper XML、Service、Controller 等各个模块的代码，极大的提升了开发效率。<br>　　与 mybatis 中的 mybatis-generator-core 类似。</p>
<p>（2）添加依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-generator&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.1.tmp&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!-- 添加 模板引擎 依赖 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.velocity&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;velocity-engine-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>



<p>（3）代码分析<br>Step1：<br>　　创建一个 代码生成器。用于生成代码。<br>　　此处不用修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step1：代码生成器</span><br><span class="line">AutoGenerator mpg &#x3D; new AutoGenerator();</span><br></pre></td></tr></table></figure>

<p>Step2：<br>　　配置全局信息。指定代码输出路径，以及包名、作者等信息。<br>　　此处按需添加，projectPath 需要修改，setAuthor 需要修改。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step2：全局配置</span><br><span class="line">GlobalConfig gc &#x3D; new GlobalConfig();</span><br><span class="line">&#x2F;&#x2F; 填写代码生成的目录(需要修改)</span><br><span class="line">String projectPath &#x3D; &quot;E:\\myProject\\test\\test_mybatis_plus&quot;;</span><br><span class="line">&#x2F;&#x2F; 拼接出代码最终输出的目录</span><br><span class="line">gc.setOutputDir(projectPath + &quot;&#x2F;src&#x2F;main&#x2F;java&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置开发者信息（可选）（需要修改）</span><br><span class="line">gc.setAuthor(&quot;lyh&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置是否打开目录，false 为不打开（可选）</span><br><span class="line">gc.setOpen(false);</span><br><span class="line">&#x2F;&#x2F; 实体属性 Swagger2 注解，添加 Swagger 依赖，开启 Swagger2 模式（可选）</span><br><span class="line">&#x2F;&#x2F;gc.setSwagger2(true);</span><br><span class="line">&#x2F;&#x2F; 重新生成文件时是否覆盖，false 表示不覆盖（可选）</span><br><span class="line">gc.setFileOverride(false);</span><br><span class="line">&#x2F;&#x2F; 配置主键生成策略，此处为 ASSIGN_ID（可选）</span><br><span class="line">gc.setIdType(IdType.ASSIGN_ID);</span><br><span class="line">&#x2F;&#x2F; 配置日期类型，此处为 ONLY_DATE（可选）</span><br><span class="line">gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">&#x2F;&#x2F; 默认生成的 service 会有 I 前缀</span><br><span class="line">gc.setServiceName(&quot;%sService&quot;);</span><br><span class="line">mpg.setGlobalConfig(gc);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>Step3：<br>　　配置数据源信息。用于指定 需要生成代码的 数据仓库、数据表。<br>　　setUrl、setDriverName、setUsername、setPassword 均需修改。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step3：数据源配置（需要修改）</span><br><span class="line">DataSourceConfig dsc &#x3D; new DataSourceConfig();</span><br><span class="line">&#x2F;&#x2F; 配置数据库 url 地址</span><br><span class="line">dsc.setUrl(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;testMyBatisPlus?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&quot;);</span><br><span class="line">&#x2F;&#x2F; dsc.setSchemaName(&quot;testMyBatisPlus&quot;); &#x2F;&#x2F; 可以直接在 url 中指定数据库名</span><br><span class="line">&#x2F;&#x2F; 配置数据库驱动</span><br><span class="line">dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置数据库连接用户名</span><br><span class="line">dsc.setUsername(&quot;root&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置数据库连接密码</span><br><span class="line">dsc.setPassword(&quot;123456&quot;);</span><br><span class="line">mpg.setDataSource(dsc);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>Step4：<br>　　配置包信息。<br>　　setParent、setModuleName 均需修改。其余按需求修改.</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step:4：包配置</span><br><span class="line">PackageConfig pc &#x3D; new PackageConfig();</span><br><span class="line">&#x2F;&#x2F; 配置父包名（需要修改）</span><br><span class="line">pc.setParent(&quot;com.lyh.test&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置模块名（需要修改）</span><br><span class="line">pc.setModuleName(&quot;test_mybatis_plus&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置 entity 包名</span><br><span class="line">pc.setEntity(&quot;entity&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置 mapper 包名</span><br><span class="line">pc.setMapper(&quot;mapper&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置 service 包名</span><br><span class="line">pc.setService(&quot;service&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置 controller 包名</span><br><span class="line">pc.setController(&quot;controller&quot;);</span><br><span class="line">mpg.setPackageInfo(pc);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>Step5：<br>　　配置数据表映射信息。<br>　　setInclude 需要修改，其余按实际开发修改。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step5：策略配置（数据库表配置）</span><br><span class="line">StrategyConfig strategy &#x3D; new StrategyConfig();</span><br><span class="line">&#x2F;&#x2F; 指定表名（可以同时操作多个表，使用 , 隔开）（需要修改）</span><br><span class="line">strategy.setInclude(&quot;test_mybatis_plus_user&quot;);</span><br><span class="line">&#x2F;&#x2F; 配置数据表与实体类名之间映射的策略</span><br><span class="line">strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">&#x2F;&#x2F; 配置数据表的字段与实体类的属性名之间映射的策略</span><br><span class="line">strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">&#x2F;&#x2F; 配置 lombok 模式</span><br><span class="line">strategy.setEntityLombokModel(true);</span><br><span class="line">&#x2F;&#x2F; 配置 rest 风格的控制器（@RestController）</span><br><span class="line">strategy.setRestControllerStyle(true);</span><br><span class="line">&#x2F;&#x2F; 配置驼峰转连字符</span><br><span class="line">strategy.setControllerMappingHyphenStyle(true);</span><br><span class="line">&#x2F;&#x2F; 配置表前缀，生成实体时去除表前缀</span><br><span class="line">&#x2F;&#x2F; 此处的表名为 test_mybatis_plus_user，模块名为 test_mybatis_plus，去除前缀后剩下为 user。</span><br><span class="line">strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);</span><br><span class="line">mpg.setStrategy(strategy);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>Step6：<br>　　执行代码生成操作。</p>
<p>　　此处不用修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Step6：执行代码生成操作</span><br><span class="line">mpg.execute();</span><br></pre></td></tr></table></figure>

<p>完整配置如下：</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">package com.lyh.test.test_mybatis_plus;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line">import com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line">public class TestAutoGenerate &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void autoGenerate() &#123;</span><br><span class="line">        &#x2F;&#x2F; Step1：代码生成器</span><br><span class="line">        AutoGenerator mpg &#x3D; new AutoGenerator();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Step2：全局配置</span><br><span class="line">        GlobalConfig gc &#x3D; new GlobalConfig();</span><br><span class="line">        &#x2F;&#x2F; 填写代码生成的目录(需要修改)</span><br><span class="line">        String projectPath &#x3D; &quot;E:\\myProject\\test\\test_mybatis_plus&quot;;</span><br><span class="line">        &#x2F;&#x2F; 拼接出代码最终输出的目录</span><br><span class="line">        gc.setOutputDir(projectPath + &quot;&#x2F;src&#x2F;main&#x2F;java&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置开发者信息（可选）（需要修改）</span><br><span class="line">        gc.setAuthor(&quot;lyh&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置是否打开目录，false 为不打开（可选）</span><br><span class="line">        gc.setOpen(false);</span><br><span class="line">        &#x2F;&#x2F; 实体属性 Swagger2 注解，添加 Swagger 依赖，开启 Swagger2 模式（可选）</span><br><span class="line">        &#x2F;&#x2F;gc.setSwagger2(true);</span><br><span class="line">        &#x2F;&#x2F; 重新生成文件时是否覆盖，false 表示不覆盖（可选）</span><br><span class="line">        gc.setFileOverride(false);</span><br><span class="line">        &#x2F;&#x2F; 配置主键生成策略，此处为 ASSIGN_ID（可选）</span><br><span class="line">        gc.setIdType(IdType.ASSIGN_ID);</span><br><span class="line">        &#x2F;&#x2F; 配置日期类型，此处为 ONLY_DATE（可选）</span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        &#x2F;&#x2F; 默认生成的 service 会有 I 前缀</span><br><span class="line">        gc.setServiceName(&quot;%sService&quot;);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Step3：数据源配置（需要修改）</span><br><span class="line">        DataSourceConfig dsc &#x3D; new DataSourceConfig();</span><br><span class="line">        &#x2F;&#x2F; 配置数据库 url 地址</span><br><span class="line">        dsc.setUrl(&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;testMyBatisPlus?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&quot;);</span><br><span class="line">        &#x2F;&#x2F; dsc.setSchemaName(&quot;testMyBatisPlus&quot;); &#x2F;&#x2F; 可以直接在 url 中指定数据库名</span><br><span class="line">        &#x2F;&#x2F; 配置数据库驱动</span><br><span class="line">        dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置数据库连接用户名</span><br><span class="line">        dsc.setUsername(&quot;root&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置数据库连接密码</span><br><span class="line">        dsc.setPassword(&quot;123456&quot;);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Step:4：包配置</span><br><span class="line">        PackageConfig pc &#x3D; new PackageConfig();</span><br><span class="line">        &#x2F;&#x2F; 配置父包名（需要修改）</span><br><span class="line">        pc.setParent(&quot;com.lyh.test&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置模块名（需要修改）</span><br><span class="line">        pc.setModuleName(&quot;test_mybatis_plus&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置 entity 包名</span><br><span class="line">        pc.setEntity(&quot;entity&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置 mapper 包名</span><br><span class="line">        pc.setMapper(&quot;mapper&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置 service 包名</span><br><span class="line">        pc.setService(&quot;service&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置 controller 包名</span><br><span class="line">        pc.setController(&quot;controller&quot;);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Step5：策略配置（数据库表配置）</span><br><span class="line">        StrategyConfig strategy &#x3D; new StrategyConfig();</span><br><span class="line">        &#x2F;&#x2F; 指定表名（可以同时操作多个表，使用 , 隔开）（需要修改）</span><br><span class="line">        strategy.setInclude(&quot;test_mybatis_plus_user&quot;);</span><br><span class="line">        &#x2F;&#x2F; 配置数据表与实体类名之间映射的策略</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        &#x2F;&#x2F; 配置数据表的字段与实体类的属性名之间映射的策略</span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        &#x2F;&#x2F; 配置 lombok 模式</span><br><span class="line">        strategy.setEntityLombokModel(true);</span><br><span class="line">        &#x2F;&#x2F; 配置 rest 风格的控制器（@RestController）</span><br><span class="line">        strategy.setRestControllerStyle(true);</span><br><span class="line">        &#x2F;&#x2F; 配置驼峰转连字符</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(true);</span><br><span class="line">        &#x2F;&#x2F; 配置表前缀，生成实体时去除表前缀</span><br><span class="line">        &#x2F;&#x2F; 此处的表名为 test_mybatis_plus_user，模块名为 test_mybatis_plus，去除前缀后剩下为 user。</span><br><span class="line">        strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Step6：执行代码生成操作</span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183427652-919200133.png" alt="img"></p>
<h3 id="4、自动填充数据功能"><a href="#4、自动填充数据功能" class="headerlink" title="4、自动填充数据功能"></a>4、自动填充数据功能</h3><p>（1）简介<br>　　添加、修改数据时，每次都会使用相同的方式进行填充。比如 数据的创建时间、修改时间等。<br>　　Mybatis-plus 支持自动填充这些字段的数据。</p>
<p>　　给之前的数据表新增两个字段：创建时间、修改时间。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_mybatis_plus_user</span><br><span class="line">(</span><br><span class="line">    id BIGINT NOT NULL COMMENT &#39;主键ID&#39;,</span><br><span class="line">    name VARCHAR(30) NULL DEFAULT NULL COMMENT &#39;姓名&#39;,</span><br><span class="line">    age INT(11) NULL DEFAULT NULL COMMENT &#39;年龄&#39;,</span><br><span class="line">    email VARCHAR(50) NULL DEFAULT NULL COMMENT &#39;邮箱&#39;,</span><br><span class="line">    create_time timestamp NULL DEFAULT NULL COMMENT &#39;创建时间&#39;,</span><br><span class="line">    update_time timestamp NULL DEFAULT NULL COMMENT &#39;最后修改时间&#39;, </span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>并使用 代码生成器生成代码。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183526359-1836932007.png" alt="img"></p>
<p>（2）未使用自动填充时<br>　　未使用 自动填充时，每次添加、修改数据都可以手动对其进行添加。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class TestMybatisPlusApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserService userService;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate() &#123;</span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setName(&quot;tom&quot;).setAge(20).setEmail(&quot;tom@163.com&quot;);</span><br><span class="line">        &#x2F;&#x2F; 手动添加数据</span><br><span class="line">        user.setCreateTime(new Date()).setUpdateTime(new Date());</span><br><span class="line">        if (userService.save(user)) &#123;</span><br><span class="line">            userService.list().forEach(System.out::println);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            System.out.println(&quot;添加数据失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183609399-44267929.png" alt="img"></p>
<p>（3）使用自动填充功能。<br>Step1：<br>　　使用 @TableField 注解，标注需要进行填充的字段。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 创建时间</span><br><span class="line"> *&#x2F;</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">private Date createTime;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 最后修改时间</span><br><span class="line"> *&#x2F;</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT_UPDATE)</span><br><span class="line">private Date updateTime;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183638934-543199454.png" alt="img"></p>
<p>Step2：<br>　　自定义一个类，实现 MetaObjectHandler 接口，并重写方法。<br>　　添加 @Component 注解，交给 Spring 去管理。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.lyh.test.test_mybatis_plus.handler;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line">import org.apache.ibatis.reflection.MetaObject;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyMetaObjectHandler implements MetaObjectHandler &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">        this.strictInsertFill(metaObject, &quot;createTime&quot;, Date.class, new Date());</span><br><span class="line">        this.strictInsertFill(metaObject, &quot;updateTime&quot;, Date.class, new Date());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void updateFill(MetaObject metaObject) &#123;</span><br><span class="line">        this.strictUpdateFill(metaObject, &quot;updateTime&quot;, Date.class, new Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183711767-990015180.png" alt="img"></p>
<p>Step3：<br>　　简单测试一下。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testAutoFill() &#123;</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setName(&quot;tom&quot;).setAge(20).setEmail(&quot;tom@163.com&quot;);</span><br><span class="line">    if (userService.save(user)) &#123;</span><br><span class="line">        userService.list().forEach(System.out::println);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        System.out.println(&quot;添加数据失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183739640-1849006710.png" alt="img"></p>
<h3 id="5、逻辑删除"><a href="#5、逻辑删除" class="headerlink" title="5、逻辑删除"></a>5、逻辑删除</h3><p>（1）简介<br>　　删除数据，可以通过物理删除，也可以通过逻辑删除。<br>　　物理删除指的是直接将数据从数据库中删除，不保留。<br>　　逻辑删除指的是修改数据的某个字段，使其表示为已删除状态，而非删除数据，保留该数据在数据库中，但是查询时不显示该数据（查询时过滤掉该数据）。</p>
<p>　　给数据表增加一个字段：delete_flag，用于表示该数据是否被逻辑删除。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_mybatis_plus_user</span><br><span class="line">(</span><br><span class="line">    id BIGINT NOT NULL COMMENT &#39;主键ID&#39;,</span><br><span class="line">    name VARCHAR(30) NULL DEFAULT NULL COMMENT &#39;姓名&#39;,</span><br><span class="line">    age INT(11) NULL DEFAULT NULL COMMENT &#39;年龄&#39;,</span><br><span class="line">    email VARCHAR(50) NULL DEFAULT NULL COMMENT &#39;邮箱&#39;,</span><br><span class="line">    create_time timestamp NULL DEFAULT NULL COMMENT &#39;创建时间&#39;,</span><br><span class="line">    update_time timestamp NULL DEFAULT NULL COMMENT &#39;最后修改时间&#39;, </span><br><span class="line">    delete_flag tinyint(1) NULL DEFAULT NULL COMMENT &#39;逻辑删除（0 未删除、1 删除）&#39;,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>（2）使用逻辑删除。<br>　　可以定义一个自动填充规则，初始值为 0。0 表示未删除， 1 表示删除。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 逻辑删除（0 未删除、1 删除）</span><br><span class="line"> *&#x2F;</span><br><span class="line">@TableLogic(value &#x3D; &quot;0&quot;, delval &#x3D; &quot;1&quot;)</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">private Integer deleteFlag;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">    this.strictInsertFill(metaObject, &quot;deleteFlag&quot;, Integer.class, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183843115-1369120260.png" alt="img"></p>
<p>（3）简单测试<br>　　使用 mybatis-plus 封装好的方法时，会自动添加逻辑删除的功能。<br>　　若是自定义的 sql 语句，需要手动添加逻辑。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDelete() &#123;</span><br><span class="line">    if (userService.removeById(1258924257048547329L)) &#123;</span><br><span class="line">        System.out.println(&quot;删除数据成功&quot;);</span><br><span class="line">        userService.list().forEach(System.out::println);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        System.out.println(&quot;删除数据失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>现有数据 </p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509183959603-847557538.png" alt="img"></p>
<p>执行 testDelete 进行逻辑删除。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184012946-489939673.png" alt="img"></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184023676-1916956821.png" alt="img"></p>
<p>若去除 TableLogic 注解，再执行 testDelete 时进行物理删除，直接删除这条数据。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184044446-583363399.png" alt="img"></p>
<p> <img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184057341-414839563.png" alt="img"></p>
<h3 id="6、分页插件的使用"><a href="#6、分页插件的使用" class="headerlink" title="6、分页插件的使用"></a>6、分页插件的使用</h3><p>（1）简介<br>　　与 mybatis 的插件 pagehelper 用法类似。<br>　　通过简单的配置即可使用。</p>
<p>（2）使用<br>Step1：<br>　　配置分页插件。<br>　　编写一个 配置类，内部使用 @Bean 注解将 PaginationInterceptor 交给 Spring 容器管理。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.lyh.test.test_mybatis_plus.config;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line">import org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 自定义一个配置类，mapper 扫描也可在此写上</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">@MapperScan(&quot;com.lyh.test.test_mybatis_plus.mapper&quot;)</span><br><span class="line">public class Myconfig &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 分页插件</span><br><span class="line">     * @return 分页插件的实例</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public PaginationInterceptor paginationInterceptor() &#123;</span><br><span class="line">        return new PaginationInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184134459-1998710648.png" alt="img"></p>
<p>Step2：<br>　　编写分页代码。<br>　　直接 new 一个 Page 对象，对象需要传递两个参数（当前页，每页显示的条数）。<br>　　调用 mybatis-plus 提供的分页查询方法，其会将 分页查询的数据封装到 Page 对象中。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testPage() &#123;</span><br><span class="line">    &#x2F;&#x2F; Step1：创建一个 Page 对象</span><br><span class="line">    Page&lt;User&gt; page &#x3D; new Page&lt;&gt;();</span><br><span class="line">    &#x2F;&#x2F; Page&lt;User&gt; page &#x3D; new Page&lt;&gt;(2, 5);</span><br><span class="line">    &#x2F;&#x2F; Step2：调用 mybatis-plus 提供的分页查询方法</span><br><span class="line">    userService.page(page, null);</span><br><span class="line">    &#x2F;&#x2F; Step3：获取分页数据</span><br><span class="line">    System.out.println(page.getCurrent()); &#x2F;&#x2F; 获取当前页</span><br><span class="line">    System.out.println(page.getTotal()); &#x2F;&#x2F; 获取总记录数</span><br><span class="line">    System.out.println(page.getSize()); &#x2F;&#x2F; 获取每页的条数</span><br><span class="line">    System.out.println(page.getRecords()); &#x2F;&#x2F; 获取每页数据的集合</span><br><span class="line">    System.out.println(page.getPages()); &#x2F;&#x2F; 获取总页数</span><br><span class="line">    System.out.println(page.hasNext()); &#x2F;&#x2F; 是否存在下一页</span><br><span class="line">    System.out.println(page.hasPrevious()); &#x2F;&#x2F; 是否存在上一页</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184212763-1123404604.png" alt="img"></p>
<h3 id="7、乐观锁的实现"><a href="#7、乐观锁的实现" class="headerlink" title="7、乐观锁的实现"></a>7、乐观锁的实现</h3><p>（1）首先认识一下 读问题、写问题？<br>　　操作数据库数据时，遇到的最基本问题就是 读问题与写问题。<br>　　读问题 指的是从数据库中读取数据时遇到的问题，比如：脏读、幻读、不可重复读。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">【脏读、幻读、不可重复读 参考地址：】</span><br><span class="line">    https:&#x2F;&#x2F;www.cnblogs.com&#x2F;l-y-h&#x2F;p&#x2F;12458777.html#_label0_3</span><br></pre></td></tr></table></figure>

<p>　　写问题 指的是数据写入数据库时遇到的问题，比如：丢失更新（多个线程同时对某条数据更新，无论执行顺序如何，都会丢失其他线程更新的数据）</p>
<p>（2）如何解决写问题？<br>　　乐观锁、悲观锁就是为了解决 写问题而存在的。<br>　　　　乐观锁：总是假设最好的情况，每次读取数据时认为数据不会被修改（即不加锁），当进行更新操作时，会判断这条数据是否被修改，未被修改，则进行更新操作。若被修改，则数据更新失败，可以对数据进行重试（重新尝试修改数据）。<br>　　　　悲观锁：总是假设最坏的情况，每次读取数据时认为数据会被修改（即加锁），当进行更新操作时，直接更新数据，结束操作后释放锁（此处才可以被其他线程读取）。</p>
<p>（3）乐观锁、悲观锁使用场景？<br>　　乐观锁一般用于读比较多的场合，尽量减少加锁的开销。<br>　　悲观锁一般用于写比较多的场合，尽量减少 类似 乐观锁重试更新引起的性能开销。</p>
<p>（4）乐观锁两种实现方式<br>方式一：通过版本号机制实现。<br>　　在数据表中增加一个 version 字段。<br>　　取数据时，获取该字段，更新时以该字段为条件进行处理（即set version = newVersion where version = oldVersion），若 version 相同，则更新成功（给新 version 赋一个值，一般加 1）。若 version 不同，则更新失败，可以重新尝试更新操作。</p>
<p>方式二：通过 CAS 算法实现。<br>　　CAS 为 Compare And Swap 的缩写，即比较交换，是一种无锁算法（即在不加锁的情况实现多线程之间的变量同步）。<br>　　CAS 操作包含三个操作数 —— 内存值（V）、预期原值（A）和新值(B)。如果内存地址里面的值 V 和 A 的值是一样的，那么就将内存里面的值更新成B。若 V 与 A 不一致，则不执行任何操作（可以通过自旋操作，不断尝试修改数据直至成功修改）。即 V == A ？ V = B ： V = V。<br>　　CAS 可能导致 ABA 问题（两次读取数据时值相同，但不确定值是否被修改过），比如两个线程操作同一个变量，线程 A、线程B 初始读取数据均为 A，后来 线程B 将数据修改为 B，然后又修改为 A，此时线程 A 再次读取到的数据依旧是 A，虽然值相同但是中间被修改过，这就是 ABA 问题。可以加一个额外的标志位 C，用于表示数据是否被修改。当标志位 C 与预期标志位相同、且 V == A 时，则更新值 B。</p>
<p>（5）mybatis-plus 实现乐观锁（通过 version 机制）<br>实现思路：<br>　　Step1：取出记录时，获取当前version<br>　　Step2：更新时，带上这个version<br>　　Step3：执行更新时， set version = newVersion where version = oldVersion<br>　　Step4：如果version不对，就更新失败</p>
<p>（6）mybatis-plus 代码实现乐观锁<br>Step1：<br>　　配置乐观锁插件。<br>　　编写一个配置类（可以与上例的分页插件共用一个配置类），将 OptimisticLockerInterceptor 通过 @Bean 交给 Spring 管理。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 乐观锁插件</span><br><span class="line"> * @return 乐观锁插件的实例</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Bean</span><br><span class="line">public OptimisticLockerInterceptor optimisticLockerInterceptor() &#123;</span><br><span class="line">    return new OptimisticLockerInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184345369-1234458679.png" alt="img"></p>
<p>Step2：<br>　　定义一个数据库字段 version。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test_mybatis_plus_user</span><br><span class="line">(</span><br><span class="line">    id BIGINT NOT NULL COMMENT &#39;主键ID&#39;,</span><br><span class="line">    name VARCHAR(30) NULL DEFAULT NULL COMMENT &#39;姓名&#39;,</span><br><span class="line">    age INT(11) NULL DEFAULT NULL COMMENT &#39;年龄&#39;,</span><br><span class="line">    email VARCHAR(50) NULL DEFAULT NULL COMMENT &#39;邮箱&#39;,</span><br><span class="line">    create_time timestamp NULL DEFAULT NULL COMMENT &#39;创建时间&#39;,</span><br><span class="line">    update_time timestamp NULL DEFAULT NULL COMMENT &#39;最后修改时间&#39;, </span><br><span class="line">    delete_flag tinyint(1) NULL DEFAULT NULL COMMENT &#39;逻辑删除（0 未删除、1 删除）&#39;,</span><br><span class="line">    version int NULL DEFAULT NULL COMMENT &#39;版本号（用于乐观锁， 默认为 1）&#39;,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>Step3：<br>　　使用 @Version 注解标注对应的实体类。<br>　　可以通过 @TableField 进行数据自动填充。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 版本号（用于乐观锁， 默认为 1）</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Version</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">private Integer version;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">    this.strictInsertFill(metaObject, &quot;version&quot;, Integer.class, 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184439393-659580638.png" alt="img"></p>
<p>Step4：<br>　　简单测试一下，可以看一下 控制台 打印的 sql 语句。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testVersion() &#123;</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setName(&quot;tom&quot;).setAge(20).setEmail(&quot;tom@163.com&quot;);</span><br><span class="line">    userService.save(user);</span><br><span class="line">    userService.list().forEach(System.out::println);</span><br><span class="line">    user.setName(&quot;jarry&quot;);</span><br><span class="line">    userService.update(user, null);</span><br><span class="line">    userService.list().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184519097-1477211602.png" alt="img"></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/l-y-h/p/12859477.html#_labelTop">回到顶部</a></p>
<h2 id="三、Mybatis-Plus-CRUD-操作简单了解一下"><a href="#三、Mybatis-Plus-CRUD-操作简单了解一下" class="headerlink" title="三、Mybatis-Plus CRUD 操作简单了解一下"></a>三、Mybatis-Plus CRUD 操作简单了解一下</h2><h3 id="1、Mapper-接口方法（CRUD）简单了解一下"><a href="#1、Mapper-接口方法（CRUD）简单了解一下" class="headerlink" title="1、Mapper 接口方法（CRUD）简单了解一下"></a>1、Mapper 接口方法（CRUD）简单了解一下</h3><p>（1）简介<br>　　使用代码生成器生成的 mapper 接口中，其继承了 BaseMapper 接口。<br>　　而 BaseMapper 接口中封装了一系列 CRUD 常用操作，可以直接使用，而不用自定义 xml 与 sql 语句进行 CRUD 操作（当然根据实际开发需要，自定义 sql 还是有必要的）。</p>
<p>此处简单介绍一下 BaseMapper 接口中的常用方法。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184606042-2140497864.png" alt="img"></p>
<p> <img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184616508-1167828998.png" alt="img"></p>
<p>（2）方法介绍<br>　　混个眼熟，用多了就记得了。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">【添加数据：（增）】</span><br><span class="line">    int insert(T entity);              &#x2F;&#x2F; 插入一条记录</span><br><span class="line">注：</span><br><span class="line">    T         表示任意实体类型</span><br><span class="line">    entity    表示实体对象</span><br><span class="line"></span><br><span class="line">【删除数据：（删）】</span><br><span class="line">    int deleteById(Serializable id);    &#x2F;&#x2F; 根据主键 ID 删除</span><br><span class="line">    int deleteByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);  &#x2F;&#x2F; 根据 map 定义字段的条件删除</span><br><span class="line">    int delete(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; wrapper); &#x2F;&#x2F; 根据实体类定义的 条件删除对象</span><br><span class="line">    int deleteBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList); &#x2F;&#x2F; 进行批量删除</span><br><span class="line">注：</span><br><span class="line">    id        表示 主键 ID</span><br><span class="line">    columnMap 表示表字段的 map 对象</span><br><span class="line">    wrapper   表示实体对象封装操作类，可以为 null。</span><br><span class="line">    idList    表示 主键 ID 集合（列表、数组），不能为 null 或 empty</span><br><span class="line"></span><br><span class="line">【修改数据：（改）】</span><br><span class="line">    int updateById(@Param(Constants.ENTITY) T entity); &#x2F;&#x2F; 根据 ID 修改实体对象。</span><br><span class="line">    int update(@Param(Constants.ENTITY) T entity, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; updateWrapper); &#x2F;&#x2F; 根据 updateWrapper 条件修改实体对象</span><br><span class="line">注：</span><br><span class="line">    update 中的 entity 为 set 条件，可以为 null。</span><br><span class="line">    updateWrapper 表示实体对象封装操作类（可以为 null,里面的 entity 用于生成 where 语句）</span><br><span class="line"></span><br><span class="line">【查询数据：（查）】</span><br><span class="line">    T selectById(Serializable id); &#x2F;&#x2F; 根据 主键 ID 查询数据</span><br><span class="line">    List&lt;T&gt; selectBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList); &#x2F;&#x2F; 进行批量查询</span><br><span class="line">    List&lt;T&gt; selectByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap); &#x2F;&#x2F; 根据表字段条件查询</span><br><span class="line">    T selectOne(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 根据实体类封装对象 查询一条记录</span><br><span class="line">    Integer selectCount(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 查询记录的总条数</span><br><span class="line">    List&lt;T&gt; selectList(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 查询所有记录（返回 entity 集合）</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; selectMaps(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 查询所有记录（返回 map 集合）</span><br><span class="line">    List&lt;Object&gt; selectObjs(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 查询所有记录（但只保存第一个字段的值）</span><br><span class="line">    &lt;E extends IPage&lt;T&gt;&gt; E selectPage(E page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 查询所有记录（返回 entity 集合），分页</span><br><span class="line">    &lt;E extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; E selectMapsPage(E page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 查询所有记录（返回 map 集合），分页</span><br><span class="line">注：</span><br><span class="line">    queryWrapper 表示实体对象封装操作类（可以为 null）</span><br><span class="line">    page 表示分页查询条件</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="2、Service-接口方法（CRUD）简单了解一下"><a href="#2、Service-接口方法（CRUD）简单了解一下" class="headerlink" title="2、Service 接口方法（CRUD）简单了解一下"></a>2、Service 接口方法（CRUD）简单了解一下</h3><p>（1）简介<br>　　使用 代码生成器 生成的 service 接口中，其继承了 IService 接口。<br>　　IService 内部进一步封装了 BaseMapper 接口的方法（当然也提供了更详细的方法）。<br>　　使用时，可以通过 生成的 mapper 类进行 CRUD 操作，也可以通过 生成的 service 的实现类进行 CRUD 操作。（当然，自定义代码执行也可）<br>此处简单介绍一下 IService 中封装的常用方法。</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184721039-779905975.png" alt="img"></p>
<p> <img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184732325-807928909.png" alt="img"></p>
<p>（2）方法介绍<br>　　混个眼熟，用多了就记得了。<br>　　内部封装了 BaseMapper 的方法，也提供了新的方法。<br>比如：<br>　　添加了 批量更新 方法、更新或修改方法等。<br>　　对 查询方法 做了细化，使用 get 命名的方法查询一条数据，使用 list 命名的方法查询多条数据等。<br>　　增加了链式调用的方法。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">【添加数据：（增）】</span><br><span class="line">    default boolean save(T entity); &#x2F;&#x2F; 调用 BaseMapper 的 insert 方法，用于添加一条数据。</span><br><span class="line">    boolean saveBatch(Collection&lt;T&gt; entityList, int batchSize); &#x2F;&#x2F; 批量插入数据</span><br><span class="line">注：</span><br><span class="line">    entityList 表示实体对象集合 </span><br><span class="line">    batchSize 表示一次批量插入的数据量，默认为 1000</span><br><span class="line"></span><br><span class="line">【添加或修改数据：（增或改）】</span><br><span class="line">    boolean saveOrUpdate(T entity); &#x2F;&#x2F; id 若存在，则修改， id 不存在则新增数据</span><br><span class="line">   default boolean saveOrUpdate(T entity, Wrapper&lt;T&gt; updateWrapper); &#x2F;&#x2F; 先根据条件尝试更新，然后再执行 saveOrUpdate 操作</span><br><span class="line">   boolean saveOrUpdateBatch(Collection&lt;T&gt; entityList, int batchSize); &#x2F;&#x2F; 批量插入并修改数据 </span><br><span class="line"></span><br><span class="line">【删除数据：（删）】</span><br><span class="line">    default boolean removeById(Serializable id); &#x2F;&#x2F; 调用 BaseMapper 的 deleteById 方法，根据 id 删除数据。</span><br><span class="line">    default boolean removeByMap(Map&lt;String, Object&gt; columnMap); &#x2F;&#x2F; 调用 BaseMapper 的 deleteByMap 方法，根据 map 定义字段的条件删除</span><br><span class="line">    default boolean remove(Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 调用 BaseMapper 的 delete 方法，根据实体类定义的 条件删除对象。</span><br><span class="line">    default boolean removeByIds(Collection&lt;? extends Serializable&gt; idList); &#x2F;&#x2F; 用 BaseMapper 的 deleteBatchIds 方法, 进行批量删除。</span><br><span class="line">    </span><br><span class="line">【修改数据：（改）】</span><br><span class="line">    default boolean updateById(T entity); &#x2F;&#x2F; 调用 BaseMapper 的 updateById 方法，根据 ID 选择修改。</span><br><span class="line">    default boolean update(T entity, Wrapper&lt;T&gt; updateWrapper); &#x2F;&#x2F; 调用 BaseMapper 的 update 方法，根据 updateWrapper 条件修改实体对象。</span><br><span class="line">    boolean updateBatchById(Collection&lt;T&gt; entityList, int batchSize); &#x2F;&#x2F; 批量更新数据</span><br><span class="line"></span><br><span class="line">【查找数据：（查）】</span><br><span class="line">    default T getById(Serializable id); &#x2F;&#x2F; 调用 BaseMapper 的 selectById 方法，根据 主键 ID 返回数据。</span><br><span class="line">    default List&lt;T&gt; listByIds(Collection&lt;? extends Serializable&gt; idList); &#x2F;&#x2F; 调用 BaseMapper 的 selectBatchIds 方法，批量查询数据。</span><br><span class="line">    default List&lt;T&gt; listByMap(Map&lt;String, Object&gt; columnMap); &#x2F;&#x2F; 调用 BaseMapper 的 selectByMap 方法，根据表字段条件查询</span><br><span class="line">    default T getOne(Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 返回一条记录（实体类保存）。</span><br><span class="line">    Map&lt;String, Object&gt; getMap(Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 返回一条记录（map 保存）。</span><br><span class="line">    default int count(Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 根据条件返回 记录数。</span><br><span class="line">    default List&lt;T&gt; list(); &#x2F;&#x2F; 返回所有数据。</span><br><span class="line">    default List&lt;T&gt; list(Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 调用 BaseMapper 的 selectList 方法，查询所有记录（返回 entity 集合）。</span><br><span class="line">    default List&lt;Map&lt;String, Object&gt;&gt; listMaps(Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 调用 BaseMapper 的 selectMaps 方法，查询所有记录（返回 map 集合）。</span><br><span class="line">    default List&lt;Object&gt; listObjs(); &#x2F;&#x2F; 返回全部记录，但只返回第一个字段的值。</span><br><span class="line">    default &lt;E extends IPage&lt;T&gt;&gt; E page(E page, Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 调用 BaseMapper 的 selectPage 方法，分页查询</span><br><span class="line">    default &lt;E extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; E pageMaps(E page, Wrapper&lt;T&gt; queryWrapper); &#x2F;&#x2F; 调用 BaseMapper 的 selectMapsPage 方法，分页查询</span><br><span class="line">注：</span><br><span class="line">    get 用于返回一条记录。</span><br><span class="line">    list 用于返回多条记录。</span><br><span class="line">    count 用于返回记录总数。</span><br><span class="line">    page 用于分页查询。</span><br><span class="line">    </span><br><span class="line">【链式调用：】</span><br><span class="line">    default QueryChainWrapper&lt;T&gt; query(); &#x2F;&#x2F; 普通链式查询</span><br><span class="line">    default LambdaQueryChainWrapper&lt;T&gt; lambdaQuery(); &#x2F;&#x2F; 支持 Lambda 表达式的修改</span><br><span class="line">    default UpdateChainWrapper&lt;T&gt; update(); &#x2F;&#x2F; 普通链式修改</span><br><span class="line">    default LambdaUpdateChainWrapper&lt;T&gt; lambdaUpdate(); &#x2F;&#x2F; 支持 Lambda 表达式的修改</span><br><span class="line">注：</span><br><span class="line">    query 表示查询</span><br><span class="line">    update 表示修改</span><br><span class="line">    Lambda 表示内部支持 Lambda 写法。</span><br><span class="line">形如：</span><br><span class="line">    query().eq(&quot;column&quot;, value).one();</span><br><span class="line">    lambdaQuery().eq(Entity::getId, value).list();</span><br><span class="line">    update().eq(&quot;column&quot;, value).remove();</span><br><span class="line">    lambdaUpdate().eq(Entity::getId, value).update(entity);</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<h3 id="3、条件构造器（Wrapper，定义-where-条件）"><a href="#3、条件构造器（Wrapper，定义-where-条件）" class="headerlink" title="3、条件构造器（Wrapper，定义 where 条件）"></a>3、条件构造器（Wrapper，定义 where 条件）</h3><p>（1）简介<br>　　上面介绍的 接口方法的参数中，会出现各种 wrapper，比如 queryWrapper、updateWrapper 等。wrapper 的作用就是用于定义各种各样的查询条件（where）。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Wrapper  条件构造抽象类</span><br><span class="line">    -- AbstractWrapper 查询条件封装，用于生成 sql 中的 where 语句。</span><br><span class="line">        -- QueryWrapper Entity 对象封装操作类，用于查询。</span><br><span class="line">        -- UpdateWrapper Update 条件封装操作类，用于更新。</span><br><span class="line">    -- AbstractLambdaWrapper 使用 Lambda 表达式封装 wrapper</span><br><span class="line">        -- LambdaQueryWrapper 使用 Lambda 语法封装条件，用于查询。</span><br><span class="line">        -- LambdaUpdateWrapper 使用 Lambda 语法封装条件，用于更新。</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184846756-1724510855.png" alt="img"></p>
<p>（2）常用条件<br>　　参考源码以及官方文档总结的，还是一句话，混个眼熟，多用用就熟练了。</p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">【通用条件：】</span><br><span class="line">【比较大小： ( &#x3D;, &lt;&gt;, &gt;, &gt;&#x3D;, &lt;, &lt;&#x3D; )】</span><br><span class="line">    eq(R column, Object val); &#x2F;&#x2F; 等价于 &#x3D;，例: eq(&quot;name&quot;, &quot;老王&quot;) ---&gt; name &#x3D; &#39;老王&#39;</span><br><span class="line">    ne(R column, Object val); &#x2F;&#x2F; 等价于 &lt;&gt;，例: ne(&quot;name&quot;, &quot;老王&quot;) ---&gt; name &lt;&gt; &#39;老王&#39;</span><br><span class="line">    gt(R column, Object val); &#x2F;&#x2F; 等价于 &gt;，例: gt(&quot;name&quot;, &quot;老王&quot;) ---&gt; name &gt; &#39;老王&#39;</span><br><span class="line">    ge(R column, Object val); &#x2F;&#x2F; 等价于 &gt;&#x3D;，例: ge(&quot;name&quot;, &quot;老王&quot;) ---&gt; name &gt;&#x3D; &#39;老王&#39;</span><br><span class="line">    lt(R column, Object val); &#x2F;&#x2F; 等价于 &lt;，例: lt(&quot;name&quot;, &quot;老王&quot;) ---&gt; name &lt; &#39;老王&#39;</span><br><span class="line">    le(R column, Object val); &#x2F;&#x2F; 等价于 &lt;&#x3D;，例: le(&quot;name&quot;, &quot;老王&quot;) ---&gt; name &lt;&#x3D; &#39;老王&#39;</span><br><span class="line">    </span><br><span class="line">【范围：（between、not between、in、not in）】</span><br><span class="line">   between(R column, Object val1, Object val2); &#x2F;&#x2F; 等价于 between a and b, 例： between(&quot;age&quot;, 18, 30) ---&gt; age between 18 and 30</span><br><span class="line">   notBetween(R column, Object val1, Object val2); &#x2F;&#x2F; 等价于 not between a and b, 例： notBetween(&quot;age&quot;, 18, 30) ---&gt; age not between 18 and 30</span><br><span class="line">   in(R column, Object... values); &#x2F;&#x2F; 等价于 字段 IN (v0, v1, ...),例: in(&quot;age&quot;,&#123;1,2,3&#125;) ---&gt; age in (1,2,3)</span><br><span class="line">   notIn(R column, Object... values); &#x2F;&#x2F; 等价于 字段 NOT IN (v0, v1, ...), 例: notIn(&quot;age&quot;,&#123;1,2,3&#125;) ---&gt; age not in (1,2,3)</span><br><span class="line">   inSql(R column, Object... values); &#x2F;&#x2F; 等价于 字段 IN (sql 语句), 例: inSql(&quot;id&quot;, &quot;select id from table where id &lt; 3&quot;) ---&gt; id in (select id from table where id &lt; 3)</span><br><span class="line">   notInSql(R column, Object... values); &#x2F;&#x2F; 等价于 字段 NOT IN (sql 语句)</span><br><span class="line">   </span><br><span class="line">【模糊匹配：（like）】</span><br><span class="line">    like(R column, Object val); &#x2F;&#x2F; 等价于 LIKE &#39;%值%&#39;，例: like(&quot;name&quot;, &quot;王&quot;) ---&gt; name like &#39;%王%&#39;</span><br><span class="line">    notLike(R column, Object val); &#x2F;&#x2F; 等价于 NOT LIKE &#39;%值%&#39;，例: notLike(&quot;name&quot;, &quot;王&quot;) ---&gt; name not like &#39;%王%&#39;</span><br><span class="line">    likeLeft(R column, Object val); &#x2F;&#x2F; 等价于 LIKE &#39;%值&#39;，例: likeLeft(&quot;name&quot;, &quot;王&quot;) ---&gt; name like &#39;%王&#39;</span><br><span class="line">    likeRight(R column, Object val); &#x2F;&#x2F; 等价于 LIKE &#39;值%&#39;，例: likeRight(&quot;name&quot;, &quot;王&quot;) ---&gt; name like &#39;王%&#39;</span><br><span class="line">    </span><br><span class="line">【空值比较：（isNull、isNotNull）】</span><br><span class="line">    isNull(R column); &#x2F;&#x2F; 等价于 IS NULL，例: isNull(&quot;name&quot;) ---&gt; name is null</span><br><span class="line">    isNotNull(R column); &#x2F;&#x2F; 等价于 IS NOT NULL，例: isNotNull(&quot;name&quot;) ---&gt; name is not null</span><br><span class="line"></span><br><span class="line">【分组、排序：（group、having、order）】</span><br><span class="line">    groupBy(R... columns); &#x2F;&#x2F; 等价于 GROUP BY 字段, ...， 例: groupBy(&quot;id&quot;, &quot;name&quot;) ---&gt; group by id,name</span><br><span class="line">    orderByAsc(R... columns); &#x2F;&#x2F; 等价于 ORDER BY 字段, ... ASC， 例: orderByAsc(&quot;id&quot;, &quot;name&quot;) ---&gt; order by id ASC,name ASC</span><br><span class="line">    orderByDesc(R... columns); &#x2F;&#x2F; 等价于 ORDER BY 字段, ... DESC， 例: orderByDesc(&quot;id&quot;, &quot;name&quot;) ---&gt; order by id DESC,name DESC</span><br><span class="line">    having(String sqlHaving, Object... params); &#x2F;&#x2F; 等价于 HAVING ( sql语句 )， 例: having(&quot;sum(age) &gt; &#123;0&#125;&quot;, 11) ---&gt; having sum(age) &gt; 11</span><br><span class="line"></span><br><span class="line">【拼接、嵌套 sql：（or、and、nested、apply）】</span><br><span class="line">   or(); &#x2F;&#x2F; 等价于 a or b， 例：eq(&quot;id&quot;,1).or().eq(&quot;name&quot;,&quot;老王&quot;) ---&gt; id &#x3D; 1 or name &#x3D; &#39;老王&#39;</span><br><span class="line">   or(Consumer&lt;Param&gt; consumer); &#x2F;&#x2F; 等价于 or(a or&#x2F;and b)，or 嵌套。例: or(i -&gt; i.eq(&quot;name&quot;, &quot;李白&quot;).ne(&quot;status&quot;, &quot;活着&quot;)) ---&gt; or (name &#x3D; &#39;李白&#39; and status &lt;&gt; &#39;活着&#39;)</span><br><span class="line">   and(Consumer&lt;Param&gt; consumer); &#x2F;&#x2F; 等价于 and(a or&#x2F;and b)，and 嵌套。例: and(i -&gt; i.eq(&quot;name&quot;, &quot;李白&quot;).ne(&quot;status&quot;, &quot;活着&quot;)) ---&gt; and (name &#x3D; &#39;李白&#39; and status &lt;&gt; &#39;活着&#39;)</span><br><span class="line">   nested(Consumer&lt;Param&gt; consumer); &#x2F;&#x2F; 等价于 (a or&#x2F;and b)，普通嵌套。例: nested(i -&gt; i.eq(&quot;name&quot;, &quot;李白&quot;).ne(&quot;status&quot;, &quot;活着&quot;)) ---&gt; (name &#x3D; &#39;李白&#39; and status &lt;&gt; &#39;活着&#39;)</span><br><span class="line">   apply(String applySql, Object... params); &#x2F;&#x2F; 拼接sql（若不使用 params 参数，可能存在 sql 注入），例: apply(&quot;date_format(dateColumn,&#39;%Y-%m-%d&#39;) &#x3D; &#123;0&#125;&quot;, &quot;2008-08-08&quot;) ---&gt; date_format(dateColumn,&#39;%Y-%m-%d&#39;) &#x3D; &#39;2008-08-08&#39;&quot;)</span><br><span class="line">   last(String lastSql); &#x2F;&#x2F; 无视优化规则直接拼接到 sql 的最后，可能存若在 sql 注入。</span><br><span class="line">   exists(String existsSql); &#x2F;&#x2F; 拼接 exists 语句。例: exists(&quot;select id from table where age &#x3D; 1&quot;) ---&gt; exists (select id from table where age &#x3D; 1)</span><br><span class="line">   </span><br><span class="line">【QueryWrapper 条件：】</span><br><span class="line">    select(String... sqlSelect); &#x2F;&#x2F; 用于定义需要返回的字段。例： select(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;) ---&gt; select id, name, age</span><br><span class="line">    select(Predicate&lt;TableFieldInfo&gt; predicate); &#x2F;&#x2F; Lambda 表达式，过滤需要的字段。</span><br><span class="line">    lambda(); &#x2F;&#x2F; 返回一个 LambdaQueryWrapper</span><br><span class="line">    </span><br><span class="line">【UpdateWrapper 条件：】</span><br><span class="line">    set(String column, Object val); &#x2F;&#x2F; 用于设置 set 字段值。例: set(&quot;name&quot;, null) ---&gt; set name &#x3D; null</span><br><span class="line">    etSql(String sql); &#x2F;&#x2F; 用于设置 set 字段值。例: setSql(&quot;name &#x3D; &#39;老李头&#39;&quot;) ---&gt; set name &#x3D; &#39;老李头&#39;</span><br><span class="line">    lambda(); &#x2F;&#x2F; 返回一个 LambdaUpdateWrapper </span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>（3）简单使用，测试一下 QueryWrapper </p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testQueryWrapper() &#123;</span><br><span class="line">    &#x2F;&#x2F; Step1：创建一个 QueryWrapper 对象</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Step2： 构造查询条件</span><br><span class="line">    queryWrapper</span><br><span class="line">            .select(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;)</span><br><span class="line">            .eq(&quot;age&quot;, 20)</span><br><span class="line">            .like(&quot;name&quot;, &quot;j&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Step3：执行查询</span><br><span class="line">    userService</span><br><span class="line">            .list(queryWrapper)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<p>当前数据库数据如下：</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509184939865-892962988.png" alt="img"></p>
<p>执行测试方法输出如下：</p>
<p><img src="https://img2020.cnblogs.com/blog/1688578/202005/1688578-20200509185011268-453045850.png" alt="img"></p>
<h2 id="lombok包"><a href="#lombok包" class="headerlink" title="lombok包"></a>lombok包</h2><pre><code>1、idea下安装lombok插件
[settings/plugins在插件库中搜索安装即可。]
(https://img-blog.csdnimg.cn/20190501112839630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Jlbnh0MDUwOA==,size_16,color_FFFFFF,t_70)
2、重启idea
3、在maven库中添加依赖
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.16.10&lt;/version&gt;
        &lt;/dependency&gt;
4、在实体类上添加注解即可生效
</code></pre>
<h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h3><p>​     1、@Data可以为类提供读写功能，从而不用写get、set方法。<br>​     2、他还会为类提供 equals()、hashCode()、toString() 方法。</p>
<h3 id="SneakyThrows（隐秘抛出）"><a href="#SneakyThrows（隐秘抛出）" class="headerlink" title="@SneakyThrows（隐秘抛出）"></a>@SneakyThrows（隐秘抛出）</h3><p>是lombok包下的注解 并且继承了Throwable作用 是为了用try{}catch{}捕捉异常添加之后会在  代码编译时 自动捕获异常</p>
<h1 id="一、mybatis-plus简介："><a href="#一、mybatis-plus简介：" class="headerlink" title="一、mybatis-plus简介："></a>一、mybatis-plus简介：</h1><p>Mybatis-Plus（简称MP）是一个 Mybatis 的增强工具，在 Mybatis 的基础上只做增强不做改变，为简化开发、提高效率而生。这是官方给的定义，关于mybatis-plus的更多介绍及特性，可以参考<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://mp.baomidou.com/%23/">mybatis-plus官网</a>。那么它是怎么增强的呢？其实就是它已经封装好了一些crud方法，我们不需要再写xml了，直接调用这些方法就行，就类似于JPA。</p>
<h1 id="二、spring整合mybatis-plus"><a href="#二、spring整合mybatis-plus" class="headerlink" title="二、spring整合mybatis-plus:"></a>二、spring整合mybatis-plus:</h1><p>正如官方所说，mybatis-plus在mybatis的基础上只做增强不做改变，因此其与spring的整合亦非常简单。只需把mybatis的依赖换成mybatis-plus的依赖，再把sqlSessionFactory换成mybatis-plus的即可。接下来看具体操作：<br> <strong>1、pom.xml:</strong><br> 核心依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.14.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mp 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>这些是核心依赖，本项目还用到了mysql驱动、c3p0、日志（slf4j-api，slf4j-log4j2）、lombok。集成mybatis-plus要把mybatis、mybatis-spring去掉，避免冲突；lombok是一个工具，添加了这个依赖，开发工具再安装Lombok插件，就可以使用它了，最常用的用法就是在实体类中使用它的@Data注解，这样实体类就不用写set、get、toString等方法了。关于Lombok的更多用法，请自行百度。</p>
<p><strong>2、log4j.xml:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">log4j</span>:configuration <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%-5p %d&#123;MM-dd</span></span></span><br><span class="line"><span class="tag"><span class="string">HH:mm:ss,SSS&#125; %m (%F:%L) \n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3、jdbc.properties:</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=<span class="symbol">jdbc:</span><span class="symbol">mysql:</span>/<span class="regexp">//</span>数据库名<span class="string">?u</span>seUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">jdbc.username=<span class="comment">#</span></span><br><span class="line">jdbc.password=<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><strong>4、mybatis-config.xml:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">PUBLIC <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>因为是与spring整合，所有mybatis-plus的大部分都写在spring的配置文件中，这里定义一个空的mybatis-config.xml即可。</p>
<p><strong>5、spring-dao.xml:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>    </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;    </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd&quot;</span>&gt;</span>    </span><br><span class="line">        </span><br><span class="line">    <span class="comment">&lt;!-- 配置整合mybatis-plus过程 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1、配置数据库相关参数properties的属性：$&#123;url&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2、配置数据库连接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis的sqlsessionFactorybean：org.mybatis.spring.SqlSessionFactoryBean--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3、配置mybatis-plus的sqlSessionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.baomidou.mybatisplus.spring.MybatisSqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.zhu.mybatisplus.entity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4、DAO接口所在包名，Spring会自动查找其下的类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.zhu.mybatisplus.dao&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>6、entity:</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = <span class="meta-string">&quot;tb_employee&quot;</span>)</span><span class="comment">//指定表名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="comment">//value与数据库主键列名一致，若实体类属性名与表主键列名一致可省略value</span></span><br><span class="line">    <span class="meta">@TableId(value = <span class="meta-string">&quot;id&quot;</span>,type = IdType.AUTO)</span><span class="comment">//指定自增策略</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">//若没有开启驼峰命名，或者表中列名不符合驼峰规则，可通过该注解指定数据库表中的列名，exist标明数据表中有没有对应列</span></span><br><span class="line">    <span class="meta">@TableField(value = <span class="meta-string">&quot;last_name&quot;</span>,exist = true)</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>7、mapper:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmplopyeeDao</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Employee</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就完成了mybatis-plus与spring的整合。首先是把mybatis和mybatis-spring依赖换成mybatis-plus的依赖，然后把sqlsessionfactory换成mybatis-plus的，然后实体类中添加<code>@TableName</code>、<code>@TableId</code>等注解，最后mapper继承<code>BaseMapper</code>即可。</p>
<p><strong>8、测试：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&#123;&quot;classpath:spring/spring-dao.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        System.out.println(dataSource.getConnection());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行该junit，可输出获取到的连接，说明整合没问题：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/11531502-2a0d958939bdcde8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/863/format/webp" alt="img"></p>
<p>image.png</p>
<p> 本文所有代码本人均亲自测试过，本文涉及代码又较多，为了不影响篇幅，故非必要处不再截图。接下来的所有操作都是基于此整合好的项目。</p>
<h1 id="三、mp的通用crud"><a href="#三、mp的通用crud" class="headerlink" title="三、mp的通用crud:"></a>三、mp的通用crud:</h1><p><strong>需求：</strong><br> 存在一张 tb_employee 表，且已有对应的实体类 Employee，实现tb_employee 表的 CRUD 操作我们需要做什么呢？<br> <strong>基于 Mybatis：</strong><br> 需要编写 EmployeeMapper 接口，并在 EmployeeMapper.xml 映射文件中手动编写 CRUD 方法对应的sql语句。<br> <strong>基于 MP：</strong><br> 只需要创建 EmployeeMapper 接口, 并继承 BaseMapper 接口。<br> 我们已经有了Employee、tb_employee了，并且EmployeeDao也继承了BaseMapper了，接下来就使用crud方法。</p>
<p><strong>1、insert操作：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&#123;&quot;classpath:spring/spring-dao.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmplopyeeDao emplopyeeDao;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">        employee.setLastName(<span class="string">&quot;东方不败&quot;</span>);</span><br><span class="line">        employee.setEmail(<span class="string">&quot;dfbb@163.com&quot;</span>);</span><br><span class="line">        employee.setGender(<span class="number">1</span>);</span><br><span class="line">        employee.setAge(<span class="number">20</span>);</span><br><span class="line">        emplopyeeDao.insert(employee);</span><br><span class="line">        <span class="comment">//mybatisplus会自动把当前插入对象在数据库中的id写回到该实体中</span></span><br><span class="line">        System.out.println(employee.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行添加操作，直接调用insert方法传入实体即可。</p>
<p><strong>2、update操作：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">        employee.setId(<span class="number">1</span>);</span><br><span class="line">        employee.setLastName(<span class="string">&quot;更新测试&quot;</span>);</span><br><span class="line">        <span class="comment">//emplopyeeDao.updateById(employee);//根据id进行更新，没有传值的属性就不会更新</span></span><br><span class="line">        emplopyeeDao.updateAllColumnById(employee);<span class="comment">//根据id进行更新，没传值的属性就更新为null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>注意这两个update操作的区别，<code>updateById</code>方法，没有传值的字段不会进行更新，比如只传入了lastName，那么age、gender等属性就会保留原来的值；<code>updateAllColumnById</code>方法，顾名思义，会更新所有的列，没有传值的列会更新为null。</p>
<p><strong>3、select操作：</strong></p>
<p><strong>(1)、</strong>根据id查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Employee employee &#x3D; emplopyeeDao.selectById(1);</span><br></pre></td></tr></table></figure>

<p><strong>(2)、</strong>根据条件查询一条数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Employee employeeCondition = <span class="keyword">new</span> Employee();</span><br><span class="line">employeeCondition.setId(<span class="number">1</span>);</span><br><span class="line">employeeCondition.setLastName(<span class="string">&quot;更新测试&quot;</span>);</span><br><span class="line"><span class="comment">//若是数据库中符合传入的条件的记录有多条，那就不能用这个方法，会报错</span></span><br><span class="line">Employee employee = emplopyeeDao.selectOne(employeeCondition);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>这个方法的sql语句就是<code>where id = 1 and last_name = 更新测试</code>，若是符合这个条件的记录不止一条，那么就会报错。</p>
<p><strong>(3)、</strong>根据查询条件返回多条数据：<br> 当符合指定条件的记录数有多条时，上面那个方法就会报错，就应该用这个方法。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>,<span class="built_in">Object</span>&gt; columnMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">columnMap.put(<span class="string">&quot;last_name&quot;</span>,<span class="string">&quot;东方不败&quot;</span>);<span class="comment">//写表中的列名</span></span><br><span class="line">columnMap.put(<span class="string">&quot;gender&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="built_in">List</span>&lt;Employee&gt; employees = emplopyeeDao.selectByMap(columnMap);</span><br><span class="line">System.out.println(employees.size());</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>查询条件用map集合封装，columnMap，写的是数据表中的列名，而非实体类的属性名。比如属性名为lastName，数据表中字段为last_name，这里应该写的是last_name。selectByMap方法返回值用list集合接收。</p>
<p><strong>(4)、</strong>通过id批量查询：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; idList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">idList.<span class="keyword">add</span>(<span class="number">1</span>);</span><br><span class="line">idList.<span class="keyword">add</span>(<span class="number">2</span>);</span><br><span class="line">idList.<span class="keyword">add</span>(<span class="number">3</span>);</span><br><span class="line">List&lt;Employee&gt; employees = emplopyeeDao.selectBatchIds(idList);</span><br><span class="line">System.<span class="keyword">out</span>.println(employees);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>把需要查询的id都add到list集合中，然后调用selectBatchIds方法，传入该list集合即可，该方法返回的是对应id的所有记录，所有返回值也是用list接收。</p>
<p><strong>(5)、</strong>分页查询：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Employee&gt; employees = emplopyeeDao.selectPage(<span class="keyword">new</span> Page&lt;&gt;(<span class="number">1</span>,<span class="number">2</span>),<span class="literal">null</span>);</span><br><span class="line">System.<span class="keyword">out</span>.println(employees);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>selectPage方法就是分页查询，在page中传入分页信息，后者为null的分页条件，这里先让其为null，讲了条件构造器再说其用法。这个分页其实并不是物理分页，而是内存分页。也就是说，查询的时候并没有limit语句。等配置了分页插件后才可以实现真正的分页。</p>
<p><strong>4、delete操作：</strong></p>
<p><strong>(1)、</strong>根据id删除：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emplopyeeDao<span class="selector-class">.deleteById</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>(2)、</strong>根据条件删除：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>,<span class="built_in">Object</span>&gt; columnMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">columnMap.put(<span class="string">&quot;gender&quot;</span>,<span class="number">0</span>);</span><br><span class="line">columnMap.put(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">emplopyeeDao.deleteByMap(columnMap);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>该方法与selectByMap类似，将条件封装在columnMap中，然后调用deleteByMap方法，传入columnMap即可，返回值是Integer类型，表示影响的行数。</p>
<p><strong>(3)、</strong>根据id批量删除：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; idList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">idList.<span class="keyword">add</span>(<span class="number">1</span>);</span><br><span class="line">idList.<span class="keyword">add</span>(<span class="number">2</span>);</span><br><span class="line">emplopyeeDao.deleteBatchIds(idList);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>该方法和selectBatchIds类似，把需要删除的记录的id装进idList，然后调用deleteBatchIds，传入idList即可。</p>
<h1 id="四、全局策略配置："><a href="#四、全局策略配置：" class="headerlink" title="四、全局策略配置："></a>四、全局策略配置：</h1><p>通过上面的小案例我们可以发现，实体类需要加@TableName注解指定数据库表名，通过@TableId注解指定id的增长策略。实体类少倒也无所谓，实体类一多的话也麻烦。所以可以在spring-dao.xml的文件中进行全局策略配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 5、mybatisplus的全局策略配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;globalConfiguration&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.baomidou.mybatisplus.entity.GlobalConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2.3版本后，驼峰命名默认值就是true，所以可不配置 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name=&quot;dbColumnUnderline&quot; value=&quot;true&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 全局主键自增策略，0表示auto --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;idType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 全局表前缀配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tablePrefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tb_&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里配置了还没用，还需要在sqlSessionFactory中注入配置才会生效。如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3、配置mybatisplus的sqlSessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.baomidou.mybatisplus.spring.MybatisSqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.zhu.mybatisplus.entity&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入全局配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;globalConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;globalConfiguration&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如此一来，实体类中的@TableName注解和@TableId注解就可以去掉了。</p>
<h1 id="五、条件构造器-EntityWrapper-："><a href="#五、条件构造器-EntityWrapper-：" class="headerlink" title="五、条件构造器(EntityWrapper)："></a>五、条件构造器(EntityWrapper)：</h1><p>以上基本的 CRUD 操作，我们仅仅需要继承一个 BaseMapper 即可实现大部分单表 CRUD 操作。BaseMapper 提供了多达 17 个方法供使用, 可以极其方便的实现单一、批量、分页等操作，极大的减少开发负担。但是mybatis-plus的强大不限于此，请看如下需求该如何处理：<br> <strong>需求：</strong><br> 我们需要分页查询 tb_employee 表中，年龄在 18~50 之间性别为男且姓名为 xx 的所有用户，这时候我们该如何实现上述需求呢？<br> <strong>使用MyBatis :</strong> 需要在 SQL 映射文件中编写带条件查询的 SQL,并用PageHelper 插件完成分页. 实现以上一个简单的需求，往往需要我们做很多重复单调的工作。<br> <strong>使用MP:</strong> 依旧不用编写 SQL 语句，MP 提供了功能强大的条件构造器 ——  EntityWrapper。</p>
<p><strong>接下来就直接看几个案例体会EntityWrapper的使用。</strong></p>
<p><strong>1、分页查询年龄在18 - 50且gender为0、姓名为tom的用户：</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Employee&gt; employees = emplopyeeDao.selectPage(<span class="keyword">new</span> Page&lt;Employee&gt;(<span class="number">1</span>,<span class="number">3</span>),</span><br><span class="line">     <span class="keyword">new</span> EntityWrapper&lt;Employee&gt;()</span><br><span class="line">        .between(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>,<span class="number">50</span>)</span><br><span class="line">        .eq(<span class="string">&quot;gender&quot;</span>,<span class="number">0</span>)</span><br><span class="line">        .eq(<span class="string">&quot;last_name&quot;</span>,<span class="string">&quot;tom&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>由此案例可知，分页查询和之前一样，new 一个page对象传入分页信息即可。至于分页条件，new 一个EntityWrapper对象，调用该对象的相关方法即可。between方法三个参数，分别是column、value1、value2，该方法表示column的值要在value1和value2之间；eq是equals的简写，该方法两个参数，column和value，表示column的值和value要相等。注意column是数据表对应的字段，而非实体类属性字段。</p>
<p><strong>2、查询gender为0且名字中带有老师、或者邮箱中带有a的用户：</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Employee&gt; employees = emplopyeeDao.selectList(</span><br><span class="line">                <span class="keyword">new</span> EntityWrapper&lt;Employee&gt;()</span><br><span class="line">               .eq(<span class="string">&quot;gender&quot;</span>,<span class="number">0</span>)</span><br><span class="line">               .like(<span class="string">&quot;last_name&quot;</span>,<span class="string">&quot;老师&quot;</span>)</span><br><span class="line">                <span class="comment">//.or()//和or new 区别不大</span></span><br><span class="line">               .orNew()</span><br><span class="line">               .like(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>未说分页查询，所以用selectList即可，用EntityWrapper的like方法进行模糊查询，like方法就是指column的值包含value值，此处like方法就是查询last_name中包含“老师”字样的记录；“或者”用or或者orNew方法表示，这两个方法区别不大，用哪个都可以，可以通过控制台的sql语句自行感受其区别。</p>
<p><strong>3、查询gender为0，根据age排序，简单分页：</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Employee&gt; employees = emplopyeeDao.selectList(</span><br><span class="line">                <span class="keyword">new</span> EntityWrapper&lt;Employee&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;gender&quot;</span>,<span class="number">0</span>)</span><br><span class="line">                .orderBy(<span class="string">&quot;age&quot;</span>)<span class="comment">//直接orderby 是升序，asc</span></span><br><span class="line">                .last(<span class="string">&quot;desc limit 1,3&quot;</span>)<span class="comment">//在sql语句后面追加last里面的内容(改为降序，同时分页)</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>简单分页是指不用page对象进行分页。orderBy方法就是根据传入的column进行升序排序，若要降序，可以使用orderByDesc方法，也可以如案例中所示用last方法；last方法就是将last方法里面的value值追加到sql语句的后面，在该案例中，最后的sql语句就变为<code>select ······ order by desc limit 1, 3</code>，追加了<code>desc limit 1,3</code>所以可以进行降序排序和分页。</p>
<p><strong>4、分页查询年龄在18 - 50且gender为0、姓名为tom的用户：</strong><br> 条件构造器除了EntityWrapper，还有Condition。用Condition来处理一下这个需求：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Employee&gt; employees = emplopyeeDao.selectPage(</span><br><span class="line">               <span class="keyword">new</span> Page&lt;Employee&gt;(<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">               Condition.create()</span><br><span class="line">                       .between(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>,<span class="number">50</span>)</span><br><span class="line">                       .eq(<span class="string">&quot;gender&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>Condition和EntityWrapper的区别就是，创建条件构造器时，EntityWrapper是new出来的，而Condition是调create方法创建出来。</p>
<p><strong>5、根据条件更新：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEntityWrapperUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">        employee.setLastName(<span class="string">&quot;苍老师&quot;</span>);</span><br><span class="line">        employee.setEmail(<span class="string">&quot;cjk@sina.com&quot;</span>);</span><br><span class="line">        employee.setGender(<span class="number">0</span>);</span><br><span class="line">        emplopyeeDao.update(employee,</span><br><span class="line">                <span class="keyword">new</span> EntityWrapper&lt;Employee&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;last_name&quot;</span>,<span class="string">&quot;tom&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;age&quot;</span>,<span class="number">25</span>)</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>该案例表示把last_name为tom，age为25的所有用户的信息更新为employee中设置的信息。</p>
<p><strong>6、根据条件删除：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emplopyeeDao.<span class="keyword">delete</span>(</span><br><span class="line">        <span class="keyword">new</span> EntityWrapper&lt;Employee&gt;()</span><br><span class="line">        .eq(<span class="string">&quot;last_name&quot;</span>,<span class="string">&quot;tom&quot;</span>)</span><br><span class="line">        .eq(<span class="string">&quot;age&quot;</span>,<span class="number">16</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong>该案例表示把last_name为tom、age为16的所有用户删除。</p>
<p>作者：贪挽懒月<br>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ceb1df475021">https://www.jianshu.com/p/ceb1df475021</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h2 id="Mybatis-Plus和Mybatis的区别"><a href="#Mybatis-Plus和Mybatis的区别" class="headerlink" title="Mybatis-Plus和Mybatis的区别"></a>Mybatis-Plus和Mybatis的区别</h2><p><img src="/13.2.MyBatis-Plus/20190530134824262.png" alt="在这里插入图片描述"></p>
<p><img src="/13.2.MyBatis-Plus/2019053013474765.png" alt="在这里插入图片描述"></p>
<p>区别一<br>如果Mybatis Plus是扳手，那Mybatis Generator就是生产扳手的工厂。<br>通俗来讲——<br>MyBatis：一种操作数据库的框架，提供一种Mapper类，支持让你用java代码进行增删改查的数据库操作，省去了每次都要手写sql语句的麻烦。但是！有一个前提，你得先在xml中写好sql语句，是不是很麻烦？于是有下面的↓<br>Mybatis Generator：自动为Mybatis生成简单的增删改查sql语句的工具，省去一大票时间，两者配合使用，开发速度快到飞起。至于标题说的↓<br>Mybatis Plus：国人团队苞米豆在Mybatis的基础上开发的框架，在Mybatis基础上扩展了许多功能，荣获了2018最受欢迎国产开源软件第5名，当然也有配套的↓<br>Mybatis Plus Generator：同样为苞米豆开发，比Mybatis Generator更加强大，支持功能更多，自动生成Entity、Mapper、Service、Controller等<br>总结：<br>数据库框架：Mybatis Plus &gt; Mybatis<br>代码生成器：Mybatis Plus Generator &gt; Mybatis Generator</p>
<p>区别二<br>Mybatis-Plus是一个Mybatis的增强工具，它在Mybatis的基础上做了增强，却不做改变。我们在使用Mybatis-Plus之后既可以使用Mybatis-Plus的特有功能，又能够正常使用Mybatis的原生功能。Mybatis-Plus(以下简称MP)是为简化开发、提高开发效率而生，但它也提供了一些很有意思的插件，比如SQL性能监控、乐观锁、执行分析等。</p>
<p>Mybatis虽然已经给我们提供了很大的方便，但它还是有不足之处，实际上没有什么东西是完美的，MP的存在就是为了稍稍弥补Mybatis的不足。在我们使用Mybatis时会发现，每当要写一个业务逻辑的时候都要在DAO层写一个方法，再对应一个SQL，即使是简单的条件查询、即使仅仅改变了一个条件都要在DAO层新增一个方法，针对这个问题，MP就提供了一个很好的解决方案，之后我会进行介绍。另外，MP的代码生成器也是一个很有意思的东西，它可以让我们避免许多重复性的工作，下面我将介绍如何在你的项目中集成MP。</p>
<p>mybatis-plus添加依赖</p>
<p>首先添加maven依赖：springboot项目用下面这个依赖！</p>
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.2.0</version>
</dependency>
注意这里的依赖！我之前犯过错误！因为使用的是springboot项目所以用上面这个依赖。如果是spring项目则用下面的依赖 

<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus</artifactId>
    <version>3.2.0</version>
</dependency>
然后就可以使用BaseMapper <entity范型> 



<p>启动类上还需要加上 @MapperScan(“UserMapper接口所在的包”)</p>
<blockquote>
<p>例如：@MapperScan(“top.yumbo.dao”) 这样启动的时候就不会因为注入的时候导致报错</p>
</blockquote>
<p>一、 集成步骤↓：(首先，你要有个spring项目)<br>集成依赖，pom中加入依赖即可，不多说：<br>Java代码 收藏代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis mybatis-plus mybatis-spring mvc --&gt;  </span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;mybatis-plus&lt;&#x2F;artifactId&gt;  </span><br><span class="line">    &lt;version&gt;$&#123;mybatis-plus.version&#125;&lt;&#x2F;version&gt;  </span><br><span class="line">&lt;&#x2F;dependency&gt;  </span><br><span class="line">&lt;dependency&gt;  </span><br><span class="line">    &lt;groupId&gt;org.apache.velocity&lt;&#x2F;groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;velocity-engine-core&lt;&#x2F;artifactId&gt;  </span><br><span class="line">    &lt;version&gt;2.0&lt;&#x2F;version&gt;  </span><br><span class="line">&lt;&#x2F;dependency&gt;  </span><br></pre></td></tr></table></figure>


<p>说明：笔者使用的版本为：mybatis-plus.version=2.1-gamma，上边的代码中有两个依赖，第一个是mybatis-plus核心依赖，第二个是使用代码生成器时需要的模板引擎依赖，若果你不打算使用代码生成器，此处可不引入。<br>注意：mybatis-plus的核心jar包中已集成了mybatis和mybatis-spring，所以为避免冲突，请勿再次引用这两个jar包。</p>
<p>说明：笔者使用的版本为：mybatis-plus.version=2.1-gamma，上边的代码中有两个依赖，第一个是mybatis-plus核心依赖，第二个是使用代码生成器时需要的模板引擎依赖，若果你不打算使用代码生成器，此处可不引入。<br>注意：mybatis-plus的核心jar包中已集成了mybatis和mybatis-spring，所以为避免冲突，请勿再次引用这两个jar包。</p>
<p>二、 在spring中配置MP：<br><bean id="sqlSessionFactory"  
    class="com.baomidou.mybatisplus.spring.MybatisSqlSessionFactoryBean"><br>    <!-- 配置数据源 --><br>    <property name="dataSource" ref="dataSource" /><br>    <!-- 自动扫描 Xml 文件位置 --><br>    <property name="mapperLocations" value="classpath*:com/ds/orm/mapper/**/*.xml" /><br>    <!-- 配置 Mybatis 配置文件（可无） --><br>    <property name="configLocation" value="classpath:mybatis-config.xml" /><br>    <!-- 配置包别名，支持通配符 * 或者 ; 分割 --><br>    <property name="typeAliasesPackage" value="com.ds.orm.model" /><br>    <!-- 枚举属性配置扫描，支持通配符 * 或者 ; 分割 --><br>    <!-- <property name="typeEnumsPackage" value="com.baomidou.springmvc.entity.*.enums"   
        /> --><br>    <!-- 以上配置和传统 Mybatis 一致 -->  </p>
<pre><code>&lt;!-- MP 全局配置注入 --&gt;  
&lt;property name=&quot;globalConfig&quot; ref=&quot;globalConfig&quot; /&gt;  
</code></pre>
</bean>  
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
<bean id="globalConfig" class="com.baomidou.mybatisplus.entity.GlobalConfiguration">  
    <!-- 主键策略配置 -->  
    <!-- 可选参数 AUTO->`0`("数据库ID自增") INPUT->`1`(用户输入ID") ID_WORKER->`2`("全局唯一ID")   
        UUID->`3`("全局唯一ID") -->  
    <property name="idType" value="2" />  
    <!-- 数据库类型配置 -->  
    <!-- 可选参数（默认mysql） MYSQL->`mysql` ORACLE->`oracle` DB2->`db2` H2->`h2`   
        HSQL->`hsql` SQLITE->`sqlite` POSTGRE->`postgresql` SQLSERVER2005->`sqlserver2005`   
        SQLSERVER->`sqlserver` -->  
    <property name="dbType" value="mysql" />  
    <!-- 全局表为下划线命名设置 true -->  
    <property name="dbColumnUnderline" value="true" />  
    <property name="sqlInjector">  
        <bean class="com.baomidou.mybatisplus.mapper.AutoSqlInjector" />  
    </property>  
</bean>  
<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">  
    <description>DAO接口所在包名，Spring会自动查找其下的类</description>  
    <property name="basePackage" value="com.ds.orm.mapper" />  
    <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory" />  
</bean>  
<!-- 乐观锁插件 -->  
<bean class="com.baomidou.mybatisplus.plugins.OptimisticLockerInterceptor" />  

<!-- xml mapper热加载 sqlSessionFactory:session工厂 mapperLocations:mapper匹配路径   
    enabled:是否开启动态加载 默认:false delaySeconds:项目启动延迟加载时间 单位：秒 默认:10s sleepSeconds:刷新时间间隔   
    单位：秒 默认:20s -->  
<bean class="com.baomidou.mybatisplus.spring.MybatisMapperRefresh">  
    <constructor-arg name="sqlSessionFactory" ref="sqlSessionFactory" />  
    <constructor-arg name="mapperLocations"  
        value="classpath*:com/ds/orm/mapper/*/*.xml" />  
    <constructor-arg name="delaySeconds" value="10" />  
    <constructor-arg name="sleepSeconds" value="20" />  
    <constructor-arg name="enabled" value="true" />  
</bean>  

<!-- 事务 -->  
<p><bean id="transactionManager"  
    class="org.springframework.jdbc.datasource.DataSourceTransactionManager"><br>    <property name="dataSource" ref="dataSource" /><br></bean><br>&lt;tx:annotation-driven transaction-manager=”transactionManager”<br>    proxy-target-class=”true” /&gt;  </p>
<p> 注意：只要做如上配置就可以正常使用mybatis了，不要重复配置。MP的配置和mybatis一样，都是配置一个sqlSessionFactory，只是现在所配置的类在原本的SqlSessionFactoryBean基础上做了增强。插件等配置请按需取舍。<br>插件配置，按需求配置就可以，此处把可以配置的插件都列了出来，具体的请看代码注释：</p>
<configuration>  
    <settings>  
        <setting name="logImpl" value="SLF4J" />  
        <!-- 字段为空时仍调用model的set方法或map的put方法 -->  
        <setting name="callSettersOnNulls" value="true" />  
    </settings>  
    <plugins>  
        <!-- | 分页插件配置 | 插件提供二种方言选择：1、默认方言 2、自定义方言实现类，两者均未配置则抛出异常！ | overflowCurrent   
            溢出总页数，设置第一页 默认false | optimizeType Count优化方式 （ 版本 2.0.9 改为使用 jsqlparser 不需要配置   
            ） | -->  
        <!-- 注意!! 如果要支持二级缓存分页使用类 CachePaginationInterceptor 默认、建议如下！！ -->  
        <plugin interceptor="com.baomidou.mybatisplus.plugins.PaginationInterceptor">  
            <property name="dialectType" value="mysql" />  
            <!--<property name="sqlParser" ref="自定义解析类、可以没有" />  
            <property name="localPage" value="默认 false 改为 true 开启了 pageHeper 支持、可以没有" />  
            <property name="dialectClazz" value="自定义方言类、可以没有" /> -->  
        </plugin>  

<pre><code>    &lt;!-- SQL 执行性能分析，开发环境使用，线上不推荐。 maxTime 指的是 sql 最大执行时长 --&gt;  
    &lt;plugin interceptor=&quot;com.baomidou.mybatisplus.plugins.PerformanceInterceptor&quot;&gt;  
        &lt;property name=&quot;maxTime&quot; value=&quot;2000&quot; /&gt;  
        &lt;!--SQL是否格式化 默认false --&gt;  
        &lt;property name=&quot;format&quot; value=&quot;true&quot; /&gt;  
    &lt;/plugin&gt;  
  
    &lt;!-- SQL 执行分析拦截器 stopProceed 发现全表执行 delete update 是否停止运行 该插件只用于开发环境，不建议生产环境使用。。。 --&gt;  
    &lt;plugin interceptor=&quot;com.baomidou.mybatisplus.plugins.SqlExplainInterceptor&quot;&gt;  
        &lt;property name=&quot;stopProceed&quot; value=&quot;false&quot; /&gt;  
    &lt;/plugin&gt;  
&lt;/plugins&gt;  
</code></pre>
</configuration>  
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
注意：执行分析拦截器和性能分析推荐只在开发时调试程序使用，为保证程序性能和稳定性，建议在生产环境中注释掉这两个插件。
数据源：(此处使用druid)

<!-- 配置数据源 -->  
<bean name="dataSource" class="com.alibaba.druid.pool.DruidDataSource" init-method="init" destroy-method="close">  
    <!--     <property name="driverClassName" value="${jdbc.driverClassName}" /> -->  
    <property name="url" value="${jdbc.url}" />   
    <property name="username" value="${jdbc.username}" />   
    <property name="password" value="${jdbc.password}" />   
    <property name="initialSize" value="${jdbc.initialSize}" />   
    <property name="minIdle" value="${jdbc.minIdle}" />   
    <property name="maxActive" value="${jdbc.maxActive}" />   
    <property name="maxWait" value="${jdbc.maxWait}" />   
    <property name="timeBetweenEvictionRunsMillis" value="${jdbc.timeBetweenEvictionRunsMillis}" />   
    <property name="minEvictableIdleTimeMillis" value="${jdbc.minEvictableIdleTimeMillis}" />   
    <property name="validationQuery" value="${jdbc.validationQuery}" />   
    <property name="testWhileIdle" value="${jdbc.testWhileIdle}" />   
    <property name="testOnBorrow" value="${jdbc.testOnBorrow}" />   
    <property name="testOnReturn" value="${jdbc.testOnReturn}" />   
    <property name="removeAbandoned" value="${jdbc.removeAbandoned}" />   
    <property name="removeAbandonedTimeout" value="${jdbc.removeAbandonedTimeout}" />   
    <!--     <property name="logAbandoned" value="${jdbc.logAbandoned}" /> -->  
    <property name="filters" value="${jdbc.filters}" />  
    <!-- 关闭abanded连接时输出错误日志 -->  
    <property name="logAbandoned" value="true" />  
    <property name="proxyFilters">  
        <list>  
            <ref bean="log-filter"/>  
        </list>  
    </property>  

<pre><code>&lt;!-- 监控数据库 --&gt;  
&lt;!-- &lt;property name=&quot;filters&quot; value=&quot;stat&quot; /&gt; --&gt;  
&lt;!--     &lt;property name=&quot;filters&quot; value=&quot;mergeStat&quot; /&gt;--&gt;  
</code></pre>
</bean>  
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
到此，MP已经集成进我们的项目中了，下面将介绍它是如何简化我们的开发的。
.
.
.

<p>**</p>
<p>三、 简单的CURD操作↓：<br>**<br>假设我们有一张user表，且已经建立好了一个与此表对应的实体类User，我们来介绍对user的简单增删改查操作。<br>建立DAO层接口。我们在使用普通的mybatis时会建立一个DAO层接口，并对应一个xml用来写SQL。在这里我们同样要建立一个DAO层接口，但是若无必要，我们甚至不需要建立xml，就可以进行资源的CURD操作了，我们只需要让我们建立的DAO继承MP提供的BaseMapper&lt;?&gt;即可：</p>
<p>public interface UserMapper extends BaseMapper { }<br>然后在我们需要做数据CURD时，像下边这样就好了：<br>Java代码 收藏代码<br>// 初始化 影响行数<br>int result = 0;<br>// 初始化 User 对象<br>User user = new User();</p>
<p>// 插入 User (插入成功会自动回写主键到实体类)<br>user.setName(“Tom”);<br>result = userMapper.insert(user);</p>
<p>// 更新 User<br>user.setAge(18);<br>result = userMapper.updateById(user);//user要设置id哦，具体的在下边我会详细介绍</p>
<p>// 查询 User<br>User exampleUser = userMapper.selectById(user.getId());</p>
<p>// 查询姓名为‘张三’的所有用户记录<br>List userList = userMapper.selectList(<br>new EntityWrapper().eq(“name”, “张三”)<br>);</p>
<p>// 删除 User<br>result = userMapper.deleteById(user.getId());</p>
<p>方便吧？如果只使用mybatis可是要写4个SQL和4个方法喔，当然了，仅仅上边这几个方法还远远满足不了我们的需求，请往下看：</p>
<p>.<br>.</p>
<p>**</p>
<p>多条件分页查询：<br>**<br>// 分页查询 10 条姓名为‘张三’、性别为男，且年龄在18至50之间的用户记录</p>
<p>List<User> userList = userMapper.selectPage(<br>        new Page<User>(1, 10),<br>        new EntityWrapper<User>().eq(“name”, “张三”)<br>                .eq(“sex”, 0)<br>                .between(“age”, “18”, “50”)<br>);<br>1<br>2<br>3<br>4<br>5<br>6<br>/**等价于SELECT *<br>*FROM sys_user<br>*WHERE (name=‘张三’ AND sex=0 AND age BETWEEN ‘18’ AND ‘50’)<br>*LIMIT 0,10<br>*/<br>.<br>.<br>.<br>下边这个，多条件构造器。其实对于条件过于复杂的查询，笔者还是建议使用原生mybatis的方式实现，易于维护且逻辑清晰，如果所有的数据操作都强行使用MP，就失去了MP简化开发的意义了。所以在使用时请按实际情况取舍，在这里还是先介绍一下。</p>
<p>public Page<T> selectPage(Page<T> page, EntityWrapper<T> entityWrapper) {<br>  if (null != entityWrapper) {<br>      entityWrapper.orderBy(page.getOrderByField(), page.isAsc());//排序<br>  }<br>  page.setRecords(baseMapper.selectPage(page, entityWrapper));//将查询结果放入page中<br>  return page;<br>}<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>** 条件构造一(上边方法的entityWrapper参数)：**</p>
<p>public void testTSQL11() {<br>    /*<br>     * 实体带查询使用方法  输出看结果<br>     <em>/<br>    EntityWrapper<User> ew = new EntityWrapper<User>();<br>    ew.setEntity(new User(1));<br>    ew.where(“user_name={0}”, “‘zhangsan’”).and(“id=1”)<br>            .orNew(“user_status={0}”, “0”).or(“status=1”)<br>            .notLike(“user_nickname”, “notvalue”)<br>            .andNew(“new=xx”).like(“hhh”, “ddd”)<br>            .andNew(“pwd=11”).isNotNull(“n1,n2”).isNull(“n3”)<br>            .groupBy(“x1”).groupBy(“x2,x3”)<br>            .having(“x1=11”).having(“x3=433”)<br>            .orderBy(“dd”).orderBy(“d1,d2”);<br>    System.out.println(ew.getSqlSegment());<br>}<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>.<br>.<br>.<br>** 条件构造二（同上）：</em>*</p>
<p>int buyCount = selectCount(Condition.create()<br>.setSqlSelect(“sum(quantity)”)<br>.isNull(“order_id”)<br>.eq(“user_id”, 1)<br>.eq(“type”, 1)<br>.in(“status”, new Integer[]{0, 1})<br>.eq(“product_id”, 1)<br>.between(“created_time”, startDate, currentDate)<br>.eq(“weal”, 1));<br>自定义条件使用entityWrapper：</p>
<p>List selectMyPage(RowBounds rowBounds, @Param(“ew”) Wrapper wrapper);</p>
<p>SELECT * FROM user ${ew.sqlSegment} <em>注意：此处不用担心SQL注入，MP已对ew做了字符串转义处理。 其实在使用MP做数据CURD时，还有另外一个方法，AR(ActiveRecord )，很简单，让我们的实体类继承MP提供Model&lt;?&gt;就好了，这和我们常用的方法可能会有些不同，下边简单说一下吧：</em><br>.<br>.<br>.<br>.<br>//实体类<br>@TableName(“sys_user”) // 注解指定表名<br>public class User extends Model {<br>… // fields</p>
<p>… // getter and setter</p>
<p>.<br>.</p>
<p>/ 指定主键 /*<br>@Override<br>protected Serializable pkVal() { //一定要指定主键哦<br>return this.id;<br>}<br>}<br>.<br>.<br>.<br>下边就是CURD操作了：</p>
<p>// 初始化 成功标识<br>boolean result = false;<br>// 初始化 User<br>User user = new User();</p>
<p>// 保存 User<br>user.setName(“Tom”);<br>result = user.insert();</p>
<p>// 更新 User<br>user.setAge(18);<br>result = user.updateById();</p>
<p>// 查询 User<br>User exampleUser = t1.selectById();</p>
<p>// 查询姓名为‘张三’的所有用户记录<br>List userList1 = user.selectList(<br>new EntityWrapper().eq(“name”, “张三”)<br>);</p>
<p>// 删除 User<br>result = t2.deleteById();</p>
<p>// 分页查询 10 条姓名为‘张三’、性别为男，且年龄在18至50之间的用户记录<br>List userList = user.selectPage(<br>new Page(1, 10),<br>new EntityWrapper().eq(“name”, “张三”)<br>.eq(“sex”, 0)<br>.between(“age”, “18”, “50”)<br>).getRecords();<br>就是这样了，可能你会说MP封装的有些过分了，这样做会分散数据逻辑到不同的层面中，难以管理，使代码难以理解。其实确实是这样，这就需要你在使用的时候注意一下了，在简化开发的同时也要保证你的代码层次清晰，做一个战略上的设计或者做一个取舍与平衡。<br>.<br>.<br>.<br>.<br>.<br>.</p>
<p>**</p>
<p>其实上边介绍的功能也不是MP的全部啦，下边介绍一下MP最有意思的模块——代码生成器。<br>**</p>
<p>步骤↓：<br>如上边所说，使用代码生成器一定要引入velocity-engine-core(模板引擎)这个依赖。<br>准备工作：<br>选择主键策略，就是在上边最开始时候我介绍MP配置时其中的这项配置，如果你不记得了，请上翻！MP提供了如下几个主键策略： 值 描述<br>IdType.AUTO ———-数据库ID自增<br>IdType.INPUT ———-用户输入ID<br>IdType.ID_WORKER———- 全局唯一ID，内容为空自动填充（默认配置）<br>IdType.UUID ———-全局唯一ID，内容为空自动填充<br>MP默认使用的是ID_WORKER，这是MP在Sequence的基础上进行部分优化，用于产生全局唯一ID。</p>
<p>表及字段命名策略选择，同上，还是在那个配置中。下边这段复制至MP官方文档：<br>在MP中，我们建议数据库表名采用下划线命名方式，而表字段名采用驼峰命名方式。</p>
<p>这么做的原因是为了避免在对应实体类时产生的性能损耗，这样字段不用做映射就能直接和实体类对应。当然如果项目里不用考虑这点性能损耗，那么你采用下滑线也是没问题的，只需要在生成代码时配置dbColumnUnderline属性就可以。</p>
<p>建表(命名规则依照刚才你所配置的，这会影响生成的代码的类名、字段名是否正确)。<br>执行下边的main方法，生成代码：</p>
<p>import java.util.HashMap;<br>import java.util.Map;  </p>
<p>import com.baomidou.mybatisplus.generator.AutoGenerator;<br>import com.baomidou.mybatisplus.generator.InjectionConfig;<br>import com.baomidou.mybatisplus.generator.config.DataSourceConfig;<br>import com.baomidou.mybatisplus.generator.config.GlobalConfig;<br>import com.baomidou.mybatisplus.generator.config.PackageConfig;<br>import com.baomidou.mybatisplus.generator.config.StrategyConfig;<br>import com.baomidou.mybatisplus.generator.config.rules.DbType;<br>import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;  </p>
<p>/** </p>
<ul>
<li><p> </li>
<li>代码生成器演示 </li>
<li></p> </li>
<li>/<br>public class MpGenerator {    /** <ul>
<li><p> </li>
<li>MySQL 生成演示 </li>
<li></p> </li>
<li>/<br>public static void main(String[] args) {<br>  AutoGenerator mpg = new AutoGenerator();    // 全局配置<br>  GlobalConfig gc = new GlobalConfig();<br>  gc.setOutputDir(“D://“);<br>  gc.setFileOverride(true);<br>  gc.setActiveRecord(true);// 不需要ActiveRecord特性的请改为false<br>  gc.setEnableCache(false);// XML 二级缓存<br>  gc.setBaseResultMap(true);// XML ResultMap<br>  gc.setBaseColumnList(false);// XML columList<br>// .setKotlin(true) 是否生成 kotlin 代码<br>  gc.setAuthor(“Yanghu”);    // 自定义文件命名，注意 %s 会自动填充表实体属性！<br>  // gc.setMapperName(“%sDao”);<br>  // gc.setXmlName(“%sDao”);<br>  // gc.setServiceName(“MP%sService”);<br>  // gc.setServiceImplName(“%sServiceDiy”);<br>  // gc.setControllerName(“%sAction”);<br>  mpg.setGlobalConfig(gc);    // 数据源配置<br>  DataSourceConfig dsc = new DataSourceConfig();<br>  dsc.setDbType(DbType.MYSQL);<br>  dsc.setTypeConvert(new MySqlTypeConvert(){  <pre><code>  // 自定义数据库表字段类型转换【可选】  
  @Override  
  public DbColumnType processTypeConvert(String fieldType) &#123;  
      System.out.println(&quot;转换类型：&quot; + fieldType);  
</code></pre>
  // 注意！！processTypeConvert 存在默认类型转换，如果不是你要的效果请自定义返回、非如下直接返回。  <pre><code>      return super.processTypeConvert(fieldType);  
  &#125;  
</code></pre>
  });<br>  dsc.setDriverName(“com.mysql.jdbc.Driver”);<br>  dsc.setUsername(“root”);<br>  dsc.setPassword(“521”);<br>  dsc.setUrl(“jdbc:mysql://127.0.0.1:3306/mybatis-plus?characterEncoding=utf8”);<br>  mpg.setDataSource(dsc);    // 策略配置<br>  StrategyConfig strategy = new StrategyConfig();<br>// strategy.setCapitalMode(true);// 全局大写命名 ORACLE 注意<br>  strategy.setTablePrefix(new String[] { “tlog_”, “tsys_” });// 此处可以修改为您的表前缀<br>  strategy.setNaming(NamingStrategy.underline_to_camel);// 表名生成策略<br>  // strategy.setInclude(new String[] { “user” }); // 需要生成的表<br>  // strategy.setExclude(new String[]{“test”}); // 排除生成的表<br>  // 自定义实体父类<br>  // strategy.setSuperEntityClass(“com.baomidou.demo.TestEntity”);<br>  // 自定义实体，公共字段<br>  // strategy.setSuperEntityColumns(new String[] { “test_id”, “age” });<br>  // 自定义 mapper 父类<br>  // strategy.setSuperMapperClass(“com.baomidou.demo.TestMapper”);<br>  // 自定义 service 父类<br>  // strategy.setSuperServiceClass(“com.baomidou.demo.TestService”);<br>  // 自定义 service 实现类父类<br>  // strategy.setSuperServiceImplClass(“com.baomidou.demo.TestServiceImpl”);<br>  // 自定义 controller 父类<br>  // strategy.setSuperControllerClass(“com.baomidou.demo.TestController”);<br>  // 【实体】是否生成字段常量（默认 false）<br>  // public static final String ID = “test_id”;<br>  // strategy.setEntityColumnConstant(true);<br>  // 【实体】是否为构建者模型（默认 false）<br>  // public User setName(String name) {this.name = name; return this;}<br>  // strategy.setEntityBuilderModel(true);<br>  mpg.setStrategy(strategy);    // 包配置<br>  PackageConfig pc = new PackageConfig();<br>  pc.setParent(“com.baomidou”);<br>  pc.setModuleName(“test”);<br>  mpg.setPackageInfo(pc);    // 注入自定义配置，可以在 VM 中使用 cfg.abc 【可无】<br>  InjectionConfig cfg = new InjectionConfig() {  <pre><code>  @Override  
  public void initMap() &#123;  
      Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();  
      map.put(&quot;abc&quot;, this.getConfig().getGlobalConfig().getAuthor() + &quot;-mp&quot;);  
      this.setMap(map);  
  &#125;  
</code></pre>
  };    // 自定义 xxList.jsp 生成<br>  List<FileOutConfig> focList = new ArrayList<FileOutConfig>();<br>  focList.add(new FileOutConfig(“/template/list.jsp.vm”) {  <pre><code>  @Override  
  public String outputFile(TableInfo tableInfo) &#123;  
      // 自定义输入文件名称  
      return &quot;D://my_&quot; + tableInfo.getEntityName() + &quot;.jsp&quot;;  
  &#125;  
</code></pre>
  });<br>  cfg.setFileOutConfigList(focList);<br>  mpg.setCfg(cfg);  </li>
</ul>
  // 调整 xml 生成目录演示  <pre><code>   focList.add(new FileOutConfig(&quot;/templates/mapper.xml.vm&quot;) &#123;  
      @Override  
      public String outputFile(TableInfo tableInfo) &#123;  
          return &quot;/develop/code/xml/&quot; + tableInfo.getEntityName() + &quot;.xml&quot;;  
      &#125;  
  &#125;);  
  cfg.setFileOutConfigList(focList);  
  mpg.setCfg(cfg);  

  // 关闭默认 xml 生成，调整生成 至 根目录  
  TemplateConfig tc = new TemplateConfig();  
  tc.setXml(null);  
  mpg.setTemplate(tc);  
  
  // 自定义模板配置，可以 copy 源码 mybatis-plus/src/main/resources/templates 下面内容修改，  
  // 放置自己项目的 src/main/resources/templates 目录下, 默认名称一下可以不配置，也可以自定义模板名称  
  // TemplateConfig tc = new TemplateConfig();  
  // tc.setController(&quot;...&quot;);  
  // tc.setEntity(&quot;...&quot;);  
  // tc.setMapper(&quot;...&quot;);  
  // tc.setXml(&quot;...&quot;);  
  // tc.setService(&quot;...&quot;);  
  // tc.setServiceImpl(&quot;...&quot;);  
</code></pre>
  // 如上任何一个模块如果设置 空 OR Null 将不生成该模块。  <pre><code>  // mpg.setTemplate(tc);  

  // 执行生成  
  mpg.execute();  
  
  // 打印注入设置【可无】  
  System.err.println(mpg.getCfg().getMap().get(&quot;abc&quot;));  
</code></pre>
  }  </li>
</ul>
<p>}  </p>
<p>说明：中间的内容请自行修改，注释很清晰。<br>成功生成代码，将生成的代码拷贝到你的项目中就可以了，这个东西节省了我们大量的时间和精力！</p>
<p>**<br>.<br>.<br>.<br>.<br>.<br>.</p>
<p>以下是注解说明，摘自官方文档： 注解说明**<br>表名注解 @TableName</p>
<p>com.baomidou.mybatisplus.annotations.TableName<br>值 描述<br>value ———- 表名（ 默认空 ）<br>resultMap ———- xml 字段映射 resultMap ID</p>
<p>主键注解 @TableId</p>
<p>com.baomidou.mybatisplus.annotations.TableId<br>值 描述<br>value ———- 字段值（驼峰命名方式，该值可无）<br>type ———-主键 ID 策略类型（ 默认 INPUT ，全局开启的是 ID_WORKER ）<br>暂不支持组合主键</p>
<p>字段注解 @TableField</p>
<p>com.baomidou.mybatisplus.annotations.TableField<br>值 描述<br>value ———-字段值（驼峰命名方式，该值可无）<br>el ———- 详看注释说明<br>exist ———-是否为数据库表字段（ 默认 true 存在，false 不存在 ）<br>strategy ———- 字段验证 （ 默认 非 null 判断，查看 com.baomidou.mybatisplus.enums.FieldStrategy ）<br>.<br>fill ———-字段填充标记 （ FieldFill, 配合自动填充使用 ）<br>字段填充策略 FieldFill<br>值 描述<br>DEFAULT ———-默认不处理<br>INSERT ———-插入填充字段<br>UPDATE ———-更新填充字段<br>INSERT_UPDATE ———-插入和更新填充字段</p>
<p>序列主键策略 注解 @KeySequence</p>
<p>com.baomidou.mybatisplus.annotations.KeySequence<br>值 描述<br>value ———-序列名<br>clazz ———-id的类型<br>乐观锁标记注解 ———-@Version</p>
<p>com.baomidou.mybatisplus.annotations.Version<br>排除非表字段、查看文档常见问题部分！</p>
<p>总结：MP的宗旨是简化开发，但是它在提供方便的同时却容易造成代码层次混乱，我们可能会把大量数据逻辑写到service层甚至contoller层中，使代码难以阅读。凡事过犹不及，在使用MP时一定要做分析，不要将所有数据操作都交给MP去实现。毕竟MP只是mybatis的增强工具，它并没有侵入mybatis的原生功能，在使用MP的增强功能的同时，原生mybatis的功能依然是可以正常使用的</p>
<h2 id="一些疑问"><a href="#一些疑问" class="headerlink" title="一些疑问"></a>一些疑问</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/13.2.MyBatis-Plus/" data-id="ckq1xbduz006cpwwdadly6gfk" data-title="MyBatis-Plus" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-12.2.SpringMVC" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/12.2.SpringMVC/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:06:03.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/12.2.SpringMVC/">SpringMVC</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一、@RequestMapping 简介</p>
<p>在Spring MVC 中使用 @RequestMapping 来映射请求，也就是通过它来指定控制器可以处理哪些URL请求，相当于Servlet中在web.xml中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;servletName&lt;&#x2F;servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;ServletClass&lt;&#x2F;servlet-class&gt;</span><br><span class="line">&lt;&#x2F;servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;servletName&lt;&#x2F;servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;url&lt;&#x2F;url-pattern&gt;</span><br><span class="line">&lt;&#x2F;servlet-mapping&gt;</span><br></pre></td></tr></table></figure>

<p>的映射作用一致。让我们先看一下RequestMapping注解类的源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Mapping</span><br><span class="line">public @interface RequestMapping &#123;</span><br><span class="line">    String name() default &quot;&quot;;</span><br><span class="line">    String[] value() default &#123;&#125;;</span><br><span class="line">    String[] path() default &#123;&#125;;</span><br><span class="line">    RequestMethod[] method() default &#123;&#125;;</span><br><span class="line">    String[] params() default &#123;&#125;;</span><br><span class="line">    String[] headers() default &#123;&#125;;</span><br><span class="line">    String[] consumes() default &#123;&#125;;</span><br><span class="line">    String[] produces() default &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1）在@Target中有两个属性，分别为 ElementType.METHOD 和 ElementType.TYPE ，也就是说 @RequestMapping 可以在方法和类的声明中使用</p>
<p>2）可以看到注解中的属性除了 name() 返回的字符串，其它的方法均返回数组，也就是可以定义多个属性值，例如 value() 和 path() 都可以同时定义多个字符串值来接收多个URL请求</p>
<p>二、准备工作</p>
<p>1）新建一个 Web 工程，取名为 SpringMVC </p>
<p>略</p>
<p>2）新建一个的控制器类：UserController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package cn.kolbe.spring.mvc.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3）新建和配置 web.xml 以及 spring-mvc.xml 文件</p>
<p>4）新建一个测试的 JSP 页面 index.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt; &lt;a href&#x3D;&quot;#&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>5）新建一个成功跳转的页面 JSP 页面 welcome.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;Welcome&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>三、测试 @RequestMapping 中的 value 和 path 属性</p>
<p>（这两个属性作用相同，可以互换，如果仅有这一个属性，则可以省略，下面两个例子均采用省略的方式）</p>
<p>1）将 @RequestMapping 注解在 login 方法上，而UserController上不添加 @RequestMapping 注解，这时的请求 URL 是相对于 Web 根目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;login&quot;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时的方法 login() 能处理的 URL 请求路径是基于 Web 应用的，也就是 <a target="_blank" rel="noopener" href="http://localhost/SpringMVC/login%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF">http://localhost/SpringMVC/login，也就是</a> index.jsp 页面中的 User Login 链接地址应该是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;login&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>2）将 @RequestMapping 注解在 UserController 类上，这时类的注解是相对于 Web 根目录，而方法上的是相对于类上的路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;login&quot;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时的方法login()能处理的 URL 请求路径则是 <a target="_blank" rel="noopener" href="http://localhost/SpringMVC/user/login%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF">http://localhost/SpringMVC/user/login，也就是</a> index.jsp 页面中的 User Login 链接地址应该是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;user&#x2F;login&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>四、测试 @RequestMapping 的 method 属性</p>
<p>1）简介：@RequestMapping 中的 method 主要用来定义接收浏览器发来的何种请求。在Spring中，使用枚举类</p>
<p>org.springframework.web.bind.annotation.RequestMethod来定义浏览器请求的方式。</p>
<blockquote>
<p>Http规范定义了多种请求资源的方式，最基本的有四种，分别为：GET（查）、POST（增）、PUT（改）、DELETE（删），而URL则用于定位网络上的资源相当于地址的作用，配合四种请求方式，可以实现对URL对应的资源的增删改查操作。</p>
<p>在实际应用中，很多人并没有按照这个规范做，因为使用GET/POST同样可以完成PUT和DELETE操作，甚至GET也可以完成POST操作，因为GET不需要用到表单，而POST却需要通过表单来发送。</p>
</blockquote>
<p>2）通过 @RequestMapping(value=”/login”,method=RequestMethod.GET) 来指定 login()方法 仅处理通过 GET 方式发来的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时，如果浏览器发来的请求不是GET的话，将收到浏览器返回的错误提示，也就是得通过链接的方式而不是表单的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;user&#x2F;login&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>3）通过 @RequestMapping(value=”/login”,method=RequestMethod.POST) 来指定 login()方法 仅处理通过 POST 方式发来的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, method&#x3D;RequestMethod.POST)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时，必须通过表单的方式发送请求，否则将收到浏览器返回的错误提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;user&#x2F;login&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;使用Post发送请求&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>4）由于在 RequestMapping 注解类中 method() 方法返回的是 RequestMethod 数组，所以可以给 method 同时指定多个请求方式，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        &#x2F;&#x2F; 该方法将同时接收通过GET和POST方式发来的请求</span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, method&#x3D;&#123;RequestMethod.POST,RequestMethod.GET&#125;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>五、测试 @RequestMapping 的 params 属性，该属性表示请求参数，也就是追加在URL上的键值对，多个请求参数以&amp;隔开，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;SpringMVC&#x2F;user&#x2F;login?username&#x3D;kolbe&amp;password&#x3D;123456</span><br></pre></td></tr></table></figure>

<p>则这个请求的参数为username=kolbe以及password=123456，@RequestMapping 中可以使用 params 来限制请求参数，来实现进一步的过滤请求，举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 该方法将接收 &#x2F;user&#x2F;login 发来的请求，且请求参数必须为 username&#x3D;kolbe&amp;password&#x3D;123456</span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, params&#x3D;&#123;&quot;username&#x3D;kolbe&quot;,&quot;password&#x3D;123456&quot;&#125;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该例中则表示 UserController 中的 login() 方法仅处理 /user/login 发来的请求，且必须带有 username=kolbe&amp;password=123456 的请求参数，否则浏览器将返回HTTP 404的错误， 对应 index.jsp 中的键接地址为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;user&#x2F;login?username&#x3D;kolbe&amp;password&#x3D;123456&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>六、测试 @RequestMapping 的 headers 属性，该属性表示请求头</p>
<blockquote>
<p>用于HTTP协义交互的信息被称为HTTP报文，客户端发送的HTTP报文被称为请求报文，服务器发回给客户端的HTTP报文称为响应报文，报文由报文头部和报文体组成。</p>
<p>请求头部（Request Headers）：请求头包含许多有关客户端环境和请求正文的信息，例如浏览器支持的语言、请求的服务器地址、客户端的操作系统等。</p>
<p>响应头部（Rsponse Headers）：响应头也包含许多有用的信息，包括服务器类型、日期、响应内容的类型及编码，响应内容的长度等等。</p>
</blockquote>
<p>如果你安装的是Chrome浏览器，可以通过在网页中  右击鼠标—-&gt;审查元素—-&gt;Network—-&gt;Name中点击网页—-&gt;右侧查看Headers即可，如果Name中没有出现网页，可以刷新一下即可，下边是我电脑中的一个请求头部示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Request Headers</span><br><span class="line">    Accept:text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">    Accept-Encoding:gzip, deflate, sdch</span><br><span class="line">    Accept-Language:zh-CN,zh;q&#x3D;0.8</span><br><span class="line">    Cache-Control:max-age&#x3D;0</span><br><span class="line">    Connection:keep-alive</span><br><span class="line">    Cookie:JSESSIONID&#x3D;210075B5E521CWE3CDE938076295A57A</span><br><span class="line">    Host:localhost:8080</span><br><span class="line">    Upgrade-Insecure-Requests:1</span><br><span class="line">    User-Agent:Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;45.0.2454.93 </span><br></pre></td></tr></table></figure>

<p>回规正题，通过 @RequestMapping 中的 headers 属性，可以限制客户端发来的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        &#x2F;&#x2F; 表示只接收本机发来的请求</span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, headers&#x3D;&quot;Host&#x3D;localhost:8080&quot;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>七、带占位符的URL</p>
<p>（一）带占位符的URL是Spring 3.0 新增的功能，可以通过 @PathVariable 将 URL 中的占位符绑定到控制器的处理方法的参数中，占位符使用{}括起来</p>
<p>（二）使用方法：</p>
<p>1）带占位符的URL示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">    public String show(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个控制器中 show() 方法将可以接收 user/1、user/2、user/3等等的路径请求，请求的方法必须为GET，使用 @PathVariable 为应用实现 REST 规范提供了具大的便利条件。</p>
<p>八、采用 REST 风格的 URL 请求</p>
<p>1）简介：REST（Representational State Transfer）：（资源）表现层状态转化，它是目前最流行的一种软件架构，其结构清晰、易于理解、扩展方便且符合标准，正在越来越多的被实践到应用中。</p>
<p>2）REST 风格的 URL 请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 请求路径        请求方法           作用</span><br><span class="line">-&#x2F;user&#x2F;1        HTTP GET        得到id为1的user</span><br><span class="line">-&#x2F;user&#x2F;1        HTTP DELETE     删除id为1的user</span><br><span class="line">-&#x2F;user&#x2F;1        HTTP PUT        更新id为1的user</span><br><span class="line">-&#x2F;user          HTTP POST       新增user</span><br></pre></td></tr></table></figure>

<p>3）由于浏览器表单只支持 GET 和 POST 请求，为了实现 DELETE 和 PUT 请求，Spring 为我们提供了一个过滤器org.springframework.web.filter.HiddenHttpMethodFilter，可以为我们将 GET 和 POST 请求通过过滤器转化成 DELETE 和 PUT 请求。</p>
<p>4）在 web.xml 中配置过滤器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置 org.springframework.web.filter.HiddenHttpMethodFilter 过滤器 --&gt;</span><br><span class="line">&lt;filter&gt;</span><br><span class="line">    &lt;filter-name&gt;hiddenHttpMethodFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">    &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;&#x2F;filter-class&gt;</span><br><span class="line">&lt;&#x2F;filter&gt;    </span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">    &lt;filter-name&gt;hiddenHttpMethodFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">    &lt;!-- 拦截所有请求 --&gt;</span><br><span class="line">    &lt;url-pattern&gt;&#x2F;*&lt;&#x2F;url-pattern&gt;</span><br><span class="line">&lt;&#x2F;filter-mapping&gt;</span><br></pre></td></tr></table></figure>

<p>5）由于浏览器表单无法发送 DELETE 和 PUT 请求，所以为了让 HiddenHttpMethodFilter 识别请求的方法，需要在表单中添加一个隐藏域，名字为 _method 值为 DELETE 或 POST 或PUT，修改后 index.jsp 页面代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">     &lt;!-- 得到id为1的user --&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;user&#x2F;1&quot;&gt;Test Rest GET&lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 新建id为1的user --&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;POST&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Test Rest POST&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 删除id为1的user --&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;user&#x2F;1&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;DELETE&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Test Rest DELETE&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 更新id为1的user --&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;user&#x2F;1&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;PUT&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Test Rest PUT&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>6）修改后的UserController代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package cn.kolbe.spring.mvc.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">    public String show(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        System.out.println(&quot;查看id为：&quot; + id + &quot;的user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.PUT)</span><br><span class="line">    public String update(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        System.out.println(&quot;更新id为：&quot; + id + &quot;的user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.DELETE)</span><br><span class="line">    public String destroy(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        System.out.println(&quot;删除id为：&quot; + id + &quot;的user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&quot;, method&#x3D;RequestMethod.POST)</span><br><span class="line">    public String create() &#123;</span><br><span class="line">        System.out.println(&quot;新建user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> 八、SpringMVC配置</span><br></pre></td></tr></table></figure>

<p>1、使用Maven的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2、在web.xml文件中配置Spring的DispatcherServlet用来拦截请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xmlns&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&quot; xmlns:jsp&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&#x2F;jsp&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&#x2F;web-app_3_0.xsd&quot;</span><br><span class="line">    version&#x3D;&quot;3.0&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 配置DispatcherServlet --&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;springDispatcherServlet&lt;&#x2F;servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;&#x2F;servlet-class&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 配置DispatcherServlet的一个初始化参数，作用是配置SpringMVC配置文件的位置和名称 --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;contextConfigLocation&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;!-- classpath表示类路径下的spring-mvc.xml文件 --&gt;</span><br><span class="line">            &lt;param-value&gt;classpath:spring-mvc.xml&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!-- load-on-startup 表示在web应用启动时，即加载该DispatcherServlet，而不是等到首次请求再中载 --&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;&#x2F;load-on-startup&gt;</span><br><span class="line">    &lt;&#x2F;servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springDispatcherServlet&lt;&#x2F;servlet-name&gt;</span><br><span class="line">        &lt;!-- 可以应答所有请求，也就是将所有的请求都交给Spring的DispatcherServlet来处理 --&gt;</span><br><span class="line">        &lt;url-pattern&gt;&#x2F;&lt;&#x2F;url-pattern&gt;</span><br><span class="line">    &lt;&#x2F;servlet-mapping&gt;</span><br><span class="line">&lt;&#x2F;web-app&gt;</span><br></pre></td></tr></table></figure>

<p>3、添加Spring MVC的配置文件取名为 spring-mvc.xml，用来加载web应用中的Spring Bean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context-4.2.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 自动扫描 cn.kolbe.spring.mvc 下的带有Spring组件注解的类 --&gt;</span><br><span class="line">    &lt;context:component-scan base-package&#x3D;&quot;cn.kolbe.spring.mvc&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置视图解析器：将控制器方法返回值解析为实际物理视图 --&gt;</span><br><span class="line">    &lt;bean class&#x3D;&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;!-- 假设控制器返回 success 字符串，该视图解析器将自动进行装配，具体的视图将为：</span><br><span class="line">            prefix + 返回的字符串 + suffix &#x3D; &#x2F;WEB-INF&#x2F;views&#x2F;success.jsp</span><br><span class="line">         --&gt;</span><br><span class="line">        &lt;!-- prefix表示前缀 --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;prefix&quot; value&#x3D;&quot;&#x2F;WEB-INF&#x2F;views&#x2F;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;!-- suffix表示后缀 --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;suffix&quot; value&#x3D;&quot;.jsp&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<p>4、编写类HelloWorld，并通过添加注解 <a target="_blank" rel="noopener" href="http://my.oschina.net/u/1774615">@Controller</a> 将其标识为控制器，这里可以看出HelloWorld仅仅是一个普通的Java类，通过简单的注解，就可以将其解析为Servlet类来响应用户的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package cn.kolbe.spring.mvc.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class HelloWorld &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 1. 使用 @RequestMapping 注解来映射请求的URL（相当于web.xml中的servlet-mapping元素的url-pattern）</span><br><span class="line">     * 2. 返回值会通过视图解析器解析为实际的物理视图，具体看第三步中的InternalResourceViewResolver配置信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @RequestMapping(&quot;&#x2F;helloworld&quot;)</span><br><span class="line">    public String success() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、编写视图层的页面，这里就两个简单的页面，一个是index.jsp页面，一个是success.jsp页面</p>
<p>（一）index.jsp页面，路径是 /index.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;helloworld&quot;&gt;HelloWorld&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>6、success.jsp页面，路径是 /WEB-INF/views/success.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Welcome&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>









<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>@ControllerAdvice</p>
<p>增强的 Controller：</p>
<ol>
<li>全局异常处理</li>
<li>全局数据绑定</li>
<li>全局数据预处理</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/12.2.SpringMVC/" data-id="ckq1xbdsi003zpwwd9x9hab5n" data-title="SpringMVC" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-12.3.SpringBoot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/12.3.SpringBoot/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:05:53.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/12.3.SpringBoot/">SpringBoot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>SpringBoot会使用内置的tomcat</p>
<p>SpringBoot的启动主要是通过实例化SpringApplication来启动的，启动过程主要做了以下几件事情：配置属性、获取监听器，发布应用开始启动事件初、始化输入参数、配置环境，输出banner、<strong>创建上下文</strong>、预处理上下文、<strong>刷新上下文</strong>、再刷新上下文、发布应用已经启动事件、发布应用启动完成事件。在SpringBoot中启动tomcat的工作在刷新上下这一步。而tomcat的启动主要是实例化两个组件：Connector、Container，一个tomcat实例就是一个Server，一个Server包含多个Service，也就是多个应用程序，每个Service包含多个Connector和一个Container，而一个Container下又包含多个子容器</p>
<h2 id="约定大于配置"><a href="#约定大于配置" class="headerlink" title="约定大于配置"></a>约定大于配置</h2><p>约定优于配置（convention over configuration），也称作按约定编程，是一种软件设计范式，旨在减少软件开发人员需做决定的数量，获得简单的好处，而又不失灵活性</p>
<p>1.开发人员仅需规定应用中不符合约定的部分<br>2.在没有规定配置的地方，采用默认配置，以力求最简配置为核心思想<br>总的来说，上面两条都遵循了推荐默认配置的思想。当存在特殊需求的时候，自定义配置即可。这样可以大大的减少配置工作，这就是所谓的“约定”。</p>
<p>spring boot中的约定：</p>
<p>1.Maven的目录结构。默认有resources文件夹,存放资源配置文件。src-main-resources,src-main-java。默认的编译生成的类都在targe文件夹下面<br>2.spring boot默认的配置文件必须是，也只能是application.命名的yml文件或者properties文件，且唯一<br>3.application.yml中默认属性。数据库连接信息必须是以spring: datasource: 为前缀；多环境配置。该属性可以根据运行环境自动读取不同的配置文件；端口号、请求路径等</p>
<h2 id="配置注解"><a href="#配置注解" class="headerlink" title="配置注解"></a><strong>配置注解</strong></h2><h3 id="主配置类"><a href="#主配置类" class="headerlink" title="主配置类"></a>主配置类</h3><h4 id="1-SpringBootApplication"><a href="#1-SpringBootApplication" class="headerlink" title="1.@SpringBootApplication"></a>1.@SpringBootApplication</h4><p>Spring boot的主配置类，Spring boot的启动类</p>
<p>@SpringBootApplication是一个复合注解，包含了@SpringBootConfiguration，@EnableAutoConfiguration，@ComponentScan这三个注解，大多数情况下，这3个注解会被同时使用，基于最佳实践，这三个注解就被做了包装@SpringBootApplication注解。</p>
<h4 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h4><p>标注当前类是配置类<br>会将当前类内声明的一个或多个以@Bean注解标记的方法的实例纳入到srping容器中，并且实例名就是方法名 继承自@Configuration。</p>
<h4 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h4><p>自动配置的注解<br>自动配置的注解，根据我们添加的组件jar来完成一些默认配置 我们做微服时会添加spring-boot-starter-web这个组件jar的pom依赖，这样配置会默认配置springmvc 和tomcat</p>
<h4 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h4><p>扫描当前包及其子包下被@Component，@Controller，@Service，@Repository<br>扫描当前包及其子包下被@Component，@Controller，@Service，@Repository注解标记的类并纳入到spring容器中进行管理。 等价于context:component-scan的xml配置文件中的配置项</p>
<h4 id="2-ServletComponentScan"><a href="#2-ServletComponentScan" class="headerlink" title="2.@ServletComponentScan"></a>2.@ServletComponentScan</h4><p>filter的实现，用在Spring boot的启动类</p>
<p>Servlet、Filter、Listener 可以直接通过 @WebServlet、@WebFilter、@WebListener 注解自动注册，这样通过注解servlet ，拦截器，监听器的功能而无需其他配置，所以项目中使用到了filter的实现，用到了这个注解。</p>
<h4 id="3-MapperScan-“dao路径”"><a href="#3-MapperScan-“dao路径”" class="headerlink" title="3.@MapperScan(“dao路径”)"></a>3.@MapperScan(“dao路径”)</h4><p>整合Mybatis，用在Spring boot的启动类    @mapper</p>
<h4 id="4-EnableScheduling"><a href="#4-EnableScheduling" class="headerlink" title="4.@EnableScheduling"></a>4.@EnableScheduling</h4><p>允许schedul定时任务</p>
<h4 id="5-EnableCaching"><a href="#5-EnableCaching" class="headerlink" title="5.@EnableCaching"></a>5.@EnableCaching</h4><p>使用缓存</p>
<h4 id="6-EnableTransactionManagement"><a href="#6-EnableTransactionManagement" class="headerlink" title="6.@EnableTransactionManagement"></a>6.@EnableTransactionManagement</h4><p>开启事务注解支持</p>
<h3 id="单元测试常用注解"><a href="#单元测试常用注解" class="headerlink" title="单元测试常用注解"></a>单元测试常用注解</h3><h4 id="RunWith-SpringJUnit4ClassRunner-class-、-SpringRunner-class"><a href="#RunWith-SpringJUnit4ClassRunner-class-、-SpringRunner-class" class="headerlink" title="@RunWith(SpringJUnit4ClassRunner.class)、(SpringRunner.class)"></a>@RunWith(SpringJUnit4ClassRunner.class)、(SpringRunner.class)</h4><p>测试类，让测试运行于Spring测试环境。<br>SpringRunner 继承了SpringJUnit4ClassRunner，没有扩展任何功能；使用SpringRunner，名字简短而已</p>
<h4 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a>@SpringBootTest</h4><p>Springboot环境下测试</p>
<h4 id="Test"><a href="#Test" class="headerlink" title="@Test"></a>@Test</h4><p>junit单元测试，单元测试方法上        </p>
<h4 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h4><p>预加载，测试方法前        </p>
<h4 id="WebAppConfiguration"><a href="#WebAppConfiguration" class="headerlink" title="@WebAppConfiguration"></a>@WebAppConfiguration</h4><p>web应用测试</p>
<h3 id="Controller常用注解"><a href="#Controller常用注解" class="headerlink" title="Controller常用注解"></a>Controller常用注解</h3><h4 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h4><p>用于Controller标识，@Controller 和@ResponseBody的结合<br>@Controller 表明这个类是一个控制器类，和 @RequestMapping 来配合使用拦截请求，如果不在method中注明请求的方式，默认是拦截get和post请求。这样请求会完成后转向一个视图解析器。但是在大多微服务搭建的时候，前后端会做分离。所以请求后端只关注数据处理，后端返回json数据的话，需要配合 @ResponseBody 注解来完成。</p>
<h4 id="GetMapping、PostMapping、PutMapping、DeleteMapping"><a href="#GetMapping、PostMapping、PutMapping、DeleteMapping" class="headerlink" title="@GetMapping、PostMapping、PutMapping、DeleteMapping"></a>@GetMapping、PostMapping、PutMapping、DeleteMapping</h4><p>rest风格</p>
<table>
<thead>
<tr>
<th>普通风格</th>
<th>Rest风格</th>
</tr>
</thead>
<tbody><tr>
<td>@RequestMapping(value=“”,method = RequestMethod.GET)</td>
<td>@GetMapping(value =“”)</td>
</tr>
</tbody></table>
<p>@GetMapping    Get请求<br>@PostMapping    Post请求<br>@PutMapping    订单确认<br>@DeleteMapping    取消订单</p>
<h4 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h4><p>按类型自动注入</p>
<h3 id="Restful之swagger"><a href="#Restful之swagger" class="headerlink" title="Restful之swagger"></a>Restful之swagger</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- swagger是当前最好用的Restful --&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">     &lt;version&gt;$&#123;swagger2.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line"> &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;swagger2.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Api-value-“订单Controller”-tags-“订单Controller”"><a href="#Api-value-“订单Controller”-tags-“订单Controller”" class="headerlink" title="@Api(value = “订单Controller”, tags = {“订单Controller”})"></a>@Api(value = “订单Controller”, tags = {“订单Controller”})</h4><p>value - 字段说明，description - 注释说明这个类</p>
<h4 id="ApiOperation-value-“订单确认接口”"><a href="#ApiOperation-value-“订单确认接口”" class="headerlink" title="@ApiOperation(value = “订单确认接口”)"></a>@ApiOperation(value = “订单确认接口”)</h4><p>在restful风格方法上配合使用<br>@ApiOperation(value = “订单取消接口”)<br>@DeleteMapping(value = “/order/{orderId}”)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">作用范围			API									使用位置</span><br><span class="line">对象属性			@ApiModelProperty					用在参数对象的字段上</span><br><span class="line">协议集描述		    @Api							    用在Conntroller类上</span><br><span class="line">协议描述			@ApiOperation						用在controller方法上</span><br><span class="line">Response集		  @ApiResponses						  用在controller方法上</span><br><span class="line">Response	       @ApiResponse							用在@ApiResponses里面</span><br><span class="line">非对象参数集			@ApilmplicitParams					用在controller方法上</span><br><span class="line">非对象参数描述			@ApiImplicitParam					用在@ApiImplicitParams的方法里边</span><br><span class="line">描述返回对象的意义		@ApiModel							用在返回对象类上</span><br></pre></td></tr></table></figure>

<h3 id="配置文件相关"><a href="#配置文件相关" class="headerlink" title="配置文件相关"></a>配置文件相关</h3><h4 id="Value-“-spring-datasource-druid-url-”"><a href="#Value-“-spring-datasource-druid-url-”" class="headerlink" title="@Value(“${spring.datasource.druid.url}”)"></a>@Value(“${spring.datasource.druid.url}”)</h4><p>注入配置文件中的值        </p>
<h4 id="ImportResource-Import-PropertySource"><a href="#ImportResource-Import-PropertySource" class="headerlink" title="@ImportResource         @Import        @PropertySource"></a>@ImportResource         @Import        @PropertySource</h4><p>用来导入自定义的一些配置文件</p>
<h4 id="ImportResource-locations-导入其他xml配置文件，需要标准在主配置类上。"><a href="#ImportResource-locations-导入其他xml配置文件，需要标准在主配置类上。" class="headerlink" title="@ImportResource(locations={}) 导入其他xml配置文件，需要标准在主配置类上。"></a>@ImportResource(locations={}) 导入其他xml配置文件，需要标准在主配置类上。</h4><p>导入property的配置文件 @PropertySource指定文件路径，这个相当于使用spring的标签来完成配置项的引入。</p>
<p>@import注解是一个可以将普通类导入到spring容器中做管理</p>
<h4 id="EnableAsync-proxyTargetClass-true"><a href="#EnableAsync-proxyTargetClass-true" class="headerlink" title="@EnableAsync(proxyTargetClass = true)"></a>@EnableAsync(proxyTargetClass = true)</h4><p>异步代理，构建异步线程池</p>
<h4 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h4><p>配置类</p>
<h4 id="Bean-“analysisExecutor”"><a href="#Bean-“analysisExecutor”" class="headerlink" title="@Bean(“analysisExecutor”)"></a>@Bean(“analysisExecutor”)</h4><p>相当于<bean></bean>，标注在方法上，方法返回值就是bean类型，bean的id默认为方法名，可以通过给@bean注解加value属性值改变id。</p>
<h4 id="Aspect"><a href="#Aspect" class="headerlink" title="@Aspect"></a>@Aspect</h4><p>切面，事务</p>
<h4 id="Scope-“prototype”"><a href="#Scope-“prototype”" class="headerlink" title="@Scope(“prototype”)"></a>@Scope(“prototype”)</h4><p>bean的作用范围，多例，httpclientConfig</p>
<h4 id="EnableRedisHttpSession-maxInactiveIntervalInSeconds-1800-redisFlushMode-RedisFlushMode-ON-SAVE-redisNamespace-“dscSession”"><a href="#EnableRedisHttpSession-maxInactiveIntervalInSeconds-1800-redisFlushMode-RedisFlushMode-ON-SAVE-redisNamespace-“dscSession”" class="headerlink" title="@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800,redisFlushMode = RedisFlushMode.ON_SAVE, redisNamespace = “dscSession”)"></a>@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800,redisFlushMode = RedisFlushMode.ON_SAVE, redisNamespace = “dscSession”)</h4><p>redissession 默认30分钟失效</p>
<h4 id="EnableWebMvc"><a href="#EnableWebMvc" class="headerlink" title="@EnableWebMvc"></a>@EnableWebMvc</h4><p>用于spring mvc 配置类，启用springmvc</p>
<h4 id="EnableSwagger2"><a href="#EnableSwagger2" class="headerlink" title="@EnableSwagger2"></a>@EnableSwagger2</h4><p>restful风格，使用Swagger2</p>
<h3 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h3><p>@Param(“ids”) Integer[] ids, @Param(“userId”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper接口中有多个参数</span><br></pre></td></tr></table></figure>

<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><h4 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h4><p>全局异常处理<br>全局数据绑定<br>全局数据预处理</p>
<h4 id="ExceptionHandler-BindException-class"><a href="#ExceptionHandler-BindException-class" class="headerlink" title="@ExceptionHandler(BindException.class)"></a>@ExceptionHandler(BindException.class)</h4><p>1、@ExceptionHandler不需要写在目标方法上，而是写在通知处理方法上<br>2、@ExceptionHandler自动拦截所设置的异常  作用范围这个controller,<br>—这种情况一般定义个父类，然后每个controller继承即可</p>
<h3 id="lombok插件使用"><a href="#lombok插件使用" class="headerlink" title="lombok插件使用"></a>lombok插件使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h4><p>首先在idea中安装lombok插件<br>@Data : 注解在类上,<br>就不用再去手写Getter,Setter,equals,canEqual,hasCode,toString等方法了，<br>注解后在编译时会自动加进去</p>
<h4 id="NoArgsConstructor-Getter-Setter"><a href="#NoArgsConstructor-Getter-Setter" class="headerlink" title="@NoArgsConstructor     @Getter      @Setter"></a>@NoArgsConstructor     @Getter      @Setter</h4><p>使用后创建一个无参构造函数、getter、setter</p>
<h4 id="AllArgsConstructor"><a href="#AllArgsConstructor" class="headerlink" title="@AllArgsConstructor"></a>@AllArgsConstructor</h4><p>使用后添加一个构造函数，该构造函数含有所有已声明字段属性参数</p>
<h4 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h4><p>关于Builder较为复杂一些，Builder的作用之一是为了解决在某个类有很多构造函数的情况，也省去写很多构造函数的麻烦，<br>在设计模式中的思想是：用一个内部类去实例化一个对象，避免一个类出现过多构造函数，</p>
<h3 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h3><h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><h4 id="ConditionalOnProperty-prefix-“dsc”-name-“ticketWatcherMaster”-havingValue-“true”"><a href="#ConditionalOnProperty-prefix-“dsc”-name-“ticketWatcherMaster”-havingValue-“true”" class="headerlink" title="@ConditionalOnProperty(prefix = “dsc”, name=“ticketWatcherMaster”, havingValue = “true”)"></a>@ConditionalOnProperty(prefix = “dsc”, name=“ticketWatcherMaster”, havingValue = “true”)</h4><p>监控转换队列是否有超时ticket,如果超时自动补偿ticket</p>
<h4 id="Scheduled-cron-“0-0-2-”"><a href="#Scheduled-cron-“0-0-2-”" class="headerlink" title="@Scheduled(cron = “0 0/2 * * * ?”)"></a>@Scheduled(cron = “0 0/2 * * * ?”)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">定期监控,补偿超时的ticket,2分钟执行一次,延迟60秒启动</span><br><span class="line">&#x2F;*&quot;0 0 12 * * ?&quot; 每天中午十二点触发 &quot;0 15 10 ? * *&quot; 每天早上10：15触发 &quot;0 15 10 * * ?&quot;</span><br><span class="line">每天早上10：15触发 &quot;0 15 10 * * ? *&quot; 每天早上10：15触发 &quot;0 15 10 * * ? 2005&quot; 2005年的每天早上10：15触发</span><br><span class="line">	&quot;0 * 14 * * ?&quot; 每天从下午2点开始到2点59分每分钟一次触发 &quot;0 0&#x2F;5 14 * * ?&quot; 每天从下午2点开始到2：55分结束每5分钟一次触发</span><br><span class="line">	&quot;0 0&#x2F;5 14,18 * * ?&quot; 每天的下午2点至2：55和6点至6点55分两个时间段内每5分钟一次触发 &quot;0 0-5 14 * * ?&quot;</span><br><span class="line">每天14:00至14:05每分钟一次触发 &quot;0 10,44 14 ? 3 WED&quot; 三月的每周三的14：10和14：44触发 &quot;0 15 10 ?</span><br><span class="line">        * MON-FRI&quot; 每个周一、周二、周三、周四、周五的10：15触发 &quot;0 15 10 15 * ?&quot; 每月15号的10：15触发 &quot;0 15</span><br><span class="line">        10 L * ?&quot; 每月的最后一天的10：15触发 &quot;0 15 10 ? * 6L&quot; 每月最后一个周五的10：15触发 &quot;0 15 10 ? *</span><br><span class="line">        6L&quot; 每月最后一个周五的10：15触发 &quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月最后一个周五的10：15触发</span><br><span class="line">        &quot;0 15 10 ? * 6#3&quot; 每月的第三个周五的10：15触发*&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="WebListener"><a href="#WebListener" class="headerlink" title="@WebListener"></a>@WebListener</h4><p>启动监听器 web监听</p>
<p>@WebListener<br>启动监听器 web监听</p>
<h3 id="事务通知"><a href="#事务通知" class="headerlink" title="事务通知"></a>事务通知</h3><h4 id="Pointcut-value-“execution-com-yozo-dsc-web…-…-”"><a href="#Pointcut-value-“execution-com-yozo-dsc-web…-…-”" class="headerlink" title="@Pointcut(value = “execution(* com.yozo.dsc.web….(…))”)"></a>@Pointcut(value = “execution(* com.yozo.dsc.web….(…))”)</h4><p>切点</p>
<h4 id="AfterReturning-value-“webRequest-”"><a href="#AfterReturning-value-“webRequest-”" class="headerlink" title="@AfterReturning(value = “webRequest()”)"></a>@AfterReturning(value = “webRequest()”)</h4><p>后置通知</p>
<h4 id="Around-value-“getFileHeaderBOByHead-”"><a href="#Around-value-“getFileHeaderBOByHead-”" class="headerlink" title="@Around(value = “getFileHeaderBOByHead()”)"></a>@Around(value = “getFileHeaderBOByHead()”)</h4><p>环绕通知</p>
<h4 id="Before-value-“onlineConvert-amp-amp-args-domainBo-dscOnlineParamBo-”"><a href="#Before-value-“onlineConvert-amp-amp-args-domainBo-dscOnlineParamBo-”" class="headerlink" title="@Before(value = “onlineConvert() &amp;&amp; args(domainBo,dscOnlineParamBo)”)"></a>@Before(value = “onlineConvert() &amp;&amp; args(domainBo,dscOnlineParamBo)”)</h4><p>前置通知</p>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><h4 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">初始化邮箱线程池</span><br></pre></td></tr></table></figure>

<h3 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h3><h4 id="RocketMQMessageListener-topic-MQConstant-ConvertFinishMqTopic-consumerGroup-“-rocketmq-consumer-group-”-consumeMode-ConsumeMode-CONCURRENTLY-messageModel-MessageModel-CLUSTERING"><a href="#RocketMQMessageListener-topic-MQConstant-ConvertFinishMqTopic-consumerGroup-“-rocketmq-consumer-group-”-consumeMode-ConsumeMode-CONCURRENTLY-messageModel-MessageModel-CLUSTERING" class="headerlink" title="@RocketMQMessageListener(topic = MQConstant.ConvertFinishMqTopic, consumerGroup = “${rocketmq.consumer.group}”, consumeMode = ConsumeMode.CONCURRENTLY, messageModel = MessageModel.CLUSTERING)"></a>@RocketMQMessageListener(topic = MQConstant.ConvertFinishMqTopic, consumerGroup = “${rocketmq.consumer.group}”, consumeMode = ConsumeMode.CONCURRENTLY, messageModel = MessageModel.CLUSTERING)</h4><p>RocketMQ监听</p>
<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><h4 id="ConditionalOnBean-RedisConfig-class"><a href="#ConditionalOnBean-RedisConfig-class" class="headerlink" title="@ConditionalOnBean(RedisConfig.class)"></a>@ConditionalOnBean(RedisConfig.class)</h4><h4 id="Qualifier-“dscRedisTemplate”"><a href="#Qualifier-“dscRedisTemplate”" class="headerlink" title="@Qualifier(“dscRedisTemplate”)"></a>@Qualifier(“dscRedisTemplate”)</h4><h4 id="Service-“redisService”"><a href="#Service-“redisService”" class="headerlink" title="@Service(“redisService”)"></a>@Service(“redisService”)</h4><h3 id="Configuration-amp-Bean"><a href="#Configuration-amp-Bean" class="headerlink" title="@Configuration &amp; @Bean"></a><strong>@Configuration &amp; @Bean</strong></h3><p>Spring Boot不同于传统的Spring，它不提倡使用配置文件，而是使用配置类来代替配置文件，所以该注解就是用于将一个类指定为配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置类中使用方法对组件进行注册，它的效果等价于：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wwj.springboot.bean.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是 Spring Boot 默认会以方法名作为组件的id，也可以在 <code>@Bean()</code> 中指定value值作为组件的id。</p>
<h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a><strong>@Import</strong></h3><p>在Spring中，我们可以使用@Component、@Controller、@Service、@Repository注解进行组件的注册，而对于一些第三方的类，我们无法在类上添加这些注解，为此，我们可以使用@Import注解将其注册到容器中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="meta">@Import(User.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过@Import注解注册的组件，其id为全类名。</p>
<h3 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a><strong>@Conditional</strong></h3><p>该注解为条件装配注解，大量运用于SpringBoot底层，由该注解衍生出来的注解非常多：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwFK8l2otg0LzIn17yFGT5Odud0qic2e8xVR4lXmvibuDE39cRakXQDicxw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>这里以@ConditionalOnBean和@ConditionalOnMissingBean举例。其中@ConditionalOnBean注解的作用是判断当前容器中是否拥有指定的Bean，若有才生效，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若如此，则SpringBoot在注册User对象之前，会先判断容器中是否已经有id为 <code>dog</code> 的对象，若有才创建，否则不创建。@ConditionalOnBean注解共有三种方式判断容器中是否已经存在指定的对象，除了可以判断组件的id外，也能够通过判断组件的全类名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(type = &quot;com.wwj.springboot.bean.Dog&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以通过判断组件的类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = Dog.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>尤其需要注意的是，因为代码是从上至下依次执行的，所以在注册组件时的顺序要特别注意，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(value = Dog.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段程序中，SpringBoot会先注册User对象，而此时Dog对象还没有被注册，所以会导致User对象无法注册。</p>
<p>而@ConditionalOnMissingBean注解的作用与@ConditionalOnBean注解正好相反，它会判断当前容器中是否不存在指定的Bean，若不存在则生效，否则不生效。</p>
<p>这些注解除了能够标注在方法上，还能作用于类上，当被标注在类上时，若条件成立，则配置类的所有注册方法生效；若条件不成立，则配置类的所有注册方法均不成立。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = Dog.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a><strong>@ImportResource</strong></h3><p>该注解用于导入资源，比如现在有一个Spring的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ls&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wwj.springboot.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;李四&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tom&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wwj.springboot.bean.Dog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>若是想将其转化为配置类，代码少一点倒还好说，当配置文件中注册的Bean非常多时，采用人工的方式显然不是一个好的办法，为此，SpringBoot提供了@ImportResource注解，该注解可以将Spring的配置文件直接导入到容器中，自动完成组件注册。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a><strong>@ConfigurationProperties</strong></h3><p>该注解用于配置绑定，也大量运用于SpringBoot底层。首先在配置文件中编写两个键值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name=zhangsan</span><br><span class="line">user.age=<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>然后使用该注解将其绑定到User类上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但结果却有些出乎意料：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;name=<span class="string">&#x27;Administrator&#x27;</span>, age=<span class="number">30</span>&#125;</span><br></pre></td></tr></table></figure>

<p>这是因为我们将前缀 <code>prefix</code> 指定为了user，而user可能和我们的系统配置产生了重复，所以导致了这个问题，此时我们只需将前缀修改一下即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前缀修改了，配置文件的内容也需要做相应的修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">users.name=zhangsan</span><br><span class="line">users.age=<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，若是想实现配置绑定，就必须要将这个待绑定的类注册到容器中，比如使用@Component注解，当然，SpringBoot也提供了一个注解与其配套使用，它就是：<code>@EnableConfigurationProperties</code> </p>
<p>该注解必须标注在配置类上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(User.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作用是开启指定类的配置绑定功能，它的底层其实也是通过@Import注解实现的，此时User类就无需将其注册到容器中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring Boot 会自动将属性值绑定到 User 类，并将其注册到容器中。Spring Boot 相关的技术文章我整理成了 PDF，关注微信公众号「Java后端」回复「666」下载这一本技术栈手册。</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p>缓存</p>
<h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>@Transactional 注解应该只被应用到 public 方法上，这是由 Spring AOP 的本质决定的</p>
<h2 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a><strong>自动配置原理</strong></h2><p>有了前面的注解基础之后，我们就能够更深入地了解Spring Boot的自动配置原理，自动配置正是建立在这些强大的注解之上的。</p>
<p>我们首先观察一下主启动类上的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>翻阅源码可以得知，@SpringBootApplication注解其实是由三个注解组成的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中@SpringBootConfiguration底层是@Configuration注解，它表示主启动类是一个配置类；而@ComponentScan是扫描注解，它默认扫描的是主启动类当前包及其子包下的组件；最关键的就是@EnableAutoConfiguration注解了，该注解便实现了自动配置。</p>
<p>查看@EnableAutoConfiguration注解的源码，又会发现它是由两个注解组合而成的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们继续查看@AutoConfigurationPackage注解的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Registrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Import注解我们非常熟悉，它是用来导入一个组件的，然而它比较特殊：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Registrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">DeterminableImports</span> </span>&#123;</span><br><span class="line">    Registrar() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">        AutoConfigurationPackages.register(registry, (String[])(<span class="keyword">new</span> AutoConfigurationPackages.PackageImports(metadata)).getPackageNames().toArray(<span class="keyword">new</span> String[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> AutoConfigurationPackages.PackageImports(metadata));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 Registrar 组件中有两个方法，它是用来导入一系列组件的，而该注解又被间接标注在了启动类上，所以它会将主启动类所在包及其子包下的所有组件均注册到容器中。</p>
<p>接下来我们继续看@EnableAutoConfiguration的第二个合成注解：@Import({AutoConfigurationImportSelector.class}) 该注解也向容器中注册了一个组件，翻阅该组件的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title">DeferredImportSelector</span>, <span class="title">BeanClassLoaderAware</span>, <span class="title">ResourceLoaderAware</span>, <span class="title">BeanFactoryAware</span>, <span class="title">EnvironmentAware</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">            <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = <span class="keyword">this</span>.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">            <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法是用来选择导入哪些组件的，该方法又调用了getAutoConfigurationEntry()方法得到需要导入的组件，所以我们查看该方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationImportSelector.<span class="function">AutoConfigurationEntry <span class="title">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        AnnotationAttributes attributes = <span class="keyword">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">        List&lt;String&gt; configurations = <span class="keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">        configurations = <span class="keyword">this</span>.removeDuplicates(configurations);</span><br><span class="line">        Set&lt;String&gt; exclusions = <span class="keyword">this</span>.getExclusions(annotationMetadata, attributes);</span><br><span class="line">        <span class="keyword">this</span>.checkExcludedClasses(configurations, exclusions);</span><br><span class="line">        configurations.removeAll(exclusions);</span><br><span class="line">        configurations = <span class="keyword">this</span>.getConfigurationClassFilter().filter(configurations);</span><br><span class="line">        <span class="keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在getCandidateConfigurations()方法处打一个断点，通过debug运行后我们可以发现，configurations集合中就已经得到了127个自动配置类：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwiakI4r3b9jZ4o76vYGkxmwSmRibQ5POBwGyFLM7Frakdc6Bshjn9iaOqw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>那么这些类究竟从何而来呢？我们需要探究一下getCandidateConfigurations()方法做了什么操作，它其实是调用了loadFactoryNames()方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());</span><br></pre></td></tr></table></figure>

<p>最终调用的是loadSpringFactories()方法来得到一个Map集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</span><br><span class="line">    MultiValueMap&lt;String, String&gt; result = (MultiValueMap)cache.get(classLoader);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Enumeration&lt;URL&gt; urls = classLoader != <span class="keyword">null</span> ? classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>) : ClassLoader.getSystemResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);</span><br><span class="line">            LinkedMultiValueMap result = <span class="keyword">new</span> LinkedMultiValueMap();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，它其实是从 META-INF/spring.factories 文件中获取的组件，我们可以看看导入的依赖中：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vweu8mKjeLr2ObBktFVLyrZvYT8icicxjyibTGsrvRKAayHPbYPItCOwMpA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在spring-boot-autoconfigure-2.3.7.RELEASE.jar的META-INF目录下就有一个spring.factories文件，打开看看文件内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Initializers</span><br><span class="line">org.springframework.context.ApplicationContextInitializer=\</span><br><span class="line">org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\</span><br><span class="line">org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</span><br><span class="line"></span><br><span class="line"># Application Listeners</span><br><span class="line">org.springframework.context.ApplicationListener=\</span><br><span class="line">org.springframework.boot.autoconfigure.BackgroundPreinitializer</span><br><span class="line"></span><br><span class="line"># Auto Configuration Import Listeners</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener</span><br><span class="line"></span><br><span class="line"># Auto Configuration Import Filters</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnBeanCondition,\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnClassCondition,\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition</span><br><span class="line"></span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>文件里的内容其实就是在最开始需要注册的组件，这些组件都是一些配置类，只要项目一启动，Spring Boot就会将这些配置类全部注册到容器中。</p>
<h3 id="按需开启自动配置"><a href="#按需开启自动配置" class="headerlink" title="按需开启自动配置"></a><strong>按需开启自动配置</strong></h3><p>虽然配置类会被 Spring Boot 自动注册到容器中，但并不是每个配置类都会默认生效，SpringBoot会根据当前的场景按需开启自动配置。比如Thymeleaf模板引擎的自动配置类：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwpsl2q2cwqbRhADxVWeglaIWQp4G9dz9QaJBibOIPH9PsmEkdIK1ejDQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>@ConditionalOnClass注解的作用是检查当前项目是否有指定的.class文件，若有则生效；否则不生效。因为我们并未引入Thymeleaf的依赖，导致TemplateMode.class和SpringTemplatengine.class都是不存在的，所以ThymeleafAutoCinfiguration并不会生效。</p>
<h3 id="修改默认配置"><a href="#修改默认配置" class="headerlink" title="修改默认配置"></a><strong>修改默认配置</strong></h3><p>既然SpringBoot帮助我们进行了大量的自动配置，那么对于特殊的一些应用场景，我们该如何修改它的默认配置呢？如果你不了解SpringBoot的配置原理，那么当你需要修改默认配置时，你肯定是束手无策的。我们可以找到SpringMVC的默认配置，看看SpringBoot是如何帮我们进行配置的：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwjenFeGzxSpZRluvzRoXakJpxEdlXQeRwhKY4dHSfSvzLWwkb3mMXAw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>@EnableConfigurationPropertie(WebMvcProperties.class)注解在之前也有介绍，它是用来开启指定类的配置绑定的，所以我们来看看WebMvcProperties类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix &#x3D; &quot;spring.mvc&quot;)</span><br><span class="line">public class WebMvcProperties &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置绑定的前缀时spring.mvc，所以我们若是想修改SpringBoot的默认配置，则必须要将前缀写为spring.mvc，至于我们可以修改哪些配置，只需要查看该类中有哪些成员变量即可，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static class View &#123;</span><br><span class="line">    </span><br><span class="line">    private String prefix;</span><br><span class="line"></span><br><span class="line">    private String suffix;</span><br><span class="line"></span><br><span class="line">    public String getPrefix() &#123;</span><br><span class="line">        return this.prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrefix(String prefix) &#123;</span><br><span class="line">        this.prefix &#x3D; prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSuffix() &#123;</span><br><span class="line">        return this.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSuffix(String suffix) &#123;</span><br><span class="line">        this.suffix &#x3D; suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在WebMvcProperties类中有这样一个内部类，内部类中有prefix和suffix两个成员变量，它们是分别用来设置视图的前缀和后缀的，所以我们若想进行配置，则需要在配置文件中这样编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.view.prefix&#x3D;&#x2F;views&#x2F;</span><br><span class="line">spring.mvc.view.suffix&#x3D;.html</span><br></pre></td></tr></table></figure>

<p>传统的Spring开发Web需要编写大量的配置，而使用SpringBoot将免去编写配置的操作，直接面向业务逻辑开发，一起来看看该如何使用SpringBoot进行Web开发吧！</p>
<h2 id="Web开发"><a href="#Web开发" class="headerlink" title="Web开发"></a><strong>Web开发</strong></h2><h3 id="静态资源处理"><a href="#静态资源处理" class="headerlink" title="静态资源处理"></a><strong>静态资源处理</strong></h3><p>Spring Boot默认设置了几个静态资源目录：</p>
<ul>
<li>/static</li>
<li>/public</li>
<li>/resources</li>
<li>/META-INF/resources</li>
</ul>
<p>这几个目录需要建立在类路径下，若如此做，则放置在这些目录下的静态资源可以被直接访问到。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwmKY2G35mehPDl0JLbWGSGBVhCicJsVgzqDuFVd2elK6XGCicTSHU6ibfQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>也可以通过配置来设置资源的访问前缀：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.static-path-pattern&#x3D;&#x2F;res</span><br></pre></td></tr></table></figure>

<p>此时若想访问静态资源，就必须添加res前缀才行。</p>
<p>我们还可以修改Spring Boot的默认资源路径，只需添加配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.web.resources.static-locations&#x3D;classpath:&#x2F;myImg</span><br></pre></td></tr></table></figure>

<p>若如此做，则我们只能将静态资源放在myImg目录下，之前的所有静态资源目录都将失效。</p>
<p><strong>欢迎页</strong></p>
<p>Spring Boot提供了两种方式来实现欢迎页，第一种便是在资源目录放置欢迎页：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;SpringBoot Index!&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>访问结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwCiasLxHPa4CgF4ialicAuzygfKaNbe8BUXXDD0eWemaDzKh9C1S91nHSg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>第二种方式是通过Controller处理/index请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public String toIndex()&#123;</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Favicon"><a href="#Favicon" class="headerlink" title="Favicon"></a><strong>Favicon</strong></h3><p>Spring Boot也提供了自动设置网站图标的方式，只需要将名为 <code>favicon.ico</code> 的图片放在静态资源目录下即可：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vw1B6tqzEX4bo1m5pBvDkKo0D9VwZiagnRibxW1ek1VVERMuRkN4Sib3Mgw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>Rest映射</strong></p>
<p>在Spring Boot中，默认已经注册了HiddenHttpMethodFilter，所以可以直接编写Rest风格的url，只需在表单中添加一个_method属性的请求域即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;get&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Get提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Post提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;DELETE&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Delete提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;PUT&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Put提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>编写Controller处理请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String getUser()&#123;</span><br><span class="line">        return &quot;Get&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String postUser()&#123;</span><br><span class="line">        return &quot;Post&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String deleteUser()&#123;</span><br><span class="line">        return &quot;Delete&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PutMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String putUser()&#123;</span><br><span class="line">        return &quot;Put&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后需要在配置文件中开启对Rest的支持：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.hiddenmethod.filter.enabled&#x3D;true</span><br></pre></td></tr></table></figure>



<h2 id="常用参数及注解"><a href="#常用参数及注解" class="headerlink" title="常用参数及注解"></a><strong>常用参数及注解</strong></h2><p>下面介绍Web开发中的一些常用参数和注解。</p>
<h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a><strong>@PathVariable</strong></h3><p>该注解用于获取路径变量，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;user&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">public String getUser(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">    return id + &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时若请求url为<a target="_blank" rel="noopener" href="http://localhost:8080/user/2%EF%BC%8C%E5%88%99%E8%8E%B7%E5%8F%96%E5%88%B0id%E5%80%BC%E4%B8%BA2%E3%80%82">http://localhost:8080/user/2，则获取到id值为2。</a></p>
<h3 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a><strong>@RequestHeader</strong></h3><p>该注解用于获取请求头，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;header&quot;)</span><br><span class="line">public String getHeader(@RequestHeader(&quot;User-Agent&quot;) String userAgent)&#123;</span><br><span class="line">    return userAgent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它还能够通过一个Map集合获取所有的请求头信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;header&quot;)</span><br><span class="line">public Map&lt;String, String&gt; getHeader(@RequestHeader Map&lt;String,String&gt; headers)&#123;</span><br><span class="line">    return headers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a><strong>@RequestParam</strong></h3><p>该注解用于获取请求参数，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;param&quot;)</span><br><span class="line">public String getParam(@RequestParam(&quot;name&quot;) String name,</span><br><span class="line">                       @RequestParam(&quot;age&quot;) Integer age)&#123;</span><br><span class="line">    return name + &quot;:&quot; + age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时若请求url为<a target="_blank" rel="noopener" href="http://localhost:8080/param?name=zhangsan&amp;age=20%EF%BC%8C%E5%88%99%E5%BE%97%E5%88%B0%E5%80%BC%60zhangsan:20%60">http://localhost:8080/param?name=zhangsan&amp;age=20，则得到值`zhangsan:20`</a> 。</p>
<h3 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a><strong>@CookieValue</strong></h3><p>该注解用于获取Cookie值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;cookie&quot;)</span><br><span class="line">public String getCookie(@CookieValue(&quot;Idea-8296e76f&quot;) String cookie) &#123;</span><br><span class="line">    return cookie;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它还可以通过Cookie键名获取一个Cookie对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;cookie&quot;)</span><br><span class="line">public String getCookie(@CookieValue(&quot;Idea-8296e76f&quot;) Cookie cookie) &#123;</span><br><span class="line">    return cookie.getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a><strong>@RequestBody</strong></h3><p>该注解用于获取获取请求体的值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;&#x2F;body&quot;)</span><br><span class="line">public String getBody(@RequestBody String content) &#123;</span><br><span class="line">    return content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>既然是获取请求体的值，那么只有Post请求才有请求体，所以编写一个表单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;body&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        账号:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        密码:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>通过该表单提交数据后，得到 <code>username=admin&amp;password=123</code> 。</p>
<h3 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a><strong>@RequestAttribute</strong></h3><p>该注解用于获取request域的数据，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;success&quot;)</span><br><span class="line">public String success(@RequestAttribute(&quot;msg&quot;) String msg)&#123;</span><br><span class="line">    return msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过键名即可获取request域中的数据。</p>
<h3 id="MatrixVariable"><a href="#MatrixVariable" class="headerlink" title="@MatrixVariable"></a><strong>@MatrixVariable</strong></h3><p>该注解用于获取矩阵变量，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;matrix&#x2F;&#123;path&#125;&quot;)</span><br><span class="line">public String getMatrix(@MatrixVariable(&quot;name&quot;) String name,</span><br><span class="line">                        @MatrixVariable(&quot;age&quot;) Integer age,</span><br><span class="line">                        @PathVariable(&quot;path&quot;) String path) &#123;</span><br><span class="line">    return path + &quot;---&quot; + name + &quot;:&quot; + age;</span><br></pre></td></tr></table></figure>

<p>对于该注解的使用，需要注意几点，首先矩阵变量是绑定在路径中的，所以请求映射中一定要携带一个${path}；其次在SpringBoot中默认禁用掉了矩阵变量的功能，所以我们还需要手动去开启该功能：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public WebMvcConfigurer webMvcConfigurer()&#123;</span><br><span class="line">        return new WebMvcConfigurer() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void configurePathMatch(PathMatchConfigurer configurer) &#123;</span><br><span class="line">                UrlPathHelper urlPathHelper &#x3D; new UrlPathHelper();</span><br><span class="line">                </span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(false);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时访问请求url：<a target="_blank" rel="noopener" href="http://localhost:8080/matrix/test;name=zhangsan;age=20%EF%BC%8C">http://localhost:8080/matrix/test;name=zhangsan;age=20，</a> 得到结果：<code>test---zhangsan:20</code> 。</p>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>模板引擎是为了解决用户界面（显示）与业务数据（内容）分离而产生的。他可以生成特定格式的文档，常用的如格式如HTML、xml以及其他格式的文本格式。其工作模式如下：</p>
<p><img src="/12.3.SpringBoot/2411352-1b8c22fae3f6a072.png" alt="img"></p>
<p>常用的模板引擎：</p>
<p>jsp：是一种动态网页开发技术。它使用JSP标签在HTML网页中插入Java代码。</p>
<p>Thymeleaf : 主要渲染xml，HTML，HTML5而且与springboot整合。</p>
<p>Velocity：不仅可以用于界面展示（HTML.xml等）还可以生成输入java代码，SQL语句等文本格式。</p>
<p>FreeMarker：功能与Velocity差不多，但是语法更加强大，使用方便。</p>
<p>1、FreeMarker是一个用Java语言编写的模板引擎，它基于模板来生成文本输出。FreeMarker与Web容器无关，即在Web运行时，它并不知道Servlet或HTTP。它不仅可以用作表现层的实现技术，而且还可以用于生成XML，JSP或Java 等，在spring4.0中推荐使用thymeleaf来做前端模版引擎。</p>
<p>2、JSP技术spring boot 官方是不推荐的，原因有三：</p>
<p>2.1. 在tomcat上，jsp不能在嵌套的tomcat容器解析即不能在打包成可执行的jar的情况下解析</p>
<p>2.2. Jetty 嵌套的容器不支持jsp</p>
<p>2.3. Undertow</p>
<p>3、反正就是spring推荐themleaf，就学学themleaf。</p>
<p>18.8.31</p>
<p>在java领域，表现层技术主要有三种：jsp、freemarker、velocity。</p>
<p>jsp是大家最熟悉的技术</p>
<p>优点：</p>
<p>1、功能强大，可以写java代码</p>
<p>2、支持jsp标签(jsp tag)</p>
<p>3、支持表达式语言(el)</p>
<p>4、官方标准，用户群广，丰富的第三方jsp标签库</p>
<p>5、性能良好。jsp编译成class文件执行，有很好的性能表现</p>
<p>缺点：</p>
<p>jsp没有明显缺点，非要挑点骨头那就是，由于可以编写java代码，如使用不当容易破坏mvc结构。</p>
<p>velocity是较早出现的用于代替jsp的模板语言</p>
<p>优点：</p>
<p>1、不能编写java代码，可以实现严格的mvc分离</p>
<p>2、性能良好，据说比jsp性能还要好些</p>
<p>3、使用表达式语言，据说jsp的表达式语言就是学velocity的</p>
<p>缺点：</p>
<p>1、不是官方标准</p>
<p>2、用户群体和第三方标签库没有jsp多。</p>
<p>3、对jsp标签支持不够好</p>
<p>4、已经很久很久没有维护了。</p>
<p>freemarker</p>
<p>优点：</p>
<p>1、不能编写java代码，可以实现严格的mvc分离</p>
<p>2、性能非常不错</p>
<p>3、对jsp标签支持良好</p>
<p>4、内置大量常用功能，使用非常方便</p>
<p>5、宏定义(类似jsp标签)非常方便</p>
<p>6、使用表达式语言</p>
<p>缺点：</p>
<p>1、不是官方标准</p>
<p>2、用户群体和第三方标签库没有jsp多</p>
<p>选择freemarker的原因：</p>
<p>1、性能。velocity应该是最好的，其次是jsp，普通的页面freemarker性能最差(虽然只是几毫秒到十几毫秒的差距)。但是在复杂页面上(包含大量判断、日期金额格式化)的页面上，freemarker的性能比使用tag和el的jsp好。</p>
<p>2、宏定义比jsp tag方便</p>
<p>3、内置大量常用功能。比如html过滤，日期金额格式化等等，使用非常方便</p>
<p>4、支持jsp标签</p>
<p>5、可以实现严格的mvc分离</p>
<p>thymeleaf</p>
<p>Thymeleaf是个XML/XHTML/HTML5模板引擎，可以用于Web与非Web应用。</p>
<p>Thymeleaf的主要目标在于提供一种可被浏览器正确显示的、格式良好的模板创建方式，因此也可以用作静态建模。你可以使用它创建经过验证的XML与HTML模板。相对于编写逻辑或代码，开发者只需将标签属性添加到模板中即可。接下来，这些标签属性就会在DOM(文档对象模型)上执行预先制定好的逻辑。Thymeleaf的可扩展性也非常棒。你可以使用它定义自己的模板属性集合，这样就可以计算自定义表达式并使用自定义逻辑。这意味着Thymeleaf还可以作为模板引擎框架。</p>
<p>thymeleaf优点：静态html嵌入标签属性，浏览器可以直接打开模板文件，便于前后端联调。springboot官方推荐方案。thymeleaf缺点：模板必须符合xml规范，就这一点就可以判死刑！太不方便了！js脚本必须加入/</p>
<p>spring  boot  使用两个模板引擎<br>一 freemaker (来自学成在线第四天的页面静态化)<br>静态化之后上传到 gridFs 服务器上</p>
<p>目录如下</p>
<p><img src="/12.3.SpringBoot/20190610231257254.png" alt="img"></p>
<p>1.配置文件</p>
<p>application.yml</p>
<p><img src="/12.3.SpringBoot/20190610231539914.png" alt="img"></p>
<p>resources下templates 下 index_banner.ftl 模板页面</p>
<p><img src="/12.3.SpringBoot/20190610231757330.png" alt="img"></p>
<p>2.在test测试下写一个测试类   GridFsTest</p>
<p>@SpringBootTest<br>@RunWith(SpringRunner.class)<br>public class GridFsTest {</p>
<pre><code>@Autowired
GridFsTemplate gridFsTemplate;
 
@Autowired
GridFSBucket gridFSBucket;
 
//存文件
@Test
public void testStore() throws FileNotFoundException &#123;
    //定义file
    File file =new File(&quot;d:/index_banner.ftl&quot;);
    //定义fileInputStream
    FileInputStream fileInputStream = new FileInputStream(file);
    ObjectId objectId = gridFsTemplate.store(fileInputStream, &quot;index_banner.ftl&quot;);
    System.out.println(objectId);
&#125;
 
//取文件
@Test
public void queryFile() throws IOException &#123;
    //根据文件id查询文件
    GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(&quot;_id&quot;).is(&quot;5ce799bf840d5e6d88a0a0f7&quot;)));
 
    //打开一个下载流对象
    GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());
    //创建GridFsResource对象，获取流
    GridFsResource gridFsResource = new GridFsResource(gridFSFile,gridFSDownloadStream);
    //从流中取数据
    String content = IOUtils.toString(gridFsResource.getInputStream(), &quot;utf-8&quot;);
    System.out.println(content);
 
&#125;
</code></pre>
<p>}<br>详细解析页面静态化的流程实质是什么。。。。。。。。。。。。。。。。。。。。</p>
<p>二.thymeleaf<br>   自己写的博客，使用的就是这个技术，但是看着有点麻烦，以后查看博客的时候再看使用</p>
<p>使用spring  框架使用freemaker<br>freemaker<br>（来自平优购的day12 的 商品详情页）感觉跟上面的spring boot集成的模式是一模一样的呀</p>
<p><img src="/12.3.SpringBoot/20190610233854182.png" alt="img"></p>
<p>最基础的配置文件，以及代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.3.3生成文件</span><br><span class="line">使用步骤：</span><br><span class="line">第一步：创建一个 Configuration 对象，直接 new 一个对象。构造方法的参数就是 freemarker的版本号。</span><br><span class="line">第二步：设置模板文件所在的路径。</span><br><span class="line">第三步：设置模板文件使用的字符集。一般就是 utf-8.</span><br><span class="line">第四步：加载一个模板，创建一个模板对象。</span><br><span class="line">第五步：创建一个模板使用的数据集，可以是 pojo 也可以是 map。一般是 Map。</span><br><span class="line">第六步：创建一个 Writer 对象，一般创建一 FileWriter 对象，指定生成的文件名。</span><br><span class="line">第七步：调用模板对象的 process 方法输出文件。</span><br><span class="line"></span><br><span class="line">第八步：关闭流</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">代码：</span><br><span class="line">创建Test类 main方法如下：</span><br><span class="line">	     &#x2F;&#x2F;1.创建配置类</span><br><span class="line">		Configuration configuration&#x3D;new Configuration(Configuration.getVersion());</span><br><span class="line">		&#x2F;&#x2F;2.设置模板所在的目录 </span><br><span class="line">		configuration.setDirectoryForTemplateLoading(new File(&quot;D:&#x2F;pinyougou_work&#x2F;freemarkerDemo&#x2F;src&#x2F;main&#x2F;resources&#x2F;&quot;));</span><br><span class="line">		&#x2F;&#x2F;3.设置字符集</span><br><span class="line">		configuration.setDefaultEncoding(&quot;utf-8&quot;);</span><br><span class="line">		&#x2F;&#x2F;4.加载模板</span><br><span class="line">		Template template &#x3D; configuration.getTemplate(&quot;test.ftl&quot;);</span><br><span class="line">		&#x2F;&#x2F;5.创建数据模型</span><br><span class="line">		Map map&#x3D;new HashMap();</span><br><span class="line">		map.put(&quot;name&quot;, &quot;张三 &quot;);</span><br><span class="line">		map.put(&quot;message&quot;, &quot;欢迎来到神奇的品优购世界！&quot;);</span><br><span class="line">		&#x2F;&#x2F;6.创建Writer对象</span><br><span class="line">		Writer out &#x3D;new FileWriter(new File(&quot;d:\\test.html&quot;));</span><br><span class="line">		&#x2F;&#x2F;7.输出</span><br><span class="line">		template.process(map, out);</span><br><span class="line">		&#x2F;&#x2F;8.关闭Writer对象</span><br><span class="line">		out.close();</span><br></pre></td></tr></table></figure>

<p>执行后，在D盘根目录即可看到生成的test.html ，打开看看<br>其实静态化的流程都是一样的，</p>
<p>只是在第四步的时候，是注入 模板对象@Autotuy  ReTemplate  reTemplate，</p>
<p>第五步的时候是注入其他的依赖   获取页面详情页所需要的数据  然后  数据+模板引擎=新的页面</p>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a><strong>拦截器</strong></h2><p>一个完善的Web应用一定要考虑安全问题，比如，只有登录上系统的用户才能查看系统内的资源，或者只有具备相关权限，才能访问对应的资源，为此，我们需要学习一下拦截器，通过拦截器我们就能够实现这些安全认证。</p>
<p>这里以登录检查为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class LoginInterceptor implements HandlerInterceptor &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">        HttpSession session &#x3D; request.getSession();</span><br><span class="line">        </span><br><span class="line">        Object user &#x3D; session.getAttribute(&quot;user&quot;);</span><br><span class="line">        if(user !&#x3D; null)&#123;</span><br><span class="line">            </span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        response.sendRedirect(&quot;&#x2F;toLogin&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写好拦截器后需要将其配置到容器中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyWebMvcConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">        </span><br><span class="line">        registry.addInterceptor(new LoginInterceptor())</span><br><span class="line">                .addPathPatterns(&quot;&#x2F;**&quot;) </span><br><span class="line">                .excludePathPatterns(&quot;toLogin&quot;, &quot;&#x2F;css&#x2F;**&quot;, &quot;&#x2F;js&#x2F;**&quot;, &quot;&#x2F;fonts&#x2F;**&quot;, &quot;&#x2F;images&#x2F;**&quot;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要指定该拦截器需要拦截哪些资源，需要放行哪些资源，这样一个简单的登录校验就完成了。</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a><strong>文件上传</strong></h2><p>Spring Boot中该如何实现文件上传呢？现有如下的一个表单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th&#x3D;&quot;http:&#x2F;&#x2F;www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;upload&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;f&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>编写控制方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class FileController &#123;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;&#x2F;upload&quot;)</span><br><span class="line">    public String upload(@RequestPart(&quot;f&quot;) MultipartFile file)&#123;</span><br><span class="line">        String name &#x3D; file.getOriginalFilename();</span><br><span class="line">        long size &#x3D; file.getSize();</span><br><span class="line">        return name + &quot;:&quot; + size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过@RequestPart注解即可将上传的文件封装到MultipartFile中，通过该对象便可以获取到文件的所有信息。输出结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwQ0g16A0M2u8FtjicATQWpxfqRqAAIxpexYh0nYoZTVbxWyVdyKSy0iaA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>若是上传多个文件，则先修改表单信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&#x2F;upload&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;f&quot; multiple&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>在文件框位置添加multiple属性即可支持多文件上传，然后修改控制器代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;&#x2F;upload&quot;)</span><br><span class="line">public String upload(@RequestPart(&quot;f&quot;) MultipartFile[] file)&#123;</span><br><span class="line">    return file.length + &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若是需要将上传的文件保存到服务器，则可以如此做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;&#x2F;upload&quot;)</span><br><span class="line">public String upload(@RequestPart(&quot;f&quot;) MultipartFile[] file) throws IOException &#123;</span><br><span class="line">    for (MultipartFile multipartFile : file) &#123;</span><br><span class="line">        if(!multipartFile.isEmpty())&#123;</span><br><span class="line">            </span><br><span class="line">            String filename &#x3D; multipartFile.getOriginalFilename();</span><br><span class="line">            </span><br><span class="line">            multipartFile.transferTo(new File(&quot;E:\\&quot; + filename));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为Spring Boot默认的文件上传大小限制为1MB，所以只要文件稍微大了一点就会上传失败，为此，可以修改SpringBoot的默认配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.servlet.multipart.max-file-size&#x3D;30MB # 配置单个文件上传大小限制</span><br><span class="line">spring.servlet.multipart.max-request-size&#x3D;100MB # 配置总文件上传大小限制</span><br></pre></td></tr></table></figure>



<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a><strong>错误处理</strong></h2><p>默认情况下，SpringBoot应用出现了异常或错误会自动跳转至/error页面，也就是这个熟悉的页面：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwfSJ3M2E2CH295oCIWdKYiayZPz4B3RFGibX5tHLlUqCYABKqiaLASDvWg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>然而一般情况下，我们都不会选择出异常时显示这个页面，而是想要显示我们自己定制的页面，为此，我们可以在/static或/templates目录下新建一个error目录，并在/error目录下放置命名为4xx、5xx的页面，SpringBoot会自动帮助我们解析。 </p>
<p>此时当出现5xx的异常时，SpringBoot会自动跳转至5xx.html页面，当然你也可以对每个状态码都做一个页面进行对应，比如放置500.html、501.html、502.html文件，当服务器出现对应的异常时，就会跳转至对应的页面。</p>
<h2 id="数据层"><a href="#数据层" class="headerlink" title="数据层"></a><strong>数据层</strong></h2><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a><strong>JDBC</strong></h3><p>若想使用原生的JDBC进行开发，SpringBoot已经为我们配置好了JDBC的相关信息，只需要引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;5.1.49&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Spring Boot 底层自动配置了HikariDataSource数据源，所以我们只需指定数据源的地址、用户名和密码即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url&#x3D;jdbc:mysql:</span><br><span class="line">spring.datasource.username&#x3D;root</span><br><span class="line">spring.datasource.password&#x3D;123456</span><br><span class="line">spring.datasource.driver-class-name&#x3D;com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>

<p>因为SpringBoot已经自动配置好了JdbcTemplate，所以我们直接使用就可以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        List&lt;String&gt; names &#x3D; jdbcTemplate.queryForList(&quot;select name from student&quot;,String.class);</span><br><span class="line">        for (String name : names) &#123;</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a><strong>Druid</strong></h3><p>若是不想使用Spring Boot底层的数据源，我们也可以修改默认配置，以Druid数据源为例，首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;druid-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.1.10&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>并对Druid进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开启Druid的监控页功能</span><br><span class="line">spring.datasource.druid.stat-view-servlet.enabled&#x3D;true</span><br><span class="line"># 开启防火墙功能</span><br><span class="line">spring.datasource.druid.filter-class-names&#x3D;stat,wall</span><br><span class="line"># 配置监控页的用户名和密码</span><br><span class="line">spring.datasource.druid.stat-view-servlet.login-username&#x3D;admin</span><br><span class="line">spring.datasource.druid.stat-view-servlet.login-password&#x3D;123</span><br><span class="line"># 开启Druid的Web监控功能</span><br><span class="line">spring.datasource.druid.web-stat-filter.enabled&#x3D;true</span><br><span class="line"># 配置监控哪些请求</span><br><span class="line">spring.datasource.druid.web-stat-filter.url-pattern&#x3D;...</span><br></pre></td></tr></table></figure>

<p>此时访问<a target="_blank" rel="noopener" href="http://localhost:8080/druid%EF%BC%8C%E5%B0%86%E4%BC%9A%E6%9D%A5%E5%88%B0Druid%E7%9A%84%E7%9B%91%E6%8E%A7%E9%A1%B5%EF%BC%9A">http://localhost:8080/druid，将会来到Druid的监控页：</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwmSnFVzD1lv7yyqibGtymFIjf9ickz8Ak2vRCergkAOdK7gzCXNAMBQicA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a><strong>MyBatis</strong></h3><p>接下来我们将整合MyBatis框架，并介绍它的简单使用。首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mybatis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.1.4&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>然后编写Mapper接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface StudentMapper &#123;</span><br><span class="line"></span><br><span class="line">    Student getStu(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Mappe配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;DTD Mapper 3.0&quot; &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.wwj.springboot.dao.StudentMapper&quot;&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;getStu&quot; resultType&#x3D;&quot;com.wwj.springboot.bean.Student&quot;&gt;</span><br><span class="line">        select * from student where id &#x3D; #&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>最后配置一下MyBatis：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置Mapper配置文件的位置</span><br><span class="line">mybatis.mapper-locations&#x3D;classpath:mappers</span><br></pre></td></tr></table></figure>

<p>这样就可以使用MyBatis了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private StudentMapper studentMapper;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        Student stu &#x3D; studentMapper.getStu(1);</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><strong>Redis</strong></h3><p>若是想要整合Redis，也非常地简单，首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>然后进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 主机地址</span><br><span class="line">spring.redis.host&#x3D;172.16.136.196</span><br></pre></td></tr></table></figure>

<p>只需要配置Redis的主机地址就可以操作Redis了，操作步骤如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; operations &#x3D; redisTemplate.opsForValue();</span><br><span class="line">        operations.set(&quot;name&quot;,&quot;zhangsan&quot;);</span><br><span class="line">        String name &#x3D; operations.get(&quot;name&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若是想使用Jedis操作Redis，则需要导入Jedis的依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;redis.clients&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jedis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>并配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.redis.client-type&#x3D;jedis</span><br></pre></td></tr></table></figure>





<h2 id="Filter-ThreadLocal"><a href="#Filter-ThreadLocal" class="headerlink" title="Filter+ThreadLocal"></a>Filter+ThreadLocal</h2><p>由于jwt的出现，使请求方法的参数中不再携带用户的标识，而是将含有用户信息的token放入请求头中，在该请求进入业务之前就要进行层层过滤拦截，这时候就会牵扯出来了一个问题，如何在当前请求的线程中保存该请求用户的信息。</p>
<ol>
<li><p>ThreadLocal<br>ThreadLocal叫做线程变量，意思是ThreadLocal中填充的变量属于当前线程，该变量对其他线程而言是隔离的。ThreadLocal为变量在每个线程中都创建了一个副本，那么每个线程可以访问自己内部的副本变量。</p>
<p>所以设计思路是，我们可以将每个访问的请求拦截下，为其分配线程变量，就先是全局变量一样，在这次请求访问的所有作用域处都可以从中拿出变量进行使用：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 存储/获取当前线程的用户信息工具类</span></span><br><span class="line"><span class="comment"> 	*/</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//线程变量，存放user实体类信息，即使是静态的与其他线程也是隔离的</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;User&gt; userThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;User&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//从当前线程变量中获取用户信息</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">getLoginUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       User user = userThreadLocal.get();</span><br><span class="line">       <span class="keyword">return</span> user;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取当前登录用户的ID</span></span><br><span class="line"><span class="comment">    * 未登录返回null</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getLoginUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      User user = userThreadLocal.get();</span><br><span class="line">      <span class="keyword">if</span> (user != <span class="keyword">null</span> &amp;&amp; user.getId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> user.getId();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为当前的线程变量赋值上用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setLoginUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    userThreadLocal.set(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//清除线程变量</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userThreadLocal.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>我们可以看出LocalThread的应用场景：</p>
<p>1、在进行对象跨层传递的时候，使用ThreadLocal可以避免多次传递，打破层次间的约束。</p>
<p>2、线程间数据隔离</p>
<p>3、进行事务操作，用于存储线程事务信息。</p>
<p>4、数据库连接，Session会话管理。</p>
<ol start="2">
<li>Filter中的使用</li>
</ol>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口业务均在api下</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;testFilter&quot;,urlPatterns = &#123;&quot;/api/*&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(AccessInterceptor.class);</span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">     HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">     String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">     <span class="comment">// 拿到token后，可以自行处理，这里假设从token获取到了id</span></span><br><span class="line">     <span class="keyword">if</span>(userId != <span class="keyword">null</span>)&#123;</span><br><span class="line">         User user = userService.getById(userId);</span><br><span class="line">         UserUtils.setLoginUser(user);</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		UserUtils.setLoginUser(<span class="keyword">null</span>);  </span><br><span class="line">	&#125;</span><br><span class="line">     <span class="comment">//执行,在后续的拦截器中还可以再进行权限拦截</span></span><br><span class="line">     filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>在拦截器中的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// access为自定义权限注解，if条件指该接口访问权限至少要登录（具备token）</span></span><br><span class="line">     <span class="keyword">if</span> (access.level().getCode() &gt;= AccessLevel.LOGIN.getCode()) &#123;</span><br><span class="line">     	<span class="comment">//这里可以直接在拦截器中再次获取用户信息</span></span><br><span class="line">         User user = UserUtils.getLoginUser();</span><br><span class="line">         <span class="keyword">if</span> (user == <span class="keyword">null</span> || user.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">             response.setStatus(<span class="number">401</span>);</span><br><span class="line">             logger.info(<span class="string">&quot;access &quot;</span> + method.getName() + <span class="string">&quot; Not logged in&quot;</span>);</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (user.getType() &lt; access.level().getCode()) &#123;</span><br><span class="line">             response.setStatus(<span class="number">403</span>);</span><br><span class="line">             logger.info(<span class="string">&quot;access &quot;</span> + method.getName() + <span class="string">&quot; No authority&quot;</span>);</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. Controller&#x2F;Service层的使用</span><br><span class="line"></span><br><span class="line">​&#96;&#96;&#96;java</span><br><span class="line">&#x2F;&#x2F;在Controller或是Service中依然可以通过线程变量或取该用户信息</span><br><span class="line">User user &#x3D; UserUtils.getLoginUser();</span><br><span class="line">long userId &#x3D; UserUtils.getLoginUserId();</span><br></pre></td></tr></table></figure>

<p>我们可以看到，在进行对象跨层传递的时候，使用ThreadLocal可以避免多次传递，打破层次间的约束。使用起来确实十分方便，但是也要有注意的地方：</p>
<p><img src="https://img-blog.csdnimg.cn/20200811152649433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjgyMjQ4NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ol>
<p>上图详细的说明了ThreadLocal和Thread以及ThreadLocalMap三者之间的关系。</p>
<p>1、Thread中有一个map，即ThreadLocalMap。</p>
<p>2、ThreadLocalMap的key是ThreadLocal，值是我们自己赋值的。</p>
<p>3、ThreadLocal是一个弱引用，当为null时侯，会被当成垃圾回收。</p>
<p>4、如果我们ThreadLocal是null了，也就是要被垃圾回收器回收了，但是此时我们的ThreadLocalMap生命周期和Thread的一样，它不会回收，这时候就出现了一个现象。那就是ThreadLocalMap的key没了，但是value还在，这就造成了内存泄漏。</p>
<p>解决办法：使用完ThreadLocal后，即拦截器的后处理，执行remove操作，避免出现内存溢出情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    UserUtils.removeUser();  <span class="comment">//其中调用的就是 userThreadLocal.remove();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ApplicationRunner（一个spring容器启动完成执行的类）"><a href="#ApplicationRunner（一个spring容器启动完成执行的类）" class="headerlink" title="ApplicationRunner（一个spring容器启动完成执行的类）"></a>ApplicationRunner（一个spring容器启动完成执行的类）</h2><p>在项目中，可能会遇到这样一个问题：在项目启动完成之后，紧接着执行一段代码。<br>在SpringBoot中，提供了一个接口：<strong>ApplicationRunner</strong>。<br>该接口中，只有一个run方法，他执行的时机是：<strong>spring容器启动完成之后，就会紧接着执行这个接口实现类的run方法。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class PublishEndpoint implements ApplicationRunner&#123;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void run(ApplicationArguments applicationArguments) throws Exception &#123;</span><br><span class="line">	&#x2F;&#x2F;do something</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有几点说明：</p>
<ul>
<li>这个实现类，要注入到spring容器中，这里使用了@Component注解；</li>
<li>在同一个项目中，可以定义多个ApplicationRunner的实现类，他们的执行顺序通过注解@Order注解或者再实现Ordered接口来实现。</li>
<li>run方法的参数：ApplicationArguments可以获取到当前项目执行的命令参数。（比如把这个项目打成jar执行的时候，带的参数可以通过ApplicationArguments获取到）；</li>
<li>由于该方法是在容器启动完成之后，才执行的，所以，这里可以从spring容器中拿到其他已经注入的bean。</li>
</ul>
<h2 id="新建一个springboot项目"><a href="#新建一个springboot项目" class="headerlink" title="新建一个springboot项目"></a>新建一个springboot项目</h2><p>一、创建项目</p>
<p>1.File-&gt;new-&gt;project；</p>
<p><img src="https://img-blog.csdnimg.cn/20190801203834598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>2.选择“Spring Initializr”，点击next；（jdk1.8默认即可）</p>
<p><img src="https://img-blog.csdnimg.cn/20190801204126964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>选择default可能会因为网速导致项目新建失败。</p>
<p>不选择默认的Default，而是适用Custom，输入aliyun的镜像节点：<a target="_blank" rel="noopener" href="http://start.aliyun.com/">http://start.aliyun.com</a></p>
<p>3.完善项目信息，组名可不做修改，项目名可做修改；最终建的项目名为：test，src-&gt;main-&gt;java下包名会是：com-&gt;example-&gt;test；点击next；</p>
<p><img src="https://img-blog.csdnimg.cn/2019080120463896.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>4.Web下勾选Spring Web Start，（网上创建springboot项目多是勾选Web选项，而较高版本的Springboot没有此选项，勾选Spring Web Start即可，2.1.8版本是Spring Web）；Template Englines勾选Thymeleaf；SQL勾选：MySQL Driver，JDBC API 和 MyBatis Framework三项；点击next；</p>
<p><img src="https://img-blog.csdnimg.cn/20190801205736116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>5.选择项目路径，点击finish；打开新的窗口；</p>
<p><img src="https://img-blog.csdnimg.cn/20190801205931712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/12.3.SpringBoot/" data-id="ckq1xbdt1005wpwwd2ddw6gcw" data-title="SpringBoot" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-12.4.SpringCloud" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/12.4.SpringCloud/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:05:47.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/12.4.SpringCloud/">SpringCloud</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/12.4.SpringCloud/" data-id="ckq1xbdrb000kpwwd4wgz44w9" data-title="SpringCloud" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-18.1.Postman" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/18.1.Postman/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:02:01.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/18.1.Postman/">Postman</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>postman是一款支持http协议的接口调试与测试工具，其主要特点就是功能强大，使用简单且易用性好 。</p>
<p>无论是开发人员进行接口调试，还是测试人员做接口测试，postman都是我们的首选工具之一 。</p>
<p>那么接下来就介绍下postman到底有哪些功能，它们分别都能干些什么 。下面先通过一张图来直观的来看下postman中所包含的功能 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FljLG8vcmXEoBc5Zy02HzOk50Vz3YsGq2cCLuBhKhPwfWsWaicjL2oSbQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>当然，以上功能也只是展示了postman的一部分功能，为了能更加全面的体现这款工具的特点，我将从以下三个维度来加以说明。它们分别是：</p>
<ul>
<li><p>基础功能</p>
</li>
<li><ul>
<li>常见类型的接口请求</li>
<li>接口响应数据的解析</li>
<li>接口管理(Collection)</li>
<li>批量执行接口请求</li>
<li>日志调试</li>
<li>断言</li>
<li>变量</li>
<li>请求前置脚本</li>
<li>接口关联</li>
<li>常见的返回值获取</li>
</ul>
</li>
<li><p>便捷功能快</p>
</li>
<li><ul>
<li>速填写查询参数</li>
<li>快速填写请求头信息</li>
<li>快速实现添加一个请求</li>
<li>如何继承集合认证</li>
<li>批量断言</li>
<li>快速查询和替换</li>
</ul>
</li>
<li><p>高级功能</p>
</li>
<li><ul>
<li>读取文件进行参数化</li>
<li>生成测试报告</li>
<li>代码中发送请求</li>
<li>编写接口文档</li>
<li>mock服务</li>
<li>监控</li>
<li>使用工作空间</li>
<li>代码同步与分支管理</li>
<li>连接数据库</li>
<li>apis</li>
</ul>
</li>
</ul>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="一-postman安装说明"><a href="#一-postman安装说明" class="headerlink" title="一. postman安装说明"></a><strong>一. postman安装说明</strong></h1><p>postman 在 2018 年之后就不再支持浏览器版本，所以，想要使用它就必须先下载客户端再安装使用，下面就以 Windows 系统为例进行安装 。</p>
<p><strong>1. 下载与安装</strong></p>
<p>postman安装步骤：</p>
<p>\1. 访问postman官方网站，下载最新版本</p>
<p>访问地址：<a target="_blank" rel="noopener" href="https://www.getpostman.com/">https://www.getpostman.com/</a></p>
<p>\2. 进入到下载页面，根据自己电脑下载对应的版本</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flo5FzPWSpwW8L1UozoTf4MJtPadpMEQtSiaqLECarT9ZeUBIGhFJiceBA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\3. 双击下载的安装包，进入到安装界面，直到用户登录和注册界面。</p>
<p>若个人使用，选择跳过即可，这时会进入到postman主界面，至此postman安装成功(下图)。</p>
<p>若团队使用，可以进行注册，注册后使用账号可以加入团队工作区</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl3qRTwy57vlII9FEOiaUjBWXCn2iaSwIn5Os3iapje8TmItZCQ5sAoFxibg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>2.界面导航说明</strong></p>
<p>初次使用postman的朋友可能对界面上的一些元素不太熟悉，下面就通过一张图来说明这些元素的含义 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flu2buNNHaeoxxruibkucBWxjVPx22P2nUHHaW5vxRCSmuWj0nd4bHMzw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>3.发送第一个请求</strong></p>
<p>如果你是第一次使用postman发送请求，下面这个例子可以作为一个最基本的入门，可以帮我们建立一个初始印象 。</p>
<p>\1. 打开postman，点击+加号打开一个新的请求页。</p>
<p>\2. 在请求的URL中输入请求地址：</p>
<p><a target="_blank" rel="noopener" href="http://www.weather.com.cn/data/sk/101010100.html">http://www.weather.com.cn/data/sk/101010100.html</a></p>
<p>\3. 点击Send按钮，这时就可以在下部的窗格中看到来自服务器的json响应数据。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl5icYWjQgcB1EOsu1Jmt3gicYPTXPxia5tibDvhxDCODFW3UbMZic1up1VGw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h1 id="二-postman基础功能"><a href="#二-postman基础功能" class="headerlink" title="二.postman基础功能"></a><strong>二.postman基础功能</strong></h1><p><strong>1.常见类型的接口请求</strong></p>
<p>常见的接口有如下四种类型，分别是含有查询参数的接口，表单类型的接口，json类型的接口以及含有上传文件的接口，以下就对这四种类型接口及如何在postman中请求进行说明 。</p>
<p><strong>1.1 .查询参数的接口请求</strong></p>
<p><strong>什么是查询参数?</strong></p>
<p>所谓的查询参数，其实就是URL地址中问号（?）后面的部分就叫查询参数，比如：<a target="_blank" rel="noopener" href="http://cx.shouji.360.cn/phonearea.php?number=13012345678">http://cx.shouji.360.cn/phonearea.php?number=13012345678</a> 。在这个接口中，查询参数就是:<strong>number=13012345678</strong> 。</p>
<p>而这一部分是由有键值对组成，格式为：key1=value1&amp;key2=value2, 如果有多组键值对，要用&amp;隔开 。</p>
<p><strong>postman如何请求</strong></p>
<p>在postman中实现对这类接口请求非常简单，一般就需要明确俩个参数即可，一个是请求方法，一个请求地址。</p>
<p>针对上面的那个接口，地址已经给出 ，而它的请求方法是get 。那么在postman中只需要把这俩个参数填写上即可请求 。</p>
<p>具体实现步骤：</p>
<p>\1. 打开postman，新建一个请求。</p>
<p>\2. 在请求方法中选择请求方法：GET,因为在postman中默认的请求方法就是GET,所以这一步可以忽略</p>
<p>\3. 接口URL中输入地址，点击Send按钮就可以发送请求了 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlibV1Mf2OLgxcuwUTHdrISFm1cjYqyITROnbniafQUveJEqwmAiaBmV1ag/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>说明：查询参数的URL一般直接拷贝到输入的URL地址栏中就可以了，当然也可以把查询参数在Params中输入，俩者的效果是一样的 。</p>
<p><strong>1.2 表单类型的接口请求</strong></p>
<p><strong>什么是表单 ？</strong></p>
<p>我们都知道，在发送HTTP请求的时候，一个请求中一般包含三个部分，分别是请求行，请求头，请求体 。</p>
<p>不同的接口，请求体的数据类型是不一样的，比较常见的一种就是表单类型，那么什么是表单类型呢 ？简单理解就是在请求头中查看<strong>Content-Type，它的值如果是:application/x-www-form-urlencoded</strong> .那么就说明客户端提交的数据是以表单形式提交的 。见下图：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlVPe9tFf87Udh16SQn2IAl13VWTueDkV2VLpSzjtSsre74BtBG1St2A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>postman中如何请求？</strong></p>
<p>如果在postman请求上图的接口，我们只需要填写四个参数，分别是(可以参考上图)：</p>
<ul>
<li><p>请求方法：POST</p>
</li>
<li><p>请求URL：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login&amp;t=0.21942974229794432">http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login&amp;t=0.21942974229794432</a></p>
</li>
<li><p>请求头：Content-Type：application/x-www-form-urlencode</p>
</li>
<li><p>请求体：username=13088888888&amp;password=123456&amp;verify_code=8888</p>
</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>打开postman，新建一个请求 。</li>
<li>在请求中设置以上四个参数，点击Send按钮。在postman中设置请求体类型为，需要<strong>选择body-&gt; x-www-form-urlencoded</strong></li>
<li>查看响应数据。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl4KnApVbx69fbFOyN4cicNt3DlnR4P6E2KQdAwm3H8A4nL4jMMJ5OrwA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>1.3 上传文件的表单请求</strong></p>
<p>在做接口测试时，我们经常会遇到需要上传文件的接口，比如微信的更新头像。这就需要用到：multipart/form-data。它也属于一种表单，但它既支持表单请求，也支持文件上传。它的请求报文中数据往往是下面这样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;localhost&#x2F;index.php&#x2F;home&#x2F;Uploadify&#x2F;imageUp&#x2F;savepath&#x2F;head_pic&#x2F;pictitle&#x2F;banner&#x2F;dir&#x2F;images.html HTTP&#x2F;1.1</span><br><span class="line">Content-Type: multipart&#x2F;form-data</span><br><span class="line"></span><br><span class="line">file&#x3D;a1.jpg</span><br></pre></td></tr></table></figure>

<p>这种类型的接口，在postman中该如何请求呢 ？我们先分析需要填写的参数 。</p>
<ul>
<li><p>请求方法：POST</p>
</li>
<li><p>请求URL：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/index.php/home/Uploadify/imageUp/savepath/head_pic/pictitle/banner/dir/images.html">http://localhost/index.php/home/Uploadify/imageUp/savepath/head_pic/pictitle/banner/dir/images.html</a></p>
</li>
<li><p>请求类型：multipart/form-data</p>
</li>
<li><p>请求体：file=a1.jpg</p>
</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>打开postman，新建一个请求 。</li>
<li>在请求中设置以上四个参数，点击Send按钮。注意：在postman中设置请求体类型，需要<strong>选择body-&gt; form-data</strong> 。file中要选择File类型，然后上传本地的文件 。</li>
<li>查看响应数据。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlmbvvEP8osueINea3jABEAYrVes8AU13fj0h5MnP3SRlQhqxdia7785w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>1.4 json类型的接口请求</strong></p>
<p>这应该是接口测试中最常见的一种情况了 ， 也就是请求体类型为json,我们来看下这个请求报文 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;xxx&#x2F;api&#x2F;sys&#x2F;login HTTP&#x2F;1.1</span><br><span class="line">Content-Type: application&#x2F;json;charset&#x3D;UTF-8</span><br><span class="line"></span><br><span class="line">&#123;&quot;account&quot;:&quot;root&quot;,&quot;password&quot;:&quot;123456&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>根据以上报文，我们可以分析出，我们在postman只需要填写四个参数即可，具体如下：</p>
<ul>
<li>请求方法：POST</li>
<li>请求地址：<a target="_blank" rel="noopener" href="http://xxx/api/sys/login">http://xxx/api/sys/login</a></li>
<li>请求体类型：json</li>
<li>请求体数据：{“account”:”root”,”password”:”123456”}</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>打开postman，新建一个请求 。</li>
<li>在请求中设置以上四个参数，点击Send按钮。注意：在postman中设置请求体类型，需要<strong>选择body-&gt; raw -JSON</strong></li>
<li>查看响应数据。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlKEyT3hrRLxClerL9ribBQfSeFrcV4bu8rp9dEv5tAmQ7xmu4GiaxL5Ng/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>2.接口响应数据解析</strong></p>
<p>响应数据是发送请求后经过服务器处理后返回的结果，响应由三部分组成，分别是状态行、响应头、响应体。我们来看下postman的响应数据展示。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlfT37Gy9Qsfc62iaicTtTx7SFbM8tDK4rcvjKhkJL2asf5SCf9xm3rPhA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在postman中的响应数据展示：</p>
<ul>
<li>状态行：Status：200 OK</li>
<li>响应头：Headers + Cookies，需要注意的是Cookies是包含在响应头中的，但是为了明显，工具会分开显示</li>
<li>响应体：Body</li>
</ul>
<p>那么这些数据对我们做接口测试有什么作用呢 ？</p>
<ul>
<li>Body和Status是我们做接口测试的重点，一般来说我们都会验证响应体中的数据和响应状态码</li>
<li>Test Results 是我们编写断言后，可以查看断言的执行结果 ，所以这个对我们也很有用 。</li>
<li>Time 和Size 是我们做性能测试时，可以根据这两个参数来对所测接口的性能做一个简单的判断。</li>
</ul>
<p>接下来我们再来关注下Body中的几个显示主题，分别是：Pretty，Raw，Preview .</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fldya46bWMCiaZEocvuLUKS4kpZ4bJia8AYe4OiaaDWgoGbxoCbbibDkVyUw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Pretty:翻译成中文就是漂亮 ， 也就是说返回的Body数据在这个标签中查看 ，都是经过格式化的，格式化后的数据看起来更加直观，所以postman默认展示的也是这个选项。比如返回html页面，它会经过格式化成HTML格式后展示，比如返回json，那么也会格式化成json格式展示 。</p>
<p>Raw：翻译成中文未经过加工的，也就是原始数据 ，原始数据一般都是本文格式的，未经过格式化处理的，一般在抓包工具中都有这个选项 。</p>
<p>Preview：翻译成中文就是预览，这个选项一般对返回HTML的页面效果特别明显，如请求百度后返回结果，点击这个选项后就直接能查看到的页面 ，如下图 。同时这个选项和浏览器抓包中的Preview也是一样的 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl6BGgoTRORufMic6V8c2YEm5mzDauicgTdr3megI5lNc6zO7JYpqaUzBw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>3. 接口管理（Collection）</strong></p>
<p>当我们对一个或多个系统中的很多用例进行维护时，首先想到的就是对用例进行分类管理，同时还希望对这批用例做回归测试 。在postman也提供了这样一个功能，就是Collection 。通过这个Collection就可以满足我们的上面说的需求。</p>
<p>先对Collection功能的使用场景做个简单总结 。</p>
<ul>
<li>用例分类管理，方便后期维护</li>
<li>可以进行批量用例回归测试 。</li>
</ul>
<p>那么Collection是如何去管理用例的呢 ？先想象我们要测试一个系统，系统下有多个模块，每个模块下有很多的被测接口用例 。那么基于这个场景，我们来通过Collection来进行实现：</p>
<p>\1. 点击Collection，点击+New Collection，在弹出的输入框中输入Collection名称（这个就可以理解为所测试的系统）</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlF4W4b5gHTEp9ibQFxHzvaBnhEOeWwm9szUn7fdkNJKgrF8srXFAvPjA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\2. 选中新建的Collection右键，点击Add Folder ，在弹出对话框中输入文件夹名称（这个就可以理解为系统中的模块）</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FljpiaOpL0k0UXiaLj4NChLgkrw0KGYAyK1EhfCgFT4uF2VzkqZ7RiaIS6g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\3. 选中新建的Folder，点击Add Request ，在弹出的对话框中输入请求名称，这个就是我们所测试的接口，也可以理解为测试用例 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flh7DP0X6alp6uhCzMmzaRxLgh4aBDfooGlGzQ8t7nWYTiaPrzCf8SZBQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>那么通过以上三个步骤，达到的效果就是如图所示：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlMKJf6o0cNlH8BiccQK7Xdn6E1UaQR6Rym6lZkfY022hrduEdTk1cggQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>总结，通过上面的操作，我们实现了一个最简单的demo模型。但实际上，有了这个功能才是postman学习的开始，因为很多功能都是基础这个功能的基础上进行的，比如用例的批量执行，Mock ，接口文档等功能 。</p>
<p><strong>4. 批量执行接口请求</strong></p>
<p>当我们在一个Collection中编写了很多的接口测试用例，想一起执行这批用例，在postman中是如何操作呢 ？</p>
<p>实现步骤：</p>
<p>\1. 选中一个Collection，点击右三角，在弹出的界面点击RUN</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flzec1dGXM233VrM4W3dDu0vic8ib2MjdbOzN8o8Wk8BU07VDqtOVHLKfg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\2. 这是会弹出一个叫Collection Runner的界面，默认会把Collection中的所有用例选中 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlUVXVIrJF4HXOibun27kmsUSYS5PrNqqjLOQZpbwdFDv32o33Rjcibc2w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\3. 点击界面下方的RUN Collection，就会对Collection中选中的所有测试用例运行 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl6b4kwTE3lypBbt8AZOzHicYWnkWjbeK2tdDGAgvUo68Zwr3NzfGjCrg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>对上面的几个红框内的功能进行简单说明：</p>
<ul>
<li><strong>断言统计</strong>：左上角的两个0是统计当前Collection中断言成功的执行数和失败的执行数，如果没有编写断言默认都为0 。</li>
<li>Run Summary: 运行结果总览，点击它可以看到每个请求中具体的测试断言详细信息 。Export Result：导出运行结果，默认导出的结果json文件 。</li>
<li>Retry: 重新运行，点击它会把该Collection重新运行一遍</li>
<li>New：返回到Runner，可以重新选择用例的组合 。</li>
</ul>
<p>总体来说，这个功能主要是用于对一个Collection中的所有用例或部分用例进行批量运行，已达到手工回归测试的目的。</p>
<p><strong>5.日志调试</strong></p>
<p>在做接口测试时，经常会因为代码写的有问题导致报错，这时通过查看日志就显得非常重要了，postman也提供了这样的功能，它允许我们在脚本中编写打印语句，查看打印的结果 ; 同时也可以查看每个请求的日志信息 。</p>
<p>在postman中编写日志打印语句使用的是JavaScript，编写的位置可以是Pre-request Script 或Tests标签中。编写打印语句如：console.log(“我是一条日志”)</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlPJiauFRraOVSibfXSBicganibSkHeicJQzyE3n4R1Yicr4Ovu3GVM4galic1Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>那么打印的日如何看呢 ？在postman中有俩个入口，第一个入口就是：view-show postman console 。</p>
<p>第二个入口就是左下角第三个图标 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlsNmeiaCqkGIwLX2JRUgSaOTxyoMOrIEEd6H7uLC0QmCSrqjY4qL78Hg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>打开的日志界面：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl1ClyeJtoia7OxjLqMYTMvyoia3xicAXgJTXd8Phgx7Bo1qT8mrC7nkXRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>这里面有几个比较实用的功能：</p>
<ul>
<li>搜索日志：输入URL或者打印的日志就能直接搜索出我们想要的请求和日志，这对我们在众多日志中查找某一条日志是非常方便的 。</li>
<li>按级别搜索：可以查询log,info,warning,error级别的日志 ，有助于我们更快定位到错误 。</li>
<li>查看原始报文(Show raw log)：如果习惯看原始请求报文的话，这个功能可能更方便些 。</li>
<li>隐藏请求(Hide network)：把请求都隐藏掉，只查看输出日志 。</li>
</ul>
<p>总之，通过这个功能，我们在请求接口报错时，通过打印响应的日志，就能很轻松的找到问题原因了 。</p>
<p><strong>6.断言</strong></p>
<p>如果没有断言，我们只能做接口的功能测试，但有了断言后，就为我们做自动化提供了条件，并且在postman中的断言是非常方便和强大的 。</p>
<p>我们先来了解下postman断言的一些特点 ，具体如下</p>
<ul>
<li>断言编写位置：Tests标签</li>
<li>断言所用语言：JavaScript</li>
<li>断言执行顺序：在响应体数据返回后执行 。</li>
<li>断言执行结果查看：Test Results</li>
</ul>
<p>在上面我们介绍到，编写的断言代码是JavaScript，那如果不会写怎么办 ？不用担心，因为postman已经给我们内置了一些常用的断言 。用的时候，只需从右侧点击其中一个断言，就会在文本框中自动生成对应断言代码块 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlGf6DyNBU8C9eyBXT3Whk0TgmG58Nibp9SEMVPrnqgfUYBwLM3X7293g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>接下来就让我们了解一些常用断言，还是按响应的组成来划分，分别是状态行，响应头，响应体。</p>
<p>状态行中又包括状态码，状态消息 。在postman也可以对这两个进行断言</p>
<p><strong>状态行中的断言</strong>：</p>
<ul>
<li>断言状态码：<strong>Status code: code is 200</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Status code is 200&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.status(200); &#x2F;&#x2F;这里填写的200是预期结果，实际结果是请求返回结果</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<ul>
<li>断言状态消息：<strong>Status code：code name has string</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Status code name has string&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.status(&quot;OK&quot;); &#x2F;&#x2F;断言响应状态消息包含OK</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>响应头中的断言</strong></p>
<ul>
<li>断言响应头中包含：Response headers:Content-Type header check</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Content-Type is present&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.header(&quot;Content-Type&quot;); &#x2F;&#x2F;断言响应头存在&quot;Content-Type&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>断言响应体(重点)</strong></p>
<ul>
<li>断言响应体中包含XXX字符串：Response body:Contains string</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Body matches string&quot;, function () &#123;</span><br><span class="line">    pm.expect(pm.response.text()).to.include(&quot;string_you_want_to_search&quot;);</span><br><span class="line">&#125;); </span><br><span class="line">&#x2F;&#x2F;注解</span><br><span class="line">pm.expect(pm.response.text()).to.include(&quot;string&quot;) 获取响应文本中包含string</span><br></pre></td></tr></table></figure>



<ul>
<li>断言响应体等于XXX字符串：Response body : is equal to a string</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Body is correct&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.body(&quot;response_body_string&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;注解</span><br><span class="line">pm.response.to.have.body(&quot;response_body_string&quot;); 获取响应体等于response_body_string</span><br></pre></td></tr></table></figure>



<ul>
<li>断言响应体(json)中某个键名对应的值：Response body : JSON value check</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Your test name&quot;, function () &#123;</span><br><span class="line">    var jsonData &#x3D; pm.response.json();</span><br><span class="line">    pm.expect(jsonData.value).to.eql(100);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;注解</span><br><span class="line">var jsonData &#x3D; pm.response.json() 获取响应体，以json显示，赋值给jsonData .注意：该响应体必须返会是的json，否则会报错</span><br><span class="line">pm.expect(jsonData.value).to.eql(100) 获取jsonData中键名为value的值，然后和100进行比较</span><br></pre></td></tr></table></figure>



<p><strong>响应时间(一般用于性能测试)</strong></p>
<ul>
<li>断言响应时间：Response time is less than 200ms</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Response time is less than 200ms&quot;, function () &#123;</span><br><span class="line">    pm.expect(pm.response.responseTime).to.be.below(200); &#x2F;&#x2F;断言响应时间&lt;200ms</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>案例说明</strong>：</p>
<p>针对以下接口返回的数据进行断言：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;cityid&quot;: &quot;101120101&quot;,</span><br><span class="line">    &quot;city&quot;: &quot;济南&quot;,</span><br><span class="line">    &quot;update_time&quot;: &quot;2020-04-17 10:50&quot;,</span><br><span class="line">    &quot;wea&quot;: &quot;晴&quot;,</span><br><span class="line">    &quot;wea_img&quot;: &quot;qing&quot;,</span><br><span class="line">    &quot;tem&quot;: &quot;16&quot;,</span><br><span class="line">    &quot;tem_day&quot;: &quot;20&quot;,</span><br><span class="line">    &quot;tem_night&quot;: &quot;9&quot;,</span><br><span class="line">    &quot;win&quot;: &quot;东北风&quot;,</span><br><span class="line">    &quot;win_speed&quot;: &quot;3级&quot;,</span><br><span class="line">    &quot;win_meter&quot;: &quot;小于12km&#x2F;h&quot;,</span><br><span class="line">    &quot;air&quot;: &quot;113&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>断言响应状态码为200</li>
<li>断言city等于济南</li>
<li>断言update_time包含2020-04-17</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlLFewBCYqrlHW20UmKudtFx9g8aOKia7ibEypul6AFseCFeicIics9Mak9g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>总结，整体来说，如果用postman做接口测试，这个断言功能必不可少，其中我们常断言的响应体包含和JSON这俩个断言又是重重之重。</p>
<p><strong>7. 变量（全局/集合/环境）</strong></p>
<p>变量可以使我们在请求或脚本中存储和重复使用其值，通过将值保存在变量中，可以在集合，环境或请求中引用。</p>
<p>对我们做接口测试来说，又是一个非常重要的功能 。</p>
<p>在postman常用的三种变量分别是全局变量，环境变量，集合变量 。</p>
<ul>
<li><strong>全局变量</strong>：一旦申明了全局变量，全局有效，也就是说postman中的任何集合，任何请求中都可以使用这个变量。它的作用域是最大的 。</li>
<li><strong>环境变量</strong>：要申明环境变量，首先的创建环境，然后在环境中才能创建变量 。如果要想使用环境变量，必须先选择(导入)这个环境，这样就可以使用这个环境下的变量了 。需要说明的是环境也可以创建多个 。每个环境下又可以有多个变量 。</li>
<li><strong>集合变量</strong>：集合变量是针对集合的，也就是说申明的变量必须基于某个集合，它的使用范围也只是针对这个集合有效 。</li>
</ul>
<p>其中，他们的作用域范围依次从大到小：全局变量&gt;集合变量&gt;环境变量 。当在几个不同的范围内都申明了相同的变量时，则会优先使用范围最小的变量使。</p>
<p>想要使用变量中的值只需俩个步骤，分别是定义变量和获取变量 。</p>
<ol>
<li>定义变量（设置变量）</li>
<li>获取变量（访问变量）</li>
</ol>
<p><strong>定义变量</strong></p>
<p>定义全局变量和环境变量，点击右上角的小齿轮，弹出如下界面，就可以根据需求定义全局变量或者环境变量了。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flx1HD6IJ11YoKCQav7eHoAic0qf8hbI1dbMB1nCxWSRmuP3deruv1how/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>已经定义的全局变量和环境变量，可以进行快速查看：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlTnuA0aOnQzo0wHQb0iaXEHfpQkod92E9zMOfVw0MZUNtibH8KZZqWJsA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>定义集合变量</strong></p>
<p>选择一个集合，打开查看更多动作(<strong>…</strong>)菜单，然后点击编辑 。选择“变量”选项卡以编辑或添加到集合变量。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flwfwfc4K53NlbDpwhicnM1vwhGqrxCicHDMyqSoHuibDJ9rXKqPYmfxricw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>定义变量除了以上方式，还有另外一种方式 。但是这种方式在不同的位置定义，编写不一样。</p>
<p>在URL，Params , Authorization , Headers , Body中定义：</p>
<p>\1. 手工方式创建一个空的变量名</p>
<p>\2. 在以上的位置把想要的值选中右击，选中Set：环境|全局 ，选中一个变量名，点击后就会保存到这个变量中</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlYNjEy0GI4H1UNMMqdsydqb0OfIFqqFGDE85TxVrIQxuxOYD9ic2INIw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在Tests，Pre-requests Script：</p>
<ul>
<li>定义全局变量：pm.collectionVariables.set(“变量名”,变量值)</li>
<li>定义环境变量：pm.environment.set(“变量名”，变量值)</li>
<li>定义集合变量：pm.variables.set(“变量名”,变量值)</li>
</ul>
<p><strong>获取变量</strong></p>
<p>定义好变量，接下来就可以使用变量了 。需要注意的是，在不同的位置获取变量，编写的规则也是不一样的 。</p>
<p>如果在<strong>请求参数中</strong>获取变量，无论是获取全局变量，还是环境变量，还是集合变量，获取的方式都是一样的编写规则： 。</p>
<ul>
<li>请求参数指的是：URL，Params , Authorization , Headers , Body</li>
</ul>
<p>如果是在编写代码的位置(Tests,Pre-requests Script)获取变量，获取不同类型的变量，编写的代码都不相同，具体如下：</p>
<ul>
<li>获取环境变量：pm.environment.get(‘变量名’)</li>
<li>获取全局变量：pm.globals.get(‘变量名’)</li>
<li>获取集合变量：pm.pm.collectionVariables.get.get(‘变量名’)</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl0YA8QPHDpsdWAMfkWAxticSOeiax1HP8Sqnb4qu6nibiapXKTtyUeYnRqw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>变量的使用场景非常广泛，比如我们后面要提到的接口关联，请求前置脚本都会使用到变量 。</p>
<p><strong>8. 请求前置脚本</strong></p>
<p>前置脚本其实就是在Pre-requests Script中编写的JavaScript脚本，想要了解这个功能，需要先了解它的执行顺序。那么下面就来看下它的执行顺序 。</p>
<p>可以看出，一个请求在发送之前，会先去执行Pre Request Script（前置脚本）中的代码 。那么这个功能在实际工作中有什么作用呢 ？</p>
<p>主要场景：一般情况下，在发送请求前需要对接口的数据做进一步处理，就都可以使用这个功能，比如说，登录接口的密码，在发送前需要做加密处理，那么就可以在前置脚本中做加密处理，再比如说，有的接口的输入参数有一些随机数，每请求一次接口参数值都会发送变化，就可以在前置脚本中编写生成随机数的代码 。</p>
<p>总体来说，就是在请求接口之前对我们的请求数据进行进一步加工处理的都可以使用前置脚本这个功能。</p>
<p>接下来通过一个案例来看下该功能是如何使用 ？</p>
<p>案例：</p>
<ul>
<li><p>请求的登录接口URL，参数t的值要求的规则是每次请求都必须是一个随机数。</p>
</li>
<li><p>接口地址：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/index.php%EF%BC%9Fm=Home&amp;c=User&amp;a=do_login&amp;t=0.7102045930338428">http://localhost/index.php？m=Home&amp;c=User&amp;a=do_login&amp;t=0.7102045930338428</a></p>
</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl90JA0Trd0rMBeq5HJcrlZBC4WfoqRIBqic1Gsib5GJLc32DUvTBTUg3Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>实现步骤：</p>
<ol>
<li>在前置脚本中编写生成随机数</li>
<li>将这个值保存成环境变量</li>
<li>将参数t的值替换成环境变量的值 。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FliaWAtcJKFaOia5VfHSPk7ZBNhVDq1IQ7GGoR7DR43D4v77hdLlTxibp6g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>总之，这个前置脚本对我们做接口测试也非常有用，对一些复杂的场景，都可以使用前置脚本进行处理后再请求接口 。</p>
<p><strong>9. 接口关联</strong></p>
<p>在我们测试的接口中，经常出现这种情况 。上一个接口的返回数据是下一个接口的输入参数 ，那么这俩个接口就产生了关联。这种关联在做接口测试时非常常见，那么在postman中，如何实现这种关联关系呢 ？</p>
<p>实现思路：</p>
<ol>
<li>提取上一个接口的返回数据值，</li>
<li>将这个数据值保存到环境变量或全局变量中</li>
<li>在下一个接口获取环境变量或全局变量</li>
</ol>
<p>案例：</p>
<ul>
<li>用户上传头像功能，需要用户先上传一张图片，然后会自动预览 。那么在这个过程中，会调用到俩个接口 ，第一个上传头像接口，第二个预览图像接口 。</li>
<li>其中调用上传头像接口成功后会返回如下信息：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;url&quot;: &quot;&#x2F;public&#x2F;upload&#x2F;user&#x2F;&#x2F;head_pic&#x2F;&#x2F;ba51d1c2f7f7b98dfb5cad90846e2d79.jpg&quot;,</span><br><span class="line">    &quot;title&quot;: &quot;banner&quot;,</span><br><span class="line">    &quot;original&quot;: &quot;&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;SUCCESS&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;images&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>而图像预览接口URL为：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/public/upload/user//head_pic//ba51d1c2f7f7b98dfb5cad90846e2d79.jpg">http://localhost/public/upload/user//head_pic//ba51d1c2f7f7b98dfb5cad90846e2d79.jpg</a> 。可以看出这个接口的URL后半部分其实是上一个接口返回的url的值 。那么这俩个接口就产生了关联。那么在postman 可以通过以下三步完成这俩个接口的关联实现 。</p>
<p>实现步骤：</p>
<ol>
<li>获取上传头像接口返回url的值</li>
<li>将这个值保存成全局变量(环境变量也可以)</li>
<li>在图像预览中使用全局变量</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlehOIJJubLWOiczR2Zzib3y1iac2I1R3fxmGPU8O6orVSbjj0gdSPD1p2Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>可以看出，接口的关联的解决方案都是用的是变量中的知识，也就是说只要你明确了要提取的值，后面就是保存该值，然后在其他接口使用该值就可以了。</p>
<p><strong>10.常见返回值获取</strong></p>
<p>在做接口测试时，请求接口返回的数据都是很复杂的json数据，有着多层嵌套，这样的数据层级在postman怎么获取呢 ？</p>
<p>案例1：多层json嵌套, 获取user_id的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;message&quot;: &quot;请求成功！&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;user_id&quot;: &quot;1252163151781167104&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获取json体数据</span><br><span class="line">var jsonData &#x3D; pm.response.json()</span><br><span class="line">&#x2F;&#x2F; 获取user_id的值,通过.获取</span><br><span class="line">var user_id &#x3D; jsonData.data.user_id</span><br></pre></td></tr></table></figure>



<p>案例2：json中存在列表，获取points中的第二个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;message&quot;: &quot;请求成功！&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;roles&quot;: &#123;</span><br><span class="line">            &quot;api&quot;: [</span><br><span class="line">                &quot;API-USER-DELETE&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;points&quot;: [</span><br><span class="line">                &quot;point-user-delete&quot;,</span><br><span class="line">                &quot;POINT-USER-UPDATE&quot;,</span><br><span class="line">                &quot;POINT-USER-ADD&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;authCache&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获取json体数据</span><br><span class="line">var jsonData &#x3D; pm.response.json()</span><br><span class="line">&#x2F;&#x2F; 获取user_id的值,通过下标获取列表中某个元素</span><br><span class="line">var user_id &#x3D; jsonData.data.roles.points[1]</span><br></pre></td></tr></table></figure>



<p>案例3：列表中取最后一个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;message&quot;: &quot;请求成功！&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;total&quot;: 24,</span><br><span class="line">        &quot;rows&quot;: [</span><br><span class="line">           </span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: &quot;1066370498633486336&quot;,</span><br><span class="line">                &quot;mobile&quot;: &quot;15812340003&quot;,</span><br><span class="line">                &quot;username&quot;: &quot;zbz&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: &quot;1071632760222810112&quot;,</span><br><span class="line">                &quot;mobile&quot;: &quot;16612094236&quot;,</span><br><span class="line">                &quot;username&quot;: &quot;llx&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            ...</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: &quot;1075383133106425856&quot;,</span><br><span class="line">                &quot;mobile&quot;: &quot;13523679872&quot;,</span><br><span class="line">                &quot;username&quot;: &quot;test001&quot;,</span><br><span class="line">       </span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获取json体数据</span><br><span class="line">var jsonData &#x3D; pm.response.json()</span><br><span class="line">&#x2F;&#x2F; 获取id的值,通过slice(-1)获取列表中最后一个元素。</span><br><span class="line">var id &#x3D; jsonData.data.rows.slice(-1)[0]</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/18.1.Postman/" data-id="ckq1xbdsj0042pwwdgwts3c7j" data-title="Postman" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-17.1.Maven" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/17.1.Maven/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:01:48.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/17.1.Maven/">Maven</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="pom文件（project-object-model）"><a href="#pom文件（project-object-model）" class="headerlink" title="pom文件（project object model）"></a>pom文件（project object model）</h4><p>pom.xml文件为Maven项目的核心配置文件，Maven的各项插件以及依赖均可以在这里配置javascript</p>
<h5 id="三个必填标签"><a href="#三个必填标签" class="headerlink" title="三个必填标签"></a>三个必填标签</h5><h6 id="groupid-公司名-com-xxx"><a href="#groupid-公司名-com-xxx" class="headerlink" title="groupid 公司名 com.xxx"></a>groupid 公司名 com.xxx</h6><h6 id="artifactId-项目名"><a href="#artifactId-项目名" class="headerlink" title="artifactId 项目名"></a>artifactId 项目名</h6><h6 id="version-版本号"><a href="#version-版本号" class="headerlink" title="version 版本号"></a>version 版本号</h6><h5 id="dependencies标签-包含不少dependency标签"><a href="#dependencies标签-包含不少dependency标签" class="headerlink" title="dependencies标签:包含不少dependency标签"></a>dependencies标签:包含不少dependency标签</h5><p>配置咱们项目中须要哪些jar包<br>maven项目中要想下载指定jar包，就是在Pom中dependency配置<br>查找所需jar包的官网：<br><a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a><br>以mybatis为例：<br><img src="https://resource.shangmayuan.com/droxy-blog/2020/07/10/106f9201d6a548cd86de2e40941c385f-1.jpg" alt="在这里插入图片描述"><br><img src="https://resource.shangmayuan.com/droxy-blog/2020/07/10/f622f4810316451e8a0c15a76629498c-1.jpg" alt="在这里插入图片描述"><br><img src="https://resource.shangmayuan.com/droxy-blog/2020/07/10/00c471b3ff8245b3b93bcaddcbe9dd96-1.jpg" alt="在这里插入图片描述">java</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">3.5</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>配置以后 编译完会在本地仓库里下载jar包<br>不只把指定jar包下载 并且还会把它所依赖的包下载<br>已经下载过的jar包，不会从新下载（maven仓库是同一个仓库,若是换了仓库，也是会从新下载的），若是Jar包版本不同 maven认为是不一样的jar包web</p>
<h5 id="properties标签-用来定义pom一些属性"><a href="#properties标签-用来定义pom一些属性" class="headerlink" title="properties标签:用来定义pom一些属性"></a>properties标签:用来定义pom一些属性</h5><p>好比咱们须要spring的jar包，各个模块的jar包须要同一个版本，这样就能够把这个版本号维护到properties标签里spring</p>
<h5 id="package标签：指定如何构建项目的类型（war-jar…）"><a href="#package标签：指定如何构建项目的类型（war-jar…）" class="headerlink" title="package标签：指定如何构建项目的类型（war jar…）"></a>package标签：指定如何构建项目的类型（war jar…）</h5><h5 id="bulid标签-指定如何构建项目的"><a href="#bulid标签-指定如何构建项目的" class="headerlink" title="bulid标签 指定如何构建项目的"></a>bulid标签 指定如何构建项目的</h5><p>source ：指定当前构建的source目录<br>plugins： 指定进行构建时使用的插件tomcat</p>
<h6 id="maven插件"><a href="#maven插件" class="headerlink" title="maven插件"></a>maven插件</h6><p>maven 其实是一个依赖插件执行的框架，每一个任务都是插件执行的mybatis</p>
<h6 id="两种插件类型"><a href="#两种插件类型" class="headerlink" title="两种插件类型:"></a>两种插件类型:</h6><p>Build plugins 在构建中执行，在pom里配置<br>reporting plugins 在网站生成中执行的，也须要在pom中配置 框架</p>
<h6 id="经常使用插件列表"><a href="#经常使用插件列表" class="headerlink" title="经常使用插件列表:"></a>经常使用插件列表:</h6><p>clean 项目构建以后 用于清理项目<br>compiler 编译java源代码的<br>jar 构建jar文件<br>war 构建war文件<br>tomcat…<br>各个插件官网文档都有做用的说明maven</p>
<h4 id="pom文件能够继承，超级pom文件等等，好比pom文件定义了一些东西，另外一个pom也想定义-就能够继承"><a href="#pom文件能够继承，超级pom文件等等，好比pom文件定义了一些东西，另外一个pom也想定义-就能够继承" class="headerlink" title="pom文件能够继承，超级pom文件等等，好比pom文件定义了一些东西，另外一个pom也想定义 就能够继承"></a>pom文件能够继承，超级pom文件等等，好比pom文件定义了一些东西，另外一个pom也想定义 就能够继承</h4><h2 id="pom-xml解析"><a href="#pom-xml解析" class="headerlink" title="pom.xml解析"></a>pom.xml解析</h2><h3 id="依赖范围"><a href="#依赖范围" class="headerlink" title="依赖范围"></a>依赖范围</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>scope:该标签指定依赖的作用域。</p>
<h3 id="依赖传递"><a href="#依赖传递" class="headerlink" title="依赖传递"></a>依赖传递</h3><h3 id="依赖冲突"><a href="#依赖冲突" class="headerlink" title="依赖冲突"></a>依赖冲突</h3><ul>
<li>依赖路径最短优先</li>
<li>pom中谁写在前面谁优先</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A--&gt;B</span><br><span class="line">B--&gt;C</span><br><span class="line">C--&gt;common-2.0.jar</span><br><span class="line">graph LR</span><br><span class="line">A--&gt;B</span><br><span class="line">B--&gt;common-3.0.jar</span><br></pre></td></tr></table></figure>

<p>介绍：项目依赖了两个版本的common.jar，在打包时会采用依赖路径最短的common.3.0.jar。</p>
<h3 id="项目聚合"><a href="#项目聚合" class="headerlink" title="项目聚合"></a>项目聚合</h3><p>把多个模块聚合到一块。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--demo-parent聚合demo1、demo2、demo3、demo4模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo1<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo2<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo3<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo4<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="依赖继承"><a href="#依赖继承" class="headerlink" title="依赖继承"></a>依赖继承</h3><p>把各个模块公用的依赖抽取成父类，供子模块继承使用。</p>
<ul>
<li>父pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--版本管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql驱动依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql-connector-java.version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">mysql-connector-java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dependencyManagement:管理父类的依赖，把版本号抽取出来放到properties标签中统一管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-java.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--子类的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-children<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-children<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--继承父类的pom依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="其他依赖标签介绍"><a href="#其他依赖标签介绍" class="headerlink" title="其他依赖标签介绍"></a>其他依赖标签介绍</h2><p>依赖传递排除</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;shiro.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--排除依赖传递列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>构建行为列表，bulid标签配置maven构建项目时的需要执行的各种行为，一般都是maven的插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>demo-parent</code>为父工程，聚合如下四个子工程：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//demo-parent下的子工程，同事子工程之间存在相互依赖，demo-admin依赖demo-core</span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-admin<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-core<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-rest<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-generator<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="package"><a href="#package" class="headerlink" title="package"></a>package</h2><p><code>demo-admin</code> 依赖 <code>demo-core</code>，如果在 <code>demo-core</code> 未打包的情况下，单独打包子工程 <code>demo-admin</code>，此时会报错，说找不到 <code>demo-core</code>，因为打包的时候通过pom去maven仓库寻找 <code>demo-core</code>，因 <code>demo-core</code> 不存在所以报错。</p>
<p>如果给 <code>demo-core</code> 执行package命令后，去给 <code>demo-core</code> 打包还会报同样的错，因为package命令仅仅是在 <code>demo-core</code> 的target目录下生成jar包，并未放入到maven仓库中，所以还是找不到。</p>
<p>所以最终解决方案是执行完package命令后，在执行insetall命令，此时会把jar安装到maven仓库中。</p>
<h2 id="maven仓库分类"><a href="#maven仓库分类" class="headerlink" title="maven仓库分类"></a>maven仓库分类</h2><p>在maven中，仓库可以分为：</p>
<p>本地仓库、远程仓库。</p>
<ul>
<li>远程仓库可以分为：中央仓库、私服仓库。<br>中央仓库是maven官方指定的仓库，可以理解为“寻找的最后一站”。</li>
<li>私服仓库可以是自己建的，也可以是其它主体建的（比如aliyun的maven仓库，jboss的maven仓库等）。<br>私服可以分为：全局应用的私服仓库、应用到项目自身的私服仓库。</li>
</ul>
<p>maven寻找得顺序大致可以理解为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">本地仓库--&gt;私服</span><br><span class="line">私服--&gt;远程仓库</span><br></pre></td></tr></table></figure>

<ol>
<li>在本地仓库中寻找，如果没有则进入下一步。</li>
<li>在全局应用的私服仓库中寻找，如果没有则进入下一步。</li>
<li>在项目自身的私服仓库中寻找，如果没有则进入下一步。</li>
<li>在中央仓库中寻找，如果没有则终止寻找。</li>
</ol>
<h2 id="maven常用命令"><a href="#maven常用命令" class="headerlink" title="maven常用命令"></a>maven常用命令</h2><ul>
<li>package命令完成了项目编译、单元测试、打包功能，但没有把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库和远程maven私服仓库</li>
<li>install命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库，==但没有布署到远程maven私服仓库==</li>
<li>deploy命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到==本地maven仓库和远程maven私服仓库==　　</li>
</ul>
<blockquote>
<p>后一个命令会覆盖前一个命令的操作</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//分别是打包、安装、发布跳过测试命令</span><br><span class="line">mvn package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">mvn install -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">mvn deploy -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure>



<p>使用Maven进行项目的声明周期管理，方便对项目依赖和插件进行管理，同时便于项目的统一管理，提升项目开发效率。但是实际工作中会有以下问题：</p>
<p>1  因为安全考虑，有些公司不给开发人员提供外网。因此不能使用maven访问远程的仓库地址。</p>
<p>2  大家同时上网，导致网速比较慢，maven下载构件效率比较低。</p>
<p>3  由于版权的问题，有些第三方jar包无法从远程仓库下载。</p>
<p>4  有些jar包是公司内部使用的，自然也无法从远程maven仓库下载。</p>
<p>使用Nexus搭建私服：<a target="_blank" rel="noopener" href="https://oss.sonatype.org/#welcome">https://oss.sonatype.org/#welcome</a></p>
<p>私服是什么<br>所谓私服，是一种特殊的远程服务器，代理广域网上的远程仓库，供局域网内Maven用户使用。Nexus就是其中一种。需要下载maven构件时候， 先从私服请求，不存在则从外部远程仓库下载，缓存到私服后供下载。对于 一些无法从外部下载的构件，就可以上传到私服供下载使用。</p>
<p>私服，私有服务器，是公司内部Maven项目经常需要的东东，不总结一下，不足以体现出重视。Nexus是常用的私用Maven服务器，一般是公司内部使用。下载地址是<a target="_blank" rel="noopener" href="http://www.sonatype.org/nexus/go%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A38081,%E8%BF%99%E9%87%8C%E6%88%91%E9%80%89%E6%8B%A9%E6%9C%80%E6%96%B0%E7%89%88nexus-2.5.0-04%E3%80%82">http://www.sonatype.org/nexus/go，默认端口8081,这里我选择最新版nexus-2.5.0-04。</a></p>
<p><strong>一 下载安装</strong></p>
<p>地址 <a target="_blank" rel="noopener" href="http://www.sonatype.com/download-oss-sonatype">http://www.sonatype.com/download-oss-sonatype</a></p>
<p>环境 win32  选择版本：nexus-2.13.0-01-bundle.tar.zip</p>
<p>解压安装</p>
<p><img src="/17.1.Maven/201811091422528.png" alt="img"></p>
<p>访问<a target="_blank" rel="noopener" href="http://localhost:8081/nexus/">http://localhost:8081/nexus/</a> 启动后如下页面，在右上角有个Log in 的超链接，点击登录</p>
<p>默认的用户名是 admin 密码是 admin123</p>
<p><img src="/17.1.Maven/201811091422529.png" alt="img"></p>
<p>Public Repositories:  仓库组</p>
<p>3rd party: 无法从公共仓库获得的第三方发布版本的构件仓库</p>
<p>Apache Snapshots: 用了代理ApacheMaven仓库快照版本的构件仓库</p>
<p>Central: 用来代理maven中央仓库中发布版本构件的仓库</p>
<p>Central M1 shadow: 用于提供中央仓库中M1格式的发布版本的构件镜像仓库</p>
<p>Releases: 用来部署管理内部的发布版本构件的宿主类型仓库</p>
<p>Snapshots:用来部署管理内部的快照版本构件的宿主类型仓库</p>
<p><strong>二  IntelliJ IDE使用私服配置</strong></p>
<p>找到maven的安装目录 D:\JetBrains\IntelliJ IDEA 14.1.5\plugins\maven\lib\maven3\conf</p>
<p>修改setting.xml 添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;&#96;&#96;mirrors&#96;&#96;&gt;&#96;&#96; &#96;&#96;&lt;&#96;&#96;mirror&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;id&#96;&#96;&gt;central&lt;&#x2F;&#96;&#96;id&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;mirrorOf&#96;&#96;&gt;*&lt;&#x2F;&#96;&#96;mirrorOf&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;name&#96;&#96;&gt;Central Repository&lt;&#x2F;&#96;&#96;name&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;url&#96;&#96;&gt;http:&#x2F;&#x2F;192.168.1.7:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;&#96;&#96;url&#96;&#96;&gt;&#96;&#96;  &#96;&#96;&lt;&#x2F;&#96;&#96;mirror&#96;&#96;&gt;&#96;&#96; &#96;&#96;&lt;&#x2F;&#96;&#96;mirrors&#96;&#96;&gt;</span><br></pre></td></tr></table></figure>

<p>修改 工程设置，一定要把user setting file  钩给勾上 .  OK 工程无需其它配置 就可以使用私服了</p>
<p><img src="/17.1.Maven/2018110914225210.png" alt="img"></p>
<p><strong>三上传构建到私服</strong> </p>
<p>直接用  idea  中的  deploy按钮就可以将 打好的 jar 包或者 war包上传到 私服中  （install  是将jar包 拷贝到本地仓库）<br>maven setting.xml 添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;servers&gt;  </span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;username&gt;admin&lt;&#x2F;username&gt;</span><br><span class="line">    &lt;password&gt;admin123&lt;&#x2F;password&gt;</span><br><span class="line">  &lt;&#x2F;server&gt;</span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;username&gt;admin&lt;&#x2F;username&gt;</span><br><span class="line">    &lt;password&gt;admin123&lt;&#x2F;password&gt;</span><br><span class="line">  &lt;&#x2F;server&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;servers&gt;</span><br></pre></td></tr></table></figure>

<p>工程pom.xml 添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Nexus Release Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.7:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;releases&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;snapshotRepository&gt;</span><br><span class="line">      &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Nexus Snapshot Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.7:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;snapshots&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;snapshotRepository&gt;</span><br><span class="line">  &lt;&#x2F;distributionManagement&gt;</span><br></pre></td></tr></table></figure>





<p>常用功能<br>Nexus常用功能就是：指定私服的中央地址、将自己的Maven项目指定到私服地址、从私服下载中央库的项目索引、从私服仓库下载依赖组件、将第三方项目jar上传到私服供其他项目组使用。<br>开启Nexus服务后访问url地址<a target="_blank" rel="noopener" href="http://localhost:8081/nexus/(%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84ip%E5%9C%B0%E5%9D%80)%EF%BC%8C%E4%B9%8B%E5%90%8E%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E5%88%86%E5%88%AB%E6%98%AF%EF%BC%9Aadmin/admin123">http://localhost:8081/nexus/(推荐使用自己的ip地址)，之后登录系统，用户名密码分别是：admin/admin123</a>.<br>最频繁的就是点击左侧菜单栏的Repositories按钮</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxMzU2MjcyNjktMTA5MDQ4MTg2LmpwZw" alt="img"></p>
<p>一般用到的仓库种类是hosted、proxy。Hosted代表宿主仓库，用来发布一些第三方不允许的组件，比如Oracle驱动、比如商业软件jar包。Proxy代表代理远程的仓库，最典型的就是Maven官方中央仓库、JBoss仓库等等。如果构建的Maven项目本地仓库没有依赖包，那么就会去这个代理站点去下载，那么如果代理站点也没有此依赖包，就回去远程中央仓库下载依赖，这些中央仓库就是proxy。代理站点下载成功后再下载至本机。笔者认为，其实Maven这个自带的默认仓库一般情况下已经够大多数项目使用了。特殊情况时在配置新的仓库，指定url即可，一般熟悉ExtJS的人操作这个Nexus都没什么问题，单词不是很难，不明白的查查单词基本差不多。就是如果Sonatype公司对其做了国际化一的处理就更好了。</p>
<p>hosted    类型的仓库，内部项目的发布仓库<br>releases    内部的模块中release模块的发布仓库<br>snapshots    发布内部的SNAPSHOT模块的仓库<br>3rd party    第三方依赖的仓库，这个数据通常是由内部人员自行下载之后发布上去<br>proxy    类型的仓库，从远程中央仓库中寻找数据的仓库<br>group    类型的仓库，组仓库用来方便我们开发人员进行设置的仓库<br>maven项目索引<br>下载Maven项目索引，项目索引是为了使用者能够在私服站点查找依赖使用的功能</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDA0MjA1ODItMTk4ODI4Njk5LmpwZw" alt="img"></p>
<p>保存后后台会运行一个任务，点击菜单栏的Scheduled Tasks选项即可看到有个任务在RUNNING。 下载完成后，Maven索引就可以使用了，在搜索栏输入要搜索的项，就可以查到相关的信息。例如spring-core</p>
<p> <img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDA1NDkyMzgtMTIwNzAwOTYyOC5qcGc" alt="img"></p>
<p>就可以检索出它的相关信息，包括怎么配置依赖信息。我们要想使用这个私服仓库，先在项目pom中配置相关私服信息</p>
<p>指定仓库</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>13</p>
<repositories>

<pre><code>&lt;repository&gt;

    &lt;id&gt;nexus&lt;/id&gt;

    &lt;name&gt;nexus&lt;/name&gt;

    &lt;url&gt;http://192.168.1.103:8081/nexus/content/groups/public/&lt;/url&gt;

    &lt;releases&gt;

        &lt;enabled&gt;true&lt;/enabled&gt;

    &lt;/releases&gt;

    &lt;snapshots&gt;

        &lt;enabled&gt;true&lt;/enabled&gt;

    &lt;/snapshots&gt;

&lt;/repository&gt;
</code></pre>
</repositories>

<p>这样只有本项目才在私服下载组件</p>
<p>这样这个Maven项目构建的时候会从私服下载相关依赖。当然这个配置仅仅是在此项目中生效，对于其他项目还是不起作用。如果相对Maven的其他项目也生效的话。需要修改全局的settings.xml文件。</p>
<p>修改settings.xml为</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEwMjgyODUtMTEzODE2ODYwOC5qcGc" alt="img"></p>
<p>追加激活profile</p>
<p>1</p>
<p>2</p>
<p>3</p>
<activeProfiles>

<pre><code>&lt;activeProfile&gt;central&lt;/activeProfile&gt;
</code></pre>
</activeProfiles>

<p>之后所有本机的Maven项目就在私服下载组件。（这样比较好）</p>
<p>项目的发布<br>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<distributionManagement>

<pre><code>&lt;repository&gt;

    &lt;id&gt;user-release&lt;/id&gt;

    &lt;name&gt;User Project Release&lt;/name&gt;

    &lt;url&gt;http://192.168.1.103:8081/nexus/content/repositories/releases/&lt;/url&gt;

&lt;/repository&gt;

&lt;snapshotRepository&gt;

    &lt;id&gt;user-snapshots&lt;/id&gt;

    &lt;name&gt;User Project SNAPSHOTS&lt;/name&gt;

    &lt;url&gt;http://192.168.1.103:8081/nexus/content/repositories/snapshots/&lt;/url&gt;

&lt;/snapshotRepository&gt;
</code></pre>
</distributionManagement>

<p>注意配置了还是发布项目到私服失败，原因为没有权限</p>
<p>配置权限在settings.xml</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEzMDEwNjYtMTQwMjI0ODA2Ny5qcGc" alt="img"></p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEzMTQ3MDctODI4Njg2ODY3LmpwZw" alt="img"></p>
<p>然后运行发布<br>clean deploy<br>在控制台发布成功<br>然后进入到私服上的仓库中，看一下确实存在刚刚发布的项目</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEzNDQ2NDQtNTc5NzgxNTQ5LmpwZw" alt="img"></p>
<p>宿主库——3rd party<br>假如我们下载了Oracle的驱动程序jar包想给其他项目组使用，就需要上传该jar包。选中宿主库——3rd party，之后选择Artifact Upload上传至宿主空间。</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDE0MzA5NDEtNzMzNTkxNDk1LmpwZw" alt="img"></p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDE0NTAyODUtNjAwODE1MDc2LmpwZw" alt="img"></p>
<p>最后点击上传</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDE1MTMyMzgtMTAwNjI4NTM4MC5qcGc" alt="img"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/17.1.Maven/" data-id="ckq1xbdrd000rpwwd48h17xgz" data-title="Maven" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-16.1.Docker" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/16.1.Docker/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:01:17.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/16.1.Docker/">Docker</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="容器简介"><a href="#容器简介" class="headerlink" title="容器简介"></a><strong>容器简介</strong></h2><h3 id="什么是-Linux-容器"><a href="#什么是-Linux-容器" class="headerlink" title="什么是 Linux 容器"></a><strong>什么是 Linux 容器</strong></h3><p>Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。</p>
<p>容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNJHb3Q3iaoePFedxGK0NdPncQfl6aotsbonTG2FicsX4Bziaw97H4FgQUw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>更加详细地来说，请您假定您在开发一个应用。您使用的是一台笔记本电脑，而且您的开发环境具有特定的配置。其他开发人员身处的环境配置可能稍有不同。您正在开发的应用依赖于您当前的配置，还要依赖于某些特定文件。</p>
<p>与此同时，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文件。</p>
<p>您希望尽可能多在本地模拟这些环境，而不产生重新创建服务器环境的开销。</p>
<p>因此，您要如何确保应用能够在这些环境中运行和通过质量检测，并且在部署过程中不出现令人头疼的问题，也无需重新编写代码和进行故障修复？答案就是使用容器。</p>
<p>容器可以确保您的应用拥有必需的配置和文件，使得这些应用能够在从开发到测试、再到生产的整个流程中顺利运行，而不出现任何不良问题。这样可以避免危机，做到皆大欢喜。</p>
<p>虽然这只是简化的示例，但在需要很高的可移植性、可配置性和隔离的情况下，我们可以利用 Linux 容器通过很多方式解决难题。</p>
<p>无论基础架构是在企业内部还是在云端，或者混合使用两者，容器都能满足您的需求。</p>
<h3 id="容器和虚拟化"><a href="#容器和虚拟化" class="headerlink" title="容器和虚拟化"></a><strong>容器和虚拟化</strong></h3><p>容器和虚拟化不是等同的。</p>
<p>虚拟化使得许多操作系统可同时在单个系统上运行。</p>
<p>容器则可共享同一个操作系统内核，将应用进程与系统其他部分隔离开。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNttwRxBsGRT1zsefq4qcWZO9lPmsSpiaS9VIMRSF7a20APn22Vn4lNqQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                                                图 - 普通虚拟化技术和Docker的对比</p>
<p>这意味着什么？首先，让多个操作系统在单个虚拟机监控程序上运行以实现虚拟化，并不能达成和使用容器同等的轻量级效果。</p>
<p>事实上，在仅拥有容量有限的有限资源时，您需要能够可以进行密集部署的轻量级应用。</p>
<p>Linux 容器可从单个操作系统运行，在所有容器中共享该操作系统，因此应用和服务能够保持轻量级，并行快速运行。</p>
<h3 id="容器发展简史"><a href="#容器发展简史" class="headerlink" title="容器发展简史"></a><strong>容器发展简史</strong></h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNNC2uBib5YZeRTnyY86wBNeOVicVUQDj8LKpD5TUibRBArAxd2M6tHtDrw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>我们现在称为容器技术的概念最初出现在 2000 年，当时称为 FreeBSD jail，这种技术可将 FreeBSD 系统分区为多个子系统（也称为 Jail）。</p>
<p>Jail 是作为安全环境而开发的，系统管理员可与企业内部或外部的多个用户共享这些 Jail。</p>
<p>Jail 的目的是让进程在经过修改的 chroot 环境中创建，而不会脱离和影响整个系统 — 在 chroot 环境中，对文件系统、网络和用户的访问都实现了虚拟化。</p>
<p>尽管 Jail 在实施方面存在局限性，但最终人们找到了脱离这种隔离环境的方法。</p>
<p>但这个概念非常有吸引力。</p>
<p>2001 年，通过 Jacques Gélinas 的 VServer 项目，隔离环境的实施进入了 Linux 领域。</p>
<p>正如 Gélinas 所说，这项工作的目的是“在高度独立且安全的单一环境中运行多个通用 Linux 服务器 [sic]。” </p>
<p>在完成了这项针对 Linux 中多个受控制用户空间的基础性工作后，Linux 容器开始逐渐成形并最终发展成了现在的模样。</p>
<h2 id="什么是-Docker？"><a href="#什么是-Docker？" class="headerlink" title="什么是 Docker？"></a><strong>什么是 Docker？</strong></h2><p>“Docker” 一词指代多种事物，包括开源社区项目、开源项目使用的工具、主导支持此类项目的公司 Docker Inc. 以及该公司官方支持的工具。技术产品和公司使用同一名称，的确让人有点困惑。</p>
<p>我们来简单说明一下：</p>
<p>🎍 IT 软件中所说的 “Docker” ，是指容器化技术，用于支持创建和使用 Linux 容器。</p>
<p>🎍 开源 Docker 社区致力于改进这类技术，并免费提供给所有用户，使之获益。</p>
<p>🎍 Docker Inc. 公司凭借 Docker 社区产品起家，它主要负责提升社区版本的安全性，并将改进后的版本与更广泛的技术社区分享。此外，它还专门对这些技术产品进行完善和安全固化，以服务于企业客户。</p>
<p>借助 Docker ，您可将容器当做重量轻、模块化的虚拟机使用。同时，您还将获得高度的灵活性，从而实现对容器的高效创建、部署及复制，并能将其从一个环境顺利迁移至另一个环境。</p>
<h3 id="Docker-如何工作？"><a href="#Docker-如何工作？" class="headerlink" title="Docker 如何工作？"></a><strong>Docker 如何工作？</strong></h3><p>Docker 技术使用 Linux 内核和内核功能（例如 Cgroups 和 namespaces）来分隔进程，以便各进程相互独立运行。</p>
<p>这种独立性正是采用容器的目的所在；它可以独立运行多种进程、多个应用程序，更加充分地发挥基础设施的作用，同时保持各个独立系统的安全性。</p>
<p>容器工具（包括 Docker）可提供基于镜像的部署模式。这使得它能够轻松跨多种环境，与其依赖程序共享应用或服务组。Docker 还可在这一容器环境中自动部署应用程序（或者合并多种流程，以构建单个应用程序）。</p>
<p>此外，由于这些工具基于 Linux 容器构建，使得 Docker 既易于使用，又别具一格 —— 它可为用户提供前所未有的高度应用程访问权限、快速部署以及版本控制和分发能力。</p>
<h3 id="Docker-技术是否与传统的-Linux-容器相同？"><a href="#Docker-技术是否与传统的-Linux-容器相同？" class="headerlink" title="Docker 技术是否与传统的 Linux 容器相同？"></a><strong>Docker 技术是否与传统的 Linux 容器相同？</strong></h3><p>否。Docker 技术最初是基于 LXC 技术构建（大多数人都会将这一技术与“传统的” Linux 容器联系在一起），但后来它逐渐摆脱了对这种技术的依赖。</p>
<p><strong>就轻量级 虚拟化 这一功能来看，LXC 非常有用</strong>，但它无法提供出色的开发人员或用户体验。除了运行容器之外，Docker 技术还具备其他多项功能，包括简化用于构建容器、传输镜像以及控制镜像版本的流程。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNSTduDPY6VjYcM953tjoDMvSQ7NQRIB4iadxRetGb582Fz7t2wBkJIyw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>传统的 Linux 容器使用 init 系统来管理多种进程。这意味着，所有应用程序都作为一个整体运行。与此相反，Docker 技术鼓励应用程序各自独立运行其进程，并提供相应工具以实现这一功能。这种精细化运作模式自有其优势。</p>
<h3 id="docker的目标"><a href="#docker的目标" class="headerlink" title="docker的目标"></a><strong>docker的目标</strong></h3><p>docker的主要目标是”Build,Ship and Run any App,Anywhere”,构建，运输，处处运行</p>
<ul>
<li><strong>构建：</strong>做一个docker镜像</li>
<li><strong>运输：</strong>docker pull</li>
<li><strong>运行：</strong>启动一个容器</li>
</ul>
<p>每一个容器，他都有自己的文件系统rootfs</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a><strong>安装Docker</strong></h2><p>环境说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 需要两台节点进行安装</span><br><span class="line">[root@docker01 ~]# cat &#x2F;etc&#x2F;redhat-release </span><br><span class="line">CentOS Linux release 7.2.1511 (Core) </span><br><span class="line">[root@docker01 ~]# uname  -r </span><br><span class="line">3.10.0-327.el7.x86_64</span><br><span class="line">[root@docker01 ~]# hostname -I</span><br><span class="line">10.0.0.100 172.16.1.100 </span><br><span class="line">[root@docker02 ~]# hostname -I</span><br><span class="line">10.0.0.101 172.16.1.101</span><br></pre></td></tr></table></figure>



<p>在<strong>两个节点</strong>上都进行操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">sed -i &#39;s#download.docker.com#mirrors.ustc.edu.cn&#x2F;docker-ce#g&#39; &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</span><br><span class="line">yum install docker-ce -y</span><br></pre></td></tr></table></figure>



<p>修改在docker01配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 修改启动文件，监听远程端口</span><br><span class="line">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock -H tcp:&#x2F;&#x2F;10.0.0.100:2375</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable docker.service </span><br><span class="line">systemctl restart docker.service</span><br><span class="line"># ps -ef检查进行，是否启动</span><br></pre></td></tr></table></figure>



<p>在docker02测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker -H 10.0.0.100 info</span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.12.0-ce</span><br><span class="line">Storage Driver: devicemapper</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="Docker基础命令操作"><a href="#Docker基础命令操作" class="headerlink" title="Docker基础命令操作"></a><strong>Docker基础命令操作</strong></h3><p>查看docker相关信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#  docker version  </span><br><span class="line">Client:</span><br><span class="line"> Version:    17.12.0-ce</span><br><span class="line"> API version:    1.35</span><br><span class="line"> Go version:    go1.9.2</span><br><span class="line"> Git commit:    c97c6d6</span><br><span class="line"> Built:    Wed Dec 27 20:10:14 2017</span><br><span class="line"> OS&#x2F;Arch:    linux&#x2F;amd64</span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:    17.12.0-ce</span><br><span class="line">  API version:    1.35 (minimum version 1.12)</span><br><span class="line">  Go version:    go1.9.2</span><br><span class="line">  Git commit:    c97c6d6</span><br><span class="line">  Built:    Wed Dec 27 20:12:46 2017</span><br><span class="line">  OS&#x2F;Arch:    linux&#x2F;amd64</span><br><span class="line">  Experimental:    false</span><br></pre></td></tr></table></figure>



<p>配置docker镜像加速</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;]</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="启动第一个容器"><a href="#启动第一个容器" class="headerlink" title="启动第一个容器"></a><strong>启动第一个容器</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 80:80 nginx</span><br><span class="line">Unable to find image &#39;nginx:latest&#39; locally</span><br><span class="line">latest: Pulling from library&#x2F;nginx</span><br><span class="line">e7bb522d92ff: Pull complete </span><br><span class="line">6edc05228666: Pull complete </span><br><span class="line">cd866a17e81f: Pull complete </span><br><span class="line">Digest: sha256:285b49d42c703fdf257d1e2422765c4ba9d3e37768d6ea83d7fe2043dad6e63d</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">8d8f81da12b5c10af6ba1a5d07f4abc041cb95b01f3d632c3d638922800b0b4d</span><br><span class="line"># 容器启动后，在浏览器进行访问测试 </span><br></pre></td></tr></table></figure>



<p>参数说明</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNjMMEyibP61FMtxGnq1XdbQH5fiaYBtyQfQ1gew4gzqQbc9QnzRIuibEdw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="Docker镜像生命周期"><a href="#Docker镜像生命周期" class="headerlink" title="Docker镜像生命周期"></a><strong>Docker镜像生命周期</strong></h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNSxPFC21wFyyxKXFJRmXXwg45brbOIr6oI52Xo12opMk4YKmtLICv5Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="Docker镜像相关操作"><a href="#Docker镜像相关操作" class="headerlink" title="Docker镜像相关操作"></a><strong>Docker镜像相关操作</strong></h2><h3 id="搜索官方仓库镜像"><a href="#搜索官方仓库镜像" class="headerlink" title="搜索官方仓库镜像"></a><strong>搜索官方仓库镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#  docker search centos</span><br><span class="line">NAME                      DESCRIPTION                    STARS    OFFICIAL               AUTOMATED</span><br><span class="line">centos                    The official build of CentOS.  3992     [OK]      </span><br><span class="line">ansible&#x2F;centos7-ansible   Ansible on Centos7             105                              [OK]</span><br></pre></td></tr></table></figure>



<p>列表说明</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNYehuNNwtQs3FPDfhGoocqoic7OuBpAicn1SOW3ANVkQDxb9LMsDGicUYg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a><strong>获取镜像</strong></h3><p>根据镜像名称拉取镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library&#x2F;centos</span><br><span class="line">af4b0a2388c6: Downloading  34.65MB&#x2F;73.67MB</span><br></pre></td></tr></table></figure>



<p>查看当前主机镜像列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              ff426288ea90        3 weeks ago         207MB</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br></pre></td></tr></table></figure>



<p>拉第三方镜像方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull index.tenxcloud.com&#x2F;tenxcloud&#x2F;httpd</span><br></pre></td></tr></table></figure>

<h3 id="-2"><a href="#-2" class="headerlink" title=""></a></h3><h3 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a><strong>导出镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              ff426288ea90        3 weeks ago         207MB</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br><span class="line"># 导出</span><br><span class="line">[root@docker01 ~]# docker image save centos &gt; docker-centos.tar.gz</span><br></pre></td></tr></table></figure>



<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a><strong>删除镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image rm centos:latest</span><br><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br></pre></td></tr></table></figure>



<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a><strong>导入镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image load -i docker-centos.tar.gz  </span><br><span class="line">e15afa4858b6: Loading layer  215.8MB&#x2F;215.8MB</span><br><span class="line">Loaded image: centos:latest</span><br><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              ff426288ea90        3 weeks ago         207MB</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br></pre></td></tr></table></figure>



<h3 id="查看镜像的详细信息"><a href="#查看镜像的详细信息" class="headerlink" title="查看镜像的详细信息"></a><strong>查看镜像的详细信息</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image inspect centos</span><br></pre></td></tr></table></figure>



<h2 id="容器的日常管理"><a href="#容器的日常管理" class="headerlink" title="容器的日常管理"></a><strong>容器的日常管理</strong></h2><h3 id="容器的起-停"><a href="#容器的起-停" class="headerlink" title="容器的起/停"></a><strong>容器的起/停</strong></h3><p>最简单的运行一个容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run nginx</span><br></pre></td></tr></table></figure>



<p>创建容器，两步走（不常用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker create centos:latest  &#x2F;bin&#x2F;bash</span><br><span class="line">bb7f32368ecf0492adb59e20032ab2e6cf6a563a0e6751e58930ee5f7aaef204</span><br><span class="line">[root@docker01 ~]# docker start stupefied_nobel</span><br><span class="line">stupefied_nobel</span><br></pre></td></tr></table></figure>



<p>快速启动容器方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  centos:latest  &#x2F;usr&#x2F;bin&#x2F;sleep 20;</span><br></pre></td></tr></table></figure>



<p><strong>容器内的第一个进程必须一直处于运行的状态，否则这个容器，就会处于退出状态！</strong></p>
<p>查看正在运行的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker container ls</span><br><span class="line">    或</span><br><span class="line">[root@docker01 ~]# docker ps </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">8708e93fd767        nginx               &quot;nginx -g &#39;daemon of…&quot;   6 seconds ago       Up 4 seconds        80&#x2F;tcp              keen_lewin</span><br></pre></td></tr></table></figure>



<p>查看你容器详细信息/ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker container  inspect  容器名称&#x2F;id</span><br></pre></td></tr></table></figure>



<p>查看你所有容器（包括未运行的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">8708e93fd767        nginx               &quot;nginx -g &#39;daemon of…&quot;   4 minutes ago       Exited (0) 59 seconds ago                       keen_lewin</span><br><span class="line">f9f3e6af7508        nginx               &quot;nginx -g &#39;daemon of…&quot;   5 minutes ago       Exited (0) 5 minutes ago                        optimistic_haibt</span><br><span class="line">8d8f81da12b5        nginx               &quot;nginx -g &#39;daemon of…&quot;   3 hours ago         Exited (0) 3 hours ago                          lucid_bohr</span><br></pre></td></tr></table></figure>



<p>停止容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker stop 容器名称&#x2F;id </span><br><span class="line">或</span><br><span class="line">[root@docker01 ~]# docker container  kill  容器名称&#x2F;id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="进入容器方法"><a href="#进入容器方法" class="headerlink" title="进入容器方法"></a><strong>进入容器方法</strong></h3><p><strong>启动时进去方法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -it #参数：-it 可交互终端</span><br><span class="line">[root@docker01 ~]# docker run -it nginx:latest  &#x2F;bin&#x2F;bash</span><br><span class="line">root@79241093859e:&#x2F;#</span><br></pre></td></tr></table></figure>



<p>退出/离开容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl+p &amp; ctrl+q</span><br></pre></td></tr></table></figure>



<p><strong>启动后进入容器的方法</strong></p>
<p>启动一个docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -it centos:latest </span><br><span class="line">[root@1bf0f43c4d2f &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 15:47 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         13      1  0 15:47 pts&#x2F;0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>



<p>attach进入容器，使用pts/0 ，会让所用通过此方法进如放入用户看到同样的操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker attach 1bf0f43c4d2f</span><br><span class="line">[root@1bf0f43c4d2f &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 15:47 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         14      1  0 15:49 pts&#x2F;0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>



<p>自命名启动一个容器 –name</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker attach 1bf0f43c4d2f</span><br><span class="line">[root@1bf0f43c4d2f &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 15:47 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         14      1  0 15:49 pts&#x2F;0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>



<p>exec 进入容器方法（推荐使用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker exec -it clsn1  &#x2F;bin&#x2F;bash </span><br><span class="line">[root@b20fa75b4b40 &#x2F;]# 重新分配一个终端</span><br><span class="line">[root@b20fa75b4b40 &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 16:11 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         13      0  0 16:14 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         26     13  0 16:14 pts&#x2F;1    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<h3 id="删除所有容器"><a href="#删除所有容器" class="headerlink" title="删除所有容器"></a><strong>删除所有容器</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker rm -f  &#96;docker ps -a -q&#96;</span><br><span class="line"># -f 强制删除</span><br></pre></td></tr></table></figure>



<h3 id="启动时进行端口映射"><a href="#启动时进行端口映射" class="headerlink" title="启动时进行端口映射"></a><strong>启动时进行端口映射</strong></h3><p>-p参数端口映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 8888:80  nginx:latest </span><br><span class="line">287bec5c60263166c03e1fc5b0b8262fe76507be3dfae4ce5cd2ee2d1e8a89a9</span><br></pre></td></tr></table></figure>



<p>不同指定映射方法</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNuZQOkTKHYyYzsuYxRnOgYo1VXicesHlyCghOXo4sj5zaiaHry6jqcZSw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>随机映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -P （大P）# 需要镜像支持</span><br></pre></td></tr></table></figure>

<h2 id="Docker-数据卷的管理"><a href="#Docker-数据卷的管理" class="headerlink" title="Docker 数据卷的管理"></a><strong>Docker 数据卷的管理</strong></h2><h3 id="挂载时创建卷"><a href="#挂载时创建卷" class="headerlink" title="挂载时创建卷"></a><strong>挂载时创建卷</strong></h3><p>挂载卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 80:80 -v &#x2F;data:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest</span><br><span class="line">079786c1e297b5c5031e7a841160c74e91d4ad06516505043c60dbb78a259d09</span><br></pre></td></tr></table></figure>



<p>容器内站点目录: /usr/share/nginx/html</p>
<p>在宿主机写入数据，查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# echo &quot;http:&#x2F;&#x2F;www.nmtui.com&quot; &gt;&#x2F;data&#x2F;index.html</span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100</span><br><span class="line">http:&#x2F;&#x2F;www.nmtui.com</span><br></pre></td></tr></table></figure>



<p>设置共享卷，使用同一个卷启动一个新的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 8080:80 -v &#x2F;data:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest </span><br><span class="line">351f0bd78d273604bd0971b186979aa0f3cbf45247274493d2490527babb4e42</span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100:8080</span><br><span class="line">http:&#x2F;&#x2F;www.nmtui.com</span><br></pre></td></tr></table></figure>



<p>查看卷列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br></pre></td></tr></table></figure>

<h3 id="创建卷后挂载"><a href="#创建卷后挂载" class="headerlink" title="创建卷后挂载"></a><strong>创建卷后挂载</strong></h3><p>创建一个卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume create </span><br><span class="line">f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521</span><br><span class="line">[root@docker01 ~]# docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521</span><br></pre></td></tr></table></figure>



<p>指定卷名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               clsn</span><br><span class="line">local               f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521</span><br></pre></td></tr></table></figure>



<p>查看卷路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume inspect clsn </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2018-02-01T00:39:25+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;clsn&#x2F;_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;clsn&quot;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>使用卷创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 9000:80 -v clsn:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest </span><br><span class="line">1434559cff996162da7ce71820ed8f5937fb7c02113bbc84e965845c219d3503</span><br><span class="line"># 宿主机测试</span><br><span class="line">[root@docker01 ~]# echo &#39;blog.nmtui.com&#39; &gt;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;clsn&#x2F;_data&#x2F;index.html </span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100:9000</span><br><span class="line">blog.nmtui.com</span><br></pre></td></tr></table></figure>



<p>设置卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -d  -P  --volumes-from 079786c1e297 nginx:latest </span><br><span class="line">b54b9c9930b417ab3257c6e4a8280b54fae57043c0b76b9dc60b4788e92369fb</span><br></pre></td></tr></table></figure>



<p>查看使用的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# netstat -lntup </span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID&#x2F;Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1400&#x2F;sshd           </span><br><span class="line">tcp        0      0 10.0.0.100:2375         0.0.0.0:*               LISTEN      26218&#x2F;dockerd       </span><br><span class="line">tcp6       0      0 :::9000                 :::*                    LISTEN      32015&#x2F;docker-proxy  </span><br><span class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      31853&#x2F;docker-proxy  </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      31752&#x2F;docker-proxy  </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1400&#x2F;sshd           </span><br><span class="line">tcp6       0      0 :::32769                :::*                    LISTEN      32300&#x2F;docker-proxy  </span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100:32769</span><br><span class="line">http:&#x2F;&#x2F;www.nmtui.com</span><br></pre></td></tr></table></figure>



<h3 id="手动将容器保存为镜像"><a href="#手动将容器保存为镜像" class="headerlink" title="手动将容器保存为镜像"></a><strong>手动将容器保存为镜像</strong></h3><p>本次是基于docker官方centos 6.8 镜像创建</p>
<p>官方镜像列表：</p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/explore/">https://hub.docker.com/explore/</a></p>
<p>启动一个centos6.8的镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker pull  centos:6.8</span><br><span class="line">[root@docker01 ~]# docker run -it -p 1022:22 centos:6.8  &#x2F;bin&#x2F;bash</span><br><span class="line"># 在容器种安装sshd服务，并修改系统密码</span><br><span class="line">[root@582051b2b92b ~]# yum install  openssh-server -y </span><br><span class="line">[root@582051b2b92b ~]# echo &quot;root:123456&quot; |chpasswd</span><br><span class="line">[root@582051b2b92b ~]#  &#x2F;etc&#x2F;init.d&#x2F;sshd start</span><br></pre></td></tr></table></figure>



<p>启动完成后镜像ssh连接测试</p>
<p>将容器提交为镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker commit brave_mcclintock  centos6-ssh</span><br></pre></td></tr></table></figure>





<p>使用新的镜像启动容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d  -p 1122:22  centos6-ssh:latest  &#x2F;usr&#x2F;sbin&#x2F;sshd -D </span><br><span class="line">5b8161fda2a9f2c39c196c67e2eb9274977e7723fe51c4f08a0190217ae93094</span><br></pre></td></tr></table></figure>





<p>在容器安装httpd服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@5b8161fda2a9 &#x2F;]#  yum install httpd -y</span><br></pre></td></tr></table></figure>



<p>编写启动脚本脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@5b8161fda2a9 &#x2F;]# cat  init.sh </span><br><span class="line">#!&#x2F;bin&#x2F;bash </span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;httpd start </span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;sshd -D</span><br><span class="line">[root@5b8161fda2a9 &#x2F;]# chmod +x init.sh </span><br><span class="line"># 注意执行权限</span><br></pre></td></tr></table></figure>





<p>再次提交为新的镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker commit  5b8161fda2a9 centos6-httpd </span><br><span class="line">sha256:705d67a786cac040800b8485cf046fd57b1828b805c515377fc3e9cea3a481c1</span><br></pre></td></tr></table></figure>





<p>启动镜像，做好端口映射。并在浏览器中测试访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 1222:22 -p 80:80  centos6-httpd &#x2F;init.sh </span><br><span class="line">46fa6a06644e31701dc019fb3a8c3b6ef008d4c2c10d46662a97664f838d8c2c</span><br></pre></td></tr></table></figure>



<h2 id="Dockerfile自动构建docker镜像"><a href="#Dockerfile自动构建docker镜像" class="headerlink" title="Dockerfile自动构建docker镜像"></a><strong>Dockerfile自动构建docker镜像</strong></h2><p>官方构建dockerffile文件参考</p>
<p><a target="_blank" rel="noopener" href="https://github.com/CentOS/CentOS-Dockerfiles">https://github.com/CentOS/CentOS-Dockerfiles</a></p>
<h3 id="Dockerfile指令集"><a href="#Dockerfile指令集" class="headerlink" title="Dockerfile指令集"></a><strong>Dockerfile指令集</strong></h3><p>dockerfile主要组成部分：</p>
<ul>
<li>基础镜像信息 FROM centos:6.8</li>
<li>制作镜像操作指令RUN yum insatll openssh-server -y</li>
<li>容器启动时执行指令 CMD [“/bin/bash”]</li>
</ul>
<p>dockerfile常用指令：</p>
<ul>
<li>FROM 这个镜像的妈妈是谁？（指定基础镜像）</li>
<li>MAINTAINER 告诉别人，谁负责养它？（指定维护者信息，可以没有）</li>
<li>RUN 你想让它干啥（在命令前面加上RUN即可）</li>
<li>ADD 给它点创业资金（COPY文件，会自动解压）</li>
<li>WORKDIR 我是cd,今天刚化了妆（设置当前工作目录）</li>
<li>VOLUME 给它一个存放行李的地方（设置卷，挂载主机目录）</li>
<li>EXPOSE 它要打开的门是啥（指定对外的端口）</li>
<li>CMD 奔跑吧，兄弟！（指定容器启动后的要干的事情）</li>
</ul>
<p>dockerfile其他指令： </p>
<ul>
<li>COPY 复制文件</li>
<li>ENV 环境变量</li>
<li>ENTRYPOINT 容器启动后执行的命令</li>
</ul>
<h3 id="创建一个Dockerfile"><a href="#创建一个Dockerfile" class="headerlink" title="创建一个Dockerfile"></a><strong>创建一个Dockerfile</strong></h3><p>创建第一个Dockerfile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 创建目录</span><br><span class="line">[root@docker01 base]# cd &#x2F;opt&#x2F;base</span><br><span class="line"># 创建Dcokerfile文件，注意大小写</span><br><span class="line">[root@docker01 base]# vim Dockerfile</span><br><span class="line">FROM centos:6.8</span><br><span class="line">RUN yum install openssh-server -y </span><br><span class="line">RUN echo &quot;root:123456&quot; |chpasswd</span><br><span class="line">RUN &#x2F;etc&#x2F;init.d&#x2F;sshd start </span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,&quot;-D&quot;]</span><br></pre></td></tr></table></figure>



<p>构建docker镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 base]# docker image build  -t centos6.8-ssh . </span><br><span class="line">-t 为镜像标签打标签  . 表示当前路径</span><br></pre></td></tr></table></figure>



<p>使用自构建的镜像启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 base]# docker run  -d -p 2022:22 centos6.8-ssh-b </span><br><span class="line">dc3027d3c15dac881e8e2aeff80724216f3ac725f142daa66484f7cb5d074e7a</span><br></pre></td></tr></table></figure>



<h3 id="使用Dcokerfile安装kodexplorer"><a href="#使用Dcokerfile安装kodexplorer" class="headerlink" title="使用Dcokerfile安装kodexplorer"></a><strong>使用Dcokerfile安装kodexplorer</strong></h3><p>Dockerfile文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:6.8</span><br><span class="line">RUN yum install wget unzip php php-gd php-mbstring -y &amp;&amp; yum clean all</span><br><span class="line"># 设置工作目录，之后的操作都在这个目录中</span><br><span class="line">WORKDIR &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">RUN wget -c http:&#x2F;&#x2F;static.kodcloud.com&#x2F;update&#x2F;download&#x2F;kodexplorer4.25.zip</span><br><span class="line">RUN unzip kodexplorer4.25.zip &amp;&amp; rm -f kodexplorer4.25.zip</span><br><span class="line">RUN chown -R apache.apache .</span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;sbin&#x2F;apachectl&quot;,&quot;-D&quot;,&quot;FOREGROUND&quot;]</span><br></pre></td></tr></table></figure>



<p>更多的Dockerfile可以参考官方方法。</p>
<h2 id="Docker中的镜像分层"><a href="#Docker中的镜像分层" class="headerlink" title="Docker中的镜像分层"></a><strong>Docker中的镜像分层</strong></h2><p>参考文档：</p>
<p><a target="_blank" rel="noopener" href="http://www.maiziedu.com/wiki/cloud/dockerimage/">http://www.maiziedu.com/wiki/cloud/dockerimage/</a></p>
<p>Docker 支持通过扩展现有镜像，创建新的镜像。实际上，Docker Hub 中 99% 的镜像都是通过在 base 镜像中安装和配置需要的软件构建出来的。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNibl4DQ5TJSKSloMYjYBFUd7pAKNFNJib9icRyhJtar11gYTl3l84Uc4Ew/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>从上图可以看到，新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层。</p>
<h3 id="Docker-镜像为什么分层"><a href="#Docker-镜像为什么分层" class="headerlink" title="Docker 镜像为什么分层"></a><strong>Docker 镜像为什么分层</strong></h3><p>镜像分层最大的一个好处就是共享资源。</p>
<p>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<p>如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是不会被修改的，修改只会被限制在单个容器内。这就是容器 Copy-on-Write 特性。</p>
<h3 id="可写的容器层"><a href="#可写的容器层" class="headerlink" title="可写的容器层"></a><strong>可写的容器层</strong></h3><p>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNz0xkGTOibTgYUxoHsGCYquqrg1eWfSV2gibNKb4xAibJ07OvGluaCtX5w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有<strong>容器层是可写的，容器层下面的所有镜像层都是只读的。</strong></p>
<h3 id="容器层的细节说明"><a href="#容器层的细节说明" class="headerlink" title="容器层的细节说明"></a><strong>容器层的细节说明</strong></h3><p>镜像层数量可能会很多，所有镜像层会联合在一起组成一个统一的文件系统。如果不同层中有一个相同路径的文件，比如 /a，上层的 /a 会覆盖下层的 /a，也就是说用户只能访问到上层中的文件 /a。在容器层中，用户看到的是一个叠加之后的文件系统。</p>
<p>文件操作的</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNKtF3xCJ5nxAmYVavUW4uSFBoPaZFhSMqEWFkfhkyTTgjEMht0dqqkA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>只有当需要修改时才复制一份数据，这种特性被称作 Copy-on-Write。可见，容器层保存的是镜像变化的部分，不会对镜像本身进行任何修改。</p>
<p>这样就解释了我们前面提出的问题：容器层记录对镜像的修改，所有镜像层都是只读的，不会被容器修改，所以镜像可以被多个容器共享。</p>
<h2 id="使用docker运行zabbix-server"><a href="#使用docker运行zabbix-server" class="headerlink" title="使用docker运行zabbix-server"></a><strong>使用docker运行zabbix-server</strong></h2><h3 id="容器间的互联"><a href="#容器间的互联" class="headerlink" title="容器间的互联"></a><strong>容器间的互联</strong></h3><p>在运行zabbix之前务必要了解容器间互联的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个nginx容器</span><br><span class="line">docker run -d -p 80:80 nginx</span><br><span class="line"># 创建容器，做link，并进入容器中</span><br><span class="line">docker run -it --link quirky_brown:web01 centos-ssh &#x2F;bin&#x2F;bash</span><br><span class="line"># 在容器中访问nginx容器可以ping通</span><br><span class="line">ping web01 </span><br></pre></td></tr></table></figure>



<p>命令执行过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 启动apache容器</span><br><span class="line">[root@docker01 ~]# docker run -d httpd:2.4  </span><br><span class="line">3f1f7fc554720424327286bd2b04aeab1b084a3fb011a785b0deab6a34e56955</span><br><span class="line">^[[A[root@docker01 docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3f1f7fc55472        httpd:2.4           &quot;httpd-foreground&quot;   6 seconds ago       Up 5 seconds        80&#x2F;tcp              determined_clarke</span><br><span class="line"># 拉取一个busybox 镜像</span><br><span class="line">[root@docker01 ~]# docker pull busybox </span><br><span class="line"># 启动容器</span><br><span class="line">[root@docker01 ~]# docker run -it  --link determined_clarke:web busybox:latest   &#x2F;bin&#x2F;sh </span><br><span class="line">&#x2F; # </span><br><span class="line"># 使用新的容器访问最初的web容器</span><br><span class="line">&#x2F; # ping web </span><br><span class="line">PING web (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.058 ms</span><br><span class="line">^C</span><br><span class="line">--- web ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.058&#x2F;0.058&#x2F;0.058 ms   </span><br></pre></td></tr></table></figure>



<h3 id="启动zabbix容器"><a href="#启动zabbix容器" class="headerlink" title="启动zabbix容器"></a><strong>启动zabbix容器</strong></h3><p>1、启动一个mysql的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-server -t \</span><br><span class="line">      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \</span><br><span class="line">      -d mysql:5.7 \</span><br><span class="line">      --character-set-server&#x3D;utf8 --collation-server&#x3D;utf8_bin </span><br></pre></td></tr></table></figure>



<p>2、启动java-gateway容器监控java服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zabbix-java-gateway -t \</span><br><span class="line">      -d zabbix&#x2F;zabbix-java-gateway:latest</span><br></pre></td></tr></table></figure>



<p>3、启动zabbix-mysql容器使用link连接mysql与java-gateway。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">      -e DB_SERVER_HOST&#x3D;&quot;mysql-server&quot; \</span><br><span class="line">      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \</span><br><span class="line">      -e ZBX_JAVAGATEWAY&#x3D;&quot;zabbix-java-gateway&quot; \</span><br><span class="line">      --link mysql-server:mysql \</span><br><span class="line">      --link zabbix-java-gateway:zabbix-java-gateway \</span><br><span class="line">      -p 10051:10051 \</span><br><span class="line">      -d zabbix&#x2F;zabbix-server-mysql:latest</span><br></pre></td></tr></table></figure>



<p>4、启动zabbix web显示，使用link连接zabbix-mysql与mysql。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">      -e DB_SERVER_HOST&#x3D;&quot;mysql-server&quot; \</span><br><span class="line">      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \</span><br><span class="line">      --link mysql-server:mysql \</span><br><span class="line">      --link zabbix-server-mysql:zabbix-server \</span><br><span class="line">      -p 80:80 \</span><br><span class="line">      -d zabbix&#x2F;zabbix-web-nginx-mysql:latest</span><br></pre></td></tr></table></figure>



<h3 id="关于zabbix-API"><a href="#关于zabbix-API" class="headerlink" title="关于zabbix API"></a><strong>关于zabbix API</strong></h3><p>关于zabbix API可以参考官方文档：</p>
<p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/3.4/zh/manual/api">https://www.zabbix.com/documentation/3.4/zh/manual/api</a></p>
<p>1、获取token方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 获取token</span><br><span class="line">[root@docker02 ~]# curl -s -X POST -H &#39;Content-Type:application&#x2F;json&#39; -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">&quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">&quot;method&quot;: &quot;user.login&quot;,</span><br><span class="line">&quot;params&quot;: &#123;</span><br><span class="line">&quot;user&quot;: &quot;Admin&quot;,</span><br><span class="line">&quot;password&quot;: &quot;zabbix&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;id&quot;: 1</span><br><span class="line">&#125;&#39; http:&#x2F;&#x2F;10.0.0.100&#x2F;api_jsonrpc.php</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;d3be707f9e866ec5d0d1c242292cbebd&quot;,&quot;id&quot;:1&#125;</span><br></pre></td></tr></table></figure>



<h2 id="docker-仓库（registry）"><a href="#docker-仓库（registry）" class="headerlink" title="docker 仓库（registry）"></a><strong>docker 仓库（registry）</strong></h2><h3 id="创建一个普通仓库"><a href="#创建一个普通仓库" class="headerlink" title="创建一个普通仓库"></a><strong>创建一个普通仓库</strong></h3><p>1、创建仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart&#x3D;always --name registry -v &#x2F;opt&#x2F;myregistry:&#x2F;var&#x2F;lib&#x2F;registry  registry </span><br></pre></td></tr></table></figure>





<p>2、修改配置文件，使之支持http</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# cat  &#x2F;etc&#x2F;docker&#x2F;daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;],</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>重启docker让修改生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# systemctl restart  docker.service</span><br></pre></td></tr></table></figure>



<p>3、修改镜像标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker tag  busybox:latest  10.0.0.100:5000&#x2F;clsn&#x2F;busybox:1.0</span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos6-ssh                     latest              3c2b1e57a0f5        18 hours ago        393MB</span><br><span class="line">httpd                           2.4                 2e202f453940        6 days ago          179MB</span><br><span class="line">10.0.0.100:5000&#x2F;clsn&#x2F;busybox    1.0                 5b0d59026729        8 days ago          1.15MB</span><br></pre></td></tr></table></figure>



<p>4、将新打标签的镜像上传镜像到仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker push   10.0.0.100:5000&#x2F;clsn&#x2F;busybox</span><br></pre></td></tr></table></figure>



<h3 id="带basic认证的仓库"><a href="#带basic认证的仓库" class="headerlink" title="带basic认证的仓库"></a><strong>带basic认证的仓库</strong></h3><p>1、安装加密工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 clsn]# yum install httpd-tools  -y</span><br></pre></td></tr></table></figure>



<p>2、设置认证密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;opt&#x2F;registry-var&#x2F;auth&#x2F; -p</span><br><span class="line">htpasswd  -Bbn clsn 123456  &gt; &#x2F;opt&#x2F;registry-var&#x2F;auth&#x2F;htpasswd</span><br></pre></td></tr></table></figure>



<p>3、启动容器，在启动时传入认证参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v &#x2F;opt&#x2F;registry-var&#x2F;auth&#x2F;:&#x2F;auth&#x2F; -e &quot;REGISTRY_AUTH&#x3D;htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM&#x3D;Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH&#x3D;&#x2F;auth&#x2F;htpasswd registry</span><br></pre></td></tr></table></figure>



<p>4、使用验证用户测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 登陆用户</span><br><span class="line">[root@docker01 ~]# docker login 10.0.0.100:5000 </span><br><span class="line">Username: clsn  </span><br><span class="line">Password: 123456</span><br><span class="line">Login Succeeded</span><br><span class="line"># 推送镜像到仓库</span><br><span class="line">[root@docker01 ~]# docker push 10.0.0.100:5000&#x2F;clsn&#x2F;busybox </span><br><span class="line">The push refers to repository [10.0.0.100:5000&#x2F;clsn&#x2F;busybox]</span><br><span class="line">4febd3792a1f: Pushed </span><br><span class="line">1.0: digest: sha256:4cee1979ba0bf7db9fc5d28fb7b798ca69ae95a47c5fecf46327720df4ff352d size: 527</span><br><span class="line">#认证文件的保存位置</span><br><span class="line">[root@docker01 ~]# cat .docker&#x2F;config.json </span><br><span class="line">&#123;</span><br><span class="line">    &quot;auths&quot;: &#123;</span><br><span class="line">        &quot;10.0.0.100:5000&quot;: &#123;</span><br><span class="line">            &quot;auth&quot;: &quot;Y2xzbjoxMjM0NTY&#x3D;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;https:&#x2F;&#x2F;index.docker.io&#x2F;v1&#x2F;&quot;: &#123;</span><br><span class="line">            &quot;auth&quot;: &quot;Y2xzbjpIenNAMTk5Ng&#x3D;&#x3D;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;HttpHeaders&quot;: &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Docker-Client&#x2F;17.12.0-ce (linux)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，一个简单的docker镜像仓库搭建完成</p>
<h2 id="docker-compose编排工具"><a href="#docker-compose编排工具" class="headerlink" title="docker-compose编排工具"></a><strong>docker-compose编排工具</strong></h2><h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a><strong>安装docker-compose</strong></h3><p>安装docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 下载pip软件</span><br><span class="line">yum install -y python2-pip</span><br><span class="line"># 下载 docker-compose</span><br><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure>



<p>国内开启pip 下载加速：</p>
<p><a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/help/pypi">http://mirrors.aliyun.com/help/pypi</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~&#x2F;.pip&#x2F;</span><br><span class="line">cat &gt; ~&#x2F;.pip&#x2F;pip.conf &lt;&lt;&#39;EOF&#39;</span><br><span class="line">[global]</span><br><span class="line">index-url &#x3D; https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple&#x2F;</span><br><span class="line">[install]</span><br><span class="line">trusted-host&#x3D;mirrors.aliyun.com</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h3 id="编排启动镜像"><a href="#编排启动镜像" class="headerlink" title="编排启动镜像"></a><strong>编排启动镜像</strong></h3><p>1、创建文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# mkdir &#x2F;opt&#x2F;my_wordpress&#x2F;</span><br><span class="line">[root@docker01 ~]# cd &#x2F;opt&#x2F;my_wordpress&#x2F;</span><br></pre></td></tr></table></figure>



<p>2、编写编排文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# vim docker-compose.yml</span><br><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">   db:</span><br><span class="line">     image: mysql:5.7</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;db_data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">       MYSQL_DATABASE: wordpress</span><br><span class="line">       MYSQL_USER: wordpress</span><br><span class="line">       MYSQL_PASSWORD: wordpress</span><br><span class="line">   wordpress:</span><br><span class="line">     depends_on:</span><br><span class="line">       - db</span><br><span class="line">     image: wordpress:latest</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;web_data:&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">     ports: </span><br><span class="line">       - &quot;8000:80&quot;</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       WORDPRESS_DB_HOST: db:3306</span><br><span class="line">       WORDPRESS_DB_USER: wordpress</span><br><span class="line">       WORDPRESS_DB_PASSWORD: wordpress</span><br></pre></td></tr></table></figure>



<p>3、启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# docker-compose up</span><br><span class="line">　　#启动方法：docker-compose up</span><br><span class="line">　　#后台启动方法：docker-compose up -d</span><br></pre></td></tr></table></figure>



<p>4、浏览器上访问<a target="_blank" rel="noopener" href="http://10.0.0.100:8000/">http://10.0.0.100:8000</a></p>
<p>进行wordpress的安装即可</p>
<h3 id="haproxy代理后端docker容器"><a href="#haproxy代理后端docker容器" class="headerlink" title="haproxy代理后端docker容器"></a><strong>haproxy代理后端docker容器</strong></h3><p>1、修改编排脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# cat docker-compose.yml </span><br><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">   db:</span><br><span class="line">     image: mysql:5.7</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;db_data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">       MYSQL_DATABASE: wordpress</span><br><span class="line">       MYSQL_USER: wordpress</span><br><span class="line">       MYSQL_PASSWORD: wordpress</span><br><span class="line">   wordpress:</span><br><span class="line">     depends_on:</span><br><span class="line">       - db</span><br><span class="line">     image: wordpress:latest</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;web_data:&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">     ports: </span><br><span class="line">       - &quot;80&quot;</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       WORDPRESS_DB_HOST: db:3306</span><br><span class="line">       WORDPRESS_DB_USER: wordpress</span><br><span class="line">       WORDPRESS_DB_PASSWORD: wordpress</span><br></pre></td></tr></table></figure>



<p>2、同时启动两台wordpress</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# docker-compose scale wordpress&#x3D;2 </span><br><span class="line">WARNING: The scale command is deprecated. Use the up command with the --scale flag instead.</span><br><span class="line">Starting mywordpress_wordpress_1 ... done</span><br><span class="line">Creating mywordpress_wordpress_2 ... done</span><br></pre></td></tr></table></figure>



<p>3、安装haproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# yum install haproxy -y</span><br></pre></td></tr></table></figure>



<p>4、修改haproxy配置文件</p>
<p>关于配置文件的详细说明，参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/MacoLee/p/5853413.html">https://www.cnblogs.com/MacoLee/p/5853413.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#cp &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg&#123;,.bak&#125;</span><br><span class="line">[root@docker01 ~]# vim &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg</span><br><span class="line">global</span><br><span class="line">    log         127.0.0.1 local2</span><br><span class="line">    chroot      &#x2F;var&#x2F;lib&#x2F;haproxy</span><br><span class="line">    pidfile     &#x2F;var&#x2F;run&#x2F;haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line">    stats socket &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats level admin  #支持命令行控制</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0&#x2F;8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           1m</span><br><span class="line">    timeout connect         10s</span><br><span class="line">    timeout client          1m</span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">listen stats</span><br><span class="line">    mode http</span><br><span class="line">    bind 0.0.0.0:8888</span><br><span class="line">    stats enable</span><br><span class="line">    stats uri     &#x2F;haproxy-status </span><br><span class="line">    stats auth    admin:123456</span><br><span class="line">frontend frontend_www_example_com</span><br><span class="line">    bind 10.0.0.100:8000</span><br><span class="line">    mode http</span><br><span class="line">    option httplog</span><br><span class="line">    log global</span><br><span class="line">    default_backend backend_www_example_com</span><br><span class="line">backend backend_www_example_com</span><br><span class="line">    option forwardfor header X-REAL-IP</span><br><span class="line">    option httpchk HEAD &#x2F; HTTP&#x2F;1.0</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server web-node1  10.0.0.100:32768 check inter 2000 rise 30 fall 15</span><br><span class="line">    server web-node2  10.0.0.100:32769 check inter 2000 rise 30 fall 15</span><br></pre></td></tr></table></figure>



<p>5、启动haproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start haproxy</span><br><span class="line">systemctl enable haproxy</span><br></pre></td></tr></table></figure>



<p>6、使用浏览器访问hapeoxy监听的8000端口可以看到负载的情况</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNic9DpCJXcR95mfbGbd9FGYfuIDH4vibYWmBCqTCVdDmlyiaP8j7PBkw3w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>7、使用浏览器访问 </p>
<p><a target="_blank" rel="noopener" href="http://10.0.0.100:8888/haproxy-status">http://10.0.0.100:8888/haproxy-status</a></p>
<p>可以看到后端节点的监控状况，</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNEnaATu6gVIjdjfqpZlrk5uhiaKM9yTYic80Q3Pq4qibnrWBibeiauLGDuwQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="安装socat-直接操作socket控制haproxy"><a href="#安装socat-直接操作socket控制haproxy" class="headerlink" title="安装socat 直接操作socket控制haproxy"></a><strong>安装socat 直接操作socket控制haproxy</strong></h3><p>1、安装软件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install socat.x86_64 -y</span><br></pre></td></tr></table></figure>



<p>2、查看帮助</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 web_data]# echo &quot;help&quot;|socat stdio &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats</span><br></pre></td></tr></table></figure>



<p>3、下线后端节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;disable server backend_www_example_com&#x2F;web-node2&quot;|socat stdio &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats</span><br></pre></td></tr></table></figure>



<p>4、上线后端节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;enable server backend_www_example_com&#x2F;web-node3&quot;|socat stdio &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats</span><br></pre></td></tr></table></figure>



<p>5、编写php测试页，放到/data/web_data下，在浏览器中访问可以查看当前的节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 web_data]# vim check.php</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;PHP测试&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;?php  echo &#39;&lt;p&gt;Hello World &lt;&#x2F;p&gt;&#39;; ?&gt;</span><br><span class="line">        &lt;?php  echo &quot;访问的服务器地址是:&quot;.&quot;&lt;fontcolor&#x3D;red&gt;&quot;.$_SERVER[&#39;SERVER_ADDR&#39;].&quot;&lt;&#x2F;font&gt;&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">        echo&quot;访问的服务器域名是:&quot;.&quot;&lt;fontcolor&#x3D;red&gt;&quot;.$_SERVER[&#39;SERVER_NAME&#39;].&quot;&lt;&#x2F;font&gt;&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">        ?&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<h2 id="重启docker服务，容器全部退出的解决办法"><a href="#重启docker服务，容器全部退出的解决办法" class="headerlink" title="重启docker服务，容器全部退出的解决办法"></a>重启docker服务，容器全部退出的解决办法</h2><h3 id="在启动是指定自动重启"><a href="#在启动是指定自动重启" class="headerlink" title="在启动是指定自动重启"></a><strong>在启动是指定自动重启</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  --restart&#x3D;always</span><br></pre></td></tr></table></figure>



<h3 id="修改docker默认配置文件"><a href="#修改docker默认配置文件" class="headerlink" title="修改docker默认配置文件"></a><strong>修改docker默认配置文件</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 添加上下面这行</span><br><span class="line">&quot;live-restore&quot;: true</span><br></pre></td></tr></table></figure>





<p>docker server配置文件 /etc/docker/daemon.json 参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# cat  &#x2F;etc&#x2F;docker&#x2F;daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;],</span><br><span class="line">  &quot;graph&quot;: &quot;&#x2F;opt&#x2F;mydocker&quot;, # 修改数据的存放目录到&#x2F;opt&#x2F;mydocker&#x2F;，原&#x2F;var&#x2F;lib&#x2F;docker&#x2F;</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;],</span><br><span class="line">  &quot;live-restore&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>重启生效，只对在此之后启动的容器生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# systemctl restart  docker.service</span><br></pre></td></tr></table></figure>



<h2 id="Docker网络类型"><a href="#Docker网络类型" class="headerlink" title="Docker网络类型"></a><strong>Docker网络类型</strong></h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyN3O8G4N3W0f7o9MMbdtXhrkok419zbBSNicK98KFOeuibry2onlibKMxAw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="docker的网络类型"><a href="#docker的网络类型" class="headerlink" title="docker的网络类型"></a><strong>docker的网络类型</strong></h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNecj4bBrkKJa3jfnpKxpicTtyPGbqbbLBZ2Pp3Bp3BCC0xCT2QIRVPTw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Bridge默认docker网络隔离基于网络命名空间，在物理机上创建docker容器时会为每一个docker容器分配网络命名空间，并且把容器IP桥接到物理机的虚拟网桥上。</p>
<h3 id="不为容器配置网络功能-none"><a href="#不为容器配置网络功能-none" class="headerlink" title="不为容器配置网络功能(none)"></a><strong>不为容器配置网络功能(none)</strong></h3><p>此模式下创建容器是不会为容器配置任何网络参数的，如：容器网卡、IP、通信路由等，全部需要自己去配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -it --network none busybox:latest  &#x2F;bin&#x2F;sh </span><br><span class="line">&#x2F; # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue </span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>



<h3 id="与其他容器共享网络配置-Container）"><a href="#与其他容器共享网络配置-Container）" class="headerlink" title="与其他容器共享网络配置(Container）"></a><strong>与其他容器共享网络配置(Container）</strong></h3><p>此模式和host模式很类似，只是此模式创建容器共享的是其他容器的IP和端口而不是物理机，此模式容器自身是不会配置网络和端口，创建此模式容器进去后，你会发现里边的IP是你所指定的那个容器IP并且端口也是共享的，而且其它还是互相隔离的，如进程等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -it --network container:mywordpress_db_1  busybox:latest  &#x2F;bin&#x2F;sh </span><br><span class="line">&#x2F; # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue </span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">105: eth0@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.3&#x2F;16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>



<h3 id="使用宿主机网络-host"><a href="#使用宿主机网络-host" class="headerlink" title="使用宿主机网络(host)"></a><strong>使用宿主机网络(host)</strong></h3><p>此模式创建的容器没有自己独立的网络命名空间，是和物理机共享一个Network Namespace，并且共享物理机的所有端口与IP，并且这个模式认为是不安全的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -it --network host  busybox:latest  &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>



<h3 id="查看网络列表"><a href="#查看网络列表" class="headerlink" title="查看网络列表"></a><strong>查看网络列表</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker network list </span><br><span class="line">NETWORK ID          NAME                  DRIVER              SCOPE</span><br><span class="line">b15e8a720d3b        bridge                bridge              local</span><br><span class="line">345d65b4c2a0        host                  host                local</span><br><span class="line">bc5e2a32bb55        mywordpress_default   bridge              local</span><br><span class="line">ebf76eea91bb        none                  null                local</span><br></pre></td></tr></table></figure>



<h3 id="用PIPEWORK为docker容器配置独立IP"><a href="#用PIPEWORK为docker容器配置独立IP" class="headerlink" title="用PIPEWORK为docker容器配置独立IP"></a><strong>用PIPEWORK为docker容器配置独立IP</strong></h3><ul>
<li><p>参考文档：</p>
<p>blog.csdn.net/design321/article/details/48264825</p>
</li>
</ul>
<ul>
<li><p>官方网站：</p>
<p>github.com/jpetazzo/pipework</p>
</li>
</ul>
<ul>
<li>宿主环境：centos7.2</li>
</ul>
<p>1、安装pipework</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;jpetazzo&#x2F;pipework&#x2F;archive&#x2F;master.zip</span><br><span class="line">unzip master.zip </span><br><span class="line">cp pipework-master&#x2F;pipework  &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line">chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pipework</span><br></pre></td></tr></table></figure>



<p>2、配置桥接网卡</p>
<p>安装桥接工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install bridge-utils.x86_64 -y</span><br></pre></td></tr></table></figure>



<p>修改网卡配置，实现桥接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 修改eth0配置，让br0实现桥接</span><br><span class="line">[root@docker01 ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0 </span><br><span class="line">TYPE&#x3D;Ethernet</span><br><span class="line">BOOTPROTO&#x3D;static</span><br><span class="line">NAME&#x3D;eth0</span><br><span class="line">DEVICE&#x3D;eth0</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">BRIDGE&#x3D;br0</span><br><span class="line">[root@docker01 ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-br0 </span><br><span class="line">TYPE&#x3D;Bridge</span><br><span class="line">BOOTPROTO&#x3D;static</span><br><span class="line">NAME&#x3D;br0</span><br><span class="line">DEVICE&#x3D;br0</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">IPADDR&#x3D;10.0.0.100</span><br><span class="line">NETMASK&#x3D;255.255.255.0</span><br><span class="line">GATEWAY&#x3D;10.0.0.254</span><br><span class="line">DNS1&#x3D;223.5.5.5</span><br><span class="line"># 重启网络</span><br><span class="line">[root@docker01 ~]# &#x2F;etc&#x2F;init.d&#x2F;network restart</span><br></pre></td></tr></table></figure>



<p>3、运行一个容器镜像测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipework br0 $(docker run -d -it -p 6880:80 --name  httpd_pw httpd) 10.0.0.220&#x2F;24@10.0.0.254</span><br></pre></td></tr></table></figure>



<p>在其他主机上测试端口及连通性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# curl 10.0.0.220</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;&#x2F;h1&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br><span class="line">[root@docker01 ~]# ping 10.0.0.220 -c 1</span><br><span class="line">PING 10.0.0.220 (10.0.0.220) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.0.0.220: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.043 ms</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4、再运行一个容器，设置网路类型为none：</span><br><span class="line">pipework br0 $(docker run -d -it --net&#x3D;none --name test httpd:2.4) 10.0.0.221&#x2F;24@10.0.0.254</span><br></pre></td></tr></table></figure>





<p>进行访问测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# curl 10.0.0.221</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;&#x2F;h1&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<p>5、重启容器后需要再次指定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipework br0 testduliip  172.16.146.113&#x2F;24@172.16.146.1</span><br><span class="line">pipework br0 testduliip01  172.16.146.112&#x2F;24@172.16.146.1</span><br></pre></td></tr></table></figure>



<p>Dcoker跨主机通信之overlay可以参考：</p>
<p>cnblogs.com/CloudMan6/p/7270551.html</p>
<h3 id="Docker跨主机通信之macvlan"><a href="#Docker跨主机通信之macvlan" class="headerlink" title="Docker跨主机通信之macvlan"></a><strong>Docker跨主机通信之macvlan</strong></h3><p>创建网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker network  create --driver macvlan  --subnet 10.1.0.0&#x2F;24 --gateway 10.1.0.254 -o parent&#x3D;eth0  macvlan_1</span><br><span class="line">33a1f41dcc074f91b5bd45e7dfedabfb2b8ec82db16542f05213839a119b62ca</span><br></pre></td></tr></table></figure>



<p>设置网卡为混杂模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set eth0 promisc on</span><br></pre></td></tr></table></figure>



<p>创建使用macvlan网络容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker run  -it --network macvlan_1  --ip&#x3D;10.1.0.222 busybox &#x2F;b</span><br></pre></td></tr></table></figure>



<h2 id="docker企业级镜像仓库harbor"><a href="#docker企业级镜像仓库harbor" class="headerlink" title="docker企业级镜像仓库harbor"></a><strong>docker企业级镜像仓库harbor</strong></h2><p>容器管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]# pwd</span><br><span class="line">&#x2F;opt&#x2F;harbor</span><br><span class="line">[root@docker01 harbor]# docker-compose stop</span><br></pre></td></tr></table></figure>



<p>1、安装docker、docker-compose</p>
<p>下载 harbor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt &amp;&amp; https:&#x2F;&#x2F;storage.googleapis.com&#x2F;harbor-releases&#x2F;harbor-offline-installer-v1.3.0.tgz</span><br><span class="line">tar xf harbor-offline-installer-v1.3.0.tgz</span><br></pre></td></tr></table></figure>



<p>2、修改主机及web界面密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]# vim harbor.cfg </span><br><span class="line">    ···</span><br><span class="line">    hostname &#x3D; 10.0.0.100</span><br><span class="line">    harbor_admin_password &#x3D; Harbor12345</span><br><span class="line">    ···</span><br></pre></td></tr></table></figure>



<p>3、执行安装脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]# .&#x2F;install.sh</span><br></pre></td></tr></table></figure>



<p>浏览器访问 <a target="_blank" rel="noopener" href="http://10.0.0.11/">http://10.0.0.11</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNdibRRbq9WzbzMkicCf1xrbuZgmXVIQFxrvsalTniaFibq0XVnuxezP4JRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"> </p>
<p>添加一个项目</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyND9aeaeciacdebb7mWbrm4lGHHju8zVianusKOBbbJic3vcY3o7nLbV8tQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>4、镜像推送到仓库的指定项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker  tag centos:6.8  10.0.0.100&#x2F;clsn&#x2F;centos6.8:1.0</span><br><span class="line">[root@docker02 ~]#  </span><br><span class="line">[root@docker02 ~]# docker images </span><br><span class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">busybox                     latest              5b0d59026729        8 days ago          1.15MB</span><br><span class="line">10.0.0.100&#x2F;clsn&#x2F;centos6.8   1.0                 6704d778b3ba        2 months ago        195MB</span><br><span class="line">centos                      6.8                 6704d778b3ba        2 months ago        195MB</span><br><span class="line">[root@docker02 ~]# docker login 10.0.0.100</span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>



<p>5、推送镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker push 10.0.0.100&#x2F;clsn&#x2F;centos6.8 </span><br><span class="line">The push refers to repository [10.0.0.100&#x2F;clsn&#x2F;centos6.8]</span><br><span class="line">e00c9229b481: Pushing  13.53MB&#x2F;194.5MB</span><br></pre></td></tr></table></figure>



<p>6、在web界面里查看</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNQAAEboIdByNZWVv08D9ibvalrm9vefENnpY5lCWhEYQWS7oMK7cJx4A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"> </p>
<h3 id="使用容器的建议"><a href="#使用容器的建议" class="headerlink" title="使用容器的建议"></a><strong>使用容器的建议</strong></h3><ol>
<li><p>不要以拆分方式进行应用程序发布</p>
</li>
<li><p>不要创建大型镜像</p>
</li>
<li><p>不要在单个容器中运行多个进程</p>
</li>
<li><p>不要再镜像内保存凭证，不要依赖IP地址</p>
</li>
<li><p>以非root用户运行进程</p>
</li>
<li><p>不要使用“最新”标签</p>
</li>
<li><p>不要利用运行中的容器创建镜像</p>
</li>
<li><p>不要使用单层镜像</p>
</li>
<li><p>不要将数据存放在容器内</p>
</li>
</ol>
<h3 id="关于Docker容器的监控"><a href="#关于Docker容器的监控" class="headerlink" title="关于Docker容器的监控"></a><strong>关于Docker容器的监控</strong></h3><p><strong>容器的基本信息</strong></p>
<ul>
<li>包括容器的数量、ID、名称、镜像、启动命令、端口等信息</li>
</ul>
<p><strong>容器的运行状态</strong></p>
<ul>
<li>统计各状态的容器的数量，包括运行中、暂停、停止及异常退出</li>
</ul>
<p><strong>容器的用量信息</strong></p>
<ul>
<li>统计容器的CPU使用率、内存使用量、块设备I/O使用量、网络使用情况等资源的使用情况</li>
</ul>
<p>在docker运行过程中，防火墙关闭或者重启后，会清空docker规则。需要重新启动docker服务和容器<br>docker里容器有一部分不能启动，是因为端口被占用，将端口杀死，重启就好了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/16.1.Docker/" data-id="ckq1xbdt2005zpwwd7x9i3i7x" data-title="Docker" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-26.1.ElasticSearch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/26.1.ElasticSearch/" class="article-date">
  <time class="dt-published" datetime="2021-04-17T05:00:52.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/17/26.1.ElasticSearch/">ElasticSearch</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>ElasticSearch 入门</strong></p>
<ul>
<li>新增数据</li>
<li>查询数据</li>
<li>更新数据</li>
<li>删除数据</li>
<li>批量操作</li>
</ul>
<p><strong>ElasticSearch 高级使用</strong></p>
<ul>
<li>聚合操作</li>
<li>映射操作</li>
<li>分词操作</li>
</ul>
<p><strong>Spring Boot 整合 ElasticSearch</strong></p>
<ul>
<li> <strong>…</strong></li>
</ul>
<blockquote>
<p>本篇文章的内容均以 Docker 环境为基础。</p>
</blockquote>
<p>首先拉取镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.4.2</span><br></pre></td></tr></table></figure>

<p>然后下载kibana，这是一个可视化检索数据的工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:7.4.2</span><br></pre></td></tr></table></figure>

<p>创建两个文件夹用作数据卷：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;mydata&#x2F;elasticsearch&#x2F;config</span><br><span class="line">mkdir -p &#x2F;mydata&#x2F;elasticsearch&#x2F;data</span><br></pre></td></tr></table></figure>

<p>创建一个配置文件并写入配置，使得外部机器能够访问 elasticsearch：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;http.host: 0.0.0.0&quot; &gt;&gt; &#x2F;mydata&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml</span><br></pre></td></tr></table></figure>

<p>这样就可以启动 elasticsearch 了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --name elasticsearch -p 9200:9200 -p 9300:9300 \</span><br><span class="line">-e &quot;discovery.type&#x3D;single-node&quot; \</span><br><span class="line">-e ES_JAVA_OPTS&#x3D;&quot;-Xms64m -Xmx128m&quot; \</span><br><span class="line">-v &#x2F;mydata&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml \</span><br><span class="line">-v &#x2F;mydata&#x2F;elasticsearch&#x2F;data:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data \</span><br><span class="line">-v &#x2F;mydata&#x2F;elasticsearch&#x2F;plugins:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins \</span><br><span class="line">-d elasticsearch:7.4.2</span><br></pre></td></tr></table></figure>

<p>其中开放的 <code>9200</code> 端口为向elasticsearch发送请求的端口，而 <code>9300</code> 为集群环境下elasticsearch之间互相通信的端口；<code>&quot;discovery.type=single-node&quot;</code> 表示以单节点运行elasticsearch；<code>ES_JAVA_OPTS=&quot;-Xms64m -Xmx128m&quot;</code> 用于指定elasticsearch的内存占用，而且必须指定，否则elasticsearch将占用系统的全部内存；最后设置elasticsearch的挂载点。</p>
<p>若是启动报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Caused by: java.nio.file.AccessDeniedException: &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data&#x2F;nodes&quot;,</span><br></pre></td></tr></table></figure>

<p>这是因为我们的挂载点权限不足导致的，此时修改挂载点权限重新启动elasticsearch即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 &#x2F;mydata&#x2F;elasticsearch&#x2F;data&#x2F;</span><br></pre></td></tr></table></figure>

<p>然后启动 Kibana：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name kibana -e ELASTICSEARCH_HOSTS&#x3D;http:&#x2F;&#x2F;www.ithui.top:9200 -p 5601:5601 -d kibana:7.4.2</span><br></pre></td></tr></table></figure>

<p>启动完成后访问 <a target="_blank" rel="noopener" href="http://www.ithui.top:5601/%EF%BC%9A">http://www.ithui.top:5601/：</a></p>
<p><strong>ElasticSearch 入门</strong></p>
<p>ElasticSearch 通过接收请求的方式来对数据进行处理，接下来对elasticsearch进行一个简单的入门。首先是 <code>_cat</code> 请求，通过该请求能够查询elasticsearch的一些基本信息，具体如下：</p>
<ul>
<li>GET   /_cat/nodes：查看所有节点</li>
<li>GET   /_cat/health：查看elasticsearch的健康状况</li>
<li>GET   /_cat/master：查看主节点</li>
<li>GET   /_cat/indices：查看所有索引</li>
</ul>
<p>比如查看 elasticsearch 的所有节点，则需要发送 <a target="_blank" rel="noopener" href="http://www.ithui.top/_cat/nodes">http://www.ithui.top/_cat/nodes</a> 请求，结果如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYYCgx7Mr24OE1uricCibBTgrnPGXpSF7zoe63LK8l4ibPHXIggHKA9eE5g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>若是想查看 elasticsearch 的健康状态，则发送 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/_cat/health">http://www.ithui.top:9200/_cat/health</a> 请求，结果如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYCGicdO6fXicBKqibNd7icibicJzOboF6ZMlO1cPqL4qu7EWTickPIb9ibjaOCA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h2><p>elasticsearch通过接收PUT和POST请求来新增数据，然而在新增数据之前，我们需要来了解elasticsearch中的几个概念：</p>
<ul>
<li>索引</li>
<li>类型</li>
<li>文档</li>
<li>属性</li>
</ul>
<p>我们可以类比一下mysql中的概念来更形象地理解它们。在mysql中，若是想保存一条数据，我们首先需要创建数据库，然后在数据库中创建数据表，最后将数据作为一条记录插入数据表；而elasticsearch中的索引就相当于mysql中的数据库，类型就相当于数据表，文档就相当于一条记录。</p>
<p>所以，若是想在elasticsearch中新增一条数据，我们就需要指定这条数据放在哪个索引的哪个类型下，该条数据也被称为一个文档，而且这些数据是json格式的，json中的键被称为属性。</p>
<p>在elasticsearch中新增一条数据我们有更加专业的说法，称其为 <code>索引一个文档</code> ，接下来就可以发送一个请求 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1">http://www.ithui.top:9200/customer/external/1</a> ，该请求表示向customer索引下的external文档存放一个标识为1的数据，数据可以存放在请求体中携带过去：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYIuEnrjuHLFtYdQFAzv9s5OMScURf3WMNiaF52oVHqcbaxgF5BhtUQqQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>我们来分析一下该请求的返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;_index&quot;</span>: <span class="string">&quot;customer&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_type&quot;</span>: <span class="string">&quot;external&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;created&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;total&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">&quot;successful&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;failed&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;_seq_no&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;_primary_term&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中以 <code>_</code> 开头的属性称为元数据，它表示的是elasticsearch中的基本信息，比如 <code>_index</code> 表示当前索引；<code>_type</code> 表示当前类型；<code>_id</code> 表示当前数据的标识；<code>_version</code> 表示版本；<code>result</code> 表示当前操作的状态，这里是新建状态，若是索引的文档已经存在，则状态为更新状态。</p>
<p>PUT请求方式同样也能够新增数据，然而它与POST有些许不同，POST能够不携带id进行数据的保存，比如：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYHcqBIEf8ywlbBCPXnVJBczmkFxmXz0FPUtFmpQeXDHOJJCHveicDW6w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>此时elasticsearch会自动为我们分配一个唯一的id，所以若是不携带id，则每次请求都将是一次新增数据的操作。然而PUT请求方式是无法实现这样的效果的，也就是说，若是使用PUT方式发送请求，则必须携带id，否则就会报错：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIY6DA3hBB9GnF19uZWh8pauaTlXNbt4KjTGQEILhNfnicdRzcvepAibuCw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>elasticsearch接收GET请求用于查询数据，比如发送 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1">http://www.ithui.top:9200/customer/external/1</a> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYJBjaqcJia8m721wZia0xcUr5D0ZcYYzU2K9voVoYSstibIK0B04cbBr7w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>其中数据存放在 <code>_source</code> 中， <code>_seq_no</code> 属性和 <code>_primary_term</code> 属性是用来做并发控制的，数据在每次更新之后都会加1，是乐观锁机制。</p>
<p>它的原理是这样的，假设此时有两个请求同时来到并且均想要修改id为1的数据，那么可以让这两个请求去判断一下当前的数据是否是最新的，怎么知道数据是最新的呢？</p>
<p>就是判断 <code>seq_no</code> 和 <code>_primary_term</code> 属性，比如这个请求：<a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1?if_seq_no=0&amp;if_primary_term=1">http://www.ithui.top:9200/customer/external/1?if_seq_no=0&amp;if_primary_term=1</a> 。</p>
<p>它在更新数据前会去判断 <code>seq_no</code> 是否等于0， <code>_primary_term</code> 是否等于1，若成立，则证明数据是最新的，所以它能够修改成功：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYVXicgTUz21KT7A16H9CGLN7uYkIUiaJaCLxfwVRLysdfHZOSudOS4HdQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>此时需要注意了，当数据更新成功后， <code>_seq_no</code> 属性便会自动向上递增，此时第二个请求就无法更新了：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYAzMN5obb1GS91mz9esw5shJzfYDgGTLEIDqciaRR6eOJrxhcZPJdMkQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>原因就是当前的版本与期望的版本不一致，此时若想继续更新，就需要重新查询数据，得到并发控制属性值，再进行更新。</p>
<p><strong>更新数据</strong></p>
<p>在新增数据中我们已然接触了更新数据，当要新增的数据已经存在时，新增操作就会变为更新操作，当然了，elasticsearch还是为我们提供了另外一种更新方式。比如 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1/_update">http://www.ithui.top:9200/customer/external/1/_update</a> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYfssgzP3mibvUTNlTY2QbTjh9QdoHp5qWazcn8F6ZqXxWAxv1RGeYZhQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>需要注意的是，若是以这样的方式进行数据更新，则请求体数据必须用 <code>doc</code> 属性进行封装，它与不携带 <code>_update</code> 进行数据更新的方式有什么区别呢？</p>
<p>若是不携带 <code>_update</code> 更新数据，则每次发送请求elasticsearch都认为是一次更新，而携带 <code>_update</code> 更新数据，则elasticsearch会检查当前数据是否与原数据一致，若一致，则不会进行任何的操作，包括版本号、并发控制属性等都不会发生变化。</p>
<p>这里的PUT方式与POST方式效果一样，没有任何区别。</p>
<p><strong>删除数据</strong></p>
<p>elasticsearch通过接收DELETE请求来完成数据的删除操作。比如 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1">http://www.ithui.top:9200/customer/external/1</a> ，通过该请求能够删除id为1的数据；elasticsearch还支持直接删除索引，比如 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer">http://www.ithui.top:9200/customer</a> ，该请求将删除customer索引；但是我们无法直接删除类型，elasticsearch是不支持直接删除类型的。</p>
<p><strong>批量操作</strong></p>
<p>elasticsearch还支持批量操作，不过批量操作我们就需要在kibana中进行测试了，我们在前面已经启动了kibana的镜像，只需访问 <a target="_blank" rel="noopener" href="http://www.ithui.top:5601/">http://www.ithui.top:5601/</a> 即可来到kibana的界面：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYia7rb9xv7Ric9z64r8ckVMLic23rCKR3843PF3HqeQ1yQUOiauK3Ricnnwg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>点击左侧导航栏的 <code>Dev Tools</code> 进入到开发工具：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYkJdlCQCic3kvjo2Jlia6YuY9bgLIeoXjbic10thd5ictEzAQSGtr4HBZPg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>编写好请求后点击运行图标即可发送请求，批量操作的数据格式非常有讲究：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;lisi&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 <code>&quot;index&quot;</code> 表示新增操作，并且指定了数据的id为1，而具体需要新增的数据值是在第二行存放着：<code>&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;</code> ；第三行也是如此，仍然是新增操作，指定数据id为2，数据值为：<code>&#123;&quot;name&quot;:&quot;lisi&quot;&#125;</code>，这样运行之后elasticsearch会执行两个新增操作，将这两个数据保存起来。</p>
<p>再比如这样一段复杂的批量操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;_bulk</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Test Title&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Test Title2&quot;&#125;</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Update Title&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>首先是第一行， <code>_bulk</code> 指定了这次操作为批量操作，因为没有设置其它的任何信息，所以接下来的所有操作都需要指定索引、类型等信息；</p>
<p>第二行 <code>delete</code> 表示一个删除操作，其后指定了索引、类型以及要删除的数据id，因为删除操作不需要携带请求体数据，所以我们可以直接在下一行编写第二个操作；</p>
<p>第三行 <code>create</code> 表示一个新增操作，并指定了索引、类型、数据id，第四行就是需要新增的数据值了；第五行与第六行也是一个新增操作；第七行和第八行是一个更新操作，而且因为是update更新，所以请求体数据需要用 <code>doc</code> 属性包装。</p>
<p>运行该操作，得到结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIY7r7ThL49nhG1e6WZLx14lKamwicjXuBPjsslTDuiaEvVxUyHwyJfoqAQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>第一个删除操作，因为不存在这样的一个数据，所以删除失败了，状态为404，但是后面的操作却成功了，从这里可以说明，elasticsearch批量操作中的每个操作都是相互独立的，互相不会造成任何影响。</p>
<p><strong>ElasticSearch高级使用</strong></p>
<p>elasticsearch有两种检索方式，一种是前面说过的，发送REST请求，将数据以请求体的方式携带，还有一种方式就是直接将数据拼接在url路径上，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search?q&#x3D;*&amp;sort&#x3D;account_number:asc</span><br></pre></td></tr></table></figure>

<p>它表示这是一个GET请求，要操作的索引是bank， <code>_search</code> 表示这是一次检索， <code>q=*</code> 表示查询所有， <code>sort=account_number:asc</code> 表示以 <code>account_number</code> 的值进行升序排序。</p>
<p>我们还可以这样进行检索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;asc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两种检索方式得到的结果是一样的，来介绍一下这种检索方式的语法。首先是 <code>query</code> ，它用于指定查询条件， <code>match_all</code> 表示匹配所有，大括号后面可以编写匹配的规则；其次是 <code>sort</code> ，它用于指定排序条件， <code>account_number:asc</code> 则表示以该属性的值进行升序排序，若是想指定多个规则，可以继续在 <code>sort</code> 属性中进行编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;asc&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;balance&quot;: &quot;desc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<p>此时则表示先按 <code>account_number</code> 进行升序，再按 <code>balance</code> 进行降序排序。</p>
<p>通过请求体数据进行检索的方式被称为 <code>Query DSL</code> ，即：查询领域对象语言，在elasticsearch中我们将会大量地编写这种语言。查询领域对象语言的基本语法是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> QUERY_NAME:&#123;</span><br><span class="line">   ARGUMENT:VALUE,</span><br><span class="line">    ARGUMENT:VALUE,</span><br><span class="line">    ....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先整个语句需要被一对大括号包含，在大括号内需要编写对应的操作，比如查询，就编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;query&quot;:&#123;</span><br><span class="line">   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>query</code> 中又需要指定查询的条件，比如匹配部分、匹配所有，以及匹配的规则等等，若是想要排序，则编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;sort&quot;:[</span><br><span class="line">  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sort</code> 是一个数组，表示可以指定多个排序的规则。在其中还可以指定分页，只需要设置 <code>from</code>和<code>size</code> 属性值即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里表示从第一条数据开始，每页显示5条数据。我们还能通过指定 <code>_source</code> 属性来决定 elasticsearch 检索出的数据中包含哪些属性值，以剔除不必要的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;asc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 5,</span><br><span class="line">  &quot;_source&quot;: [&quot;balance&quot;,&quot;firstname&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示只返回 <code>balance</code> 和 <code>firstname</code> 属性值。匹配规则中除了可以指定匹配全部外，还可以匹配指定的属性值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;20&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示检索 <code>account_number</code> 为20的数据，这是一个精确检索的操作。它当然还支持模糊检索，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill lane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示检索 <code>address</code> 中包含mill和lane的数据，我们来看看elasticsearch返回的结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYBB3AnlOrTxSgiag803nbuOyuYvyAb23ZueCiatM2VsvSbP0ziaXjMSVDA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>来观察一下这两条数据，第一条数据有一个 <code>_score</code> 的属性，它表示的是当前数据的得分情况，因为该数据中包含了Mill lane字符串，所以能够最大程度地匹配上我们的匹配规则，故它的得分最高；再看第二条数据，因为该数据中只包含了Mill而没有Lane，所以它的匹配度更低一些，故而得分低一些。</p>
<p>由此可知，elasticsearch会将匹配规则中包含的所有字符串都去与待检索的数据进行匹配，实际上，elasticsearch底层采用的是分词策略，具体是如何进行分词的我们暂且先不做了解。我们还可以根据得分情况去获知哪些数据与我们想要的数据匹配度更接近。</p>
<p>虽然elasticsearch可以进行分词模糊匹配，但我们若是就想查询哪些数据中含有mill road呢？这个时候，我们可以采用 <code>match_phrase</code> 来实现短语匹配，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill lane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还可以进行多字段匹配，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;mill&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;address&quot;,&quot;city&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示在 <code>address</code> 和 <code>city</code> 属性中匹配mill字符串，倘若有一个满足，都符合我们的匹配规则。</p>
<p>当我们需要同时指定多个检索规则的时候，我们可以使用 <code>bool</code> 属性完成复合检索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;gender&quot;: &quot;F&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &quot;mill&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;age&quot;: &quot;28&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;lastname&quot;: &quot;Wallace&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段语句中，首先是 <code>bool</code> 属性复合了四个检索条件，然后是 <code>must</code> 属性，它表示必须满足检索条件，条件为 <code>gender</code> 等于F， <code>address</code> 包含mill；而 <code>must_not</code> 表示必须排除检索条件，条件为 <code>age</code> 等于28；最后是 <code>should</code> ，它表示应该满足检索条件，检索条件为<code>lastname</code> 等于Wallace。</p>
<p>它的关键在于即使不满足该条件，这条数据也可以被查询出来，但如果某条数据满足了 <code>should</code>指定的条件，它就会得到相应的得分，可以认为这是一个加分项。</p>
<p>我们还可以通过 <code>filter</code> 过滤器实现检索，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 18,</span><br><span class="line">            &quot;lte&quot;: 30</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段语句表示检索年龄在18~30之间的数据，但需要注意的是，使用 <code>filter</code> 属性并不会影响数据的得分。</p>
<p>使用 <code>match</code> 能够实现精确检索，但elasticsearch推荐我们使用 <code>match</code> 属性进行模糊检索，而使用 <code>term</code> 进行精确检索，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;balance&quot;: &quot;32838&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>聚合</strong></p>
<p>elasticsearch 除了能够检索数据，它还能够对数据进行分析，elasticsearch 中的聚合就提供了从数据中分组和提取数据的能力。</p>
<p>比如这样的一个需求，检索地址中包含mill的所有人的年龄分布以及平均年龄，该如何编写语句呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill&quot;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;ageAgg&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ageAvg&quot;:&#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先通过 <code>query</code> 属性检索地址中包含mill的人，然后通过 <code>aggs</code> 指定聚合操作，第一个聚合为 <code>ageAgg</code> ，这是聚合操作的名字，可以取任意值，其中 <code>terms</code> 表示分布情况；第二个聚合为 <code>ageAvg</code> ，其中 <code>avg</code> 表示平均值，来看检索得到的结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYcGjVhJKWv1sLTyBNZRa31BGoFqdUd4iaLINfS9LZkXMnaHwH8xP8Ifw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>其中 <code>buckers</code> 中的数据是每种年龄的分布情况，比如38岁的有2人，28岁的有1人；<code>ageAvg</code>中的就是年龄的平均值了，为34.0。</p>
<p>又比如这个需求，按照年龄聚合，并求这些年龄段的人的平均薪资，语句就该这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;ageAgg&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 100</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;ageAvg&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个嵌套的聚合操作，首先通过 <code>terms</code> 按照年龄聚合， <code>size</code> 表示分布有多少种情况，这里假设有100种，然后在该聚合的基础上进行平均聚合，这里需要注意平均聚合语句的位置是在年龄聚合的里面的。</p>
<p><strong>映射</strong></p>
<p>映射是用来定义一个文档，以及它所包含的属性是如何存储和索引的，但我们发现，在使用elasticsearch的过程中，我们并没有对数据进行类型的指定，这是因为elasticsearch会自动猜测映射类型，我们可以通过请求查看映射信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_mapping</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;bank&quot; : &#123;</span><br><span class="line">    &quot;mappings&quot; : &#123;</span><br><span class="line">      &quot;properties&quot; : &#123;</span><br><span class="line">        &quot;account_number&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;address&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">          &quot;fields&quot; : &#123;</span><br><span class="line">            &quot;keyword&quot; : &#123;</span><br><span class="line">              &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">              &quot;ignore_above&quot; : 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;long&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每个属性的 <code>type</code> 中都显示了它的类型。然而有些属性的类型并不是我们想要的，这个时候我们可以修改指定属性的类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my_index</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;age&quot;:&#123;&quot;type&quot;: &quot;integer&quot;&#125;,</span><br><span class="line">      &quot;email&quot;:&#123;&quot;type&quot;: &quot;keyword&quot;&#125;,</span><br><span class="line">      &quot;name&quot;:&#123;&quot;type&quot;: &quot;text&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照我们获取到的映射规则对其进行设置即可。此时我们获取my_index索引的映射信息进行查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;my_index&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123; &#125;,</span><br><span class="line">    &quot;mappings&quot; : &#123;</span><br><span class="line">      &quot;properties&quot; : &#123;</span><br><span class="line">        &quot;age&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;email&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;keyword&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;name&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明设置是成功的。但这种方式仅限于设置不存在的索引，若是需要设置的索引已经存在，则我们无法通过这种方式来改变属性的类型。我们需要采用另外一种方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my_index&#x2F;_mapping</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;:&#123;</span><br><span class="line">    &quot;id&quot;:&#123;&quot;type&quot;:&quot;long&quot;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而这种方式只能用于添加新的映射规则， 而不能修改之前属性的类型。所以若是想要修改已存在的属性类型，只能再创建一个新的索引，并指定好映射规则，再将之前的数据迁移到新的索引中来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 创建新的映射规则索引</span><br><span class="line">PUT &#x2F;newbank</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;balance&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;city&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 数据迁移</span><br><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;bank&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;newbank&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h2><p>在前面有说到elasticsearch是通过分词来进行模糊检索的，而分词在elasticsearch中是通过tokenizer分词器实现的，分词器通过接收一个字符流，将其分割为独立的tokens词元。</p>
<p>elasticsearch中默认有一些分词器，但它们都只支持英文的分词，对于中文，我们需要额外安装一个分词器，这里以 <code>ik</code> 分词器为例，首先下载ik分词器，下载地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIY62y3nibUQHvUJvceyjPC0xQXlW1ghYe4JPj7ud9kiadianpiabb2ocpib8Q/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>同样下载 7.4.2 版本的 ik 分词器：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYbWoJCYJgfwMVicMRealpxaQel40T4SRAA0u94maCXVDicyarAUjYgJuQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在该位置复制下载地址，然后在服务器上进行安装，因为在启动 elasticsearch 镜像的时候我们做了数据卷的映射，所以只需将其下载好存放在 <code>/mydata/elasticsearch/plugins</code> 目录下即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;mydata&#x2F;elasticsearch&#x2F;plugins</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;medcl&#x2F;elasticsearch-analysis-ik&#x2F;releases&#x2F;download&#x2F;v7.4.2&#x2F;elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>

<p>下载完成后解压一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>

<p>解压完成后重启elasticsearch，这样我们就安装好了ik分词器，可以来测试一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;分词器检索。&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;分词器&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;检索&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来看看elasticsearch默认使用的分词器的分词效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;分词器检索。&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;分&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 1,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;词&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 1,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;器&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 2,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;检&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;索&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很显然，默认的分词器只是把每个字都当成了一个词而已，在中文的处理上与ik分词器相比就要逊色很多了。</p>
<p>但有时候ik分词器仍然达不到我们的需求，比如最近才流行起来的网络热词，ik分词器肯定是没有办法对其进行分词的，所以我们需要对其定制扩展词库，找到nginx映射目录下的html文件夹，在该文件夹下创建es文件夹用于存放ik分词器需要使用到的一些资源( <code>关于nginx的运行与配置请看文章最后一节</code> )：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd cd &#x2F;mydata&#x2F;nginx&#x2F;html&#x2F;</span><br><span class="line">mkdir es</span><br></pre></td></tr></table></figure>

<p>然后在es目录下新建一个文本信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@izrcf5u3j3q8xaz es]# vim fenci.txt</span><br><span class="line">[root@izrcf5u3j3q8xaz es]# cat fenci.txt </span><br><span class="line">乔碧萝</span><br></pre></td></tr></table></figure>

<p>将需要定制的词放在该文本中即可，此时我们测试一下访问</p>
<p><a target="_blank" rel="noopener" href="http://www.ithui.top/es/fenci.txt">http://www.ithui.top/es/fenci.txt</a> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYRt3nHT9iaEVob3nenSh9IKtJpnKvvnwq030rst9eI4SqtC2OvMytyAQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>没有问题，我们继续下一步，来到ik分词器的配置目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;mydata&#x2F;elasticsearch&#x2F;plugins&#x2F;ik&#x2F;config&#x2F;</span><br></pre></td></tr></table></figure>

<p>修改它的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim IKAnalyzer.cfg.xml</span><br></pre></td></tr></table></figure>

<p>修改内容如下，将定制的文本地址配置进去即可：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYxheBH9aKhfIWOuIxjsn1DqX6wKKJRKniaxdFa0zjY6kC23T2WopzdAw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>配置完成后一定要重启elasticsearch，此时我们来测试一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;乔碧萝殿下。&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;乔碧萝&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;殿下&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Spring Boot 整合 elasticsearch</strong></p>
<p>前面介绍了elasticsearch的一些基础知识，接下来我们来看看如何在SpringBoot应用中使用elasticsearch。</p>
<p>想要通过Java程序操作elasticsearch，我们也需要发送请求给elasticsearch进行操作，这里我们使用ElasticSearch-Rest-Client对elasticsearch进行操作。</p>
<p>首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;7.4.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>因为SpringBoot管理了elasticsearch的依赖版本，所以我们需要指定一下elasticsearch的版本与其一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">  &lt;elasticsearch.version&gt;7.4.2&lt;&#x2F;elasticsearch.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>

<p>然后编写一个配置类，向容器中注册一个操作elasticsearch的组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class GuliMailElasticSearchConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RestHighLevelClient esRestClient() &#123;</span><br><span class="line">        return new RestHighLevelClient(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        new HttpHost(&quot;www.ithui.top&quot;, 9200, &quot;http&quot;)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们就可以通过它操作 elasticsearch 了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">class User &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private String gender;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void index() throws IOException &#123;</span><br><span class="line">    IndexRequest indexRequest &#x3D; new IndexRequest(&quot;users&quot;);</span><br><span class="line">    indexRequest.id(&quot;1&quot;);</span><br><span class="line">    &#x2F;&#x2F; indexRequest.source(&quot;name&quot;,&quot;zhangsan&quot;,&quot;age&quot;,20,&quot;gender&quot;,&quot;男&quot;);</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setName(&quot;zhangsan&quot;);</span><br><span class="line">    user.setAge(20);</span><br><span class="line">    user.setGender(&quot;男&quot;);</span><br><span class="line">    String json &#x3D; JSON.toJSONString(user);</span><br><span class="line">    indexRequest.source(json, XContentType.JSON);</span><br><span class="line">    &#x2F;&#x2F; 执行保存操作</span><br><span class="line">    IndexResponse index &#x3D; client.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#x2F;&#x2F; 响应数据</span><br><span class="line">    System.out.println(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RestHighLevelClient提供了非常多的方式用于保存数据，但比较常用的是通过json数据直接保存，首先需要指定索引， <code>IndexRequest indexRequest = new IndexRequest(&quot;users&quot;);</code> 指定了users索引，然后指定数据id，接着指定数据值，最后使用client执行保存操作，然后可以拿到响应数据。</p>
<p>elasticsearch的其它简单操作，诸如：更新、删除等，都只需要转换一下调用方法即可，如更新操作，就需要使用client调用update方法，接下来我们看看Java程序该如何实现较为复杂的检索操作。</p>
<p>比如现在想聚合出年龄的分布情况，并求出每个年龄分布人群的平均薪资，就应该这样进行编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void search() throws IOException &#123;</span><br><span class="line">    &#x2F;&#x2F; 创建检索请求</span><br><span class="line">    SearchRequest searchRequest &#x3D; new SearchRequest(&quot;bank&quot;);</span><br><span class="line">    &#x2F;&#x2F; 指定需要检索的索引</span><br><span class="line">    &#x2F;&#x2F; searchRequest.indices(&quot;bank&quot;);</span><br><span class="line">    &#x2F;&#x2F; 指定检索条件</span><br><span class="line">    SearchSourceBuilder builder &#x3D; new SearchSourceBuilder();</span><br><span class="line">    &#x2F;&#x2F; 查询条件</span><br><span class="line">    builder.query(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;));</span><br><span class="line">    &#x2F;&#x2F; 聚合条件</span><br><span class="line">    builder.aggregation(AggregationBuilders.terms(&quot;ageAgg&quot;).field(&quot;age&quot;));</span><br><span class="line">    builder.aggregation(AggregationBuilders.avg(&quot;balanceAvg&quot;).field(&quot;balance&quot;));</span><br><span class="line">    searchRequest.source(builder);</span><br><span class="line">    &#x2F;&#x2F; 执行检索请求</span><br><span class="line">    SearchResponse searchResponse &#x3D; client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#x2F;&#x2F; 分析结果</span><br><span class="line">    System.out.println(searchResponse.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这些语法我们在最开始接触elasticsearch的时候都已经了解过了，只不过这里是一个链式的方法调用而已。</p>
<p><strong>Nginx</strong></p>
<p>首先拉取 nginx 的镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:1.10</span><br></pre></td></tr></table></figure>

<p>然后随意地启动一个 nginx 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name nginx -d nginx:1.10</span><br></pre></td></tr></table></figure>

<p>启动该 nginx 实例的目的是将 nginx 中的配置文件复制出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container cp nginx:&#x2F;etc&#x2F;nginx .</span><br></pre></td></tr></table></figure>

<p>这样当前目录下就会产生一个nginx文件夹，将其先重命名为conf，然后再创建一个nginx文件夹，并将conf文件夹移动进去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv nginx conf</span><br><span class="line">mkdir nginx</span><br><span class="line">mv conf&#x2F; nginx&#x2F;</span><br></pre></td></tr></table></figure>

<p>然后正式启动一个新的 nginx 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name nginx \</span><br><span class="line">        -v &#x2F;mydata&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html \</span><br><span class="line">        -v &#x2F;mydata&#x2F;nginx&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx \</span><br><span class="line">        -v &#x2F;mydata&#x2F;nginx&#x2F;conf:&#x2F;etc&#x2F;nginx \</span><br><span class="line">                -d nginx:1.10</span><br></pre></td></tr></table></figure>

<p>将刚才准备好的 nginx 文件夹与 nginx 容器内的文件夹作一个一一映射。</p>
<p>索引=数据库   类型=数据表  属性=表字段   文档=一条条的数据</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/17/26.1.ElasticSearch/" data-id="ckqk8ibxo000cn8wdbyzt5qic" data-title="ElasticSearch" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eclipse/" rel="tag">Eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitee/" rel="tag">Gitee</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HATEOAS/" rel="tag">HATEOAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/" rel="tag">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery/" rel="tag">JQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP/" rel="tag">JSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="tag">MySQL基础概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Navicat/" rel="tag">Navicat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBOOTCMS/" rel="tag">PBOOTCMS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PO-BO-VO%EF%BC%8CDTO-DAO%E4%B8%8EPOJO/" rel="tag">PO-BO-VO，DTO-DAO与POJO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Portainer-io/" rel="tag">Portainer.io</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTful/" rel="tag">RESTful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB/" rel="tag">WEB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebRTC/" rel="tag">WebRTC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/for%E5%BE%AA%E7%8E%AF/" rel="tag">for循环</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/if/" rel="tag">if</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E6%A6%82%E8%BF%B0/" rel="tag">java概述</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mqtt/" rel="tag">mqtt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngnix/" rel="tag">ngnix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/" rel="tag">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servlet/" rel="tag">servlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springfox/" rel="tag">springfox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%8E%E4%BA%BA%E6%B2%9F%E9%80%9A/" rel="tag">与人沟通</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B9%A6/" rel="tag">书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8B%E5%8A%A1/" rel="tag">事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E9%83%A8%E7%B1%BB/" rel="tag">内部类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC/" rel="tag">历史版本</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95/" rel="tag">压缩算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="tag">基础概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" rel="tag">小技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A7%91%E6%99%AE/" rel="tag">小科普</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag">微信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">快捷键</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%89%93%E5%8C%85/" rel="tag">打包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB/" rel="tag">抽象类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%A5%E5%8F%A3/" rel="tag">接口</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" rel="tag">搜索技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%B6%E8%97%8F/" rel="tag">收藏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%B0%E7%8E%AF%E5%A2%83/" rel="tag">新环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%99%BE%E5%BA%A6/" rel="tag">百度</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" rel="tag">类型转换</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E5%8E%86/" rel="tag">经历</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83/" rel="tag">编程规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/" rel="tag">设计规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%B7%E6%AD%8C/" rel="tag">谷歌</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E8%AF%B4%E6%98%8E/" rel="tag">软件说明</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD/" rel="tag">逻辑判断</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E5%90%88%E4%BD%9C/" rel="tag">项目合作</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Eclipse/" style="font-size: 10px;">Eclipse</a> <a href="/tags/ElasticSearch/" style="font-size: 10px;">ElasticSearch</a> <a href="/tags/Gitee/" style="font-size: 10px;">Gitee</a> <a href="/tags/HATEOAS/" style="font-size: 10px;">HATEOAS</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/JQuery/" style="font-size: 10px;">JQuery</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/MySQL%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" style="font-size: 10px;">MySQL基础概念</a> <a href="/tags/Navicat/" style="font-size: 10px;">Navicat</a> <a href="/tags/PBOOTCMS/" style="font-size: 10px;">PBOOTCMS</a> <a href="/tags/PO-BO-VO%EF%BC%8CDTO-DAO%E4%B8%8EPOJO/" style="font-size: 10px;">PO-BO-VO，DTO-DAO与POJO</a> <a href="/tags/Portainer-io/" style="font-size: 10px;">Portainer.io</a> <a href="/tags/RESTful/" style="font-size: 10px;">RESTful</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/SpringBoot/" style="font-size: 10px;">SpringBoot</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Typora/" style="font-size: 10px;">Typora</a> <a href="/tags/WEB/" style="font-size: 10px;">WEB</a> <a href="/tags/WebRTC/" style="font-size: 10px;">WebRTC</a> <a href="/tags/for%E5%BE%AA%E7%8E%AF/" style="font-size: 10px;">for循环</a> <a href="/tags/git/" style="font-size: 20px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/if/" style="font-size: 10px;">if</a> <a href="/tags/java%E6%A6%82%E8%BF%B0/" style="font-size: 10px;">java概述</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/mqtt/" style="font-size: 10px;">mqtt</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/ngnix/" style="font-size: 10px;">ngnix</a> <a href="/tags/node-js/" style="font-size: 20px;">node.js</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/servlet/" style="font-size: 10px;">servlet</a> <a href="/tags/springfox/" style="font-size: 10px;">springfox</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/%E4%B8%8E%E4%BA%BA%E6%B2%9F%E9%80%9A/" style="font-size: 10px;">与人沟通</a> <a href="/tags/%E4%B9%A6/" style="font-size: 10px;">书</a> <a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 10px;">事务</a> <a href="/tags/%E5%86%85%E9%83%A8%E7%B1%BB/" style="font-size: 10px;">内部类</a> <a href="/tags/%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC/" style="font-size: 10px;">历史版本</a> <a href="/tags/%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95/" style="font-size: 10px;">压缩算法</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" style="font-size: 10px;">基础概念</a> <a href="/tags/%E5%AE%89%E8%A3%85/" style="font-size: 10px;">安装</a> <a href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">小技巧</a> <a href="/tags/%E5%B0%8F%E7%A7%91%E6%99%AE/" style="font-size: 10px;">小科普</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size: 10px;">微信</a> <a href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 20px;">快捷键</a> <a href="/tags/%E6%89%93%E5%8C%85/" style="font-size: 10px;">打包</a> <a href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB/" style="font-size: 10px;">抽象类</a> <a href="/tags/%E6%8E%A5%E5%8F%A3/" style="font-size: 10px;">接口</a> <a href="/tags/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">搜索技巧</a> <a href="/tags/%E6%94%B6%E8%97%8F/" style="font-size: 10px;">收藏</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%96%B0%E7%8E%AF%E5%A2%83/" style="font-size: 10px;">新环境</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 10px;">杂谈</a> <a href="/tags/%E7%99%BE%E5%BA%A6/" style="font-size: 10px;">百度</a> <a href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" style="font-size: 10px;">类型转换</a> <a href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size: 10px;">索引</a> <a href="/tags/%E7%BB%8F%E5%8E%86/" style="font-size: 10px;">经历</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83/" style="font-size: 10px;">编程规范</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/" style="font-size: 10px;">设计规范</a> <a href="/tags/%E8%B0%B7%E6%AD%8C/" style="font-size: 10px;">谷歌</a> <a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 10px;">软件</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E8%AF%B4%E6%98%8E/" style="font-size: 10px;">软件说明</a> <a href="/tags/%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD/" style="font-size: 10px;">逻辑判断</a> <a href="/tags/%E9%94%81/" style="font-size: 10px;">锁</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">面向对象</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%90%88%E4%BD%9C/" style="font-size: 10px;">项目合作</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/06/30/4.27.%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">序列化与反序列化</a>
          </li>
        
          <li>
            <a href="/2021/06/28/%E7%94%B5%E5%95%86%E9%A1%B9%E7%9B%AE/">电商项目</a>
          </li>
        
          <li>
            <a href="/2021/06/24/4.26.JSR/">JSR</a>
          </li>
        
          <li>
            <a href="/2021/06/24/31.3.%E8%85%BE%E8%AE%AF%E4%BA%91%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9A%84%E5%BC%80%E5%8F%91/">腾讯云音视频的开发</a>
          </li>
        
          <li>
            <a href="/2021/06/23/%E7%94%B3%E8%AF%B7%E8%BD%AF%E8%91%97/">申请软著</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 swx<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>
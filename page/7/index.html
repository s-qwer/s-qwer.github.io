<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://s-qwer.github.io">
  <title>swx的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="跨行转业到计算机，未来发展方向在后端。目前记录学习和工作生涯中的经验和经历。前端，后端，测试，产品，设计，运维都需要去探索。">
<meta property="og:type" content="website">
<meta property="og:title" content="swx的博客">
<meta property="og:url" content="https://s-qwer.github.io/page/7/index.html">
<meta property="og:site_name" content="swx的博客">
<meta property="og:description" content="跨行转业到计算机，未来发展方向在后端。目前记录学习和工作生涯中的经验和经历。前端，后端，测试，产品，设计，运维都需要去探索。">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="swx">
<meta property="article:tag" content="后端，Java">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/">标签</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="qq" target="_blank" href="/932666523" title="qq"><i class="icon-qq"></i></a>
		        
					<a class="weixin" target="_blank" href="/17854205326" title="weixin"><i class="icon-weixin"></i></a>
		        
					<a class="mail" target="_blank" href="/932666523@qq.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author"></h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="qq" target="_blank" href="/932666523" title="qq"><i class="icon-qq"></i></a>
			        
						<a class="weixin" target="_blank" href="/17854205326" title="weixin"><i class="icon-weixin"></i></a>
			        
						<a class="mail" target="_blank" href="/932666523@qq.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/">标签</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-8.5.网页前端框架之bootstrap" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/8.5.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E4%B9%8Bbootstrap/">网页前端框架之bootstrap</a>
    </h1>
  

        
        <a href="/2021/04/17/8.5.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E4%B9%8Bbootstrap/" class="archive-article-date">
  	<time datetime="2021-04-17T09:50:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>bootstrap是一个基于HTML、CSS、JavaScript的前端框架</p>
<p>这个框架已经预定了一套CSS样式和与样式对应的JS代码（对应的样式有对应的特效）</p>
<p>开发人员只需要编写HTML结构，添加bootstrap固定的class样式，就可以轻松完成指定效果的实现（使用现成的样式和特效）</p>
<p>作用：bootstrap使得WEB开发更加快捷，高效</p>
<p>bootstrap支持响应式开发，解决了移动互联网前端开发问题</p>
<p>问题：不同分辨率需要不同的样式（移动手机，电脑，pad等屏幕大小都不一样）</p>
<p>响应式布局：一个网站的展示能够兼容多个终端（手机、ipad、PC等，而不需要为每个终端单独做一个展示版本）  此概念为解决移动互联网浏览而诞生的。</p>
<p>响应式布局能够使得网站仅适用一套样式，就可以在不同分辨率下展示出不同的舒适效果，大大降低了网站开发维护成本，并且能够给用户更好的体验性。</p>
<h1 id="bootstrap环境搭建"><a href="#bootstrap环境搭建" class="headerlink" title="*bootstrap环境搭建*"></a><em><strong>*bootstrap环境搭建*</strong></em></h1><p>javaee关注的是dist文件。dist中有css、fonts、js需要我们复制到项目中（css中有个bootstrap.css和bootstrap.min.css，js中也有个bootstrap.js和bootstrap.min.js），jquery-1.11.3-min.js也需要复制到js文件下，这样就算环境搭建完成了。</p>
<p>完整版bootstrap.css，bootstrap.js：完整版用于源码学习，但因为文件大小问题，不适合网络间传递。</p>
<p>压缩版bootstrap.min.css，bootstrap.min.js：压缩版用于网络发布，相比于完整版就是把源码的空格和换行删除掉了，节约了大量空间，功能是完全相同的，适用于网络间的快速传递，但是不适合源码阅读。</p>
<p>基本模版创建：可以从帮助文档中复制一个模版过来然后新建一个html文件放到其中，里面的bootstrap.min.css，bootstrap.min.js，jquery-1.11.3-min.js这三个东西要重新设置href和src</p>
<!DOCTYPE html>

<html lang="zh-CN">  <!--html页面使用的是中文简体-->

<head>

<meta charset="UTF-8">  <!--设置html页面的字符集是utf-8-->

<meta http-equiv="X-UA-Compatible" content=”IE=edge”>  <!--使用IE最新的渲染模式 展示页面-->

<meta name="viewport" content=”width=device-width,initial-scale=1”>  <!--上述3个meat变迁必须放在最前面，任何其他内容都必须跟随其后-->

<!--viewport：视口 （浏览器上网页内容的可视区域）-->

<title> Bootstrap 101 Template</title>

<link href=”../css/bootstrap.min.css” rel=”stylesheet”>

<script src=”../js/jquery-1.11.3-min.js”></script>

<script src=”../js/bootstrap.min.js”></script>

<!--这三个是bootstrap依赖的样式和脚本-->

</head>

<body>

<h1>helloworld</h1>

</body>

</html>

<p>这几个设置，仅在移动设备上生效：</p>
<p>width=device-width  设置视口的宽度为设备的宽度（大多数手机浏览器视口的宽度是980）</p>
<p>initial-scale=1  初始化缩放设置（1~5）1代表就是100%</p>
<p>minimum-scale=1  移动设备上，页面可以最小缩放的级别</p>
<p>maximum-scale=1  移动设备上，页面可以最大缩放的级别</p>
<p>user-scalable=no  移动设备上，页面禁止缩放</p>
<h1 id="布局容器"><a href="#布局容器" class="headerlink" title="*布局容器*"></a><em><strong>*布局容器*</strong></em></h1><p>bootstrap必须需要至少一个布局容器，才能为页面内容进行封装和方便的样式控制  相当于一个画板</p>
<p>帮助手册位置：全局CSS样式–概览–布局容器</p>
<p>任意元素使用了布局容器的样式都会成为一个布局容器，建议使用div作为布局容器。</p>
<p>.container  ：类用于固定宽度并支持响应式布局的容器  特点：居中，两端留白</p>
<div  class=”container”>...</div>

<p>.container-fluid  :类用于100%宽度，占据全部视口的容器  特点：占据视口100%宽度</p>
<div  class=”container-fluid”>...</div>

<h1 id="栅格系统"><a href="#栅格系统" class="headerlink" title="*栅格系统*"></a><em><strong>*栅格系统*</strong></em></h1><p>为了方便在布局容器中进行网页的布局操作，bootstrap提供了一套专门用于响应式开发布局的栅格系统。</p>
<p>栅格系统将一行分为12列，通过设定元素占用的列数来布局元素在页面上的展示位置。</p>
<p>作用：可以让开发人员更加轻松进行网页布局，并且轻松进行响应式开发</p>
<p>特点：行必须包含在container或container-fluid中；</p>
<p>行使用的样式row，列使用样式col-*-*，元素内容应当放置于列内；</p>
<p>基本的书写方式必须是：容器–行–列</p>
<p>栅格参数：col-屏幕尺寸-占用列数  (屏幕尺寸现在都写成lg)</p>
<p>为了方便显示元素大小，我们为展示元素都赋予了相同样式</p>
<div  class=”container”>

<div class=”row”>

<div class=”col-lg-2” style=”border:1px solid:red;”>

<p>11111</p>
</div>

<div class=”col-lg-4” style=”border:1px solid:red;”>

<p>222222222</p>
</div>

</div>

</div>

<p>列元素的书写顺序，决定布局顺序，先写的列元素会先被布局到行上</p>
<p>列元素的占用列数定义了列元素的大小。</p>
<p>一个row下，如果列元素总和小于等于12，都在一行上。如果大于12，那么超出的元素会另起一行排列</p>
<p>行和列可以无限嵌套，嵌套方式必须为列-行-列-行…（相当于是把当前的列当作行，这个行row又分为12列，可以继续设置）</p>
<p>一个row元素下，都会有12列。</p>
<p>屏幕尺寸设置：</p>
<p>large：lg  大屏幕，一般pc尺寸</p>
<p>medium：md  中等屏幕，小pc尺寸</p>
<p>small：sm  小屏幕，ipad尺寸</p>
<p>x small：  xs  超小屏幕，智能手机尺寸</p>
<p>如果没有设置当前屏幕尺寸的样式，默认一个元素占一行。（比如你设置了lg尺寸，但是当你缩小为md尺寸的时候，就会变为一个元素占一行，因为你没有设置md的相应样式）</p>
<p>多个屏幕尺寸共同设置：只需要在后面加即可</p>
<div class=”col-lg-4 col-md-3 col-sm-2” style=”border:1px solid:red;”>

<p>如果设置了一个屏幕尺寸，比这个尺寸大的屏幕，继承了当前的设置；比这个尺寸小的屏幕，默认一个元素占一行</p>
<p>列偏移：将列元素向右侧进行推移</p>
<p>col-屏幕尺寸-offset-*  在指定屏幕尺寸下，向右偏移*个列</p>
<div class=”col-lg-4 col-lg-offset-3” style=”border:1px solid:red;”>

<h1 id="响应式工具"><a href="#响应式工具" class="headerlink" title="*响应式工具*"></a><em><strong>*响应式工具*</strong></em></h1><p>为针对性地在移动页面上展示和隐藏不同的内容，bootstrap提供响应式工具</p>
<p>可以让开发人员通过该工具决定，在何种屏幕尺寸下，隐藏或者显示某些元素</p>
<p>visible-屏幕尺寸  可见</p>
<p>hidden-屏幕尺寸  隐藏</p>
<h1 id="列表"><a href="#列表" class="headerlink" title="*列表*"></a><em><strong>*列表*</strong></em></h1><p>bootstrap提供了实用的列表样式供开发人员使用</p>
<p>帮助手册–全局CSS样式–排版–列表</p>
<p>无序列表、有序列表、无样式列表、内联列表。</p>
<p>内联列表：可以在标签内进行设置：class=“list-inline”就可以使列表变为在一行上。</p>
<h1 id="按钮"><a href="#按钮" class="headerlink" title="*按钮*"></a><em><strong>*按钮*</strong></em></h1><p>任何HTML元素加上以下样式都会变成对应按钮：class属性设置为</p>
<p>btn btn-default  默认按钮</p>
<p>btn btn-primary  首选按钮</p>
<p>btn btn-success  成功按钮</p>
<p>btn btn-info  一般信息按钮</p>
<p>btn btn-warning  警告按钮</p>
<p>btn btn-danger  危险按钮</p>
<p>btn btn-link  链接按钮</p>
<p>尺寸：在按钮的属性后面添加即可</p>
<p>btn-lg  大按钮</p>
<p>btn-sm  小按钮</p>
<p>btn-xs  超小按钮</p>
<p>默认按钮不用写</p>
<p>块级元素：btn-block  使按钮变为块级元素</p>
<p>激活状态：active  直接在后面添加即可（不用写btn-）</p>
<p>禁用状态：让鼠标无法点击的禁用状态：disabled 用法和active一样</p>
<p>让鼠标指上去是个禁止的禁用状态：设置disabled=“disabled”</p>
<h1 id="导航条"><a href="#导航条" class="headerlink" title="*导航条*"></a><em><strong>*导航条*</strong></em></h1><p>可以复制代码，然后修改我们需要的内容即可。nav标签</p>
<p>汉堡按钮：缩小时，会将项目合并成一个图标</p>
<p>sr-only  阅读器专用的样式（盲人设备，当鼠标指针放到这的时候，阅读器会读出相应设置的内容）</p>
<h1 id="轮播图"><a href="#轮播图" class="headerlink" title="*轮播图*"></a><em><strong>*轮播图*</strong></em></h1><p>帮助手册位置–javascript插件–Carousel</p>
<p>轮播图DIV的定时换图属性：data-interval=“毫秒值”  放在标签中</p>
<p>注意：多个轮播图，必须修改轮播图的id，使id唯一，当改了id之后，后续的代码中的相应部分也要修改</p>
<h1 id="排版方式"><a href="#排版方式" class="headerlink" title="*排版方式*"></a><em><strong>*排版方式*</strong></em></h1><p>class=“”</p>
<p>将元素内所有的内容进行排版：</p>
<p>text-left  使元素内容靠左显示</p>
<p>text-center  使元素内容居中显示</p>
<p>text-right  使元素内容靠右显示</p>
<h1 id="表单元素"><a href="#表单元素" class="headerlink" title="*表单元素*"></a><em><strong>*表单元素*</strong></em></h1><p>复制相关代码，修改其中的一些部分，完成自己的需求。</p>
<p>内联表单，水平排列的表单。</p>
<p>校验状态：has-success  has-error  has-warning</p>
<h1 id="分页条"><a href="#分页条" class="headerlink" title="*分页条*"></a><em><strong>*分页条*</strong></em></h1><p>默认分页  </p>
<p>禁用和激活状态（可以显示当前在第几页，第一页的前一页不可用等情况）： disabled  active  即使设置了不可用，如果存在href标签的话，仍能点击跳转到相应地方，保险起见，建议删除href标签。</p>
<p>翻页</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/8.5.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E4%B9%8Bbootstrap/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-8.4.网页前端之JS" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/">网页前端之JS</a>
    </h1>
  

        
        <a href="/2021/04/17/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/" class="archive-article-date">
  	<time datetime="2021-04-17T05:24:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>HTML是用来写网页的</p>
<p>CSS是美化页面的</p>
<p>JavaScript是WEB上强大的脚本语言</p>
<p>JAVA编程语言：独立写程序，独立运行。编译–运行</p>
<p>脚本语言：无法独立执行。必须嵌入到其他语言中结合使用。直接被浏览器解析执行</p>
<p>作用：控制页面特效展示</p>
<p>语言特征：JavaScript无需编译，直接被浏览器解释并执行</p>
<p>JavaScript无法单独执行，必须嵌入到HTML代码中执行</p>
<p>JavaScript的执行过程由上到下依次执行</p>
<p>注意：JavaScript没有访问系统文件的权限</p>
<p>JavaScript无需编译，由上到下依次解释执行，所以在保证可读性的情况下，允许使用链式编程</p>
<p>JavaScript和java没有任何直接关系</p>
<p>组成</p>
<p>ECMAScript（核心）：规定了JS的语法和基本对象</p>
<p>DOM 文档对象模型（标记型文档。HTML）：处理网页内容的方法和接口</p>
<p>BOM  浏览器对象模型：与浏览器交互的方法和接口</p>
<p>引入方式：</p>
<p>\1. 内部脚本：在当前页面内部写script标签，script内部即可书写JavaScript代码。</p>
<p>格式：</p>
<script type=”text/javascript”>

JavaScript的代码

</sctipt>

注意：script标签理论上可以书写在HTML文件的任意位置

\2. 外部引入：在HTML文档中，通过<script src=””>标签引入.js文件

格式：

<script type=”text/javascript” src=”demo.js”></script>

<p>注意：外部引用时，script标签内不能有script代码，即使写了也不会执行</p>
<p>开发规范规定，script标签的放置位置为：在结束标签</body>前</p>
<p>(在学习时，可以先放在head标签之中，最后在放到结束标签</body>前)</p>
<p>优点：保证html展示内容优先加载，最后加载脚本，增强用户体验性</p>
<p>JavaScript的语法及规则：alert相当于是System.out.println()</p>
<p>\1. 注释：<br>单行注释： //  Hbuilder快捷键：ctrl+/</p>
<p>多行注释：/**/  Hbuilder快捷键：ctrl+shift+/</p>
<p>\2. 变量：标示内存中的一块空间，用于存储数据，且数据是可变的。<br>声明：var 变量名；  变量赋予默认值，默认值为undefined</p>
<p>var 变量名=值；</p>
<p>注意：必须以字母或下划线开头，中间可以使数字，字符或下划线。</p>
<p>变量名不能包含空格等符号</p>
<p>不能使用JavaScript的关键字作为变量名，如：function、this、class</p>
<p>JavaScript严格区分大小写</p>
<p>基本数据类型：5类</p>
<p>string：字符串类型  “” ‘’ 都是字符串，JavaScript中没有单个字符</p>
<p>boolean：布尔类型  固定值为false和true</p>
<p>number：数字类型 任意数字</p>
<p>null：空 一个占位符</p>
<p>undefined：未定义类型  该类型只有一个固定值，即undefined，表示变量声明却未定义具体的值</p>
<p>注意：因为undefined是从null中派生出来的，所以undefined==null</p>
<p>JavaScript区别于java，是弱类型语言，变量的使用不用严格遵循规范，所以一个变量声明好之后，还可以赋予任意类型的值。</p>
<p>typeof() 可以分辨变量值属于哪种基本数据类型：undefined、string、boolean、number。 如果一个变量是引用类型或者null类型的话，会返回object。</p>
<p>ECMAScript实现之初的一个bug：null属于基本数据类型，然而typeof(null)返回的却是object</p>
<p>引用数据类型:引用数据类型通常叫做类（class），但在JavaScript中，因为不存在编译过程，所以没有类的概念，所处理的引用数据类型都是对象。</p>
<p>标准创建方式： var str= new String();  //和java相同</p>
<p>var str= new String;  //js独有的方式</p>
<p>\3. 运算符：与java基本一致<br>比较运算符：== 逻辑等。 仅仅对比值<br>                === 全等。对比值并且对比类型<br>逻辑运算符：没有&amp; |  只有三个</p>
<p>&amp;&amp;：and</p>
<p>||：  or</p>
<p>!：  not</p>
<p>\4. 正则对象<br>RegExp对象的创建方式：</p>
<p>var reg= new RegExp(“表达式”);  （开发中基本不用）</p>
<p>var reg=/^表达式$/；  直接量（开发中常用）</p>
<p>直接量中存在边界，即^代表开始，$代表结束</p>
<p>直接量方式的正则是对象，不是字符串，别用引号</p>
<p>使用正则对象：方法：compile：编译正则表达式  （不咋用）</p>
<p>exec：检索字符串中指定的值，返回找到的值，并确定其位置 （不咋用）</p>
<p>test方法： 正则对象.test(string);  用来校验字符串是否匹配正则，全部字符匹配返回true，有一个字符不匹配返回false</p>
<p>注意：/表达式/ 普通方式，只要有成立正则的字符存在，就返回true，除非全部字符不符合正则，返回false（检查不严格，适合字符串查找、替换）</p>
<p>/^表达式$/ 直接量方式，只要有无法成立正则表达式的字符存在，就返回false（检查严格，适合表单校验）</p>
<p>\5. JS数组对象<br>特性：JS数组可以看作java中的ArrayList集合。</p>
<p>数组中的每一个成员都没有类型限制，即可以存放任意类型。</p>
<p>数组的长度可以自动修改</p>
<p>四种创建方式：</p>
<p>（1）var arr=[1,2,3,”a”,true];  常用的js数组  （常用）</p>
<p>（2）var arr=new Array();  创建一个数组对象，数组长度默认为0 （常用）</p>
<p>（3）var arr= new Array(4);  数组长度是4，相当于开辟了长度为4的空间，每个元素是undefined。</p>
<p>（4）var arr =new Array(“a”,1,true);创建了一个数组，长度为3，元素是“a”,1,true<br>常用属性：length  设置或返回数组中元素的数目</p>
<p>常用方法： join（string）  把数组的所有元素放入一个字符串。元素通过指定的分隔符string进行分隔 （对原来的数组无影响）</p>
<p>pop（） 删除并返回数组的最后一个元素（原先数组无了）</p>
<p>push（新元素） 向数组的末尾添加一个或更多的元素，并返回新的长度（原先数组无了）</p>
<p>reverse（） 颠倒数组中元素的顺序（物理翻转，就是把元素下标进行互换）该方法的返回值就是翻转成功的新数组。（会对当前的数组进行操作，原来的数组无了）</p>
<p>\6. 全局函数(global)</p>
<p>undefined属于全局函数的属性，但是我们在使用的时候不用加global.undefined<br>（1）执行： eval（string）  计算JavaScript字符串，并把它作为脚本代码来执行</p>
<p>作用：增强程序的扩展性</p>
<p>注意：只可以传递原始数据类型string，传递string对象无作用。</p>
<p>（2）编码和解码</p>
<p>URL/URI编码：中文和特殊符号  %十六进制</p>
<p>作用：保证数据传递的完整性</p>
<p>encodeURI（string）  把字符串进行URI编码，返回值就是编码后的结果</p>
<p>decodeURI（string）  解码某个编码的URI</p>
<p>（3）URI和URL的区别</p>
<p>URI是统一资源标识符  标识资源详细名称  必须包含资源名</p>
<p>URL是统一资源定位器  定位资源的网络位置  必须包含http：//</p>
<p>资源：就是可以通过浏览器访问的信息统称为资源（图片、文本、HTML、CSS等等）</p>
<p>（4）字符串转数字</p>
<p>parseInt(string)  解析一个字符串并返回一个整数  小数点后面部分直接去掉</p>
<p>parseFloat(string)  解析一个字符串并返回一个浮点数</p>
<p>注意：如果字符串的某个字符从字面值上无法转为数字，那么从该字符开始停止转换，仅返回前面正确的转换值。</p>
<p>如果字符串的第一个字符就无法从字面值上转为数字，那么停止转换，返回NaN（Not A Number，一个数字类型的标识，表示不是一个正确的数字）</p>
<p>\7. 自定义函数/自定义方法</p>
<p>函数：如果一段代码需要被重复编写使用，那么我们为了方便统一编写使用，可以将其封装进一个函数（方法）中</p>
<p>作用：增强代码的复用性</p>
<p>格式： function 方法名(参数列表){</p>
<p>函数体</p>
<p>}</p>
<p>注意：JavaScript函数定义必须用小写的function</p>
<p>无需定义返回值类型，在function后面直接写方法名</p>
<p>参数的定义无需使用var关键字，否则会报错</p>
<p>函数体中，return可以不写，也可以return具体值，也可以仅仅写return</p>
<p>JavaScript函数调用执行完毕一定有返回值，值及类型根据return决定，如果未return具体值，则返回值为undefined</p>
<p>函数如果同名，JavaScript中不存在方法重载，只有方法相互覆盖，所以最后定义的函数覆盖之前的定义。</p>
<p>再调用时仅仅根据方法名来调用函数，即使实际参与函数与形参不匹配，也不会影响正常调用。</p>
<p>如果实参未赋值，就使用默认值undefined</p>
<p>\8. 自定义对象</p>
<p>①function构造函数：JavaScript中的引用数据类型都是对象，而对象在JavaScript中可以用函数来表示。（相当于java中创建某个class类）</p>
<p>无形参格式：function 对象名(){</p>
<p>函数体</p>
<p>}</p>
<p>例如：</p>
<p>声明一个Person对象：</p>
<p>function Person(){</p>
<p>this.name=”swx”;  // this 就是当前的Person对象</p>
<p>this.age=”23”;   //name  age是对象的属性</p>
<p>}</p>
<p>var p=new Person();  //创建了一个Person对象</p>
<p>alert(p.name);</p>
<p>为属性赋值：</p>
<p>（1）构造参数赋值：function Person(n,a){</p>
<p>this.name=n;  </p>
<p>this.age=a;  </p>
<p>}</p>
<p>var p=new Person(“swx”,”23”);</p>
<p>（2）创建对象后，调用属性进行赋值</p>
<p>p.name=”sss”;</p>
<p>属性定义方式：</p>
<p>（1）this关键字，在对象声明定义阶段，定义一个属性</p>
<p>（2）创建对象后，使用对象.属性 方式来动态定义属性</p>
<p>p.sex=”男”;  //为Person对象声明了一个新的属性sex并赋值为男</p>
<p>应用场景：适用于对象构建及代码复用</p>
<p>②对象直接量</p>
<p>开发中可以用一种简单的方式直接创建自定义的JavaScript对象，这种方式称为“对象直接量”</p>
<p>格式： var 对象名 = {属性名1：“属性值1”，属性名2：“属性值2”，属性名3：“属性值3”……};  //  不一定非要字符串了 可以直接数字18</p>
<p>该方式直接创建出实例对象，无需构建函数，无需再new创建实例对象，直接使用即可。</p>
<p>适用场景：适用于快速创建实例对象及数据封装</p>
<p>BOM对象 </p>
<p>BOM（Browser Object Model）浏览器对象模型</p>
<p>浏览器：IE、火狐、谷歌、360等任意浏览器</p>
<p>作用：用来执行浏览器的相关操作（例如：浏览器的地址，弹出消息等）</p>
<p>一般情况下，window代表了BOM对象</p>
<p>window对象是JavaScript的内置对象，使用window对象调用方法时可以省略window不写</p>
<p>（1）消息框</p>
<p>alert()  警告框，用来弹出警告消息 </p>
<p>注意：不同浏览器显示的组件样式不同，我们无需关注</p>
<p>confirm() 确认框 用于告知用户信息并收集用户的选择</p>
<p>有一个返回值，boolean类型</p>
<p>（2）定时器</p>
<p>循环定时器：调用一次就会创建并循环执行一个定时器</p>
<p>格式：setInterval(调用的方法名()，毫秒值);  </p>
<p>会有一个返回值，返回值就是这个定时器的id</p>
<p>取消：clearInterval(id);  取消id的定时器</p>
<p>一次性定时器：调用一次就会创建并执行一个计时器一次</p>
<p>格式：setTimeout(调用的方法名()，毫秒值);</p>
<p>也会有一个返回值，返回值就是这个定时器的id</p>
<p>取消：clearTimeout(定时器ID);  这个id在当前页面要求是唯一的。</p>
<p>（3）location对象</p>
<p>包含浏览器地址栏的信息</p>
<p>常用属性：href  设置或返回完整的URL  （直接调用会返回当前页面的URL，设置href属性=””;浏览器就会跳转到对应的路径，这里可以是html页面，也可以是外网路径，但必须要加https：//）</p>
<p>DOM对象</p>
<p>DOM（Document Object Model）文档对象模型</p>
<p>文档：标记型文档（HTML等）</p>
<p>DOM是将标记型文档中所有内容（标签、文本、属性）都封装成对象</p>
<p>通过操作对象的属性或者方法，来达到操作或者改变HTML展示效果的目的</p>
<p>HTML文件会加载并解析到内存中，会生成一张DOM树</p>
<p>DOM树：</p>
<p>每个标签都会被加载成DOM树上的一个元素节点对象</p>
<p>每个标签的属性会被加载成DOM树上的一个属性节点对象</p>
<p>每个标签的内容体会被加载成DOM树上的一个文本节点对象</p>
<p>整个DOM树，是一个文档节点对象，即DOM对象</p>
<p><em><strong>*一个HTML文档加载到内存中就会形成一个DOM对象*</strong></em></p>
<p>特点：必定会有一个根节点</p>
<p>每个节点都是节点对象</p>
<p>常见的节点关系：父子节点关系</p>
<p>文本节点对象没有子节点（叶子节点）</p>
<p>每个节点都有一个父节点，零到多个子节点</p>
<p>只有根节点没有父节点</p>
<p>获取元素对象的四种方式： document的相关方法，所以要用document调用</p>
<p>getElementById();  通过元素id获取对应元素对象 （可以通过id获取对应的元素对象，如果找不到，返回null）</p>
<p>getElementsByName();  通过元素的****name属性****获取符合要求的所有元素</p>
<p>getElementsByTagName();  通过元素的****元素名属性（标签名）****获取符合要求的所有元素</p>
<p>getElementsByClassName();  通过元素的****class属性****获取符合要求的所有元素</p>
<p>注意事项：</p>
<p>获取某个或某些元素节点对象，必须保证元素节点对象先被加载到内存中。（这就是为什么script标签为什么推荐放在</body>之前的原因，这就可以保证元素都被加载完了，再运行script标签时就能找到相应的标签）</p>
<p>元素对象常见属性：</p>
<p>value: 可以修改元素的值</p>
<p>元素对象.value  获取元素对象的value属性值</p>
<p>元素对象.value=属性值  设置元素对象的value属性值</p>
<p>className： 可以修改元素的样式</p>
<p> //本来是class，但是class是关键字，所以要用className</p>
<p>元素对象.className  获取元素对象的class属性值</p>
<p>元素对象.className=属性值  设置元素对象的class属性值</p>
<p>checked：  可以修改单选/复选的选中与否</p>
<p>元素对象.checked  获取元素对象的checked属性值</p>
<p>元素对象.checked=属性值  设置元素对象的checked属性值</p>
<p>HTML中checked=”checked”,JavaScript中返回true，false</p>
<p>innerHTML：  可以操作元素的内容体</p>
<p>元素对象.innerHTML  获取元素对象的内容体</p>
<p>元素对象.innerHTML=值  设置元素对象的内容体</p>
<p>追加内容体信息：  元素对象.innerHTML+=值</p>
<p>JS事件</p>
<p>通常鼠标或热键的动作称之为事件（Event）。</p>
<p>作用：通过JS事件，我们可以完成页面的指定特效</p>
<p>JS事件驱动机制：</p>
<p>事件源：专门产生事件的组件 </p>
<p>事件：由事件源所产生的动作或者事情 </p>
<p>监听器：专门处理事件源所产生的事件</p>
<p>注册/绑定监听器：让监听器时刻监听事件源是否有指定事件产生，如果事件源产生指定事件，则调用监听器处理</p>
<p>JS常见事件：  一般都是放在标签中，事件=“方法()”</p>
<p>\1. 点击事件（onclick）：由鼠标或热键点击元素组件时触发</p>
<p>\2. 焦点事件</p>
<p>焦点：即整个页面的注意力。  默认一个正常页面最多仅有一个焦点 （例如：文本框中闪烁的小竖线）</p>
<p>通常焦点也能反映出用户目前的关注点，或者正在操作的组件。</p>
<p>获取焦点事件（onfocus）：当元素组件获取焦点时触发</p>
<p>失去焦点事件（onblur）：元素组件失去焦点时触发</p>
<p>\3. 域内容改变事件（onchange）：元素组件的值发生改变时触发</p>
<p>\4. 加载完毕事件（onload）：元素组件加载完毕时触发</p>
<p>//以前有推荐script代码放在最后是因为要元素标签加载完在调取，现在有了这个方法，也可以让元素组件加载完再调取。</p>
<p>\5. 表单提交事件（onsubmit）：表单的提交按钮被点击时触发</p>
<p>注意：该事件需要返回boolean类型的值来执行  提交/阻止表单数据的操作</p>
<p>事件得到true，提交表单数据</p>
<p>事件得到false，阻止表单数据提交</p>
<p>在form标签处写。</p>
<p>用于表单的校验，也可以控制表单的提交  onsubmit=”return run1()” run1方法中必须要有返回值（可以进行表单校验，符合返回true，会提交表单；不符合返回false，表单提交会被阻止）</p>
<p>\6. 键位弹起事件（onkeyup）：在组件中输入某些内容时，键盘键位弹起时触发该事件（可以进行校验）</p>
<p>\7. 常用鼠标事件</p>
<p>鼠标移入事件（onmouseover）：鼠标移入某个元素组件时触发</p>
<p>鼠标移出事件（onmouseout）：鼠标移出某个元素组件时触发</p>
<p>JS事件的两种绑定方式：</p>
<p>\1. 元素事件句柄绑定：将事件以元素属性的方式写到标签内部，进而绑定对应函数</p>
<p>//可以绑定一个或者多个 无参、带参函数，如果是带参的话，外面是“”里面是’’。多个函数时，函数之间用“ ， ”隔开，顺序就是执行顺序。</p>
<p>优点：开发快捷；传参方便；可以绑定多个函数</p>
<p>缺点：JS和HTML代码高度糅合在一起，不利于多部门的项目开发维护</p>
<p>\2. DOM绑定方式：使用DOM的属性方式绑定事件</p>
<p>两种：（1）对象.事件属性  一次只能绑定一个函数，不能传递参数</p>
<p>window.onload=run1；</p>
<p>（2）匿名函数  可以绑定多个函数，可以传递参数</p>
<p>window.onload=function(){</p>
<p>//这个方法是页面加载的方法，可以在这里调取此页面的所有元素，获得元素后就可以继续使用匿名函数调取方法</p>
<p>run1();</p>
<p>run2();</p>
<p>}</p>
<p>优点：使得HTML代码和JS代码完全分离</p>
<p>缺点：不能传递参数；一个事件只能绑定一个函数。解决：匿名函数就可以，匿名函数内部就可以绑定多个函数</p>
<h3 id="Window-setInterval-方法"><a href="#Window-setInterval-方法" class="headerlink" title="Window setInterval() 方法"></a>Window setInterval() 方法</h3><p>setInterval() 方法可按照指定的周期（以毫秒计）来调用函数或计算表达式。</p>
<p>setInterval() 方法会不停地调用函数，直到 <a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/met-win-clearinterval.html">clearInterval()</a> 被调用或窗口被关闭。由 setInterval() 返回的 ID 值可用作 clearInterval() 方法的参数</p>
<p>如果你只想执行一次可以使用 <a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/met-win-settimeout.html">setTimeout()</a> 方法</p>
<h3 id="Window-clearInterval-方法"><a href="#Window-clearInterval-方法" class="headerlink" title="Window clearInterval() 方法"></a>Window clearInterval() 方法</h3><p>显示当前时间 ( setInterval() 函数会每秒执行一次函数，类似手表)。使用 clearInterval() 来停止执行:</p>
<p>clearInterval() 方法可取消由 setInterval() 函数设定的定时执行操作。</p>
<p>clearInterval() 方法的参数必须是由 setInterval() 返回的 ID 值。</p>
<p><strong>注意:</strong> 要使用 clearInterval() 方法, 在创建执行定时操作时要使用全局变量：</p>
<h3 id="if问题"><a href="#if问题" class="headerlink" title="if问题"></a>if问题</h3><p>在 JavaScript 里，不为空 “” 的字符串、不为 0 的数字、不为 null 的对象、不为 undefined 的对象属性、布尔型 true，单独作为判断式里的一个表达式时 JavaScript 通通认定为真（true），反之则为假（false）</p>
<p>原型和原型链</p>
<p>一、原型<br>①所有引用类型都有一个<code>__proto__</code>(隐式原型)属性，属性值是一个普通的对象<br>②所有函数都有一个prototype(原型)属性，属性值是一个普通的对象<br>③所有引用类型的<code>__proto__</code>属性指向它构造函数的prototype</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var a &#x3D; [1,2,3];</span><br><span class="line">a.__proto__ &#x3D;&#x3D;&#x3D; Array.prototype; &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>


<p>二、原型链<br>当访问一个对象的某个属性时，会先在这个对象本身属性上查找，如果没有找到，则会去它的<code>__proto__</code>隐式原型上查找，即它的构造函数的prototype，如果还没有找到就会再在构造函数的prototype的<code>__proto__</code>中查找，这样一层一层向上查找就会形成一个链式结构，我们称为原型链。</p>
<p>二、原型链<br>当访问一个对象的某个属性时，会先在这个对象本身属性上查找，如果没有找到，则会去它的__proto__隐式原型上查找，即它的构造函数的prototype，如果还没有找到就会再在构造函数的prototype的__proto__中查找，这样一层一层向上查找就会形成一个链式结构，我们称为原型链。</p>
<p>举例，有以下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function Parent(month)&#123;</span><br><span class="line">    this.month &#x3D; month;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var child &#x3D; new Parent(&#39;Ann&#39;);</span><br><span class="line"></span><br><span class="line">console.log(child.month); &#x2F;&#x2F; Ann</span><br><span class="line"></span><br><span class="line">console.log(child.father); &#x2F;&#x2F; undefined</span><br></pre></td></tr></table></figure>

<p>在child中查找某个属性时，会执行下面步骤：</p>
<p><img src="/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/20180620134143385" alt="这里写图片描述"></p>
<p>访问链路为：</p>
<p><img src="/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/20180620155400807" alt="这里写图片描述"></p>
<p>①一直往上层查找，直到到null还没有找到，则返回undefined<br>②<code>Object.prototype.__proto__</code> === null<br>③所有从原型或更高级原型中的得到、执行的方法，其中的this在执行时，指向当前这个触发事件执行的对象</p>
<p>js的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSON.stringify()   &#x2F;&#x2F;将数组转为字符串</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stringObject.indexOf(searchvalue,fromindex) &#x2F;&#x2F;从stringObject中检索searchvalue，对大小写敏感，没找到返回-1，找到返回stringObject中的index值</span><br></pre></td></tr></table></figure>


      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/8.4.%E7%BD%91%E9%A1%B5%E5%89%8D%E7%AB%AF%E4%B9%8BJS/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-10.7.关于重构" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/">关于重构</a>
    </h1>
  

        
        <a href="/2021/04/17/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/" class="archive-article-date">
  	<time datetime="2021-04-17T05:16:25.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是重构？"><a href="#什么是重构？" class="headerlink" title="什么是重构？"></a><strong>什么是重构？</strong></h1><p>Martin Fowler曾出版了两本有关重构的书籍，他认为：</p>
<p>重构指的是，在不改变代码的外部行为，只改善其内部结构的方式下，修改软件系统的过程。重构是一种有条理的清理代码的方式，可以最大程度地减少引入bug的机会。本质上，重构意味着在代码编写完成后，改进代码的设计。</p>
<h1 id="重构有什么好处？"><a href="#重构有什么好处？" class="headerlink" title="重构有什么好处？"></a><strong>重构有什么好处？</strong></h1><p>首先，重构可以将混乱、不正确和/或重复的代码转换成整洁的代码。它可以解决多位开发人员协同工作时可能引发的代码标准化问题。重构可以提高可读性，改善源代码的可维护性以及整体结构和功能。重构可以使代码更易于扩展和添加新功能。删除不必要的代码（比如重复代码）可以减少代码所使用的内存，并加快执行速度。 </p>
<p>例如，在2014年，Kickstarter的工程师面临着一个巨大的挑战：由于用户数量呈指迅速增长，导致查询性能下降。为此，他们将MySQL查询重构为Redis，减少了100毫秒的加载时间，从而减少了加载时间的差异并提高了网站的整体速度。</p>
<h1 id="技术负债与重构"><a href="#技术负债与重构" class="headerlink" title="技术负债与重构"></a><strong>技术负债与重构</strong></h1><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAughAuEz9WJKmOEboib3KY1y335WhibibfKKEic84Md2OlBMT0UxxICJs15MOBWP5zulrkg2x6icPO3ZqtA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>简而言之，重构是消除或减少技术负债的一种方式。</p>
<p>重构对于长期维持的代码质量、安全性和性能至关重要。如果没有定期的重构，开发人员就会承受巨大的技术负债。重构代码的机会越少，技术负债就会越多，开发新功能也会变得越来越难。</p>
<h1 id="重构的指标"><a href="#重构的指标" class="headerlink" title="重构的指标"></a><strong>重构的指标</strong></h1><p>我们可以通过各种指标，衡量重构代码的优先级。在指标的帮助下，我们可以有条不紊地计划重构，每一次都专心完成最重要的任务。</p>
<p>此外，你需要通过指标来衡量重构的效果。我们不仅需要重构低效的代码，而且还可以通过修改低效代码增加价值。为了获得真正的价值，你需要进行测试，包括单元测试和功能测试。除此之外，还有一些其他方面的指标，比如发现的bug数减少，以及降低循环复杂性（重构的目标是降低复杂性）。高度复杂的方法或功能（比如超过350行的方法或功能）就是良好的重构对象。</p>
<p>此外，我们还需要考虑，如何将重构融合到更广泛的团队目标或有关工作流和任务的里程碑中。</p>
<h1 id="代码重构示例"><a href="#代码重构示例" class="headerlink" title="代码重构示例"></a><strong>代码重构示例</strong></h1><p>代码重构的示例非常多，为了简洁起见，我们介绍以下几种：</p>
<p><strong>红色，绿色和重构</strong></p>
<p>重构与单元测试息息相关。最常见的形式之一就是敏捷方法固有的测试驱动开发（Test-Driven Development，即TDD）。你可以在编写代码之前先编写测试。从本质上来说，应该由测试来驱动程序，说明代码应该执行的操作。</p>
<p>红色，绿色和重构是测试驱动开发的一个示例：</p>
<ul>
<li>红色：编写没有实现代码的测试套件，必然会失败。</li>
<li>绿色：编写实现代码，刚刚好可以通过测试套件。</li>
<li>重构：寻找优化和改进代码的方法。</li>
</ul>
<p><strong>提取方法（又名提取函数）</strong></p>
<p>将代码片段从现有方法移到新方法中，而新方法的名称明确说明了其功能。这种技术有助于降低复杂性并提高代码的可读性。</p>
<p><strong>提取变量</strong> </p>
<p>如果遇到难以理解的表达式，或者该表达式在整个代码中重复了多次，则可以通过提取变量重构，将表达式或其中一部分放入一个复杂度较低且更易于理解的变量中。这样可以减少复杂性和代码重复。</p>
<p><strong>按抽象建立分支</strong></p>
<p>按抽象建立分支可以逐步对软件系统进行大规模地修改，而你则可以一边修改代码，一边定期发布系统。这种方法可以降低在分支上重构代码的复杂性，避免在合并代码时出现问题。</p>
<p><strong>方法组合</strong></p>
<p>代码过长不便于理解，而且也不方便修改。方法组合指的是一系列的操作，将方法改成顺序结构并删除重复的代码。这些操作包括内联方法、内联模板、用查询代替模板、拆分临时变量以及删除对参数的赋值等。</p>
<h1 id="重构代码的工具"><a href="#重构代码的工具" class="headerlink" title="重构代码的工具"></a><strong>重构代码的工具</strong></h1><p>你需要专业的重构工具吗？Martin Fowler表示，自动化的工具有帮助但不是必需的。他指出：</p>
<p>“许多语言都有IDE，可以自动执行许多常见的重构。这些是非常有价值的工具，可以帮助我更快地重构代码。但是，这些工具不是必不可少的，我经常在没有工具支持的情况下编写程序，每次只迈出一小步，并通过频繁的测试来发现错误。”</p>
<p>许多开发环境都可以自动化重构，一些常见的重构工具包括：</p>
<ul>
<li>Visual studio intellicode</li>
<li>Eclipse IDE</li>
<li>Spring Tool Suite 4</li>
<li>Rider</li>
<li>IntelliJ IDEA</li>
<li>SonarQube</li>
</ul>
<h1 id="重构与工程经理的难题"><a href="#重构与工程经理的难题" class="headerlink" title="重构与工程经理的难题"></a><strong>重构与工程经理的难题</strong></h1><p>为了解决引发重构需求的问题，首先我们需要弄清楚公司的运营方式。在着手重构之前，请先回答下列几个问题：</p>
<ul>
<li>哪些任务最优先？</li>
<li>开发的速度如何？</li>
<li>开发人员是否感觉到了快速交付代码的压力？</li>
<li>解决技术负债的流程都有哪些？</li>
<li>实施了哪些类型的代码审核？</li>
<li>团队成员是否具备适当的重构技能？</li>
<li>公司的文档标准是什么？</li>
</ul>
<p>如果不解决引发重构需求的根本问题，那么问题只会愈演愈糟。</p>
<h1 id="高级管理层对重构的支持"><a href="#高级管理层对重构的支持" class="headerlink" title="高级管理层对重构的支持"></a><strong>高级管理层对重构的支持</strong></h1><p>你们公司可能并没有在基础设施和维护上投入太多资金。</p>
<p>可能会有人说，应该将花费在重构上的时间投入到新功能开发上。</p>
<p>但是，我们仍然应该看一看重构的好处，以及它们与工作流程、客户、收入和业务增长的关系。重构得当可以改善代码，交付有效更新以及急需的功能，从而吸引新客户和回头客。即使在成功发布产品之后，软件公司也可以通过这种方式保持竞争力。 </p>
<p>为了获取高层管理的支持，还有一个更好的方法，即量化团队当前花费在修复原始代码中的错误或bug上的时间。具体一点，比如每天一个小时？每天两个小时？持续记录一个星期，你就会惊讶地发现原来团队每年需要花费数周或数月时间来修复遗留的代码。</p>
<h1 id="团队支持与重构：一个Sprint还是马拉松？"><a href="#团队支持与重构：一个Sprint还是马拉松？" class="headerlink" title="团队支持与重构：一个Sprint还是马拉松？"></a><strong>团队支持与重构：一个Sprint还是马拉松？</strong></h1><p>很难在团队内部开展重构工作？提及重构就会哀声载道？顺利开展重构的最重要的标志就是有计划、有目标以及有文档记录的行动。Ron Jeffries（极限编程的三大创始人之一）将重构比喻为清道：</p>
<p>“花些时间清出一条道来，那么下一次我们就可以直奔我们要构建的下一个功能，而无需绕过杂草和灌木丛。”</p>
<p>但是，他强调指出，糟糕的代码需要花费很长的时间来清理，而且重构应该经过深思熟虑：</p>
<p>“如果我们只改进手头的代码，而忽略目前不涉及的代码，那么以后必然会走回头路。”</p>
<p>在同一个Sprint中，我们经常发现后面的功能用到了我们之前清理过的代码。我们就会立即享受重构的好处。如果我们等积攒了一堆技术负债，再开始重构，那么我们享受的好处会延迟，甚至可能会在一些没大有用的地方浪费精力。</p>
<p>产品工程师兼首席技术官Andreas Klinger是Fix-it Friday的粉丝，他表示：</p>
<p>“Fix-it Friday的规则很简单：除非当前的项目十万火急，否则周五的工作就应该是重构。让工程师选择他们的工作。我们不应该因为微观管理而抹杀这种乐趣。有些人会尝试新的库。有些人会修复积压的bug。这两种工作都很好。我们尝试鼓励大家平衡这些任务。”</p>
<p>无论采用哪种方法，你都需要慎重思考，询问团队哪些代码最影响他们的效率。</p>
<ul>
<li>修复哪些代码对你的其他代码产生的影响最大？</li>
<li>解决哪些问题得到的回报最多？</li>
</ul>
<p>你不太可能找到一整块专门的时间来重构代码，重构代码必然会牺牲你花费在其他项目上的时间，但请不要低估定期坚持开展小范围的重构带来的影响。聚沙成塔，集腋成裘，最终你会获得丰厚的回报。</p>
<h1 id="文档与重构"><a href="#文档与重构" class="headerlink" title="文档与重构"></a><strong>文档与重构</strong></h1><p>标准化命名约定之类的文档可以让每个人都达成共识。Xerox的高级开发人员的研究发现，缺乏文档是重构最大的难题之一。</p>
<p>记录重构的工作内容不仅可以记录花费的时间，而且还可以为将来的团队成员提供说明。</p>
<p>最后，你还通过文档记录下自己的成功：重构带来的最大成功是什么？这些可以成为代码审核的考虑因素吗？</p>
<p><strong>需求案例</strong></p>
<p><strong>项目需求</strong></p>
<p>项目开发阶段，有一个关于下单发货的需求：如果今天下午 3 点前进行下单，那么发货时间是明天，如果今天下午 3 点后进行下单，那么发货时间是后天，如果被确定的时间是周日，那么在此时间上再加 1 天为发货时间。</p>
<p><strong>思考与重构</strong></p>
<p>我相信这个需求看似很简单，无论怎么写都可以完成。</p>
<p>很多人可能看到这个需求，就动手开始写 Calendar 或 Date 进行计算，从而完成需求。</p>
<p>而我给的建议是，仔细考虑如何写代码，然后再去写，不是说所有的时间操作都用 Calendar 或 Date 去解决，一定要看场景。</p>
<p>对于时间的计算我们要考虑 joda-time 这种类似的成熟时间计算框架来写代码，它会让代码更加简洁和易读。</p>
<p>请读者先考虑这个需求如何用 Java 代码完成，或先写一个你觉得完成这个代码的思路，再来看我下边的代码，这样，你的收获会更多一些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">final DateTime DISTRIBUTION_TIME_SPLIT_TIME &#x3D; new DateTime().withTime(15,0,0,0);</span><br><span class="line">private Date calculateDistributionTimeByOrderCreateTime(Date orderCreateTime)&#123;</span><br><span class="line">    DateTime orderCreateDateTime &#x3D; new DateTime(orderCreateTime);</span><br><span class="line">    Date tomorrow &#x3D; orderCreateDateTime.plusDays(1).toDate();</span><br><span class="line">    Date theDayAfterTomorrow &#x3D; orderCreateDateTime.plusDays(2).toDate();</span><br><span class="line">    return orderCreateDateTime.isAfter(DISTRIBUTION_TIME_SPLIT_TIME) ? wrapDistributionTime(theDayAfterTomorrow) : wrapDistributionTime(tomorrow);</span><br><span class="line">&#125;</span><br><span class="line">private Date wrapDistributionTime(Date distributionTime)&#123;</span><br><span class="line">    DateTime currentDistributionDateTime &#x3D; new DateTime(distributionTime);</span><br><span class="line">    DateTime plusOneDay &#x3D; currentDistributionDateTime.plusDays(1);</span><br><span class="line">    boolean isSunday &#x3D; (DateTimeConstants.SUNDAY &#x3D;&#x3D; currentDistributionDateTime.getDayOfWeek());</span><br><span class="line">    return isSunday ? plusOneDay.toDate() : currentDistributionDateTime.toDate() ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读这段代码的时候，你会发现，我将判断和有可能出现的不同结果都当做一个变量，最终做一个三目运算符的方式进行返回，这样的优雅和可读性显而易见，当然这样的代码不是一蹴而就的，我优化了 3 遍产生的以上代码。读者可根据自己的代码和我写的代码进行对比。</p>
<p><strong>提高方法</strong></p>
<p>如果你做了 3 年+的程序员，我相信像如上这样的需求，你很轻松就能完成，但是如果你想做一个会写 Java 的程序员，就好好的思考和重构代码吧。</p>
<p>写代码就如同写字一样，同样的字，大家都会写，但是写出来是否好看就不一定了。如果想把程序写好，就要不断的思考和重构，敢于尝试，敢于创新，不要因循守旧，一定要做一个优秀的 Java 程序员。</p>
<p>提高代码水平最好的方法就是有条理的重构！(注意：是有条理的重构)</p>
<p><strong>设计模式</strong></p>
<p>设计模式就是工具，而不是提现你是否是高水平程序员的一个指标。</p>
<p>我经常会看到某一个程序员兴奋的大喊，哪个程序哪个点我用到了设计模式，写的多么多么优秀，多么多么好。我仔细去翻阅的时候，却发现有很多是过度设计的。</p>
<p><strong>业务驱动技术 or 技术驱动业务</strong></p>
<p>业务驱动技术 or 技术驱动业务 ？ 其实这是一个一直在争论的话题，但是很多人不这么认为，我觉得就是大家不愿意承认罢了。我来和大家大概分析一下作为一个 Java 程序员，我们应该如何判断自己所处于的位置.</p>
<p><strong>业务驱动技术：</strong>如果你所在的项目是一个收益很小或者甚至没有收益的项目，请不要搞其他创新的东西，不要驱动业务要如何如何做，而是要熟知业务现在的痛点是什么？如何才能帮助业务盈利或者让项目更好，更顺利的进行。</p>
<p><strong>技术驱动业务：</strong>如果你所在的项目是一个很牛的项目，比如淘宝这类的项目，我可以在满足业务需求的情况下，和业务沟通，使用什么样的技术能更好的帮助业务创造收益，比如说下单的时候要进队列，可能几分钟之后订单状态才能处理完成，但是会让用户有更流畅的体验，赚取更多的访问流量，那么我相信业务愿意被技术驱动，会同意订单的延迟问题，这样便是技术驱动业务。</p>
<p>我相信大部分人还都处于业务驱动技术的方向吧。</p>
<p>所以你既然不能驱动业务，那就请拥抱业务变化吧。</p>
<p><strong>代码设计</strong></p>
<p>一直在做 Java 后端的项目，经常会有一些变动，我相信大家也都遇到过。</p>
<p>比如当我们写一段代码的时候，我们考虑将需求映射成代码的状态模式，突然有一天，状态模式里边又添加了很多行为变化的东西，这时候你就挠头了，你硬生生的将状态模式中添加过多行为和变化。</p>
<p>慢慢的你会发现这些状态模式，其实更像是一簇算法，应该使用策略模式，这时你应该已经晕头转向了。</p>
<p>说了这么多，我的意思是，只要你觉得合理，就请将状态模式改为策略模式吧，所有的模式并不是凭空想象出来的，都是基于重构。</p>
<p>Java 编程中没有银弹，请拥抱业务变化，一直思考重构，你就有一个更好的代码设计!</p>
<p><strong>你真的优秀吗？</strong></p>
<p>真不好意思，我取了一个这么无聊的标题。</p>
<p>国外流行一种编程方式，叫做结对编程，我相信国内很多公司都没有这么做，我就不在讲述结对编程带来的好处了，其实就是一边 code review，一边互相提高的一个过程。既然做不到这个，那如何让自己活在自己的世界中不断提高呢？</p>
<p>“平时开发的时候，做出的代码总认为是正确的，而且写法是完美的。”，我相信这是大部分人的心声，还回到刚刚的问题，如何在自己的世界中不断提高呢？</p>
<p>答案就是:</p>
<ol>
<li>多看成熟框架的源码</li>
<li>多回头看自己的代码</li>
<li>勤于重构</li>
</ol>
<p>你真的优秀吗？ 如果你每周都完成了学习源码，回头看自己代码，然后勤于重构，我认为你就真的很优秀了。</p>
<p>即使也许你只是刚刚入门，但是一直坚持，你就是一个真的会写java代码的程序员了。</p>
<h1 id="为什么要重构？"><a href="#为什么要重构？" class="headerlink" title="为什么要重构？"></a>为什么要重构？</h1><p>项目在不断演进过程中，代码不停地在堆砌。如果没有人为代码的质量负责，代码总是会往越来越混乱的方向演进。当混乱到一定程度之后，量变引起质变，项目的维护成本已经高过重新开发一套新代码的成本，想要再去重构，已经没有人能做到了。</p>
<p>造成这样的原因往往有以下几点：</p>
<ol>
<li>编码之前缺乏有效的设计</li>
<li>成本上的考虑，在原功能堆砌式编程</li>
<li>缺乏有效代码质量监督机制</li>
</ol>
<p>对于此类问题，业界已有有很好的解决思路：通过持续不断的重构将代码中的“坏味道”清除掉。</p>
<h1 id="什么是重构"><a href="#什么是重构" class="headerlink" title="什么是重构"></a>什么是重构</h1><p>重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。<br>重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。</p>
<p>根据重构的规模可以大致分为大型重构和小型重构：</p>
<p><strong>大型重构</strong>：对顶层代码设计的重构，包括：系统、模块、代码结构、类与类之间的关系等的重构，重构的手段有：分层、模块化、解耦、抽象可复用组件等等。这类重构的工具就是我们学习过的那些设计思想、原则和模式。这类重构涉及的代码改动会比较多，影响面会比较大，所以难度也较大，耗时会比较长，引入bug的风险也会相对比较大。</p>
<p><strong>小型重构</strong>：对代码细节的重构，主要是针对类、函数、变量等代码级别的重构，比如规范命名和注释、消除超大类或函数、提取重复代码等等。小型重构更多的是使用统一的编码规范。这类重构要修改的地方比较集中，比较简单，可操作性较强，耗时会比较短，引入bug的风险相对来说也会比较小。什么时候重构 新功能开发、修bug或者代码review中出现“代码坏味道”，我们就应该及时进行重构。持续在日常开发中进行小重构，能够降低重构和测试的成本。</p>
<p>代码的坏地方：</p>
<p><strong>代码重复</strong></p>
<ul>
<li>实现逻辑相同、执行流程相同</li>
</ul>
<p><strong>方法过长</strong></p>
<ul>
<li>方法中的语句不在同一个抽象层级</li>
<li>逻辑难以理解，需要大量的注释</li>
<li>面向过程编程而非面向对象</li>
</ul>
<p><strong>过大的类</strong></p>
<ul>
<li>类做了太多的事情</li>
<li>包含过多的实例变量和方法</li>
<li>类的命名不足以描述所做的事情</li>
</ul>
<p><strong>逻辑分散</strong></p>
<ul>
<li>发散式变化：某个类经常因为不同的原因在不同的方向上发生变化</li>
<li>散弹式修改：发生某种变化时，需要在多个类中做修改</li>
</ul>
<p><strong>严重的情结依恋</strong></p>
<ul>
<li>某个类的方法过多的使用其他类的成员</li>
</ul>
<p><strong>数据泥团/基本类型偏执</strong></p>
<ul>
<li>两个类、方法签名中包含相同的字段或参数</li>
<li>应该使用类但使用基本类型，比如表示数值与币种的Money类、起始值与结束值的Range类</li>
</ul>
<p><strong>不合理的继承体系</strong></p>
<ul>
<li>继承打破了封装性，子类依赖其父类中特定功能的实现细节</li>
<li>子类必须跟着其父类的更新而演变，除非父类是专门为了扩展而设计，并且有很好的文档说明</li>
</ul>
<p><strong>过多的条件判断</strong></p>
<p><strong>过长的参数列</strong></p>
<p><strong>临时变量过多</strong></p>
<p><strong>令人迷惑的暂时字段</strong></p>
<ul>
<li>某个实例变量仅为某种特定情况而设置</li>
<li>将实例变量与相应的方法提取到新的类中</li>
</ul>
<p><strong>纯数据类</strong></p>
<ul>
<li>仅包含字段和访问（读写）这些字段的方法</li>
<li>此类被称为数据容器，应保持最小可变性</li>
</ul>
<p><strong>不恰当的命名</strong></p>
<ul>
<li>命名无法准确描述做的事情</li>
<li>命名不符合约定俗称的惯例</li>
</ul>
<p><strong>过多的注释</strong></p>
<p>带来的问题：</p>
<ul>
<li><strong>难以复用</strong></li>
<li>系统关联性过多，导致很难分离可重用部分</li>
<li><strong>难于变化</strong></li>
<li>一处变化导致其他很多部分的修改，不利于系统稳定</li>
<li><strong>难于理解</strong></li>
<li>命名杂乱，结构混乱，难于阅读和理解</li>
<li><strong>难以测试</strong></li>
<li>分支、依赖较多，难以覆盖全面</li>
</ul>
<p>好代码的评价标准</p>
<p>可维护性、可读性、可扩展性</p>
<p>要写出高质量代码，我们就需要掌握一些更加细化、更加能落地的编程方法论，这就包含面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等。</p>
<h1 id="如何重构"><a href="#如何重构" class="headerlink" title="如何重构"></a>如何重构</h1><p><strong>SOLID原则</strong></p>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720141907210.png" alt="image-20210720141907210"></p>
<h3 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h3><p>一个类只负责完成一个职责或者功能，不要存在多于一种导致类变更的原因。</p>
<p>单一职责原则通过避免设计大而全的类，避免将不相关的功能耦合在一起，来提高类的内聚性。同时，类职责单一，类依赖的和被依赖的其他类也会变少，减少了代码的耦合性，以此来实现代码的高内聚、松耦合。但是，如果拆分得过细，实际上会适得其反，反倒会降低内聚性，也会影响代码的可维护性。</p>
<h3 id="开放-关闭原则"><a href="#开放-关闭原则" class="headerlink" title="开放-关闭原则"></a>开放-关闭原则</h3><p>添加一个新的功能，应该是通过在已有代码基础上扩展代码（新增模块、类、方法、属性等），而非修改已有代码（修改模块、类、方法、属性等）的方式来完成。</p>
<p>开闭原则并不是说完全杜绝修改，而是以最小的修改代码的代价来完成新功能的开发。</p>
<p>很多设计原则、设计思想、设计模式，都是以提高代码的扩展性为最终目的的。特别是 23 种经典设计模式，大部分都是为了解决代码的扩展性问题而总结出来的，都是以开闭原则为指导原则的。最常用来提高代码扩展性的方法有：多态、依赖注入、基于接口而非实现编程，以及大部分的设计模式（比如，装饰、策略、模板、职责链、状态）。</p>
<h3 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h3><p>子类对象（object of subtype/derived class）能够替换程序（program）中父类对象（object of base/parent class）出现的任何地方，并且保证原来程序的逻辑行为（behavior）不变及正确性不被破坏。</p>
<p>子类可以扩展父类的功能，但不能改变父类原有的功能</p>
<blockquote>
<p>父类中凡是已经实现好的方法（相对于抽象方法而言），实际上是在设定一系列的规范和契约，虽然它不强制要求所有的子类必须遵从这些契约，但是如果子类对这些非抽象方法任意修改，就会对整个继承体系造成破坏。</p>
</blockquote>
<h3 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h3><p>调用方不应该依赖它不需要的接口；一个类对另一个类的依赖应该建立在最小的接口上。接口隔离原则提供了一种判断接口的职责是否单一的标准：通过调用者如何使用接口来间接地判定。如果调用者只使用部分接口或接口的部分功能，那接口的设计就不够职责单一。</p>
<h3 id="依赖反转原则"><a href="#依赖反转原则" class="headerlink" title="依赖反转原则"></a>依赖反转原则</h3><p>高层模块不应该依赖低层模块，二者都应该依赖其抽象；抽象不应该依赖细节，细节应该依赖抽象。</p>
<h3 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h3><p>一个对象应该对其他对象保持最少的了解</p>
<h3 id="合成复用原则"><a href="#合成复用原则" class="headerlink" title="合成复用原则"></a>合成复用原则</h3><p>尽量使用合成/聚合的方式，而不是使用继承。</p>
<p>单一职责原则告诉我们实现类要职责单一；里氏替换原则告诉我们不要破坏继承体系；依赖倒置原则告诉我们要面向接口编程；接口隔离原则告诉我们在设计接口的时候要精简单一；迪米特法则告诉我们要降低耦合。而开闭原则是总纲，告诉我们要对扩展开放，对修改关闭。</p>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a><strong>设计模式</strong></h1><blockquote>
<p>设计模式：软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案。</p>
</blockquote>
<ul>
<li><strong>创建型</strong>：主要解决对象的创建问题，封装复杂的创建过程，解耦对象的创建代码和使用代码</li>
<li><strong>结构型</strong>：主要通过类或对象的不同组合，解耦不同功能的耦合</li>
<li><strong>行为型</strong>：主要解决的是类或对象之间的交互行为的耦合</li>
</ul>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720142318893.png" alt="image-20210720142318893"></p>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720142334301.png" alt="image-20210720142334301"></p>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720142346463.png" alt="image-20210720142346463"></p>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720142358859.png" alt="image-20210720142358859"></p>
<h1 id="代码分层"><a href="#代码分层" class="headerlink" title="代码分层"></a><strong>代码分层</strong></h1><p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720142117537.png" alt="image-20210720142117537"></p>
<p><strong>模块结构说明</strong></p>
<ul>
<li>server_main：配置层，负责整个项目的module管理，maven配置管理、资源管理等；</li>
<li>server_application：应用接入层，承接外部流量入口，例如：RPC接口实现、消息处理、定时任务等；不要在此包含业务逻辑；</li>
<li>server_biz：核心业务层，用例服务、领域实体、领域事件等</li>
<li>server_irepository：资源接口层，负责资源接口的暴露</li>
<li>server_repository：资源层，负责资源的proxy访问，统一外部资源访问，隔离变化。注意：这里强调的是弱业务性，强数据性；</li>
<li>server_common：公共层，vo、工具等</li>
</ul>
<p>代码开发要遵守各层的规范，并注意层级之间的依赖关系。</p>
<h1 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a><strong>命名规范</strong></h1><p>一个好的命名应该要满足以下两个约束：</p>
<ul>
<li>准确描述所做得事情</li>
<li>格式符合通用的惯例</li>
</ul>
<p>如果你觉得一个类或方法难以命名的时候，可能是其承载的功能太多了，需要进一步拆分。</p>
<h3 id="约定俗称的惯例"><a href="#约定俗称的惯例" class="headerlink" title="约定俗称的惯例"></a>约定俗称的惯例</h3><p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/640" alt="图片"></p>
<h3 id="类命名"><a href="#类命名" class="headerlink" title="类命名"></a>类命名</h3><blockquote>
<p>类名使用大驼峰命名形式，类命通常使用名词或名词短语。接口名除了用名词和名词短语以外，还可以使用形容词或形容词短语，如 Cloneable，Callable 等，表示实现该接口的类有某种功能或能力。</p>
</blockquote>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720143839909.png" alt="image-20210720143839909"></p>
<h3 id="方法命名"><a href="#方法命名" class="headerlink" title="方法命名"></a>方法命名</h3><blockquote>
<p>方法命名采用小驼峰的形式，首字小写，往后的每个单词首字母都要大写。和类名不同的是，方法命名一般为动词或动词短语，与参数或参数名共同组成动宾短语，即动词 + 名词。一个好的函数名一般能通过名字直接获知该函数实现什么样的功能。</p>
</blockquote>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720144034337.png" alt="image-20210720144034337"></p>
<h1 id="重构技巧"><a href="#重构技巧" class="headerlink" title="重构技巧"></a><strong>重构技巧</strong></h1><h3 id="提炼方法"><a href="#提炼方法" class="headerlink" title="提炼方法"></a>提炼方法</h3><p>多个方法代码重复、方法中代码过长或者方法中的语句不在一个抽象层级。<br>方法是代码复用的最小粒度，方法过长不利于复用，可读性低，提炼方法往往是重构工作的第一步。</p>
<p><strong>意图导向编程</strong>：把处理某件事的流程和具体做事的实现方式分开。</p>
<ul>
<li>把一个问题分解为一系列功能性步骤，并假定这些功能步骤已经实现</li>
<li>我们只需把把各个函数组织在一起即可解决这一问题</li>
<li>在组织好整个功能后，我们在分别实现各个方法函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** </span><br><span class="line">  * 1、交易信息开始于一串标准ASCII字符串。 </span><br><span class="line">  * 2、这个信息字符串必须转换成一个字符串的数组，数组存放的此次交易的领域语言中所包含的词汇元素（token)。 </span><br><span class="line">  * 3、每一个词汇必须标准化。 </span><br><span class="line">  * 4、包含超过150个词汇元素的交易，应该采用不同于小型交易的方式（不同的算法）来提交，以提高效率。 </span><br><span class="line">  * 5、如果提交成功，API返回”true”；失败，则返回”false”。 </span><br><span class="line">  *&#x2F;</span><br><span class="line">public class Transaction &#123;    </span><br><span class="line">  public Boolean commit(String command) &#123;        </span><br><span class="line">    Boolean result &#x3D; true;        </span><br><span class="line">    String[] tokens &#x3D; tokenize(command);        </span><br><span class="line">    normalizeTokens(tokens);        </span><br><span class="line">    if (isALargeTransaction(tokens)) &#123;            </span><br><span class="line">      result &#x3D; processLargeTransaction(tokens);        </span><br><span class="line">    &#125; else &#123;            </span><br><span class="line">      result &#x3D; processSmallTransaction(tokens);        </span><br><span class="line">    &#125;        </span><br><span class="line">    return result;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="以函数对象取代函数"><a href="#以函数对象取代函数" class="headerlink" title="以函数对象取代函数"></a>以函数对象取代函数</h3><p>将函数放进一个单独对象中，如此一来局部变量就变成了对象内的字段。然后你可以在同一个对象中将这个大型函数分解为多个小型函数。</p>
<h3 id="引入参数对象"><a href="#引入参数对象" class="headerlink" title="引入参数对象"></a>引入参数对象</h3><h3 id="方法参数比较多时，将参数封装为参数对象"><a href="#方法参数比较多时，将参数封装为参数对象" class="headerlink" title="方法参数比较多时，将参数封装为参数对象"></a>方法参数比较多时，将参数封装为参数对象</h3><h3 id="移除对参数的赋值"><a href="#移除对参数的赋值" class="headerlink" title="移除对参数的赋值"></a>移除对参数的赋值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public int discount(int inputVal, int quantity, int yearToDate) &#123;</span><br><span class="line">  if (inputVal &gt; 50) inputVal -&#x3D; 2;</span><br><span class="line">  if (quantity &gt; 100) inputVal -&#x3D; 1;</span><br><span class="line">  if (yearToDate &gt; 10000) inputVal -&#x3D; 4;</span><br><span class="line">  return inputVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int discount(int inputVal, int quantity, int yearToDate) &#123; </span><br><span class="line">  int result &#x3D; inputVal;</span><br><span class="line">  if (inputVal &gt; 50) result -&#x3D; 2; </span><br><span class="line">  if (quantity &gt; 100) result -&#x3D; 1; </span><br><span class="line">  if (yearToDate &gt; 10000) result -&#x3D; 4; </span><br><span class="line">  return result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将查询与修改分离"><a href="#将查询与修改分离" class="headerlink" title="将查询与修改分离"></a>将查询与修改分离</h3><p>任何有返回值的方法，都不应该有副作用</p>
<ul>
<li>不要在convert中调用写操作，避免副作用</li>
<li>常见的例外：将查询结果缓存到本地</li>
</ul>
<h3 id="移除不必要临时变量"><a href="#移除不必要临时变量" class="headerlink" title="移除不必要临时变量"></a>移除不必要临时变量</h3><p>临时变量仅使用一次或者取值逻辑成本很低的情况下</p>
<h3 id="引入解释性变量"><a href="#引入解释性变量" class="headerlink" title="引入解释性变量"></a>引入解释性变量</h3><p>将复杂表达式（或其中一部分）的结果放进一个临时变量，以此变量名称来解释表达式用途</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if ((platform.toUpperCase().indexOf(&quot;MAC&quot;) &gt; -1) </span><br><span class="line">    &amp;&amp; (browser.toUpperCase().indexOf(&quot;IE&quot;) &gt; -1) &amp;&amp; wasInitialized() &amp;&amp; resize &gt; 0) &#123;   </span><br><span class="line">  &#x2F;&#x2F; do something </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line">final boolean isMacOs &#x3D; platform.toUpperCase().indexOf(&quot;MAC&quot;) &gt; -1; </span><br><span class="line">final boolean isIEBrowser &#x3D; browser.toUpperCase().indexOf(&quot;IE&quot;) &gt; -1; </span><br><span class="line">final boolean wasResized &#x3D; resize &gt; 0; </span><br><span class="line">if (isMacOs &amp;&amp; isIEBrowser &amp;&amp; wasInitialized() &amp;&amp; wasResized) &#123;   </span><br><span class="line">  &#x2F;&#x2F; do something </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用卫语句替代嵌套条件判断"><a href="#使用卫语句替代嵌套条件判断" class="headerlink" title="使用卫语句替代嵌套条件判断"></a>使用卫语句替代嵌套条件判断</h3><p>把复杂的条件表达式拆分成多个条件表达式，减少嵌套。嵌套了好几层的if - then-else语句，转换为多个if语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;未使用卫语句</span><br><span class="line">public void getHello(int type) &#123;</span><br><span class="line">    if (type &#x3D;&#x3D; 1) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (type &#x3D;&#x3D; 2) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (type &#x3D;&#x3D; 3) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                setHello();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用卫语句</span><br><span class="line">public void getHello(int type) &#123;</span><br><span class="line">    if (type &#x3D;&#x3D; 1) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (type &#x3D;&#x3D; 2) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (type &#x3D;&#x3D; 3) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    setHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用多态替代条件判断断"><a href="#使用多态替代条件判断断" class="headerlink" title="使用多态替代条件判断断"></a>使用多态替代条件判断断</h3><p>当存在这样一类条件表达式，它根据对象类型的不同选择不同的行为。可以将这种表达式的每个分支放进一个子类内的复写函数中，然后将原始函数声明为抽象函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public int calculate(int a, int b, String operator) &#123;</span><br><span class="line">    int result &#x3D; Integer.MIN_VALUE;</span><br><span class="line"> </span><br><span class="line">    if (&quot;add&quot;.equals(operator)) &#123;</span><br><span class="line">        result &#x3D; a + b;</span><br><span class="line">    &#125; else if (&quot;multiply&quot;.equals(operator)) &#123;</span><br><span class="line">        result &#x3D; a * b;</span><br><span class="line">    &#125; else if (&quot;divide&quot;.equals(operator)) &#123;</span><br><span class="line">        result &#x3D; a &#x2F; b;</span><br><span class="line">    &#125; else if (&quot;subtract&quot;.equals(operator)) &#123;</span><br><span class="line">        result &#x3D; a - b;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当出现大量类型检查和判断时，if else（或switch）语句的体积会比较臃肿，这无疑降低了代码的可读性。 另外，if else（或switch）本身就是一个“变化点”，当需要扩展新的类型时，我们不得不追加if else（或switch）语句块，以及相应的逻辑，这无疑降低了程序的可扩展性，也违反了面向对象的开闭原则。</p>
<blockquote>
<p>基于这种场景，我们可以考虑使用“多态”来代替冗长的条件判断，将if else（或switch）中的“变化点”封装到子类中。这样，就不需要使用if else（或switch）语句了，取而代之的是子类多态的实例，从而使得提高代码的可读性和可扩展性。很多设计模式使用都是这种套路，比如策略模式、状态模式。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public interface Operation &#123; </span><br><span class="line">  int apply(int a, int b); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Addition implements Operation &#123; </span><br><span class="line">  @Override </span><br><span class="line">  public int apply(int a, int b) &#123; </span><br><span class="line">    return a + b; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class OperatorFactory &#123;</span><br><span class="line">    private final static Map&lt;String, Operation&gt; operationMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    static &#123;</span><br><span class="line">        operationMap.put(&quot;add&quot;, new Addition());</span><br><span class="line">        operationMap.put(&quot;divide&quot;, new Division());</span><br><span class="line">        &#x2F;&#x2F; more operators</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public static Operation getOperation(String operator) &#123;</span><br><span class="line">        return operationMap.get(operator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int calculate(int a, int b, String operator) &#123;</span><br><span class="line">    if (OperatorFactory .getOperation &#x3D;&#x3D; null) &#123;</span><br><span class="line">       throw new IllegalArgumentException(&quot;Invalid Operator&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return OperatorFactory .getOperation(operator).apply(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用异常替代返回错误码"><a href="#使用异常替代返回错误码" class="headerlink" title="使用异常替代返回错误码"></a>使用异常替代返回错误码</h3><p>非正常业务状态的处理，使用抛出异常的方式代替返回错误码</p>
<ul>
<li><p>不要使用异常处理用于正常的业务流程控制</p>
</li>
<li><ul>
<li>异常处理的性能成本非常高</li>
</ul>
</li>
<li><p>尽量使用标准异常</p>
</li>
<li><p>避免在finally语句块中抛出异常</p>
</li>
<li><ul>
<li>如果同时抛出两个异常，则第一个异常的调用栈会丢失</li>
<li>finally块中应只做关闭资源这类的事情</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;使用错误码</span><br><span class="line">public boolean withdraw(int amount) &#123;</span><br><span class="line">    if (balance &lt; amount) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        balance -&#x3D; amount;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用异常</span><br><span class="line">public void withdraw(int amount) &#123;</span><br><span class="line">    if (amount &gt; balance) &#123;</span><br><span class="line">        throw new IllegalArgumentException(&quot;amount too large&quot;);    </span><br><span class="line">    &#125;</span><br><span class="line">    balance -&#x3D; amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="引入断言"><a href="#引入断言" class="headerlink" title="引入断言"></a>引入断言</h3><p>某一段代码需要对程序状态做出某种假设，以断言明确表现这种假设。</p>
<ul>
<li>不要滥用断言，不要使用它来检查“应该为真”的条件，只使用它来检查“一定必须为真”的条件</li>
<li>如果断言所指示的约束条件不能满足，代码是否仍能正常运行？如果可以就去掉断言</li>
</ul>
<h3 id="引入Null对象或特殊对象"><a href="#引入Null对象或特殊对象" class="headerlink" title="引入Null对象或特殊对象"></a>引入Null对象或特殊对象</h3><p>当使用一个方法返回的对象时，而这个对象可能为空，这个时候需要对这个对象进行操作前，需要进行判空，否则就会报空指针。当这种判断频繁的出现在各处代码之中，就会影响代码的美观程度和可读性，甚至增加Bug的几率。</p>
<p>空引用的问题在Java中无法避免，但可以通过代码编程技巧（引入空对象）来改善这一问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;空对象的例子</span><br><span class="line">public class OperatorFactory &#123; </span><br><span class="line">  static Map&lt;String, Operation&gt; operationMap &#x3D; new HashMap&lt;&gt;(); </span><br><span class="line">  static &#123; </span><br><span class="line">    operationMap.put(&quot;add&quot;, new Addition()); </span><br><span class="line">    operationMap.put(&quot;divide&quot;, new Division()); </span><br><span class="line">    &#x2F;&#x2F; more operators </span><br><span class="line">  &#125; </span><br><span class="line">  public static Optional&lt;Operation&gt; getOperation(String operator) &#123; </span><br><span class="line">    return Optional.ofNullable(operationMap.get(operator)); </span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br><span class="line">public int calculate(int a, int b, String operator) &#123; </span><br><span class="line">  Operation targetOperation &#x3D; OperatorFactory.getOperation(operator) </span><br><span class="line">     .orElseThrow(() -&gt; new IllegalArgumentException(&quot;Invalid Operator&quot;)); </span><br><span class="line">  return targetOperation.apply(a, b); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;特殊对象的例子</span><br><span class="line">public class InvalidOp implements Operation &#123; </span><br><span class="line">  @Override </span><br><span class="line">  public int apply(int a, int b)  &#123; </span><br><span class="line">    throw new IllegalArgumentException(&quot;Invalid Operator&quot;);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="提炼类"><a href="#提炼类" class="headerlink" title="提炼类"></a>提炼类</h3><p>根据单一职责原则，一个类应该有明确的责任边界。但在实际工作中，类会不断的扩展。当给某个类添加一项新责任时，你会觉得不值得分离出一个单独的类。于是，随着责任不断增加，这个类包含了大量的数据和函数，逻辑复杂不易理解。</p>
<p>此时你需要考虑将哪些部分分离到一个单独的类中，可以依据高内聚低耦合的原则。如果某些数据和方法总是一起出现，或者某些数据经常同时变化，这就表明它们应该放到一个类中。另一种信号是类的子类化方式：如果你发现子类化只影响类的部分特性，或者类的特性需要以不同方式来子类化，这就意味着你需要分解原来的类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;原始类</span><br><span class="line">public class Person &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private String officeAreaCode;</span><br><span class="line">    private String officeNumber;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTelephoneNumber() &#123;</span><br><span class="line">        return (&quot;(&quot; + officeAreaCode + &quot;)&quot; + officeNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOfficeAreaCode() &#123;</span><br><span class="line">        return officeAreaCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOfficeAreaCode(String arg) &#123;</span><br><span class="line">        officeAreaCode &#x3D; arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getOfficeNumber() &#123;</span><br><span class="line">        return officeNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOfficeNumber(String arg) &#123;</span><br><span class="line">        officeNumber &#x3D; arg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;新提炼的类（以对象替换数据值）</span><br><span class="line">public class TelephoneNumber &#123;</span><br><span class="line">    private String areaCode;</span><br><span class="line">    private String number;</span><br><span class="line"></span><br><span class="line">    public String getTelephnoeNumber() &#123;</span><br><span class="line">        return (&quot;(&quot; + getAreaCode() + &quot;)&quot; + number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String getAreaCode() &#123;</span><br><span class="line">        return areaCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setAreaCode(String arg) &#123;</span><br><span class="line">        areaCode &#x3D; arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String getNumber() &#123;</span><br><span class="line">        return number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setNumber(String arg) &#123;</span><br><span class="line">        number &#x3D; arg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="组合优先于继承"><a href="#组合优先于继承" class="headerlink" title="组合优先于继承"></a>组合优先于继承</h3><p>继承使实现代码重用的有力手段，但这并非总是完成这项工作的最佳工具，使用不当会导致软件变得很脆弱。与方法调用不同的是，继承打破了封装性。子类依赖于其父类中特定功能的实现细节，如果父类的实现随着发行版本的不同而变化，子类可能会遭到破坏，即使他的代码完全没有改变。</p>
<p>举例说明，假设有一个程序使用HashSet，为了调优该程序的性能，需要统计HashSet自从它创建以来添加了多少个元素。为了提供该功能，我们编写一个HashSet的变体。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Inappropriate use of inheritance!</span><br><span class="line">public class InstrumentedHashSet&lt;E&gt; extends HashSet&lt;E&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; The number of attempted element insertions</span><br><span class="line">    private int addCount &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    public InstrumentedHashSet() &#123; &#125;</span><br><span class="line"></span><br><span class="line">    public InstrumentedHashSet(int initCap, float loadFactor) &#123;</span><br><span class="line">        super(initCap, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        addCount++;</span><br><span class="line">        return super.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        addCount +&#x3D; c.size();</span><br><span class="line">        return super.addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAddCount() &#123;</span><br><span class="line">        return addCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过在新的类中增加一个私有域，它引用现有类的一个实例，这种设计被称为组合，因为现有的类变成了新类的一个组件。这样得到的类将会非常稳固，它不依赖现有类的实现细节。即使现有的类添加了新的方法，也不会影响新的类。许多设计模式使用就是这种套路，比如代理模式、装饰者模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Reusable forwarding class</span><br><span class="line">public class ForwardingSet&lt;E&gt; implements Set&lt;E&gt; &#123;</span><br><span class="line">    private final Set&lt;E&gt; s;</span><br><span class="line">    public ForwardingSet(Set&lt;E&gt; s) &#123; this.s &#x3D; s; &#125;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    public int size() &#123; return s.size(); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean isEmpty() &#123; return s.isEmpty(); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean contains(Object o) &#123; return s.contains(o); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Iterator&lt;E&gt; iterator() &#123; return s.iterator(); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Object[] toArray() &#123; return s.toArray(); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public &lt;T&gt; T[] toArray(T[] a) &#123; return s.toArray(a); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean add(E e) &#123; return s.add(e); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean remove(Object o) &#123; return s.remove(o); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean containsAll(Collection&lt;?&gt; c) &#123; return s.containsAll(c); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean addAll(Collection&lt;? extends E&gt; c) &#123; return s.addAll(c); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean retainAll(Collection&lt;?&gt; c) &#123; return s.retainAll(c); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean removeAll(Collection&lt;?&gt; c) &#123; return s.removeAll(c); &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void clear() &#123; s.clear(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Wrappter class - uses composition in place of inheritance</span><br><span class="line">public class InstrumentedHashSet&lt;E&gt; extends ForwardingSet&lt;E&gt; &#123;</span><br><span class="line">    private int addCount &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    public InstrumentedHashSet1(Set&lt;E&gt; s) &#123;</span><br><span class="line">        super(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        addCount++;</span><br><span class="line">        return super.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean addAll(Collection&lt;? extends E&gt; c) &#123;</span><br><span class="line">        addCount +&#x3D; c.size();</span><br><span class="line">        return super.addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAddCount() &#123;</span><br><span class="line">        return addCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>继承与组合如何取舍</strong></p>
<ul>
<li>只有当子类真正是父类的子类型时，才适合继承。对于两个类A和B，只有两者之间确实存在“is-a”关系的时候，类B才应该继承A；</li>
<li>在包的内部使用继承是非常安全的，子类和父类的实现都处在同一个程序员的控制之下；</li>
<li>对于专门为了继承而设计并且具有很好的文档说明的类来说，使用继承也是非常安全的；</li>
<li>其他情况就应该优先考虑组合的方式来实现</li>
</ul>
<h3 id="接口优于抽象类"><a href="#接口优于抽象类" class="headerlink" title="接口优于抽象类"></a>接口优于抽象类</h3><p>Java提供了两种机制，可以用来定义允许多个实现的类型：接口和抽象类。自从Java8为接口增加缺省方法（default method），这两种机制都允许为实例方法提供实现。主要区别在于，为了实现由抽象类定义的类型，类必须称为抽象类的一个子类。因为Java只允许单继承，所以用抽象类作为类型定义受到了限制。</p>
<p>接口相比于抽象类的优势：</p>
<ul>
<li>现有的类可以很容易被更新，以实现新的接口。</li>
<li>接口是定义混合类型（比如Comparable）的理想选择。</li>
<li>接口允许构造非层次结构的类型框架。</li>
</ul>
<p>接口虽然提供了缺省方法，但接口仍有有以下局限性：</p>
<ul>
<li>接口的变量修饰符只能是public static final的</li>
<li>接口的方法修饰符只能是public的</li>
<li>接口不存在构造函数，也不存在this</li>
<li>可以给现有接口增加缺省方法，但不能确保这些方法在之前存在的实现中都能良好运行。</li>
<li>因为这些默认方法是被注入到现有实现中的，它们的实现者并不知道，也没有许可</li>
</ul>
<p>接口缺省方法的设计目的和优势在于：</p>
<p><strong>为了接口的演化</strong></p>
<ul>
<li>Java 8 之前我们知道，一个接口的所有方法其子类必须实现（当然，这个子类不是一个抽象类），但是 java 8 之后接口的默认方法可以选择不实现，如上的操作是可以通过编译期编译的。这样就避免了由 Java 7 升级到 Java 8 时项目编译报错了。Java8在核心集合接口中增加了许多新的缺省方法，主要是为了便于使用lambda。</li>
</ul>
<p><strong>可以减少第三方工具类的创建</strong></p>
<ul>
<li>例如在 List 等集合接口中都有一些默认方法，List 接口中默认提供 replaceAll(UnaryOperator)、sort(Comparator)、、spliterator()等默认方法，这些方法在接口内部创建，避免了为了这些方法而专门去创建相应的工具类。</li>
</ul>
<p><strong>可以避免创建基类</strong></p>
<ul>
<li>在 Java 8 之前我们可能需要创建一个基类来实现代码复用，而默认方法的出现，可以不必要去创建基类。</li>
</ul>
<p><strong>由于接口的局限性和设计目的的不同，接口并不能完全替换抽象类。但是通过对接口提供一个抽象的骨架实现类，可以把接口和抽象类的优点结合起来。</strong> 接口负责定义类型，或许还提供一些缺省方法，而骨架实现类则负责实现除基本类型接口方法之外，剩下的非基本类型接口方法。扩展骨架实现占了实现接口之外的大部分工作。这就是模板方法（Template Method）设计模式。</p>
<p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720144200655.png" alt="image-20210720144200655"></p>
<p>接口Protocol：定义了RPC协议层两个主要的方法，export暴露服务和refer引用服务</p>
<p>抽象类AbstractProtocol：封装了暴露服务之后的Exporter和引用服务之后的Invoker实例，并实现了服务销毁的逻辑</p>
<p>具体实现类XxxProtocol：实现export暴露服务和refer引用服务具体逻辑</p>
<h3 id="优先考虑泛型"><a href="#优先考虑泛型" class="headerlink" title="优先考虑泛型"></a>优先考虑泛型</h3><p>声明中具有一个或者多个类型参数（type parameter）的类或者接口，就是泛型（generic）类或者接口。泛型类和接口统称为泛型（generic type）。泛型从Java 5引入，提供了编译时类型安全检测机制。泛型的本质是参数化类型，通过一个参数来表示所操作的数据类型，并且可以限制这个参数的类型范围。泛型的好处就是编译期类型检测，避免类型转换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 比较三个值并返回最大值</span><br><span class="line">public static &lt;T extends Comparable&lt;T&gt;&gt; T maximum(T x, T y, T z) &#123;   </span><br><span class="line">  T max &#x3D; x; </span><br><span class="line">  &#x2F;&#x2F; 假设x是初始最大值   </span><br><span class="line">  if ( y.compareTo( max ) &gt; 0 ) &#123;      </span><br><span class="line">    max &#x3D; y; &#x2F;&#x2F;y 更大  </span><br><span class="line">  &#125;   if ( z.compareTo( max ) &gt; 0 ) &#123;     </span><br><span class="line">    max &#x3D; z; &#x2F;&#x2F; 现在 z 更大              </span><br><span class="line">  &#125;   return max; &#x2F;&#x2F; 返回最大对象</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main( String args[] ) &#123;   </span><br><span class="line">  System.out.printf( &quot;%d, %d 和 %d 中最大的数为 %d\n\n&quot;,  3, 4, 5, maximum( 3, 4, 5 ));   </span><br><span class="line">  System.out.printf( &quot;%.1f, %.1f 和 %.1f 中最大的数为 %.1f\n\n&quot;,  6.6, 8.8, 7.7,  maximum( 6.6, 8.8, 7.7 ));   </span><br><span class="line">  System.out.printf( &quot;%s, %s 和 %s 中最大的数为 %s\n&quot;,&quot;pear&quot;, &quot;apple&quot;, &quot;orange&quot;, maximum( &quot;pear&quot;, &quot;apple&quot;, &quot;orange&quot; ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="不要使用原生态类型"><a href="#不要使用原生态类型" class="headerlink" title="不要使用原生态类型"></a>不要使用原生态类型</h4><p>由于为了保持Java代码的兼容性，支持和原生态类型转换，并使用擦除机制实现的泛型。但是使用原生态类型就会失去泛型的优势，会受到编译器警告。</p>
<h4 id="要尽可能地消除每一个非受检警告"><a href="#要尽可能地消除每一个非受检警告" class="headerlink" title="要尽可能地消除每一个非受检警告"></a>要尽可能地消除每一个非受检警告</h4><p>每一条警告都表示可能在运行时抛出ClassCastException异常。要尽最大的努力去消除这些警告。如果无法消除但是可以证明引起警告的代码是安全的，就可以在尽可能小的范围中，使用＠SuppressWarnings(“unchecked”)注解来禁止警告，但是要把禁止的原因记录下来。</p>
<h4 id="利用有限制通配符来提升API的灵活性"><a href="#利用有限制通配符来提升API的灵活性" class="headerlink" title="利用有限制通配符来提升API的灵活性"></a>利用有限制通配符来提升API的灵活性</h4><p>参数化类型不支持协变的，即对于任何两个不同的类型Type1和Type2而言，List既不是List的子类型，也不是它的超类。为了解决这个问题，提高灵活性，Java提供了一种特殊的参数化类型，称作有限制的通配符类型，即List&lt;? extends E&gt;和List&lt;? super E&gt;。使用原则是producer-extends，consumer-super（PECS）。如果即是生产者，又是消费者，就没有必要使用通配符了。</p>
<p>还有一种特殊的无限制通配符List&lt;?&gt;，表示某种类型但不确定。常用作泛型的引用，不可向其添加除Null以外的任何对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;List&lt;? extends E&gt;</span><br><span class="line">&#x2F;&#x2F; Number 可以认为 是Number 的 &quot;子类&quot;</span><br><span class="line">List&lt;? extends Number&gt; numberArray &#x3D; new ArrayList&lt;Number&gt;(); </span><br><span class="line">&#x2F;&#x2F; Integer 是 Number 的子类</span><br><span class="line">List&lt;? extends Number&gt; numberArray &#x3D; new ArrayList&lt;Integer&gt;(); </span><br><span class="line">&#x2F;&#x2F; Double 是 Number 的子类</span><br><span class="line">List&lt;? extends Number&gt; numberArray &#x3D; new ArrayList&lt;Double&gt;();  </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;List&lt;? super E&gt;</span><br><span class="line">&#x2F;&#x2F; Integer 可以认为是 Integer 的 &quot;父类&quot;</span><br><span class="line">List&lt;? super Integer&gt; array &#x3D; new ArrayList&lt;Integer&gt;();、</span><br><span class="line">&#x2F;&#x2F; Number 是 Integer 的 父类</span><br><span class="line">List&lt;? super Integer&gt; array &#x3D; new ArrayList&lt;Number&gt;();</span><br><span class="line">&#x2F;&#x2F; Object 是 Integer 的 父类</span><br><span class="line">List&lt;? super Integer&gt; array &#x3D; new ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">public static &lt;T&gt; void copy(List&lt;? super T&gt; dest, List&lt;? extends T&gt; src) &#123;    </span><br><span class="line">  int srcSize &#x3D; src.size();    </span><br><span class="line">  if (srcSize &gt; dest.size())        </span><br><span class="line">   throw new IndexOutOfBoundsException(&quot;Source does not fit in dest&quot;);    </span><br><span class="line">  if (srcSize &lt; COPY_THRESHOLD || (src instanceof RandomAccess &amp;&amp; dest instanceof RandomAccess)) &#123;        </span><br><span class="line">    for (int i&#x3D;0; i&lt;srcSize; i++)            </span><br><span class="line">    dest.set(i, src.get(i));    </span><br><span class="line">  &#125; else &#123;        </span><br><span class="line">    ListIterator&lt;? super T&gt; di&#x3D;dest.listIterator();        </span><br><span class="line">    ListIterator&lt;? extends T&gt; si&#x3D;src.listIterator();        </span><br><span class="line">    for (int i&#x3D;0; i&lt;srcSize; i++) &#123;            </span><br><span class="line">      di.next();            </span><br><span class="line">      di.set(si.next());        </span><br><span class="line">    &#125;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="静态成员类优于非静态成员类"><a href="#静态成员类优于非静态成员类" class="headerlink" title="静态成员类优于非静态成员类"></a>静态成员类优于非静态成员类</h3><p>嵌套类（nested class）是指定义在另一个类的内部的类。<strong>嵌套类存在的目的只是为了它的外部类提供服务，如果其他的环境也会用到的话，应该成为一个顶层类（top-level class）。</strong> 嵌套类有四种：静态成员类（static member class）、非静态成员类（nonstatic member class）、匿名类（anonymous class）和 局部类（local class）。除了第一种之外，其他三种都称为内部类（inner class）。</p>
<h4 id="匿名类（anonymous-class）"><a href="#匿名类（anonymous-class）" class="headerlink" title="匿名类（anonymous class）"></a>匿名类（anonymous class）</h4><p>没有名字，声明的同时进行实例化，只能使用一次。当出现在非静态的环境中，会持有外部类实例的引用。通常用于创建函数对象和过程对象，不过现在会优先考虑lambda。</p>
<h4 id="局部类（local-class）"><a href="#局部类（local-class）" class="headerlink" title="局部类（local class）"></a>局部类（local class）</h4><p>任何可以声明局部变量的地方都可以声明局部类，同时遵循同样的作用域规则。跟匿名类不同的是，有名字可以重复使用。不过实际很少使用局部类。</p>
<h4 id="静态成员类（static-member-class）"><a href="#静态成员类（static-member-class）" class="headerlink" title="静态成员类（static member class）"></a>静态成员类（static member class）</h4><p>最简单的一种嵌套类，声明在另一个类的内部，是这个类的静态成员，遵循同样的可访问性规则。常见的用法是作为公有的辅助类，只有与它的外部类一起使用才有意义。</p>
<h4 id="非静态成员类（nonstatic-member-class）"><a href="#非静态成员类（nonstatic-member-class）" class="headerlink" title="非静态成员类（nonstatic member class）"></a>非静态成员类（nonstatic member class）</h4><p>尽管语法上，跟静态成员类的唯一区别就是类的声明不包含static，但两者有很大的不同。非静态成员类的每个实例都隐含地与外部类的实例相关联，可以访问外部类的成员属性和方法。另外必须先创建外部类的实例之后才能创建非静态成员类的实例。</p>
<p>总而言之，这四种嵌套类都有自己的用途。假设这个嵌套类属于一个方法的内部，如果只需要在一个地方创建实例，并且已经有了一个预置的类型可以说明这个类的特征，就要把它做成匿名类。如果一个嵌套类需要在单个方法之外仍然可见，或者它太长了，不适合放在方法内部，就应该使用成员类。如果成员类的每个实例都需要一个指向其外围实例的引用，就要把成员类做成非静态的，否则就做成静态的。</p>
<h3 id="优先使用模板-工具类"><a href="#优先使用模板-工具类" class="headerlink" title="优先使用模板/工具类"></a>优先使用模板/工具类</h3><p>通过对常见场景的代码逻辑进行抽象封装，形成相应的模板工具类，可以大大减少重复代码，专注于业务逻辑，提高代码质量。</p>
<h3 id="分离对象的创建与使用"><a href="#分离对象的创建与使用" class="headerlink" title="分离对象的创建与使用"></a>分离对象的创建与使用</h3><p>面向对象编程相对于面向过程，多了实例化这一步，而对象的创建必须要指定具体类型。我们常见的做法是“哪里用到，就在哪里创建”，使用实例和创建实例的是同一段代码。这似乎使代码更具有可读性，但是某些情况下造成了不必要的耦合。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public class BusinessObject &#123;</span><br><span class="line"> public void actionMethond &#123;</span><br><span class="line">     &#x2F;&#x2F;Other things</span><br><span class="line">     Service myServiceObj &#x3D; new Service();</span><br><span class="line">       myServiceObj.doService();</span><br><span class="line">       &#x2F;&#x2F;Other things</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BusinessObject &#123;</span><br><span class="line"> public void actionMethond &#123;</span><br><span class="line">     &#x2F;&#x2F;Other things</span><br><span class="line">     Service myServiceObj &#x3D; new ServiceImpl();</span><br><span class="line">       myServiceObj.doService();</span><br><span class="line">       &#x2F;&#x2F;Other things</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BusinessObject &#123;</span><br><span class="line">   private Service myServiceObj;</span><br><span class="line">   public BusinessObject(Service aService) &#123;</span><br><span class="line">       myServiceObj &#x3D; aService;</span><br><span class="line">    &#125;</span><br><span class="line"> public void actionMethond &#123;</span><br><span class="line">     &#x2F;&#x2F;Other things</span><br><span class="line">       myServiceObj.doService();</span><br><span class="line">       &#x2F;&#x2F;Other things</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BusinessObject &#123;</span><br><span class="line">   private Service myServiceObj;</span><br><span class="line">   public BusinessObject() &#123;</span><br><span class="line">       myServiceObj &#x3D; ServiceFactory;</span><br><span class="line">    &#125;</span><br><span class="line"> public void actionMethond &#123;</span><br><span class="line">     &#x2F;&#x2F;Other things</span><br><span class="line">       myServiceObj.doService();</span><br><span class="line">       &#x2F;&#x2F;Other things</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对象的创建者耦合的是对象的具体类型，而对象的使用者耦合的是对象的接口。也就是说，创建者关心的是这个对象是什么，而使用者关心的是它能干什么。这两者应该视为独立的考量，它们往往会因为不同的原因而改变。</p>
</blockquote>
<p>当对象的类型涉及多态、对象创建复杂（依赖较多）可以考虑将对象的创建过程分离出来，使得使用者不用关注对象的创建细节。设计模式中创建型模式的出发点就是如此，实际项目中可以使用工厂模式、构建器、依赖注入的方式。</p>
<h3 id="可访问性最小化"><a href="#可访问性最小化" class="headerlink" title="可访问性最小化"></a>可访问性最小化</h3><p>区分一个组件设计得好不好，一个很重要的因素在于，它对于外部组件而言，是否隐藏了其内部数据和实现细节。Java提供了访问控制机制来决定类、接口和成员的可访问性。实体的可访问性由该实体声明所在的位置，以及该实体声明中所出现的访问修饰符（private、protected、public）共同决定的。</p>
<p>对于顶层的（非嵌套的）类和接口，只有两种的访问级别：包级私有的（没有public修饰）和公有的（public修饰）。</p>
<p>对于成员（实例/域、方法、嵌套类和嵌套接口）由四种的访问级别，可访问性如下递增：</p>
<ul>
<li>私有的（private修饰）–只有在声明该成员的顶层类内部才可以访问这个成员；</li>
<li>包级私有的（默认）–声明该成员的包内部的任何类都可以访问这个成员；</li>
<li>受保护的（protected修饰）–声明该成员的类的子类可以访问这个成员，并且声明该成员的包内部的任何类也可以访问这个成员；</li>
<li>公有的（public修饰）–在任何地方都可以访问该成员；</li>
</ul>
<p>正确地使用这些修饰符对于实现信息隐藏是非常关键的，原则就是：尽可能地使每个类和成员不被外界访问（私有或包级私有）。这样好处就是在以后的发行版本中，可以对它进行修改、替换或者删除，而无须担心会影响现有的客户端程序。</p>
<ul>
<li>如果类或接口能够做成包级私有的，它就应该被做成包级私有的；</li>
<li>如果一个包级私有的顶层类或接口只是在某一个类的内部被用到，就应该考虑使它成为那个类的私有嵌套类；</li>
<li>公有类不应直接暴露实例域，应该提供相应的方法以保留将来改变该类的内部表示法的灵活性；</li>
<li>当确定了类的公有API之后，应该把其他的成员都变成私有的；</li>
<li>如果同一个包下的类之间存在比较多的访问时，就要考虑重新设计以减少这种耦合；</li>
</ul>
<h3 id="可变性最小化"><a href="#可变性最小化" class="headerlink" title="可变性最小化"></a>可变性最小化</h3><p>不可变类是指其实例不能被修改的类。每个实例中包含的所有信息都必须在创建该实例时提供，并在对象的整个生命周期内固定不变。不可变类好处就是简单易用、线程安全、可自由共享而不容易出错。Java平台类库中包含许多不可变的类，比如String、基本类型包装类、BigDecimal等。</p>
<p><strong>为了使类成为不可变，要遵循下面五条规则：</strong></p>
<ul>
<li><p>声明所有的域都是私有的</p>
</li>
<li><p>声明所有的域都是final的</p>
</li>
<li><ul>
<li><em>如果一个指向新创建实例的引用在缺乏同步机制的情况下，从一个线程被传递到另一个线程，就必须确保正确的行为</em></li>
</ul>
</li>
<li><p>不提供任何会修改对象状态的方法</p>
</li>
<li><p>保证类不会被扩展（防止子类化，类声明为final）</p>
</li>
<li><ul>
<li><em>防止粗心或者恶意的子类假装对象的状态已经改变，从而破坏该类的不可变行为</em></li>
</ul>
</li>
<li><p>确保对任何可变组件的互斥访问</p>
</li>
<li><ul>
<li><em>如果类具有指向可变对象的域，则必须确保该类的客户端无法获得指向这些对象的引用。并且，永远不要用客户端提供的对象引用来初始化这样的域，也不要从任何访问方法中返回该对象引用。在构造器、访问方法和readObject 方法中使用保护性拷贝技术</em></li>
</ul>
</li>
</ul>
<p><strong>可变性最小化的一些建议：</strong></p>
<ul>
<li>除非有很好的理由要让类成为可变的类，否则它就应该是不可变的；</li>
<li>如果类不能被做成不可变的，仍然应该尽可能地限制它的可变性；</li>
<li>除非有令人信服的理由要使域变成非final的，否则要使每个域都是private final的；</li>
<li>构造器应该创建完全初始化的对象，并建立起所有的约束关系；</li>
</ul>
<h1 id="质量如何保证"><a href="#质量如何保证" class="headerlink" title="质量如何保证"></a>质量如何保证</h1><h2 id="测试驱动开发"><a href="#测试驱动开发" class="headerlink" title="测试驱动开发"></a>测试驱动开发</h2><blockquote>
<p>测试驱动开发（TDD）要求以测试作为开发过程的中心，要求在编写任何代码之前，首先编写用于产码行为的测试，而编写的代码又要以使测试通过为目标。TDD要求测试可以完全自动化地运行，并在对代码重构前后必须运行测试。</p>
</blockquote>
<p>TDD的最终目标是整洁可用的代码（clean code that works）。大多数的开发者大部分时间无法得到整洁可用的代码。办法是分而治之。首先解决目标中的“可用”问题，然后再解决“代码的整洁”问题。这与体系结构驱动（architecture-driven）的开发相反。</p>
<p>采用TDD另一个好处就是让我们拥有一套伴随代码产生的详尽的自动化测试集。将来无论出于任何原因（需求、重构、性能改进）需要对代码进行维护时，在这套测试集的驱动下工作，我们代码将会一直是健壮的。</p>
<h2 id="TDD的开发周期"><a href="#TDD的开发周期" class="headerlink" title="TDD的开发周期"></a>TDD的开发周期</h2><p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720144601409.png" alt="image-20210720144601409"></p>
<p>添加一个测试 -&gt; 运行所有测试并检查测试结果 -&gt; 编写代码以通过测试 -&gt; 运行所有测试且全部通过 -&gt; 重构代码，以消除重复设计，优化设计结构</p>
<h2 id="两个基本的原则"><a href="#两个基本的原则" class="headerlink" title="两个基本的原则"></a>两个基本的原则</h2><ul>
<li>仅在测试失败时才编写代码并且只编写刚好使测试通过的代码</li>
<li>编写下一个测试之前消除现有的重复设计，优化设计结构</li>
</ul>
<p>关注点分离是这两条规则隐含的另一个非常重要的原则。其表达的含义指在编码阶段先达到代码“可用”的目标，在重构阶段再追求“整洁”目标，每次只关注一件事！</p>
<h2 id="分层测试点"><a href="#分层测试点" class="headerlink" title="分层测试点"></a>分层测试点</h2><p><img src="/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/image-20210720144618190.png" alt="image-20210720144618190"></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/10.7.%E5%85%B3%E4%BA%8E%E9%87%8D%E6%9E%84/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-12.2.SpringMVC" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/12.2.SpringMVC/">SpringMVC</a>
    </h1>
  

        
        <a href="/2021/04/17/12.2.SpringMVC/" class="archive-article-date">
  	<time datetime="2021-04-17T05:06:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring MVC是基于 Servlet 的一个 MVC 框架，主要解决 WEB 开发的问题。</p>
<p>2.2.2 用途介绍</p>
<p>Spring MVC是Spring的一部分，主要用于开发WEB应用和网络接口，它是Spring的一个模块，通过Dispatcher Servlet, ModelAndView 和 View Resolver，让应用开发变得很容易。</p>
<p>一个典型的Spring MVC应用开发分为下面几步：<br>首先通过配置文件声明Dispatcher Servlet：</p>
<p>通过配置文件声明servlet详情，如MVC resource，data source，bean等</p>
<p>若需添加其它功能，如security，则需添加对应配置：</p>
<p>增加业务代码，如controller，service，model等，最后生成war包，通过容器进行启动</p>
<p>2.2.3 SpringMVC常用注解</p>
<p>  @Controller</p>
<p>　　负责注册一个bean 到spring 上下文中<br>@RequestMapping</p>
<p>　　注解为控制器指定可以处理哪些 URL 请求<br>@RequestBody</p>
<p>　　该注解用于读取Request请求的body部分数据，使用系统默认配置的HttpMessageConverter进行解析，然后把相应的数据绑定到要返回的对象上 ,再把HttpMessageConverter返回的对象数据绑定到 controller中方法的参数上</p>
<p>@ResponseBody</p>
<p>　　 该注解用于将Controller的方法返回的对象，通过适当的HttpMessageConverter转换为指定格式后，写入到Response对象的body数据区</p>
<p>@ModelAttribute 　　</p>
<p>　　在方法定义上使用 @ModelAttribute 注解：Spring MVC 在调用目标处理方法前，会先逐个调用在方法级上标注了@ModelAttribute 的方法</p>
<p>　　在方法的入参前使用 @ModelAttribute 注解：可以从隐含对象中获取隐含的模型数据中获取对象，再将请求参数 –绑定到对象中，再传入入参将方法入参对象添加到模型中 </p>
<p>@RequestParam　</p>
<p>　　在处理方法入参处使用 @RequestParam 可以把请求参 数传递给请求方法</p>
<p>@PathVariable</p>
<p>　　绑定 URL 占位符到入参<br>@ExceptionHandler</p>
<p>　　注解到方法上，出现异常时会执行该方法<br>@ControllerAdvice</p>
<p>　　使一个Contoller成为全局的异常处理类，类中用@ExceptionHandler方法注解的方法可以处理所有Controller发生的异常</p>
<p>一、@RequestMapping 简介</p>
<p>在Spring MVC 中使用 @RequestMapping 来映射请求，也就是通过它来指定控制器可以处理哪些URL请求，相当于Servlet中在web.xml中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;servletName&lt;&#x2F;servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;ServletClass&lt;&#x2F;servlet-class&gt;</span><br><span class="line">&lt;&#x2F;servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;servletName&lt;&#x2F;servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;url&lt;&#x2F;url-pattern&gt;</span><br><span class="line">&lt;&#x2F;servlet-mapping&gt;</span><br></pre></td></tr></table></figure>

<p>的映射作用一致。让我们先看一下RequestMapping注解类的源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Mapping</span><br><span class="line">public @interface RequestMapping &#123;</span><br><span class="line">    String name() default &quot;&quot;;</span><br><span class="line">    String[] value() default &#123;&#125;;</span><br><span class="line">    String[] path() default &#123;&#125;;</span><br><span class="line">    RequestMethod[] method() default &#123;&#125;;</span><br><span class="line">    String[] params() default &#123;&#125;;</span><br><span class="line">    String[] headers() default &#123;&#125;;</span><br><span class="line">    String[] consumes() default &#123;&#125;;</span><br><span class="line">    String[] produces() default &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>produces:指定返回值类型，不但可以设置返回值类型还可以设定返回值的字符编码</p>
<p>consumes:指定处理请求的提交内容类型（Content-Type），例如application/json, text/html;</p>
<p>例子：</p>
<p>1.produces第一种使用，返回json数据，下边的代码可以省略produces属性，因为我们已经使用了注解@responseBody就是返回值是json数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Controller  </span><br><span class="line">@RequestMapping(value &#x3D; &quot;&#x2F;pets&#x2F;&#123;petId&#125;&quot;, method &#x3D; RequestMethod.GET, produces&#x3D;&quot;application&#x2F;json&quot;)  </span><br><span class="line">@ResponseBody  </span><br><span class="line">public Pet getPet(@PathVariable String petId, Model model) &#123;     </span><br><span class="line">    &#x2F;&#x2F; implementation omitted  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>produces第二种使用，返回json数据的字符编码为utf-8：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Controller  </span><br><span class="line">@RequestMapping(value &#x3D; &quot;&#x2F;pets&#x2F;&#123;petId&#125;&quot;, produces&#x3D;&quot;MediaType.APPLICATION_JSON_VALUE&quot;+&quot;;charset&#x3D;utf-8&quot;)  </span><br><span class="line">@ResponseBody  </span><br><span class="line">public Pet getPet(@PathVariable String petId, Model model) &#123;      </span><br><span class="line">    &#x2F;&#x2F; implementation omitted  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>2.consumes的例子（ 方法仅处理request Content-Type为“application/json”类型的请求。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Controller  </span><br><span class="line">@RequestMapping(value &#x3D; &quot;&#x2F;pets&quot;, method &#x3D; RequestMethod.POST, consumes&#x3D;&quot;application&#x2F;json&quot;)  </span><br><span class="line">public void addPet(@RequestBody Pet pet, Model model) &#123;      </span><br><span class="line">    &#x2F;&#x2F; implementation omitted  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>1）在@Target中有两个属性，分别为 ElementType.METHOD 和 ElementType.TYPE ，也就是说 @RequestMapping 可以在方法和类的声明中使用</p>
<p>2）可以看到注解中的属性除了 name() 返回的字符串，其它的方法均返回数组，也就是可以定义多个属性值，例如 value() 和 path() 都可以同时定义多个字符串值来接收多个URL请求</p>
<p>二、准备工作</p>
<p>1）新建一个 Web 工程，取名为 SpringMVC </p>
<p>略</p>
<p>2）新建一个的控制器类：UserController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package cn.kolbe.spring.mvc.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3）新建和配置 web.xml 以及 spring-mvc.xml 文件</p>
<p>4）新建一个测试的 JSP 页面 index.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;p&gt; &lt;a href&#x3D;&quot;#&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>5）新建一个成功跳转的页面 JSP 页面 welcome.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;Welcome&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>三、测试 @RequestMapping 中的 value 和 path 属性</p>
<p>（这两个属性作用相同，可以互换，如果仅有这一个属性，则可以省略，下面两个例子均采用省略的方式）</p>
<p>1）将 @RequestMapping 注解在 login 方法上，而UserController上不添加 @RequestMapping 注解，这时的请求 URL 是相对于 Web 根目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;login&quot;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时的方法 login() 能处理的 URL 请求路径是基于 Web 应用的，也就是 <a target="_blank" rel="noopener" href="http://localhost/SpringMVC/login%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF">http://localhost/SpringMVC/login，也就是</a> index.jsp 页面中的 User Login 链接地址应该是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;login&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>2）将 @RequestMapping 注解在 UserController 类上，这时类的注解是相对于 Web 根目录，而方法上的是相对于类上的路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;login&quot;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时的方法login()能处理的 URL 请求路径则是 <a target="_blank" rel="noopener" href="http://localhost/SpringMVC/user/login%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF">http://localhost/SpringMVC/user/login，也就是</a> index.jsp 页面中的 User Login 链接地址应该是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;user&#x2F;login&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>四、测试 @RequestMapping 的 method 属性</p>
<p>1）简介：@RequestMapping 中的 method 主要用来定义接收浏览器发来的何种请求。在Spring中，使用枚举类</p>
<p>org.springframework.web.bind.annotation.RequestMethod来定义浏览器请求的方式。</p>
<blockquote>
<p>Http规范定义了多种请求资源的方式，最基本的有四种，分别为：GET（查）、POST（增）、PUT（改）、DELETE（删），而URL则用于定位网络上的资源相当于地址的作用，配合四种请求方式，可以实现对URL对应的资源的增删改查操作。</p>
<p>在实际应用中，很多人并没有按照这个规范做，因为使用GET/POST同样可以完成PUT和DELETE操作，甚至GET也可以完成POST操作，因为GET不需要用到表单，而POST却需要通过表单来发送。</p>
</blockquote>
<p>2）通过 @RequestMapping(value=”/login”,method=RequestMethod.GET) 来指定 login()方法 仅处理通过 GET 方式发来的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时，如果浏览器发来的请求不是GET的话，将收到浏览器返回的错误提示，也就是得通过链接的方式而不是表单的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;user&#x2F;login&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>3）通过 @RequestMapping(value=”/login”,method=RequestMethod.POST) 来指定 login()方法 仅处理通过 POST 方式发来的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, method&#x3D;RequestMethod.POST)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时，必须通过表单的方式发送请求，否则将收到浏览器返回的错误提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;user&#x2F;login&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;使用Post发送请求&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>4）由于在 RequestMapping 注解类中 method() 方法返回的是 RequestMethod 数组，所以可以给 method 同时指定多个请求方式，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        &#x2F;&#x2F; 该方法将同时接收通过GET和POST方式发来的请求</span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, method&#x3D;&#123;RequestMethod.POST,RequestMethod.GET&#125;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>五、测试 @RequestMapping 的 params 属性，该属性表示请求参数，也就是追加在URL上的键值对，多个请求参数以&amp;隔开，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;SpringMVC&#x2F;user&#x2F;login?username&#x3D;kolbe&amp;password&#x3D;123456</span><br></pre></td></tr></table></figure>

<p>则这个请求的参数为username=kolbe以及password=123456，@RequestMapping 中可以使用 params 来限制请求参数，来实现进一步的过滤请求，举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 该方法将接收 &#x2F;user&#x2F;login 发来的请求，且请求参数必须为 username&#x3D;kolbe&amp;password&#x3D;123456</span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, params&#x3D;&#123;&quot;username&#x3D;kolbe&quot;,&quot;password&#x3D;123456&quot;&#125;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该例中则表示 UserController 中的 login() 方法仅处理 /user/login 发来的请求，且必须带有 username=kolbe&amp;password=123456 的请求参数，否则浏览器将返回HTTP 404的错误， 对应 index.jsp 中的键接地址为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;user&#x2F;login?username&#x3D;kolbe&amp;password&#x3D;123456&quot;&gt;User Login&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<p>六、测试 @RequestMapping 的 headers 属性，该属性表示请求头</p>
<blockquote>
<p>用于HTTP协义交互的信息被称为HTTP报文，客户端发送的HTTP报文被称为请求报文，服务器发回给客户端的HTTP报文称为响应报文，报文由报文头部和报文体组成。</p>
<p>请求头部（Request Headers）：请求头包含许多有关客户端环境和请求正文的信息，例如浏览器支持的语言、请求的服务器地址、客户端的操作系统等。</p>
<p>响应头部（Rsponse Headers）：响应头也包含许多有用的信息，包括服务器类型、日期、响应内容的类型及编码，响应内容的长度等等。</p>
</blockquote>
<p>如果你安装的是Chrome浏览器，可以通过在网页中  右击鼠标—-&gt;审查元素—-&gt;Network—-&gt;Name中点击网页—-&gt;右侧查看Headers即可，如果Name中没有出现网页，可以刷新一下即可，下边是我电脑中的一个请求头部示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Request Headers</span><br><span class="line">    Accept:text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">    Accept-Encoding:gzip, deflate, sdch</span><br><span class="line">    Accept-Language:zh-CN,zh;q&#x3D;0.8</span><br><span class="line">    Cache-Control:max-age&#x3D;0</span><br><span class="line">    Connection:keep-alive</span><br><span class="line">    Cookie:JSESSIONID&#x3D;210075B5E521CWE3CDE938076295A57A</span><br><span class="line">    Host:localhost:8080</span><br><span class="line">    Upgrade-Insecure-Requests:1</span><br><span class="line">    User-Agent:Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;45.0.2454.93 </span><br></pre></td></tr></table></figure>

<p>回规正题，通过 @RequestMapping 中的 headers 属性，可以限制客户端发来的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        &#x2F;&#x2F; 表示只接收本机发来的请求</span><br><span class="line">    @RequestMapping(path &#x3D; &quot;&#x2F;login&quot;, headers&#x3D;&quot;Host&#x3D;localhost:8080&quot;)</span><br><span class="line">    public String login() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>七、带占位符的URL</p>
<p>（一）带占位符的URL是Spring 3.0 新增的功能，可以通过 @PathVariable 将 URL 中的占位符绑定到控制器的处理方法的参数中，占位符使用{}括起来</p>
<p>（二）使用方法：</p>
<p>1）带占位符的URL示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">        </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">    public String show(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个控制器中 show() 方法将可以接收 user/1、user/2、user/3等等的路径请求，请求的方法必须为GET，使用 @PathVariable 为应用实现 REST 规范提供了具大的便利条件。</p>
<p>八、采用 REST 风格的 URL 请求</p>
<p>1）简介：REST（Representational State Transfer）：（资源）表现层状态转化，它是目前最流行的一种软件架构，其结构清晰、易于理解、扩展方便且符合标准，正在越来越多的被实践到应用中。</p>
<p>2）REST 风格的 URL 请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 请求路径        请求方法           作用</span><br><span class="line">-&#x2F;user&#x2F;1        HTTP GET        得到id为1的user</span><br><span class="line">-&#x2F;user&#x2F;1        HTTP DELETE     删除id为1的user</span><br><span class="line">-&#x2F;user&#x2F;1        HTTP PUT        更新id为1的user</span><br><span class="line">-&#x2F;user          HTTP POST       新增user</span><br></pre></td></tr></table></figure>

<p>3）由于浏览器表单只支持 GET 和 POST 请求，为了实现 DELETE 和 PUT 请求，Spring 为我们提供了一个过滤器org.springframework.web.filter.HiddenHttpMethodFilter，可以为我们将 GET 和 POST 请求通过过滤器转化成 DELETE 和 PUT 请求。</p>
<p>4）在 web.xml 中配置过滤器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置 org.springframework.web.filter.HiddenHttpMethodFilter 过滤器 --&gt;</span><br><span class="line">&lt;filter&gt;</span><br><span class="line">    &lt;filter-name&gt;hiddenHttpMethodFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">    &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;&#x2F;filter-class&gt;</span><br><span class="line">&lt;&#x2F;filter&gt;    </span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">    &lt;filter-name&gt;hiddenHttpMethodFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">    &lt;!-- 拦截所有请求 --&gt;</span><br><span class="line">    &lt;url-pattern&gt;&#x2F;*&lt;&#x2F;url-pattern&gt;</span><br><span class="line">&lt;&#x2F;filter-mapping&gt;</span><br></pre></td></tr></table></figure>

<p>5）由于浏览器表单无法发送 DELETE 和 PUT 请求，所以为了让 HiddenHttpMethodFilter 识别请求的方法，需要在表单中添加一个隐藏域，名字为 _method 值为 DELETE 或 POST 或PUT，修改后 index.jsp 页面代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">     &lt;!-- 得到id为1的user --&gt;</span><br><span class="line">    &lt;a href&#x3D;&quot;user&#x2F;1&quot;&gt;Test Rest GET&lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 新建id为1的user --&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;POST&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Test Rest POST&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 删除id为1的user --&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;user&#x2F;1&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;DELETE&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Test Rest DELETE&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 更新id为1的user --&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;user&#x2F;1&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;PUT&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Test Rest PUT&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>6）修改后的UserController代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package cn.kolbe.spring.mvc.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(path &#x3D; &quot;&#x2F;user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">    public String show(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        System.out.println(&quot;查看id为：&quot; + id + &quot;的user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.PUT)</span><br><span class="line">    public String update(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        System.out.println(&quot;更新id为：&quot; + id + &quot;的user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&#x2F;&#123;id&#125;&quot;, method&#x3D;RequestMethod.DELETE)</span><br><span class="line">    public String destroy(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">        System.out.println(&quot;删除id为：&quot; + id + &quot;的user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value&#x3D;&quot;&quot;, method&#x3D;RequestMethod.POST)</span><br><span class="line">    public String create() &#123;</span><br><span class="line">        System.out.println(&quot;新建user&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> 八、SpringMVC配置</span><br></pre></td></tr></table></figure>

<p>1、使用Maven的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2、在web.xml文件中配置Spring的DispatcherServlet用来拦截请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xmlns&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&quot; xmlns:jsp&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&#x2F;jsp&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&#x2F;web-app_3_0.xsd&quot;</span><br><span class="line">    version&#x3D;&quot;3.0&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 配置DispatcherServlet --&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;springDispatcherServlet&lt;&#x2F;servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;&#x2F;servlet-class&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 配置DispatcherServlet的一个初始化参数，作用是配置SpringMVC配置文件的位置和名称 --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;contextConfigLocation&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;!-- classpath表示类路径下的spring-mvc.xml文件 --&gt;</span><br><span class="line">            &lt;param-value&gt;classpath:spring-mvc.xml&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!-- load-on-startup 表示在web应用启动时，即加载该DispatcherServlet，而不是等到首次请求再中载 --&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;&#x2F;load-on-startup&gt;</span><br><span class="line">    &lt;&#x2F;servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springDispatcherServlet&lt;&#x2F;servlet-name&gt;</span><br><span class="line">        &lt;!-- 可以应答所有请求，也就是将所有的请求都交给Spring的DispatcherServlet来处理 --&gt;</span><br><span class="line">        &lt;url-pattern&gt;&#x2F;&lt;&#x2F;url-pattern&gt;</span><br><span class="line">    &lt;&#x2F;servlet-mapping&gt;</span><br><span class="line">&lt;&#x2F;web-app&gt;</span><br></pre></td></tr></table></figure>

<p>3、添加Spring MVC的配置文件取名为 spring-mvc.xml，用来加载web应用中的Spring Bean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">        http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context-4.2.xsd&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 自动扫描 cn.kolbe.spring.mvc 下的带有Spring组件注解的类 --&gt;</span><br><span class="line">    &lt;context:component-scan base-package&#x3D;&quot;cn.kolbe.spring.mvc&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置视图解析器：将控制器方法返回值解析为实际物理视图 --&gt;</span><br><span class="line">    &lt;bean class&#x3D;&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;!-- 假设控制器返回 success 字符串，该视图解析器将自动进行装配，具体的视图将为：</span><br><span class="line">            prefix + 返回的字符串 + suffix &#x3D; &#x2F;WEB-INF&#x2F;views&#x2F;success.jsp</span><br><span class="line">         --&gt;</span><br><span class="line">        &lt;!-- prefix表示前缀 --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;prefix&quot; value&#x3D;&quot;&#x2F;WEB-INF&#x2F;views&#x2F;&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;!-- suffix表示后缀 --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;suffix&quot; value&#x3D;&quot;.jsp&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<p>4、编写类HelloWorld，并通过添加注解 <a target="_blank" rel="noopener" href="http://my.oschina.net/u/1774615">@Controller</a> 将其标识为控制器，这里可以看出HelloWorld仅仅是一个普通的Java类，通过简单的注解，就可以将其解析为Servlet类来响应用户的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package cn.kolbe.spring.mvc.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class HelloWorld &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 1. 使用 @RequestMapping 注解来映射请求的URL（相当于web.xml中的servlet-mapping元素的url-pattern）</span><br><span class="line">     * 2. 返回值会通过视图解析器解析为实际的物理视图，具体看第三步中的InternalResourceViewResolver配置信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @RequestMapping(&quot;&#x2F;helloworld&quot;)</span><br><span class="line">    public String success() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、编写视图层的页面，这里就两个简单的页面，一个是index.jsp页面，一个是success.jsp页面</p>
<p>（一）index.jsp页面，路径是 /index.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;helloworld&quot;&gt;HelloWorld&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>6、success.jsp页面，路径是 /WEB-INF/views/success.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Spring MVC&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Welcome&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>









<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>@ControllerAdvice</p>
<p>增强的 Controller：</p>
<ol>
<li>全局异常处理</li>
<li>全局数据绑定</li>
<li>全局数据预处理</li>
</ol>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/12.2.SpringMVC/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-12.3.SpringBoot" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/12.3.SpringBoot/">SpringBoot</a>
    </h1>
  

        
        <a href="/2021/04/17/12.3.SpringBoot/" class="archive-article-date">
  	<time datetime="2021-04-17T05:05:53.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spring Boot 是基于Spring的一套快速开发整合包。</p>
<p>Spring Boot 简化了基于Spring的应用开发，只需要“run”就能创建一个独立的、生产级别的Spring应用。Spring Boot为Spring平台及第三方库提供开箱即用的设置（提供默认设置），这样我们就可以简单的开始。多数SpringBoot应用只需要很少的Spring配置。</p>
<p>2.3.2 用途介绍</p>
<p>Spring Boot的核心思想就是约定大于配置,一切自动完成。采用 Spring Boot可以大大的简化你的开发模式,所有你想集成的常用框架,它都有对应的组件支持。你甚至都不用额外的WEB容器，直接生成jar包执行即可，因为spring-boot-starter-web模块中包含有一个内置tomcat，可以直接提供容器使用；基于Spring Boot，不是说原来的配置没有了，而是Spring Boot有一套默认配置，我们可以把它看做比较通用的约定，而Spring Boot遵循的也是约定优于配置原则，同时，如果你需要使用到Spring以往提供的各种复杂但功能强大的配置功能，SpringBoot一样支持</p>
<p>在Spring Boot中，你会发现你引入的所有包都是starter形式，如：</p>
<p>·  spring-boot-starter-web-services，针对SOAP Web Services</p>
<p>·  spring-boot-starter-web，针对Web应用与网络接口</p>
<p>·  spring-boot-starter-jdbc，针对JDBC</p>
<p>·  spring-boot-starter-data-jpa，一套JPA应用框架</p>
<p>·  spring-boot-starter-cache，针对缓存支持</p>
<p>·  等等</p>
<p>Spring Boot对starter的解释如下：</p>
<p>Starters are a set of convenient dependency descriptors that you can include in your application. You get a one-stop-shop for all the Spring and related technology that you need, without having to hunt through sample code and copy paste loads of dependency descriptors. For example, if you want to get started using Spring and JPA for database access, just include the spring-boot-starter-data-jpa dependency in your project, and you are good to go</p>
<p>这句话的译意为：</p>
<p>Starters是一系列极其方便的依赖描述，通过在你的项目中包含这些starter，你可以一站式获得你所需要的服务，而无需像以往那样copy各种示例配置及代码，然后调试，真正做到开箱即用；比如你想使用Spring JPA进行数据操作，只需要在你的项目依赖中引入spring-boot-starter-data-jpa即可。</p>
<p>2.3.3 主要目标</p>
<p>1.为所有Spring的开发提供一个从根本上更快的入门体验</p>
<p>2.开箱即用，但通过自己设置参数，即可快速摆脱这种方式。</p>
<p>3.提供了一些大型项目中常见的非功能性特性，如内嵌服务器、安全、指标，健康检测、外部化配置等</p>
<p>4.绝对没有代码生成，也无需 XML 配置。</p>
<p>SpringBoot会使用内置的tomcat</p>
<p>SpringBoot的启动主要是通过实例化SpringApplication来启动的，启动过程主要做了以下几件事情：配置属性、获取监听器，发布应用开始启动事件初、始化输入参数、配置环境，输出banner、<strong>创建上下文</strong>、预处理上下文、<strong>刷新上下文</strong>、再刷新上下文、发布应用已经启动事件、发布应用启动完成事件。在SpringBoot中启动tomcat的工作在刷新上下这一步。而tomcat的启动主要是实例化两个组件：Connector、Container，一个tomcat实例就是一个Server，一个Server包含多个Service，也就是多个应用程序，每个Service包含多个Connector和一个Container，而一个Container下又包含多个子容器</p>
<h2 id="约定大于配置"><a href="#约定大于配置" class="headerlink" title="约定大于配置"></a>约定大于配置</h2><p>约定优于配置（convention over configuration），也称作按约定编程，是一种软件设计范式，旨在减少软件开发人员需做决定的数量，获得简单的好处，而又不失灵活性</p>
<p>1.开发人员仅需规定应用中不符合约定的部分<br>2.在没有规定配置的地方，采用默认配置，以力求最简配置为核心思想<br>总的来说，上面两条都遵循了推荐默认配置的思想。当存在特殊需求的时候，自定义配置即可。这样可以大大的减少配置工作，这就是所谓的“约定”。</p>
<p>spring boot中的约定：</p>
<p>1.Maven的目录结构。默认有resources文件夹,存放资源配置文件。src-main-resources,src-main-java。默认的编译生成的类都在targe文件夹下面<br>2.spring boot默认的配置文件必须是，也只能是application.命名的yml文件或者properties文件，且唯一<br>3.application.yml中默认属性。数据库连接信息必须是以spring: datasource: 为前缀；多环境配置。该属性可以根据运行环境自动读取不同的配置文件；端口号、请求路径等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"># 配置端口</span><br><span class="line">server:</span><br><span class="line">  port: 9005</span><br><span class="line">  servlet:</span><br><span class="line">    #context-path: &#x2F;api</span><br><span class="line">    application-display-name: swx</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: swx-wx-program</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">  mvc:</span><br><span class="line">    static-path-pattern: &#x2F;api&#x2F;swx&#x2F;data&#x2F;**</span><br><span class="line">  resources:</span><br><span class="line">    static-locations: classpath:&#x2F;METAINF&#x2F;resources&#x2F;,classpath:&#x2F;resources&#x2F;,classpath:&#x2F;static&#x2F;,classpath:&#x2F;public&#x2F;,file:$&#123;attachment.filePath&#125;</span><br><span class="line">  # 配置数据源</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;swx?useUnicode&#x3D;yes&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;true&amp;serverTimezone&#x3D;GMT%2B8</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    # 使用druid数据源</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">    #   数据源其他配置</span><br><span class="line">    initialSize: 5</span><br><span class="line">    minIdle: 5</span><br><span class="line">    maxActive: 20</span><br><span class="line">    maxWait: 60000</span><br><span class="line">    timeBetweenEvictionRunsMillis: 60000</span><br><span class="line">    minEvictableIdleTimeMillis: 300000</span><br><span class="line">    validationQuery: SELECT 1 FROM DUAL</span><br><span class="line">    testWhileIdle: true</span><br><span class="line">    testOnBorrow: false</span><br><span class="line">    testOnReturn: false</span><br><span class="line">    poolPreparedStatements: true</span><br><span class="line">  redis:</span><br><span class="line">    pool:</span><br><span class="line">      max-active: 8</span><br><span class="line">      max-wait: 3</span><br><span class="line">      max-idle: 8</span><br><span class="line">      min-idle: 0</span><br><span class="line">    timeout: 6000</span><br><span class="line">    host: 192.168.0.1</span><br><span class="line">    port: 6379</span><br><span class="line"></span><br><span class="line"># 关闭安全验证</span><br><span class="line">management:</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      enabled: true</span><br><span class="line">  security:</span><br><span class="line">    enabled: false</span><br><span class="line"># mybatis-plus相关配置</span><br><span class="line">mybatis-plus:</span><br><span class="line">  # xml扫描，多个目录用逗号或者分号分隔（告诉 Mapper 所对应的 XML 文件位置）</span><br><span class="line">  mapper-locations: classpath:**&#x2F;*Mapper.xml</span><br><span class="line">  # 以下配置均有默认值,可以不设置</span><br><span class="line">  global-config:</span><br><span class="line">    #主键类型  0:&quot;数据库ID自增&quot;, 1:&quot;用户输入ID&quot;,2:&quot;全局唯一ID (数字类型唯一ID)&quot;, 3:&quot;全局唯一ID UUID&quot;;</span><br><span class="line">    id-type: 0</span><br><span class="line">    #字段策略 0:&quot;忽略判断&quot;,1:&quot;非 NULL 判断&quot;),2:&quot;非空判断&quot;</span><br><span class="line">    field-strategy: 2</span><br><span class="line">    #驼峰下划线转换</span><br><span class="line">    db-column-underline: true</span><br><span class="line">    #刷新mapper 调试神器</span><br><span class="line">    refresh-mapper: false</span><br><span class="line">  configuration:</span><br><span class="line">    # 是否开启自动驼峰命名规则映射:从数据库列名到Java属性驼峰命名的类似映射</span><br><span class="line">    map-underscore-to-camel-case: true</span><br><span class="line">    cache-enabled: false</span><br><span class="line">    # 如果查询结果中包含空值的列，则 MyBatis 在映射的时候，不会映射这个字段</span><br><span class="line">    #call-setters-on-nulls: true</span><br><span class="line">    # 这个配置会将执行的sql在控制台打印出来，在开发或测试的时候可以用</span><br><span class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br><span class="line">    # 解决oracle更新数据为null时无法转换报错，mysql不会出现此情况</span><br><span class="line">    jdbc-type-for-null: &#39;null&#39;</span><br><span class="line"></span><br><span class="line">#请求服务器地址的基础路径</span><br><span class="line">baseUrl: </span><br><span class="line">#前端项目路径地址</span><br><span class="line">baseWebUrl: </span><br><span class="line"></span><br><span class="line">attachment:</span><br><span class="line">  filePath: &#x2F;swx&#x2F;data&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/image-20210816141410343.png" alt="image-20210816141410343"></p>
<h2 id="配置注解"><a href="#配置注解" class="headerlink" title="配置注解"></a><strong>配置注解</strong></h2><h3 id="主配置类"><a href="#主配置类" class="headerlink" title="主配置类"></a>主配置类</h3><h4 id="1-SpringBootApplication"><a href="#1-SpringBootApplication" class="headerlink" title="1.@SpringBootApplication"></a>1.@SpringBootApplication</h4><p>Spring boot的主配置类，Spring boot的启动类</p>
<p>@SpringBootApplication是一个复合注解，包含了@SpringBootConfiguration，@EnableAutoConfiguration，@ComponentScan这三个注解，大多数情况下，这3个注解会被同时使用，基于最佳实践，这三个注解就被做了包装@SpringBootApplication注解。</p>
<p>springboot中有着SpringBootServletInitializer这样一个组件，它关系着程序的初始化</p>
<p>Springboot启动项目方式:</p>
<p>1.application.xml启动</p>
<p>默认application启动，在创建项目时自动生成application启动类，直接run执行即可</p>
<p>2.使用外置tomcat启动</p>
<p>默认启动类要继承SpringBootServletInitiailzer类，并复写configure()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileuploadApplication</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SpringApplication.run(FileuploadApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder builder)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.configure(builder);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>需要添加本地tomcat并进行配置</p>
<p>SpringBootServletInitializer的执行过程，简单来说就是通过SpringApplicationBuilder构建并封装SpringApplication对象，并最终调用SpringApplication的run方法的过程。</p>
<p>spring boot就是为了简化开发的，也就是用注解的方式取代了传统的xml配置。</p>
<p>SpringBootServletInitializer就是原有的web.xml文件的替代。</p>
<p>使用了嵌入式Servlet,默认是不支持jsp。</p>
<p>SpringBootServletInitializer 可以使用外部的Servlet容器，使用步骤：</p>
<p>·必须创建war项目，需要创建好web项目的目录。</p>
<p>·嵌入式Tomcat依赖scope指定provided。</p>
<p>·编写SpringBootServletInitializer类子类,并重写configure方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class ServletInitializer extends SpringBootServletInitializer</span><br><span class="line">&#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected SpringApplicationBuilder configure(SpringApplicationBuilder application)</span><br><span class="line">    &#123;</span><br><span class="line">        return application.sources(SpringBoot04WebJspApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>·开始启动服务器。</p>
<p>jar包和war包启动区别</p>
<p>jar包:执行SpringBootApplication的run方法,启动IOC容器,然后创建嵌入式Servlet容器</p>
<p>war包: 先是启动Servlet服务器,服务器启动Springboot应用(springBootServletInitizer),然后启动IOC容器</p>
<p>SpringBootServletInitializer实例执行onStartup方法的时候会通过createRootApplicationContext方法来执行run方法，接下来的过程就同以jar包形式启动的应用的run过程一样了，在内部会创建IOC容器并返回，只是以war包形式的应用在创建IOC容器过程中，不再创建Servlet容器了。</p>
<h4 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h4><p>标注当前类是配置类<br>会将当前类内声明的一个或多个以@Bean注解标记的方法的实例纳入到srping容器中，并且实例名就是方法名 继承自@Configuration。</p>
<h4 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h4><p>自动配置的注解<br>自动配置的注解，根据我们添加的组件jar来完成一些默认配置 我们做微服时会添加spring-boot-starter-web这个组件jar的pom依赖，这样配置会默认配置springmvc 和tomcat</p>
<h4 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h4><p>扫描当前包及其子包下被@Component，@Controller，@Service，@Repository<br>扫描当前包及其子包下被@Component，@Controller，@Service，@Repository注解标记的类并纳入到spring容器中进行管理。 等价于context:component-scan的xml配置文件中的配置项</p>
<h4 id="2-ServletComponentScan"><a href="#2-ServletComponentScan" class="headerlink" title="2.@ServletComponentScan"></a>2.@ServletComponentScan</h4><p>filter的实现，用在Spring boot的启动类</p>
<p>Servlet、Filter、Listener 可以直接通过 @WebServlet、@WebFilter、@WebListener 注解自动注册，这样通过注解servlet ，拦截器，监听器的功能而无需其他配置，所以项目中使用到了filter的实现，用到了这个注解。</p>
<h4 id="3-MapperScan-“dao路径”"><a href="#3-MapperScan-“dao路径”" class="headerlink" title="3.@MapperScan(“dao路径”)"></a>3.@MapperScan(“dao路径”)</h4><p>整合Mybatis，用在Spring boot的启动类    @mapper</p>
<p>@Mapper注解与@MapperScan注解有什么关联呢？</p>
<ol>
<li>使用@Mapper，最终Mybatis会有一个拦截器，会自动的把@Mapper注解的接口生成动态代理类。</li>
<li>使用@MapperScan配置一个或多个包路径，自动的扫描这些包路径下的类，自动的为它们生成动态代理类。</li>
<li>@Mapper注解针对的是一个接口一个接口的使用，太麻烦了。</li>
<li>@MapperScan注解针对的是一个或多个包中的所有接口，相比@Mapper注解来说非常简单。</li>
</ol>
<h4 id="4-EnableScheduling"><a href="#4-EnableScheduling" class="headerlink" title="4.@EnableScheduling"></a>4.@EnableScheduling</h4><p>允许schedul定时任务，表明此类是一个定时计划类</p>
<p>@Scheduled(fixedRate = 5000) ：要执行的具体计划任务</p>
<p>参数</p>
<p>1.cron:cron表达式语句</p>
<p>2.zone:时区，接收一个java.util.TimeZone#ID。默认空字符串，即取服务器所在的时区</p>
<p>3.fixedDelay：上一次执行完毕多长时间点后多长时间再执行</p>
<p>4.fixedDelayString：与fixedDelay意思相同，只是使用字符串的形式，支持占位符</p>
<p>5.fixedRate：与上一次开始执行时间点之后多长时间再执行</p>
<p>6.fixedRateString：与fixedRate意思相同，只是使用字符串的形式，支持占位符</p>
<p>7.initialDelay：第一次延迟多长时间后再执行</p>
<p>8.initialDelayString :与initialDelay意思相同，只是使用字符串的形式，支持占位符</p>
<h4 id="5-EnableCaching"><a href="#5-EnableCaching" class="headerlink" title="5.@EnableCaching"></a>5.@EnableCaching</h4><p>使用缓存</p>
<h4 id="6-EnableTransactionManagement"><a href="#6-EnableTransactionManagement" class="headerlink" title="6.@EnableTransactionManagement"></a>6.@EnableTransactionManagement</h4><p>开启事务注解支持</p>
<h3 id="单元测试常用注解"><a href="#单元测试常用注解" class="headerlink" title="单元测试常用注解"></a>单元测试常用注解</h3><h4 id="RunWith-SpringJUnit4ClassRunner-class-、-SpringRunner-class"><a href="#RunWith-SpringJUnit4ClassRunner-class-、-SpringRunner-class" class="headerlink" title="@RunWith(SpringJUnit4ClassRunner.class)、(SpringRunner.class)"></a>@RunWith(SpringJUnit4ClassRunner.class)、(SpringRunner.class)</h4><p>测试类，让测试运行于Spring测试环境。<br>SpringRunner 继承了SpringJUnit4ClassRunner，没有扩展任何功能；使用SpringRunner，名字简短而已</p>
<h4 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a>@SpringBootTest</h4><p>Springboot环境下测试</p>
<h4 id="Test"><a href="#Test" class="headerlink" title="@Test"></a>@Test</h4><p>junit单元测试，单元测试方法上    ，方法要求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void 方法名() &#123;&#125;     &#x2F;&#x2F;公共方法、无返回值、方法无参数</span><br></pre></td></tr></table></figure>

<pre><code>@Ignore：表示这个方法不进行单元测试
@Before: 在每个方法执行运行
@After：在每个方法之后运行
</code></pre>
<h4 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h4><p>预加载，测试方法前        </p>
<h4 id="WebAppConfiguration"><a href="#WebAppConfiguration" class="headerlink" title="@WebAppConfiguration"></a>@WebAppConfiguration</h4><p>web应用测试</p>
<h3 id="Controller常用注解"><a href="#Controller常用注解" class="headerlink" title="Controller常用注解"></a>Controller常用注解</h3><h4 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h4><p>用于Controller标识，@Controller 和@ResponseBody的结合<br>@Controller 表明这个类是一个控制器类，和 @RequestMapping 来配合使用拦截请求，如果不在method中注明请求的方式，默认是拦截get和post请求。这样请求会完成后转向一个视图解析器。但是在大多微服务搭建的时候，前后端会做分离。所以请求后端只关注数据处理，后端返回json数据的话，需要配合 @ResponseBody 注解来完成。</p>
<h4 id="GetMapping、PostMapping、PutMapping、DeleteMapping"><a href="#GetMapping、PostMapping、PutMapping、DeleteMapping" class="headerlink" title="@GetMapping、PostMapping、PutMapping、DeleteMapping"></a>@GetMapping、PostMapping、PutMapping、DeleteMapping</h4><p>rest风格</p>
<table>
<thead>
<tr>
<th>普通风格</th>
<th>Rest风格</th>
</tr>
</thead>
<tbody><tr>
<td>@RequestMapping(value=“”,method = RequestMethod.GET)</td>
<td>@GetMapping(value =“”)</td>
</tr>
</tbody></table>
<p>@GetMapping    Get请求<br>@PostMapping    Post请求<br>@PutMapping    订单确认<br>@DeleteMapping    取消订单</p>
<h4 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h4><p>按类型自动注入</p>
<h3 id="Restful之swagger"><a href="#Restful之swagger" class="headerlink" title="Restful之swagger"></a>Restful之swagger</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- swagger是当前最好用的Restful --&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">     &lt;version&gt;$&#123;swagger2.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line"> &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;swagger2.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Api-value-“订单Controller”-tags-“订单Controller”"><a href="#Api-value-“订单Controller”-tags-“订单Controller”" class="headerlink" title="@Api(value = “订单Controller”, tags = {“订单Controller”})"></a>@Api(value = “订单Controller”, tags = {“订单Controller”})</h4><p>value - 字段说明，description - 注释说明这个类</p>
<h4 id="ApiOperation-value-“订单确认接口”"><a href="#ApiOperation-value-“订单确认接口”" class="headerlink" title="@ApiOperation(value = “订单确认接口”)"></a>@ApiOperation(value = “订单确认接口”)</h4><p>在restful风格方法上配合使用<br>@ApiOperation(value = “订单取消接口”)<br>@DeleteMapping(value = “/order/{orderId}”)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">作用范围			API									使用位置</span><br><span class="line">对象属性			@ApiModelProperty					用在参数对象的字段上</span><br><span class="line">协议集描述		    @Api							    用在Conntroller类上</span><br><span class="line">协议描述			@ApiOperation						用在controller方法上</span><br><span class="line">Response集		  @ApiResponses						  用在controller方法上</span><br><span class="line">Response	       @ApiResponse							用在@ApiResponses里面</span><br><span class="line">非对象参数集			@ApilmplicitParams					用在controller方法上</span><br><span class="line">非对象参数描述			@ApiImplicitParam					用在@ApiImplicitParams的方法里边</span><br><span class="line">描述返回对象的意义		@ApiModel							用在返回对象类上</span><br></pre></td></tr></table></figure>

<h3 id="配置文件相关"><a href="#配置文件相关" class="headerlink" title="配置文件相关"></a>配置文件相关</h3><h4 id="Value-“-spring-datasource-druid-url-”"><a href="#Value-“-spring-datasource-druid-url-”" class="headerlink" title="@Value(“${spring.datasource.druid.url}”)"></a>@Value(“${spring.datasource.druid.url}”)</h4><p>注入配置文件中的值</p>
<p>​        </p>
<h4 id="ImportResource-Import-PropertySource"><a href="#ImportResource-Import-PropertySource" class="headerlink" title="@ImportResource         @Import        @PropertySource"></a>@ImportResource         @Import        @PropertySource</h4><p>用来导入自定义的一些配置文件</p>
<h4 id="ImportResource-locations-导入其他xml配置文件，需要标准在主配置类上。"><a href="#ImportResource-locations-导入其他xml配置文件，需要标准在主配置类上。" class="headerlink" title="@ImportResource(locations={}) 导入其他xml配置文件，需要标准在主配置类上。"></a>@ImportResource(locations={}) 导入其他xml配置文件，需要标准在主配置类上。</h4><p>导入property的配置文件 @PropertySource指定文件路径，这个相当于使用spring的标签来完成配置项的引入。</p>
<p>@import注解是一个可以将普通类导入到spring容器中做管理</p>
<h4 id="EnableAsync-proxyTargetClass-true"><a href="#EnableAsync-proxyTargetClass-true" class="headerlink" title="@EnableAsync(proxyTargetClass = true)"></a>@EnableAsync(proxyTargetClass = true)</h4><p>异步代理，构建异步线程池</p>
<p>使用@EnableAsync来开启异步的支持，使用@Async来对某个方法进行异步执行</p>
<p>在定时器里可以设置多个不同线程的任务同时完成不同的事情</p>
<h4 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h4><p>配置类</p>
<h4 id="Bean-“analysisExecutor”"><a href="#Bean-“analysisExecutor”" class="headerlink" title="@Bean(“analysisExecutor”)"></a>@Bean(“analysisExecutor”)</h4><p>相当于<bean></bean>，标注在方法上，方法返回值就是bean类型，bean的id默认为方法名，可以通过给@bean注解加value属性值改变id。</p>
<h4 id="Aspect"><a href="#Aspect" class="headerlink" title="@Aspect"></a>@Aspect</h4><p>切面，事务</p>
<h4 id="Scope-“prototype”"><a href="#Scope-“prototype”" class="headerlink" title="@Scope(“prototype”)"></a>@Scope(“prototype”)</h4><p>bean的作用范围，多例，httpclientConfig</p>
<h4 id="EnableRedisHttpSession-maxInactiveIntervalInSeconds-1800-redisFlushMode-RedisFlushMode-ON-SAVE-redisNamespace-“dscSession”"><a href="#EnableRedisHttpSession-maxInactiveIntervalInSeconds-1800-redisFlushMode-RedisFlushMode-ON-SAVE-redisNamespace-“dscSession”" class="headerlink" title="@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800,redisFlushMode = RedisFlushMode.ON_SAVE, redisNamespace = “dscSession”)"></a>@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800,redisFlushMode = RedisFlushMode.ON_SAVE, redisNamespace = “dscSession”)</h4><p>redissession 默认30分钟失效</p>
<h4 id="EnableWebMvc"><a href="#EnableWebMvc" class="headerlink" title="@EnableWebMvc"></a>@EnableWebMvc</h4><p>用于spring mvc 配置类，启用springmvc</p>
<h4 id="EnableSwagger2"><a href="#EnableSwagger2" class="headerlink" title="@EnableSwagger2"></a>@EnableSwagger2</h4><p>restful风格，使用Swagger2</p>
<h3 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h3><p>@Param(“ids”) Integer[] ids, @Param(“userId”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper接口中有多个参数</span><br></pre></td></tr></table></figure>

<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><h4 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h4><p>全局异常处理<br>全局数据绑定<br>全局数据预处理</p>
<h4 id="ExceptionHandler-BindException-class"><a href="#ExceptionHandler-BindException-class" class="headerlink" title="@ExceptionHandler(BindException.class)"></a>@ExceptionHandler(BindException.class)</h4><p>1、@ExceptionHandler不需要写在目标方法上，而是写在通知处理方法上<br>2、@ExceptionHandler自动拦截所设置的异常  作用范围这个controller,<br>—这种情况一般定义个父类，然后每个controller继承即可</p>
<h3 id="lombok插件使用"><a href="#lombok插件使用" class="headerlink" title="lombok插件使用"></a>lombok插件使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h4><p>首先在idea中安装lombok插件<br>@Data : 注解在类上,<br>就不用再去手写Getter,Setter,equals,canEqual,hasCode,toString等方法了，<br>注解后在编译时会自动加进去</p>
<h4 id="NoArgsConstructor-Getter-Setter"><a href="#NoArgsConstructor-Getter-Setter" class="headerlink" title="@NoArgsConstructor     @Getter      @Setter"></a>@NoArgsConstructor     @Getter      @Setter</h4><p>使用后创建一个无参构造函数、getter、setter</p>
<h4 id="AllArgsConstructor"><a href="#AllArgsConstructor" class="headerlink" title="@AllArgsConstructor"></a>@AllArgsConstructor</h4><p>使用后添加一个构造函数，该构造函数含有所有已声明字段属性参数</p>
<h4 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h4><p>关于Builder较为复杂一些，Builder的作用之一是为了解决在某个类有很多构造函数的情况，也省去写很多构造函数的麻烦，<br>在设计模式中的思想是：用一个内部类去实例化一个对象，避免一个类出现过多构造函数，</p>
<h4 id="Accessors"><a href="#Accessors" class="headerlink" title="@Accessors"></a>@Accessors</h4><p>存取器。通过该注解可以控制getter和setter方法的形式，默认为false</p>
<p>1.fluent为一个布尔值，如果为true生成的get/set方法则没有set/get前缀，默认为false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@Accessors(fluent &#x3D; true)</span><br><span class="line">class User &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 生成的getter和setter方法如下，方法体略</span><br><span class="line">    public Integer id()&#123;&#125;</span><br><span class="line">    public User id(Integer id)&#123;&#125;</span><br><span class="line">    public String name()&#123;&#125;</span><br><span class="line">    public User name(String name)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.chain为一个布尔值，如果为true生成的set方法返回this，为false生成的set方法是void类型。默认为false，除非当fluent为true时，chain默认则为true。<br>这个比较常用，由于set方法返回的是this对象，常用来实现链式编程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.setName(&quot;张三&quot;).setAge(12).setHeight(175)</span><br></pre></td></tr></table></figure>

<p>3.prefix为一系列string类型，可以指定前缀，生成get/set方法时会去掉指定的前缀</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Accessors(prefix &#x3D; &quot;m&quot;)</span><br><span class="line">public class MyClass &#123;</span><br><span class="line">    @Getter</span><br><span class="line">    private int mNum;</span><br><span class="line">&#125;</span><br><span class="line">生成的get方法为getNum()，而不是getMNum()</span><br></pre></td></tr></table></figure>



<h3 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h3><h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><h4 id="ConditionalOnProperty-prefix-“dsc”-name-“ticketWatcherMaster”-havingValue-“true”"><a href="#ConditionalOnProperty-prefix-“dsc”-name-“ticketWatcherMaster”-havingValue-“true”" class="headerlink" title="@ConditionalOnProperty(prefix = “dsc”, name=“ticketWatcherMaster”, havingValue = “true”)"></a>@ConditionalOnProperty(prefix = “dsc”, name=“ticketWatcherMaster”, havingValue = “true”)</h4><p>监控转换队列是否有超时ticket,如果超时自动补偿ticket</p>
<h4 id="Scheduled-cron-“0-0-2-”"><a href="#Scheduled-cron-“0-0-2-”" class="headerlink" title="@Scheduled(cron = “0 0/2 * * * ?”)"></a>@Scheduled(cron = “0 0/2 * * * ?”)</h4><p>定期监控,补偿超时的ticket,2分钟执行一次,延迟60秒启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*&quot;0 0 12 * * ?&quot; 每天中午十二点触发 </span><br><span class="line">&quot;0 15 10 ? * *&quot; 每天早上10：15触发 </span><br><span class="line">&quot;0 15 10 * * ?&quot; 每天早上10：15触发 </span><br><span class="line">&quot;0 15 10 * * ? *&quot; 每天早上10：15触发 </span><br><span class="line">&quot;0 15 10 * * ? 2005&quot; 2005年的每天早上10：15触发</span><br><span class="line">&quot;0 * 14 * * ?&quot; 每天从下午2点开始到2点59分每分钟一次触发 </span><br><span class="line">&quot;0 0&#x2F;5 14 * * ?&quot; 每天从下午2点开始到2：55分结束每5分钟一次触发</span><br><span class="line">&quot;0 0&#x2F;5 14,18 * * ?&quot; 每天的下午2点至2：55和6点至6点55分两个时间段内每5分钟一次触发 </span><br><span class="line">&quot;0 0-5 14 * * ?&quot;  每天14:00至14:05每分钟一次触发 </span><br><span class="line">&quot;0 10,44 14 ? 3 WED&quot; 三月的每周三的14：10和14：44触发 </span><br><span class="line">&quot;0 15 10 ? * MON-FRI&quot; 每个周一、周二、周三、周四、周五的10：15触发 </span><br><span class="line">&quot;0 15 10 15 * ?&quot; 每月15号的10：15触发 </span><br><span class="line">&quot;0 15 10 L * ?&quot; 每月的最后一天的10：15触发 </span><br><span class="line">&quot;0 15 10 ? * 6L&quot; 每月最后一个周五的10：15触发 </span><br><span class="line">&quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月最后一个周五的10：15触发</span><br><span class="line">&quot;0 15 10 ? * 6#3&quot; 每月的第三个周五的10：15触发*&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="WebListener"><a href="#WebListener" class="headerlink" title="@WebListener"></a>@WebListener</h4><p>启动监听器 web监听</p>
<h3 id="事务通知"><a href="#事务通知" class="headerlink" title="事务通知"></a>事务通知</h3><h4 id="Pointcut-value-“execution-com-yozo-dsc-web…-…-”"><a href="#Pointcut-value-“execution-com-yozo-dsc-web…-…-”" class="headerlink" title="@Pointcut(value = “execution(* com.yozo.dsc.web….(…))”)"></a>@Pointcut(value = “execution(* com.yozo.dsc.web….(…))”)</h4><p>切点</p>
<h4 id="AfterReturning-value-“webRequest-”"><a href="#AfterReturning-value-“webRequest-”" class="headerlink" title="@AfterReturning(value = “webRequest()”)"></a>@AfterReturning(value = “webRequest()”)</h4><p>后置通知</p>
<h4 id="Around-value-“getFileHeaderBOByHead-”"><a href="#Around-value-“getFileHeaderBOByHead-”" class="headerlink" title="@Around(value = “getFileHeaderBOByHead()”)"></a>@Around(value = “getFileHeaderBOByHead()”)</h4><p>环绕通知</p>
<h4 id="Before-value-“onlineConvert-amp-amp-args-domainBo-dscOnlineParamBo-”"><a href="#Before-value-“onlineConvert-amp-amp-args-domainBo-dscOnlineParamBo-”" class="headerlink" title="@Before(value = “onlineConvert() &amp;&amp; args(domainBo,dscOnlineParamBo)”)"></a>@Before(value = “onlineConvert() &amp;&amp; args(domainBo,dscOnlineParamBo)”)</h4><p>前置通知</p>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><h4 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">初始化邮箱线程池</span><br></pre></td></tr></table></figure>

<h3 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h3><h4 id="RocketMQMessageListener-topic-MQConstant-ConvertFinishMqTopic-consumerGroup-“-rocketmq-consumer-group-”-consumeMode-ConsumeMode-CONCURRENTLY-messageModel-MessageModel-CLUSTERING"><a href="#RocketMQMessageListener-topic-MQConstant-ConvertFinishMqTopic-consumerGroup-“-rocketmq-consumer-group-”-consumeMode-ConsumeMode-CONCURRENTLY-messageModel-MessageModel-CLUSTERING" class="headerlink" title="@RocketMQMessageListener(topic = MQConstant.ConvertFinishMqTopic, consumerGroup = “${rocketmq.consumer.group}”, consumeMode = ConsumeMode.CONCURRENTLY, messageModel = MessageModel.CLUSTERING)"></a>@RocketMQMessageListener(topic = MQConstant.ConvertFinishMqTopic, consumerGroup = “${rocketmq.consumer.group}”, consumeMode = ConsumeMode.CONCURRENTLY, messageModel = MessageModel.CLUSTERING)</h4><p>RocketMQ监听</p>
<h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><h4 id="ConditionalOnBean-RedisConfig-class"><a href="#ConditionalOnBean-RedisConfig-class" class="headerlink" title="@ConditionalOnBean(RedisConfig.class)"></a>@ConditionalOnBean(RedisConfig.class)</h4><h4 id="Qualifier-“dscRedisTemplate”"><a href="#Qualifier-“dscRedisTemplate”" class="headerlink" title="@Qualifier(“dscRedisTemplate”)"></a>@Qualifier(“dscRedisTemplate”)</h4><h4 id="Service-“redisService”"><a href="#Service-“redisService”" class="headerlink" title="@Service(“redisService”)"></a>@Service(“redisService”)</h4><h3 id="Configuration-amp-Bean"><a href="#Configuration-amp-Bean" class="headerlink" title="@Configuration &amp; @Bean"></a><strong>@Configuration &amp; @Bean</strong></h3><p>Spring Boot不同于传统的Spring，它不提倡使用配置文件，而是使用配置类来代替配置文件，所以该注解就是用于将一个类指定为配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置类中使用方法对组件进行注册，它的效果等价于：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wwj.springboot.bean.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是 Spring Boot 默认会以方法名作为组件的id，也可以在 <code>@Bean()</code> 中指定value值作为组件的id。</p>
<h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a><strong>@Import</strong></h3><p>在Spring中，我们可以使用@Component、@Controller、@Service、@Repository注解进行组件的注册，而对于一些第三方的类，我们无法在类上添加这些注解，为此，我们可以使用@Import注解将其注册到容器中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="meta">@Import(User.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过@Import注解注册的组件，其id为全类名。</p>
<h3 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a><strong>@Conditional</strong></h3><p>该注解为条件装配注解，大量运用于SpringBoot底层，由该注解衍生出来的注解非常多：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwFK8l2otg0LzIn17yFGT5Odud0qic2e8xVR4lXmvibuDE39cRakXQDicxw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>这里以@ConditionalOnBean和@ConditionalOnMissingBean举例。其中@ConditionalOnBean注解的作用是判断当前容器中是否拥有指定的Bean，若有才生效，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若如此，则SpringBoot在注册User对象之前，会先判断容器中是否已经有id为 <code>dog</code> 的对象，若有才创建，否则不创建。@ConditionalOnBean注解共有三种方式判断容器中是否已经存在指定的对象，除了可以判断组件的id外，也能够通过判断组件的全类名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(type = &quot;com.wwj.springboot.bean.Dog&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以通过判断组件的类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = Dog.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>尤其需要注意的是，因为代码是从上至下依次执行的，所以在注册组件时的顺序要特别注意，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(value = Dog.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段程序中，SpringBoot会先注册User对象，而此时Dog对象还没有被注册，所以会导致User对象无法注册。</p>
<p>而@ConditionalOnMissingBean注解的作用与@ConditionalOnBean注解正好相反，它会判断当前容器中是否不存在指定的Bean，若不存在则生效，否则不生效。</p>
<p>这些注解除了能够标注在方法上，还能作用于类上，当被标注在类上时，若条件成立，则配置类的所有注册方法生效；若条件不成立，则配置类的所有注册方法均不成立。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = Dog.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a><strong>@ImportResource</strong></h3><p>该注解用于导入资源，比如现在有一个Spring的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ls&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wwj.springboot.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;李四&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tom&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wwj.springboot.bean.Dog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>若是想将其转化为配置类，代码少一点倒还好说，当配置文件中注册的Bean非常多时，采用人工的方式显然不是一个好的办法，为此，SpringBoot提供了@ImportResource注解，该注解可以将Spring的配置文件直接导入到容器中，自动完成组件注册。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dog&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a><strong>@ConfigurationProperties</strong></h3><p>该注解用于配置绑定，也大量运用于SpringBoot底层。首先在配置文件中编写两个键值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name=zhangsan</span><br><span class="line">user.age=<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>然后使用该注解将其绑定到User类上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但结果却有些出乎意料：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;name=<span class="string">&#x27;Administrator&#x27;</span>, age=<span class="number">30</span>&#125;</span><br></pre></td></tr></table></figure>

<p>这是因为我们将前缀 <code>prefix</code> 指定为了user，而user可能和我们的系统配置产生了重复，所以导致了这个问题，此时我们只需将前缀修改一下即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前缀修改了，配置文件的内容也需要做相应的修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">users.name=zhangsan</span><br><span class="line">users.age=<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，若是想实现配置绑定，就必须要将这个待绑定的类注册到容器中，比如使用@Component注解，当然，SpringBoot也提供了一个注解与其配套使用，它就是：<code>@EnableConfigurationProperties</code> </p>
<p>该注解必须标注在配置类上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(User.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作用是开启指定类的配置绑定功能，它的底层其实也是通过@Import注解实现的，此时User类就无需将其注册到容器中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring Boot 会自动将属性值绑定到 User 类，并将其注册到容器中。Spring Boot 相关的技术文章我整理成了 PDF，关注微信公众号「Java后端」回复「666」下载这一本技术栈手册。</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p>@Cacheable 注解在方法上，表示该方法的返回结果是可以缓存的</p>
<h3 id="Async"><a href="#Async" class="headerlink" title="@Async"></a>@Async</h3><p>当访问的接口较慢或者做耗时任务时，不想程序一直卡在耗时任务上，想程序能够并行执行，我们可以使用<strong>多线程</strong>来并行的处理任务</p>
<h4 id="在SpringBoot中使用-Async："><a href="#在SpringBoot中使用-Async：" class="headerlink" title="在SpringBoot中使用@Async："></a>在SpringBoot中使用@Async：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br></pre></td><td class="code"><pre><span class="line">一、异步配置（配置里主要写无返回值的异常处理）</span><br><span class="line">1.基于Java配置的启用方式：需要一个注解 @EnableAsync 开启 @Async 的功能，SpringBoot 可以放在 Application 上，也可以放其他配置文件上：</span><br><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class SpringAsyncConfig &#123; ... &#125;</span><br><span class="line">2.基于XML配置文件的启用方式：（不常用）</span><br><span class="line">&lt;task:executor id&#x3D;&quot;myexecutor&quot; pool-size&#x3D;&quot;5&quot;  &#x2F;&gt;</span><br><span class="line">&lt;task:annotation-driven executor&#x3D;&quot;myexecutor&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">二、线程池配置</span><br><span class="line">执行的线程池默认情况下找唯一的 org.springframework.core.task.TaskExecutor，或者一个 Bean 的 Name 为 taskExecutor 的java.util.concurrent.Executor 作为执行任务的线程池。如果都没有的话，会创建 SimpleAsyncTaskExecutor 线程池来处理异步方法调用，当然 @Async 注解支持一个 String 参数，来指定一个 Bean 的 Name，类型是 Executor 或 TaskExecutor，表示使用这个指定的线程池来执行这个异步任务</span><br><span class="line">@Configuration</span><br><span class="line">public class ThreadPoolConfig &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * logger</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private final static Logger logger &#x3D; LoggerFactory.getLogger(ThreadPoolConfig.class);</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;asyncThreadPool.corePoolSize&#125;&quot;)</span><br><span class="line">    private int corePoolSize;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;asyncThreadPool.maxPoolSize&#125;&quot;)</span><br><span class="line">    private int maxPoolSize;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;asyncThreadPool.queueCapacity&#125;&quot;)</span><br><span class="line">    private int queueCapacity;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;asyncThreadPool.keepAliveSeconds&#125;&quot;)</span><br><span class="line">    private int keepAliveSeconds;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;asyncThreadPool.awaitTerminationSeconds&#125;&quot;)</span><br><span class="line">    private int awaitTerminationSeconds;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;asyncThreadPool.threadNamePrefix&#125;&quot;)</span><br><span class="line">    private String threadNamePrefix;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 线程池配置</span><br><span class="line">     * @param</span><br><span class="line">     * @return java.util.concurrent.Executor</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean(name &#x3D; &quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">    public ThreadPoolTaskExecutor threadPoolTaskExecutor() &#123;</span><br><span class="line">        logger.info(&quot;---------- 线程池开始加载 ----------&quot;);</span><br><span class="line">        ThreadPoolTaskExecutor threadPoolTaskExecutor &#x3D; new ThreadPoolTaskExecutor();</span><br><span class="line">        &#x2F;&#x2F; 核心线程池大小</span><br><span class="line">        threadPoolTaskExecutor.setCorePoolSize(corePoolSize);</span><br><span class="line">        &#x2F;&#x2F; 最大线程数</span><br><span class="line">        threadPoolTaskExecutor.setMaxPoolSize(maxPoolSize);</span><br><span class="line">        &#x2F;&#x2F; 队列容量</span><br><span class="line">        threadPoolTaskExecutor.setQueueCapacity(keepAliveSeconds);</span><br><span class="line">        &#x2F;&#x2F; 活跃时间</span><br><span class="line">        threadPoolTaskExecutor.setKeepAliveSeconds(queueCapacity);</span><br><span class="line">        &#x2F;&#x2F; 主线程等待子线程执行时间</span><br><span class="line">        threadPoolTaskExecutor.setAwaitTerminationSeconds(awaitTerminationSeconds);</span><br><span class="line">        &#x2F;&#x2F; 线程名字前缀</span><br><span class="line">        threadPoolTaskExecutor.setThreadNamePrefix(threadNamePrefix);</span><br><span class="line">        &#x2F;&#x2F; RejectedExecutionHandler:当pool已经达到max-size的时候，如何处理新任务</span><br><span class="line">        &#x2F;&#x2F; CallerRunsPolicy:不在新线程中执行任务，而是由调用者所在的线程来执行</span><br><span class="line">        threadPoolTaskExecutor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">        &#x2F;&#x2F; 初始化</span><br><span class="line">        threadPoolTaskExecutor.initialize();</span><br><span class="line">        logger.info(&quot;---------- 线程池加载完成 ----------&quot;);</span><br><span class="line">        return threadPoolTaskExecutor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">三、异常处理</span><br><span class="line">异常处理，@Async 标记的方法只能是 void 或者 Future 返回值，在无返回值的异步调用中，异步处理抛出异常，默认是SimpleAsyncUncaughtExceptionHandler 的 handleUncaughtException() 会捕获指定异常，只是简单的输出了错误日志(一般需要自定义配置异常处理)，原有任务还会继续运行，直到结束(具有 void 返回类型的方法不能将任何异常发送回调用者，默认情况下此类未捕获异常只会输出错误日志)</span><br><span class="line">在有返回值的异步调用中，异步处理抛出了异常，会直接返回主线程处理，异步任务结束执行，主线程也会被异步方法中的异常中断结束执行</span><br><span class="line">@Configuration</span><br><span class="line">@EnableAsync</span><br><span class="line">public class AsyncConfig implements AsyncConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * logger</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static final Logger logger &#x3D; LoggerFactory.getLogger(AsyncConfig.class);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 这里不实现了，使用 ThreadPoolConfig 里的线程池即可</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return java.util.concurrent.Executor</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    &#x2F;*@Override</span><br><span class="line">    public Executor getAsyncExecutor() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;*&#x2F;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 只能捕获无返回值的异步方法，有返回值的被主线程处理</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() &#123;</span><br><span class="line">        return new CustomAsyncExceptionHandler();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;***</span><br><span class="line">     * 处理异步方法中未捕获的异常</span><br><span class="line">     *&#x2F;</span><br><span class="line">    class CustomAsyncExceptionHandler implements AsyncUncaughtExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void handleUncaughtException(Throwable throwable, Method method, Object... obj) &#123;</span><br><span class="line">            logger.info(&quot;Exception message - &#123;&#125;&quot;, throwable.getMessage());</span><br><span class="line">            logger.info(&quot;Method name - &#123;&#125;&quot;, method.getName());</span><br><span class="line">            logger.info(&quot;Parameter values - &#123;&#125;&quot;, Arrays.toString(obj));</span><br><span class="line">            if (throwable instanceof Exception) &#123;</span><br><span class="line">                Exception exception &#x3D; (Exception) throwable;</span><br><span class="line">                logger.info(&quot;exception:&#123;&#125;&quot;, exception.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">四、实际使用</span><br><span class="line">&#x2F;**</span><br><span class="line"> * AsyncController</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;async&quot;)</span><br><span class="line">public class AsyncController &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * logger</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private final static Logger logger &#x3D; LoggerFactory.getLogger(AsyncController.class);</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AsyncService asyncService;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private SmsUtil smsUtil;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 可以看到无返回值异步方法出现异常，主线程还是继续执行完成</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return void</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @GetMapping(&quot;&#x2F;run1&quot;)</span><br><span class="line">    public String run1() throws Exception &#123;</span><br><span class="line">        asyncService.task1();</span><br><span class="line">        logger.info(&quot;run1开始执行&quot;);</span><br><span class="line">        Thread.sleep(5000);</span><br><span class="line">        logger.info(&quot;run1执行完成&quot;);</span><br><span class="line">        return &quot;run1 success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 可以看到有返回值异步方法出现异常，异常抛给主线程处理，导致主线程也被中断执行</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return java.lang.String</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @GetMapping(&quot;&#x2F;run2&quot;)</span><br><span class="line">    public String run2() throws Exception &#123;</span><br><span class="line">        Future&lt;String&gt; future &#x3D; asyncService.task2();</span><br><span class="line">        &#x2F;&#x2F; get()方法阻塞主线程，直到执行完成</span><br><span class="line">        String result &#x3D; future.get();</span><br><span class="line">        logger.info(&quot;run2开始执行&quot;);</span><br><span class="line">        Thread.sleep(5000);</span><br><span class="line">        logger.info(&quot;run2执行完成&quot;);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 多个异步执行</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return java.lang.String</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @GetMapping(&quot;&#x2F;run3&quot;)</span><br><span class="line">    public String run3() throws Exception &#123;</span><br><span class="line">        logger.info(&quot;run3开始执行&quot;);</span><br><span class="line">        long start &#x3D; System.currentTimeMillis();</span><br><span class="line">        Future&lt;String&gt; future3 &#x3D; asyncService.task3();</span><br><span class="line">        Future&lt;String&gt; future4 &#x3D; asyncService.task4();</span><br><span class="line">        &#x2F;&#x2F; 调用返回结果通过future.get()获取</span><br><span class="line">        logger.info(future3.get());</span><br><span class="line">        logger.info(future4.get());</span><br><span class="line">        &#x2F;&#x2F; 先判断是否执行完成</span><br><span class="line">        boolean run3Done &#x3D; Boolean.FALSE;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            if (future3.isDone() &amp;&amp; future4.isDone()) &#123;</span><br><span class="line">                &#x2F;&#x2F; 执行完成</span><br><span class="line">                run3Done &#x3D; Boolean.TRUE;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            if (future3.isCancelled() || future4.isCancelled()) &#123;</span><br><span class="line">                &#x2F;&#x2F; 取消情况</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (run3Done) &#123;</span><br><span class="line">            logger.info(future3.get());</span><br><span class="line">            logger.info(future4.get());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            &#x2F;&#x2F; 其他异常情况</span><br><span class="line">        &#125;</span><br><span class="line">        long end &#x3D; System.currentTimeMillis();</span><br><span class="line">        logger.info(&quot;run3执行完成，执行时间: &#123;&#125;&quot;, end - start);</span><br><span class="line">        return &quot;run3 success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 工具类异步</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return java.lang.String</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @GetMapping(&quot;&#x2F;sms&quot;)</span><br><span class="line">    public String sms() throws Exception &#123;</span><br><span class="line">        logger.info(&quot;run1开始执行&quot;);</span><br><span class="line">        smsUtil.sendCode(&quot;15912347896&quot;, &quot;135333&quot;);</span><br><span class="line">        logger.info(&quot;run1执行完成&quot;);</span><br><span class="line">        return &quot;send sms success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * AsyncServiceImpl</span><br><span class="line"> * 有返回值时，返回的数据类型为Future类型，其为一个接口。具体的结果类型为AsyncResult</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Service</span><br><span class="line">public class AsyncServiceImpl implements AsyncService &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * logger</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private final static Logger logger &#x3D; LoggerFactory.getLogger(AsyncServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    @Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">    public void task1() throws Exception &#123;</span><br><span class="line">        logger.info(&quot;task1开始执行&quot;);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        logger.info(&quot;task1执行结束&quot;);</span><br><span class="line">        throw new RuntimeException(&quot;出现异常&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    @Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">    public Future&lt;String&gt; task2() throws Exception &#123;</span><br><span class="line">        logger.info(&quot;task2开始执行&quot;);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        logger.info(&quot;task2执行结束&quot;);</span><br><span class="line">        throw new RuntimeException(&quot;出现异常&quot;);</span><br><span class="line">        &#x2F;&#x2F; return new AsyncResult&lt;String&gt;(&quot;task2 success&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    @Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">    public Future&lt;String&gt; task3() throws Exception &#123;</span><br><span class="line">        logger.info(&quot;task3开始执行&quot;);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        logger.info(&quot;task3执行结束&quot;);</span><br><span class="line">        return new AsyncResult&lt;String&gt;(&quot;task3 success&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    @Async(&quot;threadPoolTaskExecutor&quot;)</span><br><span class="line">    public Future&lt;String&gt; task4() throws Exception &#123;</span><br><span class="line">        logger.info(&quot;task4开始执行&quot;);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        logger.info(&quot;task4执行结束&quot;);</span><br><span class="line">        return new AsyncResult&lt;String&gt;(&quot;task4 success&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * SmsUtil</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Component</span><br><span class="line">public class SmsUtil &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger &#x3D; LoggerFactory.getLogger(SmsUtil.class);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 异步发送短信</span><br><span class="line">     *</span><br><span class="line">     * @param phone</span><br><span class="line">     * @param code</span><br><span class="line">     * @return void</span><br><span class="line">     * @throws</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Async</span><br><span class="line">    public void sendCode(String phone, String code) &#123;</span><br><span class="line">        logger.info(&quot;开始发送验证码...&quot;);</span><br><span class="line">        &#x2F;&#x2F; 模拟调用接口发验证码的耗时</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(3000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(&quot;发送成功: &#123;&#125;&quot;, phone);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">五、注意事项</span><br><span class="line">1.仅适用于 public 方法</span><br><span class="line">2.在同一个类中调用异步方法将无法正常工作(self-invocation)</span><br></pre></td></tr></table></figure>



<h4 id="基于-Async调用中的异常处理机制"><a href="#基于-Async调用中的异常处理机制" class="headerlink" title="基于@Async调用中的异常处理机制"></a>基于@Async调用中的异常处理机制</h4><p>在异步方法中，如果出现异常，对于调用者caller而言，是无法感知的。如果确实需要进行异常处理，则按照如下方法来进行处理：</p>
<pre><code>1.自定义实现AsyncTaskExecutor的任务执行器
在这里定义处理具体异常的逻辑和方式。

2.配置由自定义的TaskExecutor替代内置的任务执行器
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class ExceptionHandlingAsyncTaskExecutor implements AsyncTaskExecutor &#123;</span><br><span class="line">    private AsyncTaskExecutor executor;</span><br><span class="line">    public ExceptionHandlingAsyncTaskExecutor(AsyncTaskExecutor executor) &#123;</span><br><span class="line">        this.executor &#x3D; executor;</span><br><span class="line">     &#125;</span><br><span class="line">      &#x2F;&#x2F;&#x2F;&#x2F;用独立的线程来包装，@Async其本质就是如此</span><br><span class="line">    public void execute(Runnable task) &#123;</span><br><span class="line">      executor.execute(createWrappedRunnable(task));</span><br><span class="line">    &#125;</span><br><span class="line">    public void execute(Runnable task, long startTimeout) &#123;</span><br><span class="line">        &#x2F;用独立的线程来包装，@Async其本质就是如此</span><br><span class="line">       executor.execute(createWrappedRunnable(task), startTimeout);</span><br><span class="line">    &#125;</span><br><span class="line">    public Future submit(Runnable task) &#123; return executor.submit(createWrappedRunnable(task));</span><br><span class="line">       &#x2F;&#x2F;用独立的线程来包装，@Async其本质就是如此。</span><br><span class="line">    &#125;</span><br><span class="line">    public Future submit(final Callable task) &#123;</span><br><span class="line">      &#x2F;&#x2F;用独立的线程来包装，@Async其本质就是如此。</span><br><span class="line">       return executor.submit(createCallable(task));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Callable createCallable(final Callable task) &#123;</span><br><span class="line">        return new Callable() &#123;</span><br><span class="line">            public T call() throws Exception &#123;</span><br><span class="line">                 try &#123;</span><br><span class="line">                     return task.call();</span><br><span class="line">                 &#125; catch (Exception ex) &#123;</span><br><span class="line">                     handle(ex);</span><br><span class="line">                     throw ex;</span><br><span class="line">                   &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Runnable createWrappedRunnable(final Runnable task) &#123;</span><br><span class="line">         return new Runnable() &#123;</span><br><span class="line">             public void run() &#123;</span><br><span class="line">                 try &#123;</span><br><span class="line">                     task.run();</span><br><span class="line">                  &#125; catch (Exception ex) &#123;</span><br><span class="line">                     handle(ex);</span><br><span class="line">                   &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    private void handle(Exception ex) &#123;</span><br><span class="line">      &#x2F;&#x2F;具体的异常逻辑处理的地方</span><br><span class="line">      System.err.println(&quot;Error during @Async execution: &quot; + ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现其实实现了AsyncTaskExecutor, 用独立的线程来执行具体的每个方法操作。在createCallable和createWrapperRunnable中，定义了异常的处理方式和机制。</p>
<p>handle()就是我们需要关注的异常处理的地方</p>
<p>配置文件中的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;task:annotation-driven executor&#x3D;&quot;exceptionHandlingTaskExecutor&quot; scheduler&#x3D;&quot;defaultTaskScheduler&quot; &#x2F;&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;exceptionHandlingTaskExecutor&quot; class&#x3D;&quot;nl.jborsje.blog.examples.ExceptionHandlingAsyncTaskExecutor&quot;&gt;</span><br><span class="line">    &lt;constructor-arg ref&#x3D;&quot;defaultTaskExecutor&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;task:executor id&#x3D;&quot;defaultTaskExecutor&quot; pool-size&#x3D;&quot;5&quot; &#x2F;&gt;</span><br><span class="line">&lt;task:scheduler id&#x3D;&quot;defaultTaskScheduler&quot; pool-size&#x3D;&quot;1&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>这里的配置使用自定义的taskExecutor来替代缺省的TaskExecutor</p>
<p>@Async调用中的事务处理机制</p>
<p>在@Async标注的方法，同时也适用了@Transactional进行了标注；在其调用<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/mysql">数据库</a>操作之时，将无法产生事务管理的控制，原因就在于其是基于异步处理的操作。</p>
<p>那该如何给这些操作添加事务管理呢？可以将需要事务管理操作的方法放置到异步方法内部，在内部被调用的方法上添加@Transactional.</p>
<p>例如：  </p>
<p>方法A，使用了@Async/@Transactional来标注，但是无法产生事务控制的目的。</p>
<p>方法B，使用了@Async来标注，  B中调用了C、D，C/D分别使用@Transactional做了标注，则可实现事务控制的目的。</p>
<p>测试代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">1.java的代码是同步顺序执行，当我们需要执行异步操作时我们需要创建一个新线程去执行</span><br><span class="line">&#x2F;**</span><br><span class="line">     * 任务类</span><br><span class="line">     *&#x2F;</span><br><span class="line">    class Task implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：异步任务&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        &#x2F;&#x2F;新建线程并执行任务类</span><br><span class="line">        new Thread(new Task()).start();</span><br><span class="line">        </span><br><span class="line">java1.8之后用lambda</span><br><span class="line">        &#x2F;&#x2F;新建线程并执行任务类</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：异步任务&quot;);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">2.除了显式的new Thread，我们也可以通过线程池获取线程</span><br><span class="line">	@Autowired</span><br><span class="line">    AsyncTaskExecutor asyncTaskExecutor;&#x2F;&#x2F;注入线程池对象</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;通过线程池对象提交异步任务</span><br><span class="line">    asyncTaskExecutor.submit(() -&gt; &#123;</span><br><span class="line">        log.info(&quot;异步任务开始&quot;);</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;省略异步任务业务逻辑...</span><br><span class="line"></span><br><span class="line">        log.info(&quot;异步任务结束&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">3.用@Async测试：</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@EnableAsync&#x2F;&#x2F;开启异步调用</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringbootAsyncApplication &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private TestService testService;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpringbootAsyncApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 启动成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationRunner applicationRunner() &#123;</span><br><span class="line">        return applicationArguments -&gt; &#123;</span><br><span class="line">            long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：开始调用异步业务&quot;);</span><br><span class="line">            &#x2F;&#x2F;无返回值</span><br><span class="line">&#x2F;&#x2F;            testService.asyncTask();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;有返回值，但主线程不需要用到返回值</span><br><span class="line">&#x2F;&#x2F;            Future&lt;String&gt; future &#x3D; testService.asyncTask(&quot;huanzi-qch&quot;);</span><br><span class="line">            &#x2F;&#x2F;有返回值，且主线程需要用到返回值</span><br><span class="line">&#x2F;&#x2F;            System.out.println(Thread.currentThread().getName() + &quot;：返回值：&quot; + testService.asyncTask(&quot;huanzi-qch&quot;).get());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;事务测试，事务正常提交</span><br><span class="line">&#x2F;&#x2F;            testService.asyncTaskForTransaction(false);</span><br><span class="line">            &#x2F;&#x2F;事务测试，模拟异常事务回滚</span><br><span class="line">&#x2F;&#x2F;            testService.asyncTaskForTransaction(true);</span><br><span class="line"></span><br><span class="line">            long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：调用异步业务结束，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">测试业务类TestService</span><br><span class="line">public interface TestService &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 异步调用，无返回值</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void asyncTask();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 异步调用，有返回值</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Future&lt;String&gt; asyncTask(String s);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 异步调用，无返回值，事务测试</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void asyncTaskForTransaction(Boolean exFlag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class TestServiceImpl implements TestService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private TbUserRepository tbUserRepository;</span><br><span class="line"></span><br><span class="line">    @Async</span><br><span class="line">    @Override</span><br><span class="line">    public void asyncTask() &#123;</span><br><span class="line">        long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;模拟耗时</span><br><span class="line">            Thread.sleep(3000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + &quot;：void asyncTask()，耗时：&quot; + (endTime - startTime));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Async(&quot;asyncTaskExecutor&quot;)</span><br><span class="line">    @Override</span><br><span class="line">    public Future&lt;String&gt; asyncTask(String s) &#123;</span><br><span class="line">        long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;模拟耗时</span><br><span class="line">            Thread.sleep(3000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + &quot;：Future&lt;String&gt; asyncTask(String s)，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        return AsyncResult.forValue(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Async(&quot;asyncTaskExecutor&quot;)</span><br><span class="line">    @Transactional</span><br><span class="line">    @Override</span><br><span class="line">    public void asyncTaskForTransaction(Boolean exFlag) &#123;</span><br><span class="line">        &#x2F;&#x2F;新增一个用户</span><br><span class="line">        TbUser tbUser &#x3D; new TbUser();</span><br><span class="line">        tbUser.setUsername(&quot;huanzi-qch&quot;);</span><br><span class="line">        tbUser.setPassword(&quot;123456&quot;);</span><br><span class="line">        tbUserRepository.save(tbUser);</span><br><span class="line"></span><br><span class="line">        if(exFlag)&#123;</span><br><span class="line">            &#x2F;&#x2F;模拟异常</span><br><span class="line">            throw new RuntimeException(&quot;模拟异常&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 线程池的配置</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class AsyncConfig &#123;</span><br><span class="line"></span><br><span class="line">    private static final int MAX_POOL_SIZE &#x3D; 50;</span><br><span class="line"></span><br><span class="line">    private static final int CORE_POOL_SIZE &#x3D; 20;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;asyncTaskExecutor&quot;)</span><br><span class="line">    public AsyncTaskExecutor asyncTaskExecutor() &#123;</span><br><span class="line">        ThreadPoolTaskExecutor asyncTaskExecutor &#x3D; new ThreadPoolTaskExecutor();</span><br><span class="line">        asyncTaskExecutor.setMaxPoolSize(MAX_POOL_SIZE);&#x2F;&#x2F;最大线程数</span><br><span class="line">        asyncTaskExecutor.setCorePoolSize(CORE_POOL_SIZE);&#x2F;&#x2F;核心线程数 </span><br><span class="line">        asyncTaskExecutor.setThreadNamePrefix(&quot;async-task-thread-pool-&quot;);&#x2F;&#x2F;线程名称前缀</span><br><span class="line">        asyncTaskExecutor.setKeepAliveSeconds(60);&#x2F;&#x2F;空闲线程保留时间</span><br><span class="line">        asyncTaskExecutor.setQueueCapacity(200);&#x2F;&#x2F;队列容量</span><br><span class="line">        asyncTaskExecutor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());&#x2F;&#x2F;线程池对拒绝任务的处理策略：这里采用了CallerRunsPolicy策略，当线程池没有处理能力的时候，该策略会直接在 execute 方法的调用线程中运行被拒绝的任务；如果执行程序已关闭，则会丢弃该任务</span><br><span class="line">        asyncTaskExecutor.initialize();</span><br><span class="line">        return asyncTaskExecutor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">配置好后，@Async会默认从线程池获取线程，当然也可以显式的指定@Async(&quot;asyncTaskExecutor&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>无返回值的测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 启动成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationRunner applicationRunner() &#123;</span><br><span class="line">        return applicationArguments -&gt; &#123;</span><br><span class="line">            long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：开始调用异步业务&quot;);</span><br><span class="line">            &#x2F;&#x2F;无返回值</span><br><span class="line">            testService.asyncTask();</span><br><span class="line">            long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：调用异步业务结束，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/1353055-20190723115827369-137054437.png" alt="img"></p>
<p>有返回值，但主线程不需要用到返回值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 启动成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationRunner applicationRunner() &#123;</span><br><span class="line">        return applicationArguments -&gt; &#123;</span><br><span class="line">            long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：开始调用异步业务&quot;);&#x2F;&#x2F;有返回值，但主线程不需要用到返回值</span><br><span class="line">            Future&lt;String&gt; future &#x3D; testService.asyncTask(&quot;huanzi-qch&quot;);</span><br><span class="line"></span><br><span class="line">            long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：调用异步业务结束，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/1353055-20190723120750063-1637394085.png" alt="img"></p>
<p>有返回值，且主线程需要用到返回值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 启动成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationRunner applicationRunner() &#123;</span><br><span class="line">        return applicationArguments -&gt; &#123;</span><br><span class="line">            long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：开始调用异步业务&quot;);</span><br><span class="line">&#x2F;&#x2F;有返回值，且主线程需要用到返回值</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：返回值：&quot; + testService.asyncTask(&quot;huanzi-qch&quot;).get());</span><br><span class="line"></span><br><span class="line">            long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：调用异步业务结束，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/1353055-20190723121014479-355020614.png" alt="img"></p>
<p>可以发现，有返回值的情况下，虽然异步业务逻辑是由新线程执行，但如果在主线程操作返回值对象，主线程会等待，还是顺序执行</p>
<p>事务测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 启动成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationRunner applicationRunner() &#123;</span><br><span class="line">        return applicationArguments -&gt; &#123;</span><br><span class="line">            long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：开始调用异步业务&quot;);&#x2F;&#x2F;事务测试，事务正常提交</span><br><span class="line">            testService.asyncTaskForTransaction(false);</span><br><span class="line"></span><br><span class="line">            long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：调用异步业务结束，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">数据库正确插入</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/1353055-20190723121259049-1268764937.png" alt="img"></p>
<p><img src="/12.3.SpringBoot/1353055-20190723115133055-806425816.png" alt="img"></p>
<p>模拟异常，事务回滚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 启动成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationRunner applicationRunner() &#123;</span><br><span class="line">        return applicationArguments -&gt; &#123;</span><br><span class="line">            long startTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：开始调用异步业务&quot;);</span><br><span class="line">&#x2F;&#x2F;事务测试，模拟异常事务回滚</span><br><span class="line">            testService.asyncTaskForTransaction(true);</span><br><span class="line"></span><br><span class="line">            long endTime &#x3D; System.currentTimeMillis();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;：调用异步业务结束，耗时：&quot; + (endTime - startTime));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">数据库正确回滚</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/1353055-20190723121249738-1640041332.png" alt="img"></p>
<p><img src="/12.3.SpringBoot/1353055-20190723113653670-484594019.png" alt="img"></p>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="@Profile"></a>@Profile</h3><p>Spring为我们提供的可以根据当前环境，动态的激活和切换一系列组件的功能</p>
<p>@Profile:指定组件在哪个环境的情况下才能被注册到容器中，不指定，任何环境下都能注册这个组件</p>
<ol>
<li>加了环境标识的bean，只有这个环境被激活的时候才能注册到容器中。默认是default环境</li>
<li>写在配置类上，只有是指定的环境的时候，整个配置类里面的所有配置才能开始生效</li>
</ol>
<h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><p>JDBC的数据库连接池使用javax.sql.DataSource来表示，DataSource只是一个接口，该接口通常由服务器（Weblogic,WebSphere,Tomcat）提供实现，也有一些开源组织提供实现，如：DBCP数据库连接池、C3P0数据库连接池、Proxpool数据库连接池.</p>
<p>对象采用池化的原因：采用池化的本意是通过减少对象生成的次数，减少花在对象初始化上面的开销，从而提高整体性能。</p>
<p>使用数据库连接池的优点：</p>
<p>1）资源重用：</p>
<p>由于数据库连接得以重用，避免了频繁创建，释放连接引起的大量性能开销。在减少系统消耗的基础上，另一方面也增加了系统运行环境的平稳性。</p>
<p>2）更快的系统反应速度</p>
<p>数据库连接池在初始化过程中，往往<strong>已经创建了若干数据库连接置于连接池中备用</strong>。此时连接的初始化工作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而减少了系统的响应时间。</p>
<p>3）新的资源分配手段</p>
<p>对于多应用共享同一数据库的系统而言，可在应用层通过数据库连接池的配置，实现某一应用最大可用数据库连接数的限制，避免某一应用独占所有的数据库资源。</p>
<p>4）统一的连接管理，避免数据库连接泄露</p>
<p>在较为完善的数据库连接池实现中，可根据预先的占用超时设定，强制回收被占用连接，从而避免了常规数据库连接操作中可能出现的资源泄露。</p>
<p>Springboot默认数据库连接池为 Tomcat JDBC Pool </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#初始化连接</span><br><span class="line">spring.datasource.initial-size=<span class="number">10</span></span><br><span class="line">#最大空闲连接</span><br><span class="line">spring.datasource.max-idle=<span class="number">20</span></span><br><span class="line">#最小空闲连接</span><br><span class="line">spring.datasource.min-idle=<span class="number">5</span></span><br><span class="line">#最大连接数量</span><br><span class="line">spring.datasource.max-active=<span class="number">50</span></span><br><span class="line">#是否在自动回收超时连接的时候打印连接的超时错误</span><br><span class="line">spring.datasource.log-abandoned=<span class="keyword">true</span></span><br><span class="line">#是否自动回收超时连接</span><br><span class="line">spring.datasource.remove-abandoned=<span class="keyword">true</span></span><br><span class="line">#超时时间(以秒数为单位)</span><br><span class="line">spring.datasource.remove-abandoned-timeout=<span class="number">180</span></span><br><span class="line">##&lt;!-- 超时等待时间以毫秒为单位 6000毫秒/1000等于60秒 --&gt;</span><br><span class="line">spring.datasource.max-wait=<span class="number">1000</span></span><br><span class="line">spring.datasource.test-<span class="keyword">while</span>-idle=<span class="keyword">true</span></span><br><span class="line">#检测数据库的查询语句</span><br><span class="line">spring.datasource.validation-query=select <span class="number">1</span> from dual</span><br><span class="line">spring.datasource.test-on-borrow=<span class="keyword">true</span></span><br><span class="line">#每隔五分钟检测空闲超过10分钟的连接</span><br><span class="line">spring.datasource.min-evictable-idle-time-millis=<span class="number">600000</span></span><br><span class="line">spring.datasource.time-between-eviction-runs-millis=<span class="number">300000</span></span><br></pre></td></tr></table></figure>

<p>wait_timeout需要设置成很大一个值：</p>
<p>如果wait_timeout设置成很小，如1分钟。因为服务器1分钟就把空闲连接断开了，客户端过了5分钟再去检查连接情况，那有什么意义？先前就是没理解被误导了，把timeBetweenEvictionRunsMillis设置了一个比较大的值，所以一直有问题。包括所说的8小时问题也是源于此（mysql数据库默认是空闲8小时断开）</p>
<p>连接池配置中的timeBetweenEvictionRunsMillis和minEvictableIdleTimeMillis的时间小于或者等于mysql数据库中wait_timeout的时间</p>
<h3 id="多数据库源配置"><a href="#多数据库源配置" class="headerlink" title="多数据库源配置"></a>多数据库源配置</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/aizen-sousuke/p/11756279.html">https://www.cnblogs.com/aizen-sousuke/p/11756279.html</a></p>
<p>maven依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring-boot-starter-web</span><br><span class="line">mybatis-plus-boot-starter</span><br><span class="line">dynamic-datasource-spring-boot-starter # 配置动态数据源</span><br><span class="line">druid-spring-boot-starter # 阿里的数据库连接池</span><br><span class="line">mysql-connector-java</span><br><span class="line">lombok      </span><br></pre></td></tr></table></figure>

<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;1.配置文件application.properties，配置了2个库的连接</span><br><span class="line">#配置数据源</span><br><span class="line">datasource:</span><br><span class="line">	dynamic:</span><br><span class="line">		primary: first # 配置默认数据库</span><br><span class="line">		datasource:</span><br><span class="line">        	first: # 数据源1配置</span><br><span class="line">          		username: root</span><br><span class="line">          		password: root</span><br><span class="line">          		url: jdbc:mysql:&#x2F;&#x2F;39.101.193.57:3306&#x2F;yxtl_db_admin?useUnicode&#x3D;yes&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;true&amp;serverTimezone&#x3D;GMT%2B8</span><br><span class="line">          		driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">        	second: # 数据源2配置</span><br><span class="line">          		username: root</span><br><span class="line">          		password: root</span><br><span class="line">          		url: jdbc:mysql:&#x2F;&#x2F;39.101.193.57:3306&#x2F;yxtl_db_lora?useUnicode&#x3D;yes&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;true&amp;serverTimezone&#x3D;GMT%2B8</span><br><span class="line">          		driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">		durid:</span><br><span class="line">        	initial-size: 1</span><br><span class="line">        	max-active: 20</span><br><span class="line">        	min-idle: 1</span><br><span class="line">        	max-wait: 60000  </span><br><span class="line">autoconfigure:</span><br><span class="line">    exclude:  com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure # 去除druid配置</span><br><span class="line">    </span><br><span class="line">&#x2F;&#x2F;DruidDataSourceAutoConfigure会注入一个DataSourceWrapper，其会在原生的spring.datasource下找 url, username, password 等。动态数据源 URL 等配置是在 dynamic 下，因此需要排除，否则会报错。排除方式有两种，一种是上述配置文件排除，还有一种可以在项目启动类排除：</span><br><span class="line">@SpringBootApplication(exclude &#x3D; DruidDataSourceAutoConfigure.class)</span><br><span class="line">public class Application &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    SpringApplication.run(Application.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;2.配置启动类</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@MapperScan(&#123;&quot;com.swx.business.mapper.first&quot;, &quot;com.swx.business.mapper.second&quot;&#125;)</span><br><span class="line">@EnableSwagger2</span><br><span class="line">@EnableCaching</span><br><span class="line">public class Application &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;3.项目中使用：给使用非默认数据源添加注解@DS。加上  @DS(&quot;second&quot;) 表示使用的是第二个数据库源</span><br><span class="line">@DS 可以注解在方法上和类上，同时存在方法注解优先于类上注解。</span><br><span class="line">注解在 service 实现或 mapper 接口方法上，不要同时在 service 和 mapper 注解</span><br></pre></td></tr></table></figure>





<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>缓存不关心方法的执行逻辑，它能确定的是：对于同一个方法，如果参数相同，那么返回结果也是相同的。但是如果参数不同，缓存只能假设结果是不同的，所以对于同一个方法，你的程序运行过程中，使用了多少种参数组合调用过该方法，理论上就会生成多少个缓存的 key（当然，这些组合的参数指的是与生成 key 相关的）</p>
<h3 id="cacheNames-value"><a href="#cacheNames-value" class="headerlink" title="cacheNames/value"></a>cacheNames/value</h3><p>@Cacheable 提供两个参数来指定缓存名：value、cacheNames，二者选其一即可 <code>@Cacheable(&quot;menu&quot;)</code> </p>
<p>@Cacheable 支持同一个方法关联多个缓存。这种情况下，当执行方法之前，这些关联的每一个缓存都会被检查，而且只要至少其中一个缓存命中了，那么这个缓存中的值就会被返回 <code>@Cacheable(&#123;&quot;menu&quot;, &quot;menuById&quot;&#125;)</code></p>
<h3 id="key-amp-keyGenerator"><a href="#key-amp-keyGenerator" class="headerlink" title="key&amp;keyGenerator"></a>key&amp;keyGenerator</h3><p>一个缓存名对应一个被注解的方法，但是一个方法可能传入不同的参数，那么结果也就会不同，需要用到 key 。</p>
<p>在 spring 中，key 的生成有两种方式：显式指定和使用 keyGenerator 自动生成</p>
<p>1.spring 官方更推荐显式指定 key 的方式，即指定 @Cacheable 的 key 参数，使用SpEL（Spring Expression Language，Spring 表达式语言）</p>
<p> <code>@Cacheable(value = &#123;&quot;menuById&quot;&#125;, key = &quot;#id&quot;)</code> </p>
<p><code>@Cacheable(value = &#123;&quot;menuById&quot;&#125;, key = &quot;&#39;id-&#39; + #menu.id&quot;)</code></p>
<p><code>@Cacheable(value = &#123;&quot;menuById&quot;&#125;, key = &quot;&#39;hash&#39; + #menu.hashCode()&quot;)</code></p>
<p><img src="/12.3.SpringBoot/9b44287bd9e642abfc8edcd09a51b87a.png" alt="img"></p>
<p>2.当我们在声明 @Cacheable 时不指定 key 参数，则该缓存名下的所有 key 会使用 KeyGenerator 根据参数 自动生成。spring 有一个默认的 SimpleKeyGenerator ，在 spring boot 自动化配置中，这个会被默认注入。生成规则如下：</p>
<p>　　　　　　a. 如果该缓存方法没有参数，返回 SimpleKey.EMPTY ；</p>
<p>　　　　　　b. 如果该缓存方法有一个参数，返回该参数的实例 ；</p>
<p>　　　　　　c. 如果该缓存方法有多个参数，返回一个包含所有参数的 SimpleKey ；</p>
<p>　　　　默认的 key 生成器要求参数具有有效的 hashCode() 和 equals() 方法实现。另外，keyGenerator 也支持自定义， 并通过 keyGenerator 来指定。关于 KeyGenerator，其实就是使用 hashCode 进行加乘运算。跟 String 和 ArrayList 的 hash 计算类似。</p>
<p> 注：key 和 keyGenerator 参数是互斥的，同时指定两个会导致异常</p>
<h3 id="cacheManager"><a href="#cacheManager" class="headerlink" title="cacheManager"></a>cacheManager</h3><p>CacheManager，缓存管理器是用来管理（检索）一类缓存的。通常来讲，缓存管理器是与缓存组件类型相关联的。我们知道，spring 缓存抽象的目的是为使用不同缓存组件类型提供统一的访问接口，以向开发者屏蔽各种缓存组件的差异性。那么  CacheManager 就是承担了这种屏蔽的功能。spring 为其支持的每一种缓存的组件类型提供了一个默认的 manager，如：RedisCacheManager 管理 redis 相关的缓存的检索、EhCacheManager 管理 ehCache 相关的缓等。</p>
<p>cacheResolver</p>
<p>　　CacheResolver，缓存解析器是用来管理缓存管理器的，CacheResolver 保持一个 cacheManager 的引用，并通过它来检索缓存。CacheResolver 与 CacheManager 的关系有点类似于 KeyGenerator 跟 key。spring 默认提供了一个 SimpleCacheResolver，开发者可以自定义并通过 @Bean 来注入自定义的解析器，以实现更灵活的检索。</p>
<p>　　大多数情况下，我们的系统只会配置一种缓存，所以我们并不需要显式指定 cacheManager 或者 cacheResolver。但是 spring 允许我们的系统同时配置多种缓存组件，这种情况下，我们需要指定。指定的方式是使用 @Cacheable 的 cacheManager 或者 cacheResolver 参数。</p>
<p>　　注意：按照官方文档，cacheManager 和 cacheResolver 是互斥参数，同时指定两个可能会导致异常。</p>
<h3 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h3><p>是否同步，true/false。在一个多线程的环境中，某些操作可能被相同的参数并发地调用，这样同一个 value 值可能被多次计算（或多次访问 db），这样就达不到缓存的目的。针对这些可能高并发的操作，我们可以使用 sync 参数来告诉底层的缓存提供者将缓存的入口锁住，这样就只能有一个线程计算操作的结果值，而其它线程需要等待，这样就避免了 n-1 次数据库访问。</p>
<p>　　sync = true 可以有效的避免缓存击穿的问题</p>
<h3 id="condition"><a href="#condition" class="headerlink" title="condition"></a>condition</h3><p>调用前判断，缓存的条件。有时候，我们可能并不想对一个方法的所有调用情况进行缓存，我们可能想要根据调用方法时候的某些参数值，来确定是否需要将结果进行缓存或者从缓存中取结果。比如当我根据年龄查询用户的时候，我只想要缓存年龄大于 35 的查询结果。那么 condition 能实现这种效果。</p>
<p>　　condition 接收一个结果为 true 或 false 的表达式，表达式同样支持 SpEL 。如果表达式结果为 true，则调用方法时会执行正常的缓存逻辑（查缓存-有就返回-没有就执行方法-方法返回不空就添加缓存）；否则，调用方法时就好像该方法没有声明缓存一样（即无论传入了什么参数或者缓存中有些什么值，都会执行方法，并且结果不放入缓存）</p>
<p><code>@Cacheable(value = &#123;&quot;menuById&quot;&#125;, key = &quot;#id&quot;, condition = &quot;#conditionValue &gt; 1&quot;)</code></p>
<h3 id="unless"><a href="#unless" class="headerlink" title="unless"></a>unless</h3><p>执行后判断，不缓存的条件。unless 接收一个结果为 true 或 false 的表达式，表达式支持 SpEL。当结果为 true 时，不缓存</p>
<p><code>@Cacheable(value = &#123;&quot;menuById&quot;&#125;, key = &quot;#id&quot;, unless = &quot;#result.type == &#39;folder&#39;&quot;)</code></p>
<p>condition 不指定相当于 true，unless 不指定相当于 false</p>
<p>　　　　当 condition = false，一定不会缓存；</p>
<p>　　　　当 condition = true，且 unless = true，不缓存；</p>
<p>　　　　当 condition = true，且 unless = false，缓存；</p>
<p>实际使用遇到的问题：</p>
<p>1.同一个类，其中一个方法调用另一个注解缓存的方法时，不走缓存。</p>
<p>2.缓存的对象会存往redis，存入redis的对象必须实现序列化接口，否则存入的是乱码或者二进制字符。</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="事务管理器"><a href="#事务管理器" class="headerlink" title="事务管理器"></a>事务管理器</h3><p>事务的打开、回滚和提交是由事务管理器来完成的。在Spring中，事务管理器的顶层接口为PlatformTransactionManager，Spring也定义了一些其他的接口和类。</p>
<p>在Spring Boot中，当你依赖于<strong>mybatis-spring-boot-starter</strong>之后，它会自动创建一个<strong>DataSource­ TransactionManager</strong>对象作为事务管理器；</p>
<p>如果依赖于<strong>spring-boot-starter-data-jpa</strong>，则它会自动创建<strong>JpaTransactionManager</strong>对象作为事务管理器，所以我们一般不需要自己创建事务管理器而直接使用它们即可</p>
<h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>声明式事务，@Transactional 注解应该只被应用到 <strong>public</strong> 方法上，这是由 Spring AOP 的本质决定的，</p>
<p>涉及到两张表以上的更新或者删除操作，为了保证数据库的一致性，需要添加 @Transactional事务注解，否则程序会抛出异常</p>
<p>（@Scheduled 和@Transactional不能同时存在一个类里面）</p>
<h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line">    <span class="comment">// 通过 bean name 指定事务管理器</span></span><br><span class="line">    <span class="meta">@AliasFor(&quot;transactionManager&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// 同 value 属性</span></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">transactionManager</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// 传播行为</span></span><br><span class="line">    <span class="function">Propagation <span class="title">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED</span>;</span><br><span class="line">    <span class="comment">// 隔离级别</span></span><br><span class="line">    <span class="function">Isolation <span class="title">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT</span>;</span><br><span class="line">    <span class="comment">// 超时时间</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">timeout</span><span class="params">()</span> <span class="keyword">default</span> TransactionDefinition.TIMEOUT_DEFAULT</span>;</span><br><span class="line">    <span class="comment">// 是否只读事务</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    <span class="comment">// 方法在发生指定异常时回滚，默认是所有异常都回滚</span></span><br><span class="line">    Class&lt;? extends Throwable&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 方法在发生指定异常名称时回滚，默认是所有异常都回滚</span></span><br><span class="line">    String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 方法在发生指定异常时不回滚，默认是所有异常都回滚</span></span><br><span class="line">    Class&lt;? extends Throwable&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 方法在发生指定异常名称时不回滚，默认是所有异常都回滚</span></span><br><span class="line">    String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/12.3.SpringBoot/1055208-20180316120820674-2029592173.png" alt="img"></p>
<p><img src="/12.3.SpringBoot/2599320-5bdab563c3050406.png" alt="img"></p>
<p>@Transaction 默认配置适合80%的配置，特殊场景的配置需要手动配置参数</p>
<p>Spring的默认的事务规则是<strong>遇到运行异常（RuntimeException）和程序错误（Error）才会回滚</strong>。</p>
<h4 id="其他异常回滚"><a href="#其他异常回滚" class="headerlink" title="其他异常回滚"></a>其他异常回滚</h4><p>Spring默认情况下会对(RuntimeException)及其子类来进行回滚,在遇见Exception及其子类的时候则不会进行回滚操作</p>
<p>如果想针对<strong>非检测异常</strong>（即运行异常）进行事务回滚，可以在@Transactional 注解里使用，@Transactional(rollbackFor=Exception.class) 属性明确指定异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">@Transactional(rollbackFor &#x3D; &#123;SQLException.class&#125;)</span><br><span class="line">public void rollback() throws SQLException &#123;</span><br><span class="line">    &#x2F;&#x2F; update db</span><br><span class="line">    throw new SQLException(&quot;exception&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当遇到SQLException时会回滚，遇到RuntimeException和Error也会回滚。（相当于设置后是添加了属性）</p>
<h4 id="嵌套回滚"><a href="#嵌套回滚" class="headerlink" title="嵌套回滚"></a>嵌套回滚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// updateA</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        selfProxy.innelTransaction()</span><br><span class="line">    &#125;<span class="keyword">catch</span>(RuntimeException e)&#123;</span><br><span class="line">        <span class="comment">//do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//updateC</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">innelTransaction</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">// updateB</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;exception&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">会回滚，因为内部事务触发回滚，当前事务被标记为 rollback-only，</span><br><span class="line">当外部事务提交的时候，Spring抛出以下异常，同时回滚外部事务</span><br><span class="line">org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only</span><br></pre></td></tr></table></figure>

<h4 id="事务传播性"><a href="#事务传播性" class="headerlink" title="事务传播性"></a>事务传播性</h4><p>@Transaction中的propagation的可以配置事务的传播性</p>
<p>常用的传播行为是REQUIRED、REQUIRES_NEW、NESTED三种</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//源码分析</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Propagation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 需要事务。它是默认传播行为，如果当前存在事务，就沿用当前事务，否则新建一个事务运行子方法</span></span><br><span class="line">    REQUIRED(TransactionDefinition.PROPAGATION_REQUIRED),</span><br><span class="line">    <span class="comment">// 支持事务，如果当前存在事务,就沿用当前事务,如果不存在 ，则继续采用无事务的方式运行子方法</span></span><br><span class="line">    SUPPORTS(TransactionDefinition.PROPAGATION_SUPPORTS),</span><br><span class="line">    <span class="comment">// 必须使用事务，如果当前没有事务，则会抛出异常，如果存在当前事务 ，就沿用当前事务</span></span><br><span class="line">    MANDATORY(TransactionDefinition.PROPAGATION_MANDATORY),</span><br><span class="line">    <span class="comment">// 无论当前事务是否存在，都会创建新事务运行方法，这样新事务就可以拥有新的锁和隔离级别等特性，与当前事务相互独立</span></span><br><span class="line">    REQUIRES_NEW(TransactionDefinition.PROPAGATION_REQUIRES_NEW),</span><br><span class="line">    <span class="comment">// 不支持事务，当前存在事务时，将挂起事务，运行方法</span></span><br><span class="line">    NOT_SUPPORTED(TransactionDefinition.PROPAGATION_NOT_SUPPORTED),</span><br><span class="line">    <span class="comment">// 不支持事务，如果当前方法存在事务，则抛出异常，否则继续使用无事务机制运行</span></span><br><span class="line">    NEVER(TransactionDefinition.PROPAGATION_NEVER),</span><br><span class="line">    <span class="comment">// 在当前方法调用子方法时，如果子方法发生异常，只回滚子方法执行过的 SQL，而不回滚当前方法的事务</span></span><br><span class="line">    NESTED(TransactionDefinition.PROPAGATION_NESTED);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    Propagation(<span class="keyword">int</span> value) &#123; <span class="keyword">this</span>.value = value; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.value; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在事务中读取最新配置</p>
<p>有时候需要在一个事务中，读取最新数据（默认是读取事务开始前的快照）。其实很简单，只要使用上面PROPAGATION_NOT_SUPPORTED传播性就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Transactional</span><br><span class="line">public void transaction() throws SQLException &#123;</span><br><span class="line">    &#x2F;&#x2F; do something</span><br><span class="line">    selfProxy.queryNewValue();</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">@Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">public void queryNewValue() throws SQLException &#123;</span><br><span class="line">    &#x2F;&#x2F;查询数据中的最新值</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="事务失效"><a href="#事务失效" class="headerlink" title="事务失效"></a>事务失效</h4><p>1.如果你在方法中有try{}catch(Exception e){}处理，那么try里面的代码块就脱离了事务的管理，若要事务生效需要在catch中throw new RuntimeException (“xxxxxx”)</p>
<p>2.在@Transactional注解的方法中，再调用本类中的其他方法method2时，那么method2方法上的@Transactional注解是不会生效的！（也就是下面这个内部调用事务方法模块所讲的解决方法）</p>
<h4 id="内部调用事务方法"><a href="#内部调用事务方法" class="headerlink" title="内部调用事务方法"></a>内部调用事务方法</h4><p>事务注解的实质就是在创建一个动态代理，在调用事务方法前开启事务，在事务方法结束以后决定是事务提交还是回滚</p>
<p>Spring数据库事务的实现原理是AOP，而AOP的原理是动态代理。在事务自调用的过程中，是类自身的调用即通过this.指向的目标对象，而不是代理对象去调用，那么就不会产生AOP，这样Spring就不能把你的代码织入到约定的流程中，于是就产生了@Transactional自调用失效的场景。</p>
<p>因此，直接在类内部中调用事务方法，是不会经过动态代理的</p>
<p><img src="/12.3.SpringBoot/1055208-20180309165042456-532167462.png" alt="img"></p>
<p>因此，如果要使方法B点事务生效：</p>
<p><img src="/12.3.SpringBoot/1055208-20180309165117679-1753916897.png" alt="img"></p>
<p>解决方法1：需要在内部调用方法B的时候，找到当前类的代理类，用代理类去调用方法B</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class MyService&#123;</span><br><span class="line">    @Transactional</span><br><span class="line">    public void transaction()&#123;</span><br><span class="line">        &#x2F;&#x2F; do something</span><br><span class="line">        ((MyService) AopContext.currentProxy()).queryNewValue();</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    @Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">    public void queryNewValue()&#123;</span><br><span class="line">        &#x2F;&#x2F;查询数据中的最新值</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">通过AopContext.currentProxy()可以拿到当前类的代理类，但是要使用这个时候，必须在启动类上加上</span><br><span class="line">@EnableAspectJAutoProxy(exposeProxy&#x3D;true)</span><br></pre></td></tr></table></figure>

<p>解决办法2：在spring中拿Bean的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class MyService&#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private MyService self;</span><br><span class="line">    @Transactional</span><br><span class="line">    public void transaction() &#123;</span><br><span class="line">        &#x2F;&#x2F; do something</span><br><span class="line">        self.queryNewValue();</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    @Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">    public void queryNewValue() &#123;</span><br><span class="line">        &#x2F;&#x2F;查询数据中的最新值</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>tips:spring现在对一些循环依赖是提供支持的，简单来说，满足：</p>
<p>1.Bean是单例<br>2.注入的方式不是构造函数注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">通过BeanFactory</span><br><span class="line">@Service</span><br><span class="line">public class MyService implements BeanFactoryAware&#123;</span><br><span class="line">    private MyService self;</span><br><span class="line">      </span><br><span class="line">    @Transactional</span><br><span class="line">    public void transaction()&#123;</span><br><span class="line">        &#x2F;&#x2F; do something</span><br><span class="line">        self.queryNewValue();</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    @Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">    public void queryNewValue() &#123;</span><br><span class="line">        &#x2F;&#x2F;查询数据中的最新值</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">     @Override</span><br><span class="line">    public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123;</span><br><span class="line">        self &#x3D; beanFactory.getBean(MyService.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>1.使用@Transaction注解的方法，必须用public来修饰。<br>2.其实不止是@Transaction，其他类似@Cacheable,@Retryable等依赖spring proxy也必须使用上述方式达到内部调用。<br>3.@Transactional,@Async放在同一个类中，如果使用Autowire注入会循环依赖，而使用BeanFactoryAware会使得@Transactional无效</p>
<p>4.@Transactional注解保证的是每个方法处在一个事务，如果有try一定在catch中抛出运行时异常</p>
<p>5.this.本方法的调用，被调用方法上注解是不生效的，因为无法再次进行切面增强</p>
<p>6.不仅是执行两个以上增删改数据时需要加事务，如果是<strong>两条查询语句，一个增删改语句和一个额外操作</strong>，都需要加事务来预防出现查询时不一致，额外操作失败导致语句执行不回滚的情况</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>在需要事务回滚的时候，最好还是抛出RuntimeException,并且不要在代码中捕获此类异常</p>
<h2 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a><strong>自动配置原理</strong></h2><p>有了前面的注解基础之后，我们就能够更深入地了解Spring Boot的自动配置原理，自动配置正是建立在这些强大的注解之上的。</p>
<p>我们首先观察一下主启动类上的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>翻阅源码可以得知，@SpringBootApplication注解其实是由三个注解组成的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中@SpringBootConfiguration底层是@Configuration注解，它表示主启动类是一个配置类；而@ComponentScan是扫描注解，它默认扫描的是主启动类当前包及其子包下的组件；最关键的就是@EnableAutoConfiguration注解了，该注解便实现了自动配置。</p>
<p>查看@EnableAutoConfiguration注解的源码，又会发现它是由两个注解组合而成的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们继续查看@AutoConfigurationPackage注解的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Registrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Import注解我们非常熟悉，它是用来导入一个组件的，然而它比较特殊：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Registrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">DeterminableImports</span> </span>&#123;</span><br><span class="line">    Registrar() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">        AutoConfigurationPackages.register(registry, (String[])(<span class="keyword">new</span> AutoConfigurationPackages.PackageImports(metadata)).getPackageNames().toArray(<span class="keyword">new</span> String[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> AutoConfigurationPackages.PackageImports(metadata));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 Registrar 组件中有两个方法，它是用来导入一系列组件的，而该注解又被间接标注在了启动类上，所以它会将主启动类所在包及其子包下的所有组件均注册到容器中。</p>
<p>接下来我们继续看@EnableAutoConfiguration的第二个合成注解：@Import({AutoConfigurationImportSelector.class}) 该注解也向容器中注册了一个组件，翻阅该组件的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title">DeferredImportSelector</span>, <span class="title">BeanClassLoaderAware</span>, <span class="title">ResourceLoaderAware</span>, <span class="title">BeanFactoryAware</span>, <span class="title">EnvironmentAware</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">            <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = <span class="keyword">this</span>.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">            <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法是用来选择导入哪些组件的，该方法又调用了getAutoConfigurationEntry()方法得到需要导入的组件，所以我们查看该方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationImportSelector.<span class="function">AutoConfigurationEntry <span class="title">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        AnnotationAttributes attributes = <span class="keyword">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">        List&lt;String&gt; configurations = <span class="keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">        configurations = <span class="keyword">this</span>.removeDuplicates(configurations);</span><br><span class="line">        Set&lt;String&gt; exclusions = <span class="keyword">this</span>.getExclusions(annotationMetadata, attributes);</span><br><span class="line">        <span class="keyword">this</span>.checkExcludedClasses(configurations, exclusions);</span><br><span class="line">        configurations.removeAll(exclusions);</span><br><span class="line">        configurations = <span class="keyword">this</span>.getConfigurationClassFilter().filter(configurations);</span><br><span class="line">        <span class="keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在getCandidateConfigurations()方法处打一个断点，通过debug运行后我们可以发现，configurations集合中就已经得到了127个自动配置类：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwiakI4r3b9jZ4o76vYGkxmwSmRibQ5POBwGyFLM7Frakdc6Bshjn9iaOqw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>那么这些类究竟从何而来呢？我们需要探究一下getCandidateConfigurations()方法做了什么操作，它其实是调用了loadFactoryNames()方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());</span><br></pre></td></tr></table></figure>

<p>最终调用的是loadSpringFactories()方法来得到一个Map集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(<span class="meta">@Nullable</span> ClassLoader classLoader) &#123;</span><br><span class="line">    MultiValueMap&lt;String, String&gt; result = (MultiValueMap)cache.get(classLoader);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Enumeration&lt;URL&gt; urls = classLoader != <span class="keyword">null</span> ? classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>) : ClassLoader.getSystemResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);</span><br><span class="line">            LinkedMultiValueMap result = <span class="keyword">new</span> LinkedMultiValueMap();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，它其实是从 META-INF/spring.factories 文件中获取的组件，我们可以看看导入的依赖中：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vweu8mKjeLr2ObBktFVLyrZvYT8icicxjyibTGsrvRKAayHPbYPItCOwMpA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在spring-boot-autoconfigure-2.3.7.RELEASE.jar的META-INF目录下就有一个spring.factories文件，打开看看文件内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Initializers</span><br><span class="line">org.springframework.context.ApplicationContextInitializer=\</span><br><span class="line">org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\</span><br><span class="line">org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</span><br><span class="line"></span><br><span class="line"># Application Listeners</span><br><span class="line">org.springframework.context.ApplicationListener=\</span><br><span class="line">org.springframework.boot.autoconfigure.BackgroundPreinitializer</span><br><span class="line"></span><br><span class="line"># Auto Configuration Import Listeners</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener</span><br><span class="line"></span><br><span class="line"># Auto Configuration Import Filters</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnBeanCondition,\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnClassCondition,\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition</span><br><span class="line"></span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>文件里的内容其实就是在最开始需要注册的组件，这些组件都是一些配置类，只要项目一启动，Spring Boot就会将这些配置类全部注册到容器中。</p>
<h3 id="按需开启自动配置"><a href="#按需开启自动配置" class="headerlink" title="按需开启自动配置"></a><strong>按需开启自动配置</strong></h3><p>虽然配置类会被 Spring Boot 自动注册到容器中，但并不是每个配置类都会默认生效，SpringBoot会根据当前的场景按需开启自动配置。比如Thymeleaf模板引擎的自动配置类：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwpsl2q2cwqbRhADxVWeglaIWQp4G9dz9QaJBibOIPH9PsmEkdIK1ejDQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>@ConditionalOnClass注解的作用是检查当前项目是否有指定的.class文件，若有则生效；否则不生效。因为我们并未引入Thymeleaf的依赖，导致TemplateMode.class和SpringTemplatengine.class都是不存在的，所以ThymeleafAutoCinfiguration并不会生效。</p>
<h3 id="修改默认配置"><a href="#修改默认配置" class="headerlink" title="修改默认配置"></a><strong>修改默认配置</strong></h3><p>既然SpringBoot帮助我们进行了大量的自动配置，那么对于特殊的一些应用场景，我们该如何修改它的默认配置呢？如果你不了解SpringBoot的配置原理，那么当你需要修改默认配置时，你肯定是束手无策的。我们可以找到SpringMVC的默认配置，看看SpringBoot是如何帮我们进行配置的：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwjenFeGzxSpZRluvzRoXakJpxEdlXQeRwhKY4dHSfSvzLWwkb3mMXAw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>@EnableConfigurationPropertie(WebMvcProperties.class)注解在之前也有介绍，它是用来开启指定类的配置绑定的，所以我们来看看WebMvcProperties类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix &#x3D; &quot;spring.mvc&quot;)</span><br><span class="line">public class WebMvcProperties &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置绑定的前缀时spring.mvc，所以我们若是想修改SpringBoot的默认配置，则必须要将前缀写为spring.mvc，至于我们可以修改哪些配置，只需要查看该类中有哪些成员变量即可，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static class View &#123;</span><br><span class="line">    </span><br><span class="line">    private String prefix;</span><br><span class="line"></span><br><span class="line">    private String suffix;</span><br><span class="line"></span><br><span class="line">    public String getPrefix() &#123;</span><br><span class="line">        return this.prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrefix(String prefix) &#123;</span><br><span class="line">        this.prefix &#x3D; prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSuffix() &#123;</span><br><span class="line">        return this.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSuffix(String suffix) &#123;</span><br><span class="line">        this.suffix &#x3D; suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在WebMvcProperties类中有这样一个内部类，内部类中有prefix和suffix两个成员变量，它们是分别用来设置视图的前缀和后缀的，所以我们若想进行配置，则需要在配置文件中这样编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.view.prefix&#x3D;&#x2F;views&#x2F;</span><br><span class="line">spring.mvc.view.suffix&#x3D;.html</span><br></pre></td></tr></table></figure>

<p>传统的Spring开发Web需要编写大量的配置，而使用SpringBoot将免去编写配置的操作，直接面向业务逻辑开发，一起来看看该如何使用SpringBoot进行Web开发吧！</p>
<h2 id="Web开发"><a href="#Web开发" class="headerlink" title="Web开发"></a><strong>Web开发</strong></h2><h3 id="静态资源处理"><a href="#静态资源处理" class="headerlink" title="静态资源处理"></a><strong>静态资源处理</strong></h3><p>Spring Boot默认设置了几个静态资源目录：</p>
<ul>
<li>/static</li>
<li>/public</li>
<li>/resources</li>
<li>/META-INF/resources</li>
</ul>
<p>这几个目录需要建立在类路径下，若如此做，则放置在这些目录下的静态资源可以被直接访问到。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwmKY2G35mehPDl0JLbWGSGBVhCicJsVgzqDuFVd2elK6XGCicTSHU6ibfQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>也可以通过配置来设置资源的访问前缀：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.static-path-pattern&#x3D;&#x2F;res</span><br></pre></td></tr></table></figure>

<p>此时若想访问静态资源，就必须添加res前缀才行。</p>
<p>我们还可以修改Spring Boot的默认资源路径，只需添加配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.web.resources.static-locations&#x3D;classpath:&#x2F;myImg</span><br></pre></td></tr></table></figure>

<p>若如此做，则我们只能将静态资源放在myImg目录下，之前的所有静态资源目录都将失效。</p>
<p><strong>欢迎页</strong></p>
<p>Spring Boot提供了两种方式来实现欢迎页，第一种便是在资源目录放置欢迎页：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;SpringBoot Index!&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>访问结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwCiasLxHPa4CgF4ialicAuzygfKaNbe8BUXXDD0eWemaDzKh9C1S91nHSg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>第二种方式是通过Controller处理/index请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;&quot;)</span><br><span class="line">    public String toIndex()&#123;</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Favicon"><a href="#Favicon" class="headerlink" title="Favicon"></a><strong>Favicon</strong></h3><p>Spring Boot也提供了自动设置网站图标的方式，只需要将名为 <code>favicon.ico</code> 的图片放在静态资源目录下即可：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vw1B6tqzEX4bo1m5pBvDkKo0D9VwZiagnRibxW1ek1VVERMuRkN4Sib3Mgw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>Rest映射</strong></p>
<p>在Spring Boot中，默认已经注册了HiddenHttpMethodFilter，所以可以直接编写Rest风格的url，只需在表单中添加一个_method属性的请求域即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;get&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Get提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Post提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;DELETE&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Delete提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;user&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;_method&quot; value&#x3D;&quot;PUT&quot;&gt;</span><br><span class="line">        &lt;input value&#x3D;&quot;Put提交&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>编写Controller处理请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String getUser()&#123;</span><br><span class="line">        return &quot;Get&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String postUser()&#123;</span><br><span class="line">        return &quot;Post&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String deleteUser()&#123;</span><br><span class="line">        return &quot;Delete&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PutMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public String putUser()&#123;</span><br><span class="line">        return &quot;Put&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后需要在配置文件中开启对Rest的支持：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.hiddenmethod.filter.enabled&#x3D;true</span><br></pre></td></tr></table></figure>



<h2 id="常用参数及注解"><a href="#常用参数及注解" class="headerlink" title="常用参数及注解"></a><strong>常用参数及注解</strong></h2><p>下面介绍Web开发中的一些常用参数和注解。</p>
<h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a><strong>@PathVariable</strong></h3><p>该注解用于获取路径变量，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;user&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">public String getUser(@PathVariable(&quot;id&quot;) Integer id)&#123;</span><br><span class="line">    return id + &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时若请求url为<a target="_blank" rel="noopener" href="http://localhost:8080/user/2%EF%BC%8C%E5%88%99%E8%8E%B7%E5%8F%96%E5%88%B0id%E5%80%BC%E4%B8%BA2%E3%80%82">http://localhost:8080/user/2，则获取到id值为2。</a></p>
<h3 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a><strong>@RequestHeader</strong></h3><p>该注解用于获取请求头，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;header&quot;)</span><br><span class="line">public String getHeader(@RequestHeader(&quot;User-Agent&quot;) String userAgent)&#123;</span><br><span class="line">    return userAgent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它还能够通过一个Map集合获取所有的请求头信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;header&quot;)</span><br><span class="line">public Map&lt;String, String&gt; getHeader(@RequestHeader Map&lt;String,String&gt; headers)&#123;</span><br><span class="line">    return headers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a><strong>@RequestParam</strong></h3><p>该注解用于获取请求参数，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;param&quot;)</span><br><span class="line">public String getParam(@RequestParam(&quot;name&quot;) String name,</span><br><span class="line">                       @RequestParam(&quot;age&quot;) Integer age)&#123;</span><br><span class="line">    return name + &quot;:&quot; + age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时若请求url为<a target="_blank" rel="noopener" href="http://localhost:8080/param?name=zhangsan&amp;age=20%EF%BC%8C%E5%88%99%E5%BE%97%E5%88%B0%E5%80%BC%60zhangsan:20%60">http://localhost:8080/param?name=zhangsan&amp;age=20，则得到值`zhangsan:20`</a> 。</p>
<h3 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a><strong>@CookieValue</strong></h3><p>该注解用于获取Cookie值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;cookie&quot;)</span><br><span class="line">public String getCookie(@CookieValue(&quot;Idea-8296e76f&quot;) String cookie) &#123;</span><br><span class="line">    return cookie;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它还可以通过Cookie键名获取一个Cookie对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;cookie&quot;)</span><br><span class="line">public String getCookie(@CookieValue(&quot;Idea-8296e76f&quot;) Cookie cookie) &#123;</span><br><span class="line">    return cookie.getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a><strong>@RequestBody</strong></h3><p>该注解用于获取获取请求体的值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;&#x2F;body&quot;)</span><br><span class="line">public String getBody(@RequestBody String content) &#123;</span><br><span class="line">    return content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>既然是获取请求体的值，那么只有Post请求才有请求体，所以编写一个表单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;body&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        账号:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        密码:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>通过该表单提交数据后，得到 <code>username=admin&amp;password=123</code> 。</p>
<h3 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a><strong>@RequestAttribute</strong></h3><p>该注解用于获取request域的数据，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;success&quot;)</span><br><span class="line">public String success(@RequestAttribute(&quot;msg&quot;) String msg)&#123;</span><br><span class="line">    return msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过键名即可获取request域中的数据。</p>
<h3 id="MatrixVariable"><a href="#MatrixVariable" class="headerlink" title="@MatrixVariable"></a><strong>@MatrixVariable</strong></h3><p>该注解用于获取矩阵变量，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;matrix&#x2F;&#123;path&#125;&quot;)</span><br><span class="line">public String getMatrix(@MatrixVariable(&quot;name&quot;) String name,</span><br><span class="line">                        @MatrixVariable(&quot;age&quot;) Integer age,</span><br><span class="line">                        @PathVariable(&quot;path&quot;) String path) &#123;</span><br><span class="line">    return path + &quot;---&quot; + name + &quot;:&quot; + age;</span><br></pre></td></tr></table></figure>

<p>对于该注解的使用，需要注意几点，首先矩阵变量是绑定在路径中的，所以请求映射中一定要携带一个${path}；其次在SpringBoot中默认禁用掉了矩阵变量的功能，所以我们还需要手动去开启该功能：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public WebMvcConfigurer webMvcConfigurer()&#123;</span><br><span class="line">        return new WebMvcConfigurer() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void configurePathMatch(PathMatchConfigurer configurer) &#123;</span><br><span class="line">                UrlPathHelper urlPathHelper &#x3D; new UrlPathHelper();</span><br><span class="line">                </span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(false);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时访问请求url：<a target="_blank" rel="noopener" href="http://localhost:8080/matrix/test;name=zhangsan;age=20%EF%BC%8C">http://localhost:8080/matrix/test;name=zhangsan;age=20，</a> 得到结果：<code>test---zhangsan:20</code> 。</p>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>模板引擎是为了解决用户界面（显示）与业务数据（内容）分离而产生的。他可以生成特定格式的文档，常用的如格式如HTML、xml以及其他格式的文本格式。其工作模式如下：</p>
<p><img src="/12.3.SpringBoot/2411352-1b8c22fae3f6a072.png" alt="img"></p>
<p>常用的模板引擎：</p>
<p>jsp：是一种动态网页开发技术。它使用JSP标签在HTML网页中插入Java代码。</p>
<p>Thymeleaf : 主要渲染xml，HTML，HTML5而且与springboot整合。</p>
<p>Velocity：不仅可以用于界面展示（HTML.xml等）还可以生成输入java代码，SQL语句等文本格式。</p>
<p>FreeMarker：功能与Velocity差不多，但是语法更加强大，使用方便。</p>
<p>1、FreeMarker是一个用Java语言编写的模板引擎，它基于模板来生成文本输出。FreeMarker与Web容器无关，即在Web运行时，它并不知道Servlet或HTTP。它不仅可以用作表现层的实现技术，而且还可以用于生成XML，JSP或Java 等，在spring4.0中推荐使用thymeleaf来做前端模版引擎。</p>
<p>2、JSP技术spring boot 官方是不推荐的，原因有三：</p>
<p>2.1. 在tomcat上，jsp不能在嵌套的tomcat容器解析即不能在打包成可执行的jar的情况下解析</p>
<p>2.2. Jetty 嵌套的容器不支持jsp</p>
<p>2.3. Undertow</p>
<p>3、反正就是spring推荐themleaf，就学学themleaf。</p>
<p>18.8.31</p>
<p>在java领域，表现层技术主要有三种：jsp、freemarker、velocity。</p>
<p>jsp是大家最熟悉的技术</p>
<p>优点：</p>
<p>1、功能强大，可以写java代码</p>
<p>2、支持jsp标签(jsp tag)</p>
<p>3、支持表达式语言(el)</p>
<p>4、官方标准，用户群广，丰富的第三方jsp标签库</p>
<p>5、性能良好。jsp编译成class文件执行，有很好的性能表现</p>
<p>缺点：</p>
<p>jsp没有明显缺点，非要挑点骨头那就是，由于可以编写java代码，如使用不当容易破坏mvc结构。</p>
<p>velocity是较早出现的用于代替jsp的模板语言</p>
<p>优点：</p>
<p>1、不能编写java代码，可以实现严格的mvc分离</p>
<p>2、性能良好，据说比jsp性能还要好些</p>
<p>3、使用表达式语言，据说jsp的表达式语言就是学velocity的</p>
<p>缺点：</p>
<p>1、不是官方标准</p>
<p>2、用户群体和第三方标签库没有jsp多。</p>
<p>3、对jsp标签支持不够好</p>
<p>4、已经很久很久没有维护了。</p>
<p>freemarker</p>
<p>优点：</p>
<p>1、不能编写java代码，可以实现严格的mvc分离</p>
<p>2、性能非常不错</p>
<p>3、对jsp标签支持良好</p>
<p>4、内置大量常用功能，使用非常方便</p>
<p>5、宏定义(类似jsp标签)非常方便</p>
<p>6、使用表达式语言</p>
<p>缺点：</p>
<p>1、不是官方标准</p>
<p>2、用户群体和第三方标签库没有jsp多</p>
<p>选择freemarker的原因：</p>
<p>1、性能。velocity应该是最好的，其次是jsp，普通的页面freemarker性能最差(虽然只是几毫秒到十几毫秒的差距)。但是在复杂页面上(包含大量判断、日期金额格式化)的页面上，freemarker的性能比使用tag和el的jsp好。</p>
<p>2、宏定义比jsp tag方便</p>
<p>3、内置大量常用功能。比如html过滤，日期金额格式化等等，使用非常方便</p>
<p>4、支持jsp标签</p>
<p>5、可以实现严格的mvc分离</p>
<p>thymeleaf</p>
<p>Thymeleaf是个XML/XHTML/HTML5模板引擎，可以用于Web与非Web应用。Thymeleaf就是jsp的高端升级版</p>
<p>Thymeleaf的主要目标在于提供一种可被浏览器正确显示的、格式良好的模板创建方式，因此也可以用作静态建模。你可以使用它创建经过验证的XML与HTML模板。相对于编写逻辑或代码，开发者只需将标签属性添加到模板中即可。接下来，这些标签属性就会在DOM(文档对象模型)上执行预先制定好的逻辑。Thymeleaf的可扩展性也非常棒。你可以使用它定义自己的模板属性集合，这样就可以计算自定义表达式并使用自定义逻辑。这意味着Thymeleaf还可以作为模板引擎框架。</p>
<p>thymeleaf优点：静态html嵌入标签属性，浏览器可以直接打开模板文件，便于前后端联调。springboot官方推荐方案。</p>
<p>thymeleaf缺点：模板必须符合xml规范，就这一点就可以判死刑！太不方便了！js脚本必须加入/</p>
<p>spring  boot  使用两个模板引擎<br>一 freemaker (来自学成在线第四天的页面静态化)<br>静态化之后上传到 gridFs 服务器上</p>
<p>目录如下</p>
<p><img src="/12.3.SpringBoot/20190610231257254.png" alt="img"></p>
<p>1.配置文件</p>
<p>application.yml</p>
<p><img src="/12.3.SpringBoot/20190610231539914.png" alt="img"></p>
<p>resources下templates 下 index_banner.ftl 模板页面</p>
<p><img src="/12.3.SpringBoot/20190610231757330.png" alt="img"></p>
<p>2.在test测试下写一个测试类   GridFsTest</p>
<p>@SpringBootTest<br>@RunWith(SpringRunner.class)<br>public class GridFsTest {</p>
<pre><code>@Autowired
GridFsTemplate gridFsTemplate;
 
@Autowired
GridFSBucket gridFSBucket;
 
//存文件
@Test
public void testStore() throws FileNotFoundException &#123;
    //定义file
    File file =new File(&quot;d:/index_banner.ftl&quot;);
    //定义fileInputStream
    FileInputStream fileInputStream = new FileInputStream(file);
    ObjectId objectId = gridFsTemplate.store(fileInputStream, &quot;index_banner.ftl&quot;);
    System.out.println(objectId);
&#125;
 
//取文件
@Test
public void queryFile() throws IOException &#123;
    //根据文件id查询文件
    GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(&quot;_id&quot;).is(&quot;5ce799bf840d5e6d88a0a0f7&quot;)));
 
    //打开一个下载流对象
    GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());
    //创建GridFsResource对象，获取流
    GridFsResource gridFsResource = new GridFsResource(gridFSFile,gridFSDownloadStream);
    //从流中取数据
    String content = IOUtils.toString(gridFsResource.getInputStream(), &quot;utf-8&quot;);
    System.out.println(content);
 
&#125;
</code></pre>
<p>}<br>详细解析页面静态化的流程实质是什么。。。。。。。。。。。。。。。。。。。。</p>
<p>二.thymeleaf<br>   自己写的博客，使用的就是这个技术，但是看着有点麻烦，以后查看博客的时候再看使用</p>
<p>使用spring  框架使用freemaker<br>freemaker<br>（来自平优购的day12 的 商品详情页）感觉跟上面的spring boot集成的模式是一模一样的呀</p>
<p><img src="/12.3.SpringBoot/20190610233854182.png" alt="img"></p>
<p>最基础的配置文件，以及代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.3.3生成文件</span><br><span class="line">使用步骤：</span><br><span class="line">第一步：创建一个 Configuration 对象，直接 new 一个对象。构造方法的参数就是 freemarker的版本号。</span><br><span class="line">第二步：设置模板文件所在的路径。</span><br><span class="line">第三步：设置模板文件使用的字符集。一般就是 utf-8.</span><br><span class="line">第四步：加载一个模板，创建一个模板对象。</span><br><span class="line">第五步：创建一个模板使用的数据集，可以是 pojo 也可以是 map。一般是 Map。</span><br><span class="line">第六步：创建一个 Writer 对象，一般创建一 FileWriter 对象，指定生成的文件名。</span><br><span class="line">第七步：调用模板对象的 process 方法输出文件。</span><br><span class="line"></span><br><span class="line">第八步：关闭流</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">代码：</span><br><span class="line">创建Test类 main方法如下：</span><br><span class="line">	     &#x2F;&#x2F;1.创建配置类</span><br><span class="line">		Configuration configuration&#x3D;new Configuration(Configuration.getVersion());</span><br><span class="line">		&#x2F;&#x2F;2.设置模板所在的目录 </span><br><span class="line">		configuration.setDirectoryForTemplateLoading(new File(&quot;D:&#x2F;pinyougou_work&#x2F;freemarkerDemo&#x2F;src&#x2F;main&#x2F;resources&#x2F;&quot;));</span><br><span class="line">		&#x2F;&#x2F;3.设置字符集</span><br><span class="line">		configuration.setDefaultEncoding(&quot;utf-8&quot;);</span><br><span class="line">		&#x2F;&#x2F;4.加载模板</span><br><span class="line">		Template template &#x3D; configuration.getTemplate(&quot;test.ftl&quot;);</span><br><span class="line">		&#x2F;&#x2F;5.创建数据模型</span><br><span class="line">		Map map&#x3D;new HashMap();</span><br><span class="line">		map.put(&quot;name&quot;, &quot;张三 &quot;);</span><br><span class="line">		map.put(&quot;message&quot;, &quot;欢迎来到神奇的品优购世界！&quot;);</span><br><span class="line">		&#x2F;&#x2F;6.创建Writer对象</span><br><span class="line">		Writer out &#x3D;new FileWriter(new File(&quot;d:\\test.html&quot;));</span><br><span class="line">		&#x2F;&#x2F;7.输出</span><br><span class="line">		template.process(map, out);</span><br><span class="line">		&#x2F;&#x2F;8.关闭Writer对象</span><br><span class="line">		out.close();</span><br></pre></td></tr></table></figure>

<p>执行后，在D盘根目录即可看到生成的test.html ，打开看看<br>其实静态化的流程都是一样的，</p>
<p>只是在第四步的时候，是注入 模板对象@Autotuy  ReTemplate  reTemplate，</p>
<p>第五步的时候是注入其他的依赖   获取页面详情页所需要的数据  然后  数据+模板引擎=新的页面</p>
<h2 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h2><p>创建定时任务主要有两种创建方式：一、基于注解(@Scheduled) 二、基于接口（SchedulingConfigurer）</p>
<h3 id="cron表达式"><a href="#cron表达式" class="headerlink" title="cron表达式"></a>cron表达式</h3><p>一个<strong>cron表达式</strong>有至少6个（也可能7个）有空格分隔的时间元素。crontab参数<code>* * * * * * *</code></p>
<p>第一个*  second: 区间为 0 – 59    <code>, - * /</code></p>
<p>第二个*  minute: 区间为 0 – 59  <code>, - * /</code></p>
<p>第三个*  hour: 区间为0 – 23  <code>, - * /</code><br>第四个*  day-of-month: 区间为0 – 31  <code>, - * / ? L W C</code><br>第五个*  month: 区间为1 – 12 或JAN-DEC    1 是1月  12是12月  <code>, - * /</code><br>第六个*  Day-of-week: 区间为0 – 7 或SUN-SAT   周日可以是0或7  <code>, - * / ? L C #</code></p>
<p>第七个* （可选）year：区间为1970-2099  <code>, - * /</code></p>
<p>1.有些子表达式能包含一些范围或列表</p>
<p>例如：子表达式（天（星期））可以为 “MON-FRI”，“MON，WED，FRI”，“MON-WED,SAT”</p>
<p>2.<code>* </code>字符代表所有可能的值：表示匹配该域的任意值，假如在Minutes域使用*, 即表示每分钟都会触发事件</p>
<p>3.<code>/</code>字符用来指定数值的增量：表示起始时间开始触发，然后每隔固定时间触发一次，例如在Minutes域使用5/20,则意味着5分钟触发一次，而25，45等分别触发一次.</p>
<p>4.<code>？</code>字符仅被用于天（月）和天（星期）两个子表达式，表示不指定值（也就是第四位和第六位只能指定一个值，另一个不指定的就为？）</p>
<p>只能用在DayofMonth和DayofWeek两个域。它也匹配域的任意值，但实际不会。因为DayofMonth和DayofWeek会相互影响。</p>
<p>例如想在每月的20日触发调度，不管20日到底是星期几，则只能使用如下写法： 13 13 15 20 * ?, 其中最后一位只能用？，而不能使用<em>，如果使用</em>表示不管星期几都会触发，实际上并不是这样。</p>
<p>5.<code>-</code>表示范围，例如在Minutes域使用5-20，表示从5分到20分钟每分钟触发一次 </p>
<p>6.<code>,</code>表示列出枚举值值。例如：在Minutes域使用5,20，则意味着在5和20分每分钟触发一次</p>
<p>7.<code>L</code>字符仅被用于天（月）和天（星期）两个子表达式，它是单词“last”的缩写</p>
<p>在天（月）子表达式中，“L”表示一个月的最后一天</p>
<p>在天（星期）自表达式中，“L”表示一个星期的最后一天，也就是SAT</p>
<p>如果在“L”前有具体的内容，它就具有其他的含义了</p>
<p>例如：</p>
<p>在DayofWeek域使用5L,意味着在最后的一个星期四触发</p>
<p>“6L”表示这个月的倒数第６天，“ＦＲＩＬ”表示这个月的最一个星期五</p>
<p>注意：在使用“L”参数时，不要指定列表或范围，因为这会导致问题</p>
<p><code>W</code>表示有效工作日(周一到周五),只能出现在DayofMonth域，系统将在离指定日期的最近的有效工作日触发事件。</p>
<p>例如：在 DayofMonth使用5W，如果5日是星期六，则将在最近的工作日：星期五，即4日触发。如果5日是星期天，则在6日(周一)触发；如果5日在星期一到星期五中的一天，则就在5日触发。另外一点，W的最近寻找不会跨过月份</p>
<p><code>LW</code> 这两个字符可以连用，表示在某个月最后一个工作日，即最后一个星期五</p>
<p><code>#</code>用于确定每个月第几个星期几，只能出现在DayofMonth域。例如在4#2，表示某月的第二个星期三</p>
<h3 id="一、静态定时任务（基于注解）"><a href="#一、静态定时任务（基于注解）" class="headerlink" title="一、静态定时任务（基于注解）"></a>一、静态定时任务（基于注解）</h3><p>基于注解@Scheduled默认为单线程，开启多个任务时，任务的执行时机会受上一个任务执行时间的影响</p>
<p>当定时任务增多，如果一个任务卡死，会导致其他任务也无法执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Configuration &#x2F;&#x2F;1.主要用于标记配置类，兼备Component的效果。</span><br><span class="line">@EnableScheduling &#x2F;&#x2F; 2.开启定时任务</span><br><span class="line">public class SimpleScheduleConfig &#123;</span><br><span class="line">    &#x2F;&#x2F;3.添加定时任务</span><br><span class="line">    @Scheduled(cron &#x3D; &quot;0&#x2F;5 * * * * ?&quot;)</span><br><span class="line">    private void configureTasks() &#123;</span><br><span class="line">        System.out.println(&quot;执行定时任务1: &quot; + LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动应用，可以看到控制台的信息打印出了语句。</p>
<p>使用Scheduled 很方便，但缺点是当我们调整了执行周期的时候，需要重启应用才能生效，这多少有些不方便。为了达到实时生效的效果，可以使用接口来完成定时任务。</p>
<h3 id="二、动态定时任务（基于接口）"><a href="#二、动态定时任务（基于接口）" class="headerlink" title="二、动态定时任务（基于接口）"></a>二、动态定时任务（基于接口）</h3><p>数据库准备好数据之后，编写定时任务，注意这里添加的是TriggerTask，目的是循环读取我们在数据库设置好的执行周期，以及执行相关定时任务的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompleteScheduleConfig</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapper</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CronMapper</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Select(&quot;select cron from cron limit 1&quot;)</span></span><br><span class="line">        <span class="function">String <span class="title">getCron</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    CronMapper cronMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行定时任务.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line">        taskRegistrar.addTriggerTask(</span><br><span class="line">                <span class="comment">//1.添加任务内容(Runnable)</span></span><br><span class="line">                () -&gt; System.out.println(<span class="string">&quot;执行定时任务2: &quot;</span> + LocalDateTime.now().toLocalTime()),</span><br><span class="line">                <span class="comment">//2.设置执行周期(Trigger)</span></span><br><span class="line">                triggerContext -&gt; &#123;</span><br><span class="line">                    <span class="comment">//2.1 从数据库获取执行周期</span></span><br><span class="line">                    String cron = cronMapper.getCron();</span><br><span class="line">                    <span class="comment">//2.2 合法性校验.</span></span><br><span class="line">                    <span class="keyword">if</span> (StringUtils.isEmpty(cron)) &#123;</span><br><span class="line">                        <span class="comment">// Omitted Code .. 省略代码</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//2.3 返回执行周期(Date)</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> CronTrigger(cron).nextExecutionTime(triggerContext);</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意： 如果在数据库修改时格式出现错误，则定时任务会停止，即使重新修改正确；此时只能重新启动项目才能恢复</p>
<h3 id="三、多线程定时任务"><a href="#三、多线程定时任务" class="headerlink" title="三、多线程定时任务"></a>三、多线程定时任务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component注解用于对那些比较中立的类进行注释；</span></span><br><span class="line"><span class="comment">//相对与在持久层、业务层和控制层分别采用 @Repository、@Service 和 @Controller 对分层中的类进行注释</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>   <span class="comment">// 1.开启定时任务</span></span><br><span class="line"><span class="meta">@EnableAsync</span>        <span class="comment">// 2.开启多线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultithreadScheduleTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Async</span></span><br><span class="line">        <span class="meta">@Scheduled(fixedDelay = 1000)</span>  <span class="comment">//间隔1秒</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;第一个定时任务开始 : &quot;</span> + LocalDateTime.now().toLocalTime() + <span class="string">&quot;\r\n线程 : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            System.out.println();</span><br><span class="line">            Thread.sleep(<span class="number">1000</span> * <span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Async</span></span><br><span class="line">        <span class="meta">@Scheduled(fixedDelay = 2000)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">second</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;第二个定时任务开始 : &quot;</span> + LocalDateTime.now().toLocalTime() + <span class="string">&quot;\r\n线程 : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/12.3.SpringBoot/20181220165535820.png" alt="在这里插入图片描述"></p>
<p>每一个任务都是在不同的线程中，第一个定时任务和第二个定时任务互不影响；</p>
<p>并且，由于开启了多线程，第一个任务的执行时间也不受其本身执行时间的限制，所以需要注意可能会出现重复操作导致数据异常</p>
<h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><h3 id="Timer："><a href="#Timer：" class="headerlink" title="Timer："></a>Timer：</h3><p>这是java自带的java.util.Timer类，这个类允许你调度一个java.util.TimerTask任务。使用这种方式可以让你的程序按照某一个频度执行，但不能在指定时间运行。一般用的较少。</p>
<p>在java中一个完整的定时任务可以用Timer和TimerTask两个类配合完成。</p>
<p>Timer是一种工具，线程用其安排在后台线程中执行的任务，可安排任务执行一次或者定期重复执行。</p>
<p>TimerTask是由Timer安排执行一次或者重复执行的任务。</p>
<p>Timer中提供了四个方法：</p>
<p>（1）schedule(TimerTask task,Date time)——安排在指定的时间执行指定的任务</p>
<p>（2）schedule(TimerTask task,Date firstTime,long period)——安排指定的任务在指定的时间开始进行重复的固定延迟执行</p>
<p>（3）schedule(TimerTask task,long delay)——安排在指定延迟后执行指定的任务</p>
<p>（4）schedule(TimerTask task,long delay,long period)——安排指定的任务在指定的延迟后开始进行重复的固定速率执行</p>
<p>注意：Timer对于系统时间的改变非常敏感，它对调度的支持是基于绝对时间而不是相对时间。</p>
<p>Timer线程是不会捕获异常的，多线程并行处理定时任务时，Timer运行多个TimerTask时，只要其中之一没有捕获抛出的异常，其他任务便会自动终止运行。同时Timer也不会重新恢复线程的执行，它会错误的认为整个Timer线程都会取消，已经被安排但尚未执行的TimerTask也不会再执行了，新的任务也不能被调度。因此，如果TimerTask抛出未检查的异常，Timer将会产生无法预料的行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTimer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TimerTask timerTask = <span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;task  run:&quot;</span>+ <span class="keyword">new</span> Date());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();</span><br><span class="line">        <span class="comment">//安排指定的任务在指定的时间开始进行重复的固定延迟执行。这里是每3秒执行一次</span></span><br><span class="line">        timer.schedule(timerTask,<span class="number">10</span>,<span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ScheduledExecutorService："><a href="#ScheduledExecutorService：" class="headerlink" title="ScheduledExecutorService："></a>ScheduledExecutorService：</h3><p>jdk自带的一个类；是基于线程池设计的定时任务类,每个调度任务都会分配到线程池中的一个线程去执行,也就是说,任务是并发执行,互不影响。</p>
<p>Timer是基于绝对时间的，对系统时间比较敏感，而ScheduledExecutor则是基于相对时间。</p>
<p>Timer的内部只有一个线程，如果有多个任务的话就会顺序执行，这样我们的延迟时间和循环时间就会出现问题。而ScheduledThreadPoolExecutor内部是个线程池，可以支持多个任务并发执行，在对延迟任务和循环任务要求严格的时候，就需要考虑使用ScheduledExecutor了。</p>
<p>针对Timer类存在的缺陷，Java 5 推出了基于线程池设计的 ScheduledExecutor，ScheduledExecutor的设计思想是每一个被调度的任务都会由线程池中一个线程去执行，因此任务是并发的，相互之间不会受到干扰，只有当任务的时间到来时，ScheduledExecutor才会真正启动一个线程，其余时间ScheduledExecutor都是处于轮询任务的状态。如果我们设定的调度周期小于任务运行时间，该任务会被重复添加到一个延时任务队列，所以同一时间任务队列中会有多个任务待调度，线程池会首先获取优先级高的任务执行。效果就是任务运行多长时间，调度时间就会变为多久，因为添加到任务队列的任务的延时时间每次都是负数，所以会被立刻执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestScheduledExecutorService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ScheduledExecutorService service = Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">        <span class="comment">// 参数：1、任务体 2、首次执行的延时时间</span></span><br><span class="line">        <span class="comment">//      3、任务执行间隔 4、间隔时间单位</span></span><br><span class="line">        service.scheduleAtFixedRate(()-&gt;System.out.println(<span class="string">&quot;task ScheduledExecutorService &quot;</span>+<span class="keyword">new</span> Date()), <span class="number">0</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Spring-Task："><a href="#Spring-Task：" class="headerlink" title="Spring Task："></a>Spring Task：</h3><p>Spring3.0以后自带的task，可以将它看成一个轻量级的Quartz，而且使用起来比Quartz简单许多。</p>
<p>也就是上面的那个定时器</p>
<p>Spring提供的注解，优点就是配置简单，依赖少，缺点是同一个task，如果前一个还没跑完后面一个就不会触发，不同的task也不能同时运行。因为scheduler的默认线程数为1，配置pool-size为2的话，会导致同一个task前一个还没跑完后面又被触发的问题，不支持集群等。</p>
<h3 id="Quartz"><a href="#Quartz" class="headerlink" title="Quartz"></a>Quartz</h3><p>Quartz 是一个完全由 Java 编写的开源作业调度框架，它可以集成在几乎任何Java应用程序中进行作业调度。</p>
<p>Quartz 可以与 J2EE 与 J2SE 应用程序相结合也可以单独使用。</p>
<p>Quartz 允许程序开发人员根据时间的间隔来调度作业。</p>
<p>Quartz 实现了作业和触发器的多对多的关系，还能把多个作业与不同的触发器关联。</p>
<p>Quartz的运行环境</p>
<p>Quartz 可以运行嵌入在另一个独立式应用程序。</p>
<p>Quartz 可以在应用程序服务器(或 servlet 容器)内被实例化，并且参与 XA 事务。</p>
<p>Quartz 可以作为一个独立的程序运行(其自己的 Java 虚拟机内)，可以通过 RMI 使用。</p>
<p>Quartz 可以被实例化，作为独立的项目集群(负载平衡和故障转移功能)，用于作业的执行。</p>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a><strong>拦截器</strong></h2><p>一个完善的Web应用一定要考虑安全问题，比如，只有登录上系统的用户才能查看系统内的资源，或者只有具备相关权限，才能访问对应的资源，为此，我们需要学习一下拦截器，通过拦截器我们就能够实现这些安全认证。</p>
<p>这里以登录检查为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class LoginInterceptor implements HandlerInterceptor &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">        HttpSession session &#x3D; request.getSession();</span><br><span class="line">        </span><br><span class="line">        Object user &#x3D; session.getAttribute(&quot;user&quot;);</span><br><span class="line">        if(user !&#x3D; null)&#123;</span><br><span class="line">            </span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        response.sendRedirect(&quot;&#x2F;toLogin&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写好拦截器后需要将其配置到容器中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyWebMvcConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">        </span><br><span class="line">        registry.addInterceptor(new LoginInterceptor())</span><br><span class="line">                .addPathPatterns(&quot;&#x2F;**&quot;) </span><br><span class="line">                .excludePathPatterns(&quot;toLogin&quot;, &quot;&#x2F;css&#x2F;**&quot;, &quot;&#x2F;js&#x2F;**&quot;, &quot;&#x2F;fonts&#x2F;**&quot;, &quot;&#x2F;images&#x2F;**&quot;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要指定该拦截器需要拦截哪些资源，需要放行哪些资源，这样一个简单的登录校验就完成了。</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a><strong>文件上传</strong></h2><p>Spring Boot中该如何实现文件上传呢？现有如下的一个表单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th&#x3D;&quot;http:&#x2F;&#x2F;www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;&#x2F;upload&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;f&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>编写控制方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class FileController &#123;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;&#x2F;upload&quot;)</span><br><span class="line">    public String upload(@RequestPart(&quot;f&quot;) MultipartFile file)&#123;</span><br><span class="line">        String name &#x3D; file.getOriginalFilename();</span><br><span class="line">        long size &#x3D; file.getSize();</span><br><span class="line">        return name + &quot;:&quot; + size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过@RequestPart注解即可将上传的文件封装到MultipartFile中，通过该对象便可以获取到文件的所有信息。输出结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwQ0g16A0M2u8FtjicATQWpxfqRqAAIxpexYh0nYoZTVbxWyVdyKSy0iaA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>若是上传多个文件，则先修改表单信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&#x2F;upload&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;f&quot; multiple&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>

<p>在文件框位置添加multiple属性即可支持多文件上传，然后修改控制器代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;&#x2F;upload&quot;)</span><br><span class="line">public String upload(@RequestPart(&quot;f&quot;) MultipartFile[] file)&#123;</span><br><span class="line">    return file.length + &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若是需要将上传的文件保存到服务器，则可以如此做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;&#x2F;upload&quot;)</span><br><span class="line">public String upload(@RequestPart(&quot;f&quot;) MultipartFile[] file) throws IOException &#123;</span><br><span class="line">    for (MultipartFile multipartFile : file) &#123;</span><br><span class="line">        if(!multipartFile.isEmpty())&#123;</span><br><span class="line">            </span><br><span class="line">            String filename &#x3D; multipartFile.getOriginalFilename();</span><br><span class="line">            </span><br><span class="line">            multipartFile.transferTo(new File(&quot;E:\\&quot; + filename));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为Spring Boot默认的文件上传大小限制为1MB，所以只要文件稍微大了一点就会上传失败，为此，可以修改SpringBoot的默认配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.servlet.multipart.max-file-size&#x3D;30MB # 配置单个文件上传大小限制</span><br><span class="line">spring.servlet.multipart.max-request-size&#x3D;100MB # 配置总文件上传大小限制</span><br></pre></td></tr></table></figure>



<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a><strong>错误处理</strong></h2><p>默认情况下，SpringBoot应用出现了异常或错误会自动跳转至/error页面，也就是这个熟悉的页面：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwfSJ3M2E2CH295oCIWdKYiayZPz4B3RFGibX5tHLlUqCYABKqiaLASDvWg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>然而一般情况下，我们都不会选择出异常时显示这个页面，而是想要显示我们自己定制的页面，为此，我们可以在/static或/templates目录下新建一个error目录，并在/error目录下放置命名为4xx、5xx的页面，SpringBoot会自动帮助我们解析。 </p>
<p>此时当出现5xx的异常时，SpringBoot会自动跳转至5xx.html页面，当然你也可以对每个状态码都做一个页面进行对应，比如放置500.html、501.html、502.html文件，当服务器出现对应的异常时，就会跳转至对应的页面。</p>
<h2 id="健康检查、审计、统计和监控"><a href="#健康检查、审计、统计和监控" class="headerlink" title="健康检查、审计、统计和监控"></a>健康检查、审计、统计和监控</h2><p>Spring Boot Actuator可以帮助你监控和管理Spring Boot应用，比如健康检查、审计、统计和HTTP追踪等。所有的这些特性可以通过JMX或者HTTP endpoints来获得</p>
<p>Actuator同时还可以与外部应用监控系统整合，比如 Prometheus, Graphite, DataDog, Influx, Wavefront, New Relic等。这些系统提供了非常好的仪表盘、图标、分析和告警等功能，使得你可以通过统一的接口轻松的监控和管理你的应用。</p>
<p>Actuator使用Micrometer来整合上面提到的外部应用监控系统。这使得只要通过非常小的配置就可以集成任何应用监控系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>Actuator创建了所谓的<strong>endpoint</strong>来暴露HTTP或者JMX来监控和管理应用</p>
<p><code>/health</code>endpoint，提供了关于应用健康的基础信息。</p>
<p><code>/metrics</code>endpoints展示了几个有用的度量信息，比如JVM内存使用情况、系统CPU使用情况、打开的文件等等。</p>
<p><code>/loggers</code>endpoint展示了应用的日志和可以让你在运行时改变日志等级</p>
<p><strong>值得注意的是，每一个actuator endpoint可以被显式的打开和关闭。此外，这些endpoints也需要通过HTTP或者JMX暴露出来，使得它们能被远程进入</strong></p>
<h2 id="数据层"><a href="#数据层" class="headerlink" title="数据层"></a><strong>数据层</strong></h2><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a><strong>JDBC</strong></h3><p>若想使用原生的JDBC进行开发，SpringBoot已经为我们配置好了JDBC的相关信息，只需要引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;5.1.49&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Spring Boot 底层自动配置了HikariDataSource数据源，所以我们只需指定数据源的地址、用户名和密码即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url&#x3D;jdbc:mysql:</span><br><span class="line">spring.datasource.username&#x3D;root</span><br><span class="line">spring.datasource.password&#x3D;123456</span><br><span class="line">spring.datasource.driver-class-name&#x3D;com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>

<p>因为SpringBoot已经自动配置好了JdbcTemplate，所以我们直接使用就可以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        List&lt;String&gt; names &#x3D; jdbcTemplate.queryForList(&quot;select name from student&quot;,String.class);</span><br><span class="line">        for (String name : names) &#123;</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a><strong>Druid</strong></h3><p>若是不想使用Spring Boot底层的数据源，我们也可以修改默认配置，以Druid数据源为例，首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;druid-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.1.10&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>并对Druid进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开启Druid的监控页功能</span><br><span class="line">spring.datasource.druid.stat-view-servlet.enabled&#x3D;true</span><br><span class="line"># 开启防火墙功能</span><br><span class="line">spring.datasource.druid.filter-class-names&#x3D;stat,wall</span><br><span class="line"># 配置监控页的用户名和密码</span><br><span class="line">spring.datasource.druid.stat-view-servlet.login-username&#x3D;admin</span><br><span class="line">spring.datasource.druid.stat-view-servlet.login-password&#x3D;123</span><br><span class="line"># 开启Druid的Web监控功能</span><br><span class="line">spring.datasource.druid.web-stat-filter.enabled&#x3D;true</span><br><span class="line"># 配置监控哪些请求</span><br><span class="line">spring.datasource.druid.web-stat-filter.url-pattern&#x3D;...</span><br></pre></td></tr></table></figure>

<p>此时访问<a target="_blank" rel="noopener" href="http://localhost:8080/druid%EF%BC%8C%E5%B0%86%E4%BC%9A%E6%9D%A5%E5%88%B0Druid%E7%9A%84%E7%9B%91%E6%8E%A7%E9%A1%B5%EF%BC%9A">http://localhost:8080/druid，将会来到Druid的监控页：</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsjuQ9hhKup7oUdNM5yHX5vwmSnFVzD1lv7yyqibGtymFIjf9ickz8Ak2vRCergkAOdK7gzCXNAMBQicA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a><strong>MyBatis</strong></h3><p>接下来我们将整合MyBatis框架，并介绍它的简单使用。首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mybatis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.1.4&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>然后编写Mapper接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface StudentMapper &#123;</span><br><span class="line"></span><br><span class="line">    Student getStu(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Mappe配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;DTD Mapper 3.0&quot; &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.wwj.springboot.dao.StudentMapper&quot;&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;getStu&quot; resultType&#x3D;&quot;com.wwj.springboot.bean.Student&quot;&gt;</span><br><span class="line">        select * from student where id &#x3D; #&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>最后配置一下MyBatis：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置Mapper配置文件的位置</span><br><span class="line">mybatis.mapper-locations&#x3D;classpath:mappers</span><br></pre></td></tr></table></figure>

<p>这样就可以使用MyBatis了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private StudentMapper studentMapper;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        Student stu &#x3D; studentMapper.getStu(1);</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><strong>Redis</strong></h3><p>若是想要整合Redis，也非常地简单，首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>然后进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 主机地址</span><br><span class="line">spring.redis.host&#x3D;172.16.136.196</span><br></pre></td></tr></table></figure>

<p>只需要配置Redis的主机地址就可以操作Redis了，操作步骤如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; operations &#x3D; redisTemplate.opsForValue();</span><br><span class="line">        operations.set(&quot;name&quot;,&quot;zhangsan&quot;);</span><br><span class="line">        String name &#x3D; operations.get(&quot;name&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若是想使用Jedis操作Redis，则需要导入Jedis的依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;redis.clients&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jedis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>并配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.redis.client-type&#x3D;jedis</span><br></pre></td></tr></table></figure>





<h2 id="Filter-ThreadLocal"><a href="#Filter-ThreadLocal" class="headerlink" title="Filter+ThreadLocal"></a>Filter+ThreadLocal</h2><p>由于jwt的出现，使请求方法的参数中不再携带用户的标识，而是将含有用户信息的token放入请求头中，在该请求进入业务之前就要进行层层过滤拦截，这时候就会牵扯出来了一个问题，如何在当前请求的线程中保存该请求用户的信息。</p>
<ol>
<li><p>ThreadLocal<br>ThreadLocal叫做线程变量，意思是ThreadLocal中填充的变量属于当前线程，该变量对其他线程而言是隔离的。ThreadLocal为变量在每个线程中都创建了一个副本，那么每个线程可以访问自己内部的副本变量。</p>
<p>所以设计思路是，我们可以将每个访问的请求拦截下，为其分配线程变量，就先是全局变量一样，在这次请求访问的所有作用域处都可以从中拿出变量进行使用：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 存储/获取当前线程的用户信息工具类</span></span><br><span class="line"><span class="comment"> 	*/</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//线程变量，存放user实体类信息，即使是静态的与其他线程也是隔离的</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;User&gt; userThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;User&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//从当前线程变量中获取用户信息</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">getLoginUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       User user = userThreadLocal.get();</span><br><span class="line">       <span class="keyword">return</span> user;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取当前登录用户的ID</span></span><br><span class="line"><span class="comment">    * 未登录返回null</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getLoginUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      User user = userThreadLocal.get();</span><br><span class="line">      <span class="keyword">if</span> (user != <span class="keyword">null</span> &amp;&amp; user.getId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> user.getId();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为当前的线程变量赋值上用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setLoginUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    userThreadLocal.set(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//清除线程变量</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userThreadLocal.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>我们可以看出LocalThread的应用场景：</p>
<p>1、在进行对象跨层传递的时候，使用ThreadLocal可以避免多次传递，打破层次间的约束。</p>
<p>2、线程间数据隔离</p>
<p>3、进行事务操作，用于存储线程事务信息。</p>
<p>4、数据库连接，Session会话管理。</p>
<ol start="2">
<li>Filter中的使用</li>
</ol>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口业务均在api下</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;testFilter&quot;,urlPatterns = &#123;&quot;/api/*&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(AccessInterceptor.class);</span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">     HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">     String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">     <span class="comment">// 拿到token后，可以自行处理，这里假设从token获取到了id</span></span><br><span class="line">     <span class="keyword">if</span>(userId != <span class="keyword">null</span>)&#123;</span><br><span class="line">         User user = userService.getById(userId);</span><br><span class="line">         UserUtils.setLoginUser(user);</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		UserUtils.setLoginUser(<span class="keyword">null</span>);  </span><br><span class="line">	&#125;</span><br><span class="line">     <span class="comment">//执行,在后续的拦截器中还可以再进行权限拦截</span></span><br><span class="line">     filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>在拦截器中的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// access为自定义权限注解，if条件指该接口访问权限至少要登录（具备token）</span></span><br><span class="line">     <span class="keyword">if</span> (access.level().getCode() &gt;= AccessLevel.LOGIN.getCode()) &#123;</span><br><span class="line">     	<span class="comment">//这里可以直接在拦截器中再次获取用户信息</span></span><br><span class="line">         User user = UserUtils.getLoginUser();</span><br><span class="line">         <span class="keyword">if</span> (user == <span class="keyword">null</span> || user.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">             response.setStatus(<span class="number">401</span>);</span><br><span class="line">             logger.info(<span class="string">&quot;access &quot;</span> + method.getName() + <span class="string">&quot; Not logged in&quot;</span>);</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (user.getType() &lt; access.level().getCode()) &#123;</span><br><span class="line">             response.setStatus(<span class="number">403</span>);</span><br><span class="line">             logger.info(<span class="string">&quot;access &quot;</span> + method.getName() + <span class="string">&quot; No authority&quot;</span>);</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. Controller&#x2F;Service层的使用</span><br><span class="line"></span><br><span class="line">​&#96;&#96;&#96;java</span><br><span class="line">&#x2F;&#x2F;在Controller或是Service中依然可以通过线程变量或取该用户信息</span><br><span class="line">User user &#x3D; UserUtils.getLoginUser();</span><br><span class="line">long userId &#x3D; UserUtils.getLoginUserId();</span><br></pre></td></tr></table></figure>

<p>我们可以看到，在进行对象跨层传递的时候，使用ThreadLocal可以避免多次传递，打破层次间的约束。使用起来确实十分方便，但是也要有注意的地方：</p>
<p><img src="https://img-blog.csdnimg.cn/20200811152649433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjgyMjQ4NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ol>
<p>上图详细的说明了ThreadLocal和Thread以及ThreadLocalMap三者之间的关系。</p>
<p>1、Thread中有一个map，即ThreadLocalMap。</p>
<p>2、ThreadLocalMap的key是ThreadLocal，值是我们自己赋值的。</p>
<p>3、ThreadLocal是一个弱引用，当为null时侯，会被当成垃圾回收。</p>
<p>4、如果我们ThreadLocal是null了，也就是要被垃圾回收器回收了，但是此时我们的ThreadLocalMap生命周期和Thread的一样，它不会回收，这时候就出现了一个现象。那就是ThreadLocalMap的key没了，但是value还在，这就造成了内存泄漏。</p>
<p>解决办法：使用完ThreadLocal后，即拦截器的后处理，执行remove操作，避免出现内存溢出情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    UserUtils.removeUser();  <span class="comment">//其中调用的就是 userThreadLocal.remove();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ApplicationRunner（一个spring容器启动完成执行的类）"><a href="#ApplicationRunner（一个spring容器启动完成执行的类）" class="headerlink" title="ApplicationRunner（一个spring容器启动完成执行的类）"></a>ApplicationRunner（一个spring容器启动完成执行的类）</h2><p>在项目中，可能会遇到这样一个问题：在项目启动完成之后，紧接着执行一段代码。<br>在SpringBoot中，提供了一个接口：<strong>ApplicationRunner</strong>。<br>该接口中，只有一个run方法，他执行的时机是：<strong>spring容器启动完成之后，就会紧接着执行这个接口实现类的run方法。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class PublishEndpoint implements ApplicationRunner&#123;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void run(ApplicationArguments applicationArguments) throws Exception &#123;</span><br><span class="line">	&#x2F;&#x2F;do something</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有几点说明：</p>
<ul>
<li>这个实现类，要注入到spring容器中，这里使用了@Component注解；</li>
<li>在同一个项目中，可以定义多个ApplicationRunner的实现类，他们的执行顺序通过注解@Order注解或者再实现Ordered接口来实现。</li>
<li>run方法的参数：ApplicationArguments可以获取到当前项目执行的命令参数。（比如把这个项目打成jar执行的时候，带的参数可以通过ApplicationArguments获取到）；</li>
<li>由于该方法是在容器启动完成之后，才执行的，所以，这里可以从spring容器中拿到其他已经注入的bean。</li>
</ul>
<h2 id="新建一个springboot项目"><a href="#新建一个springboot项目" class="headerlink" title="新建一个springboot项目"></a>新建一个springboot项目</h2><p>一、创建项目</p>
<p>1.File-&gt;new-&gt;project；</p>
<p><img src="https://img-blog.csdnimg.cn/20190801203834598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>2.选择“Spring Initializr”，点击next；（jdk1.8默认即可）</p>
<p><img src="https://img-blog.csdnimg.cn/20190801204126964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>选择default可能会因为网速导致项目新建失败。</p>
<p>不选择默认的Default，而是适用Custom，输入aliyun的镜像节点：<a target="_blank" rel="noopener" href="http://start.aliyun.com/">http://start.aliyun.com</a></p>
<p>3.完善项目信息，组名可不做修改，项目名可做修改；最终建的项目名为：test，src-&gt;main-&gt;java下包名会是：com-&gt;example-&gt;test；点击next；</p>
<p><img src="https://img-blog.csdnimg.cn/2019080120463896.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>4.Web下勾选Spring Web Start，（网上创建springboot项目多是勾选Web选项，而较高版本的Springboot没有此选项，勾选Spring Web Start即可，2.1.8版本是Spring Web）；Template Englines勾选Thymeleaf；SQL勾选：MySQL Driver，JDBC API 和 MyBatis Framework三项；点击next；</p>
<p><img src="https://img-blog.csdnimg.cn/20190801205736116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>5.选择项目路径，点击finish；打开新的窗口；</p>
<p><img src="https://img-blog.csdnimg.cn/20190801205931712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM5Mjk4NjI1,size_16,color_FFFFFF,t_70" alt="img"></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">SpringBoot</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/12.3.SpringBoot/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-12.4.SpringCloud" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/12.4.SpringCloud/">SpringCloud</a>
    </h1>
  

        
        <a href="/2021/04/17/12.4.SpringCloud/" class="archive-article-date">
  	<time datetime="2021-04-17T05:05:47.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>SpringCloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。</p>
<p>2.4.2 Spring Cloud组成</p>
<p>Spring Cloud的子项目，大致可分成两类，一类是对现有成熟框架”Spring Boot化”的封装和抽象，也是数量最多的项目；第二类是开发了一部分分布式系统的基础设施的实现，如Spring Cloud Stream扮演的就是kafka, ActiveMQ这样的角色。对于我们想快速实践微服务的开发者来说，第一类子项目就已经足够使用，如：</p>
<p>.Spring Cloud Netflix<br>　　是对Netflix开发的一套分布式服务框架的封装，包括服务的发现和注册，负载均衡、断路器、REST客户端、请求路由等。</p>
<p>.Spring Cloud Config<br>　　将配置信息中央化保存, 配置Spring Cloud Bus可以实现动态修改配置文件</p>
<p>.Spring Cloud Bus<br>　　分布式消息队列，是对Kafka, MQ的封装</p>
<p>.Spring Cloud Security<br>　　对Spring Security的封装，并能配合Netflix使用</p>
<p>.Spring Cloud Zookeeper<br>　　对Zookeeper的封装，使之能配置其它Spring Cloud的子项目使用</p>
<p>.Spring Cloud Eureka</p>
<p>Spring Cloud Eureka 是 Spring Cloud Netflix 微服务套件中的一部分，它基于Netflix Eureka 做了二次封装，主要负责完成微服务架构中的服务治理功能。</p>
<p>2.4.3  Spring Cloud架构</p>
<p>　我们从整体来看一下 Spring Cloud主要的组件,以及它的访间流程<br> 1、外部或者内部的非 Spring Cloud目都统一通过API网关(Zuul)来访可内部服务.<br> 2、网关接收到请求后,从注册中心( Eureka)获取可用服务<br> 3、由 Ribbon进行均负载后,分发到后端的具体实例<br> 4、徹服务之间通过 Feign进行通信处理业务<br> 5、 Hystrix负责处理服务超时熔断<br> 6、 Turbine监控服务间的调用和焠断相关指标</p>
<h2 id="各个spring产品比较"><a href="#各个spring产品比较" class="headerlink" title="各个spring产品比较"></a>各个spring产品比较</h2><p>3 Spring和SpringMVC</p>
<ol>
<li><p>spring是一个一站式的轻量级的java开发框架，核心是控制反转（IOC）和面向切面（AOP），针对于开发的WEB层(springMvc)、业务层(Ioc)、持久层(jdbcTemplate)等都提供了多种配置解决方案；</p>
</li>
<li><p>springMvc是spring基础之上的一个MVC框架，主要处理web开发的路径映射和视图渲染，属于spring框架中WEB层开发的一部分；</p>
</li>
</ol>
<p>4 SpringMVC和SpringBoot</p>
<ol>
<li><p>springMvc属于一个企业WEB开发的MVC框架，涵盖面包括前端视图开发、文件配置、后台接口逻辑开发等，XML、config等配置相对比较繁琐复杂；</p>
</li>
<li><p>springBoot框架相对于springMvc框架来说，更专注于开发微服务后台接口，不开发前端视图；</p>
</li>
</ol>
<p>5 Spring，Spring MVC，Spring Boot 三者比较</p>
<p>这三者专注的领域不同，解决的问题也不一样；总的来说，Spring 就像一个大家族，有众多衍生产品例如 Boot，Security，JPA等等。但他们的基础都是Spring 的 IOC 和 AOP，IOC提供了依赖注入的容器，而AOP解决了面向切面的编程，然后在此两者的基础上实现了其他衍生产品的高级功能；Spring MVC是基于 Servlet 的一个 MVC 框架，主要解决 WEB 开发的问题，因为 Spring 的配置非常复杂，各种xml，properties处理起来比较繁琐。于是为了简化开发者的使用，Spring社区创造性地推出了Spring Boot，它遵循约定优于配置，极大降低了Spring使用门槛，但又不失Spring原本灵活强大的功能，下面用一张图来描述三者的关系：</p>
<p>6 SpringBoot和SpringCloud</p>
<p>1.Spring Boot使用了默认大于配置的理念，集成了快速开发的Spring多个插件，同时自动过滤不需要配置的多余的插件，简化了项目的开发配置流程，一定程度上取消xml配置，是一套快速配置开发的脚手架，能快速开发单个微服务；</p>
<p>2.SpringCloud大部分的功能插件都是基于SpringBoot去实现的，springCloud关注于全局的微服务整合和管理，将多个SpringBoot单体微服务进行整合以及管理；SpringCloud依赖于SpringBoot开发，而SpringBoot可以独立开发；</p>
<p>7 结论</p>
<p>1.Spring 框架就像一个家族，有众多衍生产品例如 boot、security、jpa等等。但他们的基础都是Spring的ioc、aop等. ioc 提供了依赖注入的容器， aop解决了面向横切面编程，然后在此两者的基础上实现了其他延伸产品的高级功能；</p>
<p>2.SpringMvc是基于Servlet 的一个MVC框架主要解决WEB开发的问题，因为Spring的配置非常复杂，各种XML、JavaConfig、servlet处理起来比较繁琐；</p>
<p>3.为了简化开发者的使用，从而创造性地推出了SpringBoot框架，默认优于配置，简化了SpringMVC的配置流程；</p>
<p>但区别于SpringMVC的是，SpringBoot专注于微服务方面的接口开发，和前端解耦，虽然SpringBoot也可以做成SpringMVC前后台一起开发，但是这就有点不符合SpringBoot框架的初衷了；</p>
<p>4.对于SpringCloud框架来说，它和SpringBoot一样，注重的是微服务的开发，但是SpringCloud更关注的是全局微服务的整合和管理，相当于管理多个SpringBoot框架的单体微服务;</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/12.4.SpringCloud/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-18.1.Postman" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/18.1.Postman/">Postman</a>
    </h1>
  

        
        <a href="/2021/04/17/18.1.Postman/" class="archive-article-date">
  	<time datetime="2021-04-17T05:02:01.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>postman是一款支持http协议的接口调试与测试工具，其主要特点就是功能强大，使用简单且易用性好 。</p>
<p>无论是开发人员进行接口调试，还是测试人员做接口测试，postman都是我们的首选工具之一 。</p>
<p>那么接下来就介绍下postman到底有哪些功能，它们分别都能干些什么 。下面先通过一张图来直观的来看下postman中所包含的功能 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FljLG8vcmXEoBc5Zy02HzOk50Vz3YsGq2cCLuBhKhPwfWsWaicjL2oSbQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>当然，以上功能也只是展示了postman的一部分功能，为了能更加全面的体现这款工具的特点，我将从以下三个维度来加以说明。它们分别是：</p>
<ul>
<li><p>基础功能</p>
</li>
<li><ul>
<li>常见类型的接口请求</li>
<li>接口响应数据的解析</li>
<li>接口管理(Collection)</li>
<li>批量执行接口请求</li>
<li>日志调试</li>
<li>断言</li>
<li>变量</li>
<li>请求前置脚本</li>
<li>接口关联</li>
<li>常见的返回值获取</li>
</ul>
</li>
<li><p>便捷功能快</p>
</li>
<li><ul>
<li>速填写查询参数</li>
<li>快速填写请求头信息</li>
<li>快速实现添加一个请求</li>
<li>如何继承集合认证</li>
<li>批量断言</li>
<li>快速查询和替换</li>
</ul>
</li>
<li><p>高级功能</p>
</li>
<li><ul>
<li>读取文件进行参数化</li>
<li>生成测试报告</li>
<li>代码中发送请求</li>
<li>编写接口文档</li>
<li>mock服务</li>
<li>监控</li>
<li>使用工作空间</li>
<li>代码同步与分支管理</li>
<li>连接数据库</li>
<li>apis</li>
</ul>
</li>
</ul>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="一-postman安装说明"><a href="#一-postman安装说明" class="headerlink" title="一. postman安装说明"></a><strong>一. postman安装说明</strong></h1><p>postman 在 2018 年之后就不再支持浏览器版本，所以，想要使用它就必须先下载客户端再安装使用，下面就以 Windows 系统为例进行安装 。</p>
<p><strong>1. 下载与安装</strong></p>
<p>postman安装步骤：</p>
<p>\1. 访问postman官方网站，下载最新版本</p>
<p>访问地址：<a target="_blank" rel="noopener" href="https://www.getpostman.com/">https://www.getpostman.com/</a></p>
<p>\2. 进入到下载页面，根据自己电脑下载对应的版本</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flo5FzPWSpwW8L1UozoTf4MJtPadpMEQtSiaqLECarT9ZeUBIGhFJiceBA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\3. 双击下载的安装包，进入到安装界面，直到用户登录和注册界面。</p>
<p>若个人使用，选择跳过即可，这时会进入到postman主界面，至此postman安装成功(下图)。</p>
<p>若团队使用，可以进行注册，注册后使用账号可以加入团队工作区</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl3qRTwy57vlII9FEOiaUjBWXCn2iaSwIn5Os3iapje8TmItZCQ5sAoFxibg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>2.界面导航说明</strong></p>
<p>初次使用postman的朋友可能对界面上的一些元素不太熟悉，下面就通过一张图来说明这些元素的含义 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flu2buNNHaeoxxruibkucBWxjVPx22P2nUHHaW5vxRCSmuWj0nd4bHMzw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>3.发送第一个请求</strong></p>
<p>如果你是第一次使用postman发送请求，下面这个例子可以作为一个最基本的入门，可以帮我们建立一个初始印象 。</p>
<p>\1. 打开postman，点击+加号打开一个新的请求页。</p>
<p>\2. 在请求的URL中输入请求地址：</p>
<p><a target="_blank" rel="noopener" href="http://www.weather.com.cn/data/sk/101010100.html">http://www.weather.com.cn/data/sk/101010100.html</a></p>
<p>\3. 点击Send按钮，这时就可以在下部的窗格中看到来自服务器的json响应数据。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl5icYWjQgcB1EOsu1Jmt3gicYPTXPxia5tibDvhxDCODFW3UbMZic1up1VGw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h1 id="二-postman基础功能"><a href="#二-postman基础功能" class="headerlink" title="二.postman基础功能"></a><strong>二.postman基础功能</strong></h1><p><strong>1.常见类型的接口请求</strong></p>
<p>常见的接口有如下四种类型，分别是含有查询参数的接口，表单类型的接口，json类型的接口以及含有上传文件的接口，以下就对这四种类型接口及如何在postman中请求进行说明 。</p>
<p><strong>1.1 .查询参数的接口请求</strong></p>
<p><strong>什么是查询参数?</strong></p>
<p>所谓的查询参数，其实就是URL地址中问号（?）后面的部分就叫查询参数，比如：<a target="_blank" rel="noopener" href="http://cx.shouji.360.cn/phonearea.php?number=13012345678">http://cx.shouji.360.cn/phonearea.php?number=13012345678</a> 。在这个接口中，查询参数就是:<strong>number=13012345678</strong> 。</p>
<p>而这一部分是由有键值对组成，格式为：key1=value1&amp;key2=value2, 如果有多组键值对，要用&amp;隔开 。</p>
<p><strong>postman如何请求</strong></p>
<p>在postman中实现对这类接口请求非常简单，一般就需要明确俩个参数即可，一个是请求方法，一个请求地址。</p>
<p>针对上面的那个接口，地址已经给出 ，而它的请求方法是get 。那么在postman中只需要把这俩个参数填写上即可请求 。</p>
<p>具体实现步骤：</p>
<p>\1. 打开postman，新建一个请求。</p>
<p>\2. 在请求方法中选择请求方法：GET,因为在postman中默认的请求方法就是GET,所以这一步可以忽略</p>
<p>\3. 接口URL中输入地址，点击Send按钮就可以发送请求了 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlibV1Mf2OLgxcuwUTHdrISFm1cjYqyITROnbniafQUveJEqwmAiaBmV1ag/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>说明：查询参数的URL一般直接拷贝到输入的URL地址栏中就可以了，当然也可以把查询参数在Params中输入，俩者的效果是一样的 。</p>
<p><strong>1.2 表单类型的接口请求</strong></p>
<p><strong>什么是表单 ？</strong></p>
<p>我们都知道，在发送HTTP请求的时候，一个请求中一般包含三个部分，分别是请求行，请求头，请求体 。</p>
<p>不同的接口，请求体的数据类型是不一样的，比较常见的一种就是表单类型，那么什么是表单类型呢 ？简单理解就是在请求头中查看<strong>Content-Type，它的值如果是:application/x-www-form-urlencoded</strong> .那么就说明客户端提交的数据是以表单形式提交的 。见下图：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlVPe9tFf87Udh16SQn2IAl13VWTueDkV2VLpSzjtSsre74BtBG1St2A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>postman中如何请求？</strong></p>
<p>如果在postman请求上图的接口，我们只需要填写四个参数，分别是(可以参考上图)：</p>
<ul>
<li><p>请求方法：POST</p>
</li>
<li><p>请求URL：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login&amp;t=0.21942974229794432">http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login&amp;t=0.21942974229794432</a></p>
</li>
<li><p>请求头：Content-Type：application/x-www-form-urlencode</p>
</li>
<li><p>请求体：username=13088888888&amp;password=123456&amp;verify_code=8888</p>
</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>打开postman，新建一个请求 。</li>
<li>在请求中设置以上四个参数，点击Send按钮。在postman中设置请求体类型为，需要<strong>选择body-&gt; x-www-form-urlencoded</strong></li>
<li>查看响应数据。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl4KnApVbx69fbFOyN4cicNt3DlnR4P6E2KQdAwm3H8A4nL4jMMJ5OrwA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>1.3 上传文件的表单请求</strong></p>
<p>在做接口测试时，我们经常会遇到需要上传文件的接口，比如微信的更新头像。这就需要用到：multipart/form-data。它也属于一种表单，但它既支持表单请求，也支持文件上传。它的请求报文中数据往往是下面这样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;localhost&#x2F;index.php&#x2F;home&#x2F;Uploadify&#x2F;imageUp&#x2F;savepath&#x2F;head_pic&#x2F;pictitle&#x2F;banner&#x2F;dir&#x2F;images.html HTTP&#x2F;1.1</span><br><span class="line">Content-Type: multipart&#x2F;form-data</span><br><span class="line"></span><br><span class="line">file&#x3D;a1.jpg</span><br></pre></td></tr></table></figure>

<p>这种类型的接口，在postman中该如何请求呢 ？我们先分析需要填写的参数 。</p>
<ul>
<li><p>请求方法：POST</p>
</li>
<li><p>请求URL：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/index.php/home/Uploadify/imageUp/savepath/head_pic/pictitle/banner/dir/images.html">http://localhost/index.php/home/Uploadify/imageUp/savepath/head_pic/pictitle/banner/dir/images.html</a></p>
</li>
<li><p>请求类型：multipart/form-data</p>
</li>
<li><p>请求体：file=a1.jpg</p>
</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>打开postman，新建一个请求 。</li>
<li>在请求中设置以上四个参数，点击Send按钮。注意：在postman中设置请求体类型，需要<strong>选择body-&gt; form-data</strong> 。file中要选择File类型，然后上传本地的文件 。</li>
<li>查看响应数据。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlmbvvEP8osueINea3jABEAYrVes8AU13fj0h5MnP3SRlQhqxdia7785w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>1.4 json类型的接口请求</strong></p>
<p>这应该是接口测试中最常见的一种情况了 ， 也就是请求体类型为json,我们来看下这个请求报文 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;xxx&#x2F;api&#x2F;sys&#x2F;login HTTP&#x2F;1.1</span><br><span class="line">Content-Type: application&#x2F;json;charset&#x3D;UTF-8</span><br><span class="line"></span><br><span class="line">&#123;&quot;account&quot;:&quot;root&quot;,&quot;password&quot;:&quot;123456&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>根据以上报文，我们可以分析出，我们在postman只需要填写四个参数即可，具体如下：</p>
<ul>
<li>请求方法：POST</li>
<li>请求地址：<a target="_blank" rel="noopener" href="http://xxx/api/sys/login">http://xxx/api/sys/login</a></li>
<li>请求体类型：json</li>
<li>请求体数据：{“account”:”root”,”password”:”123456”}</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>打开postman，新建一个请求 。</li>
<li>在请求中设置以上四个参数，点击Send按钮。注意：在postman中设置请求体类型，需要<strong>选择body-&gt; raw -JSON</strong></li>
<li>查看响应数据。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlKEyT3hrRLxClerL9ribBQfSeFrcV4bu8rp9dEv5tAmQ7xmu4GiaxL5Ng/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>2.接口响应数据解析</strong></p>
<p>响应数据是发送请求后经过服务器处理后返回的结果，响应由三部分组成，分别是状态行、响应头、响应体。我们来看下postman的响应数据展示。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlfT37Gy9Qsfc62iaicTtTx7SFbM8tDK4rcvjKhkJL2asf5SCf9xm3rPhA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在postman中的响应数据展示：</p>
<ul>
<li>状态行：Status：200 OK</li>
<li>响应头：Headers + Cookies，需要注意的是Cookies是包含在响应头中的，但是为了明显，工具会分开显示</li>
<li>响应体：Body</li>
</ul>
<p>那么这些数据对我们做接口测试有什么作用呢 ？</p>
<ul>
<li>Body和Status是我们做接口测试的重点，一般来说我们都会验证响应体中的数据和响应状态码</li>
<li>Test Results 是我们编写断言后，可以查看断言的执行结果 ，所以这个对我们也很有用 。</li>
<li>Time 和Size 是我们做性能测试时，可以根据这两个参数来对所测接口的性能做一个简单的判断。</li>
</ul>
<p>接下来我们再来关注下Body中的几个显示主题，分别是：Pretty，Raw，Preview .</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fldya46bWMCiaZEocvuLUKS4kpZ4bJia8AYe4OiaaDWgoGbxoCbbibDkVyUw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Pretty:翻译成中文就是漂亮 ， 也就是说返回的Body数据在这个标签中查看 ，都是经过格式化的，格式化后的数据看起来更加直观，所以postman默认展示的也是这个选项。比如返回html页面，它会经过格式化成HTML格式后展示，比如返回json，那么也会格式化成json格式展示 。</p>
<p>Raw：翻译成中文未经过加工的，也就是原始数据 ，原始数据一般都是本文格式的，未经过格式化处理的，一般在抓包工具中都有这个选项 。</p>
<p>Preview：翻译成中文就是预览，这个选项一般对返回HTML的页面效果特别明显，如请求百度后返回结果，点击这个选项后就直接能查看到的页面 ，如下图 。同时这个选项和浏览器抓包中的Preview也是一样的 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl6BGgoTRORufMic6V8c2YEm5mzDauicgTdr3megI5lNc6zO7JYpqaUzBw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>3. 接口管理（Collection）</strong></p>
<p>当我们对一个或多个系统中的很多用例进行维护时，首先想到的就是对用例进行分类管理，同时还希望对这批用例做回归测试 。在postman也提供了这样一个功能，就是Collection 。通过这个Collection就可以满足我们的上面说的需求。</p>
<p>先对Collection功能的使用场景做个简单总结 。</p>
<ul>
<li>用例分类管理，方便后期维护</li>
<li>可以进行批量用例回归测试 。</li>
</ul>
<p>那么Collection是如何去管理用例的呢 ？先想象我们要测试一个系统，系统下有多个模块，每个模块下有很多的被测接口用例 。那么基于这个场景，我们来通过Collection来进行实现：</p>
<p>\1. 点击Collection，点击+New Collection，在弹出的输入框中输入Collection名称（这个就可以理解为所测试的系统）</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlF4W4b5gHTEp9ibQFxHzvaBnhEOeWwm9szUn7fdkNJKgrF8srXFAvPjA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\2. 选中新建的Collection右键，点击Add Folder ，在弹出对话框中输入文件夹名称（这个就可以理解为系统中的模块）</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FljpiaOpL0k0UXiaLj4NChLgkrw0KGYAyK1EhfCgFT4uF2VzkqZ7RiaIS6g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\3. 选中新建的Folder，点击Add Request ，在弹出的对话框中输入请求名称，这个就是我们所测试的接口，也可以理解为测试用例 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flh7DP0X6alp6uhCzMmzaRxLgh4aBDfooGlGzQ8t7nWYTiaPrzCf8SZBQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>那么通过以上三个步骤，达到的效果就是如图所示：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlMKJf6o0cNlH8BiccQK7Xdn6E1UaQR6Rym6lZkfY022hrduEdTk1cggQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>总结，通过上面的操作，我们实现了一个最简单的demo模型。但实际上，有了这个功能才是postman学习的开始，因为很多功能都是基础这个功能的基础上进行的，比如用例的批量执行，Mock ，接口文档等功能 。</p>
<p><strong>4. 批量执行接口请求</strong></p>
<p>当我们在一个Collection中编写了很多的接口测试用例，想一起执行这批用例，在postman中是如何操作呢 ？</p>
<p>实现步骤：</p>
<p>\1. 选中一个Collection，点击右三角，在弹出的界面点击RUN</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flzec1dGXM233VrM4W3dDu0vic8ib2MjdbOzN8o8Wk8BU07VDqtOVHLKfg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\2. 这是会弹出一个叫Collection Runner的界面，默认会把Collection中的所有用例选中 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlUVXVIrJF4HXOibun27kmsUSYS5PrNqqjLOQZpbwdFDv32o33Rjcibc2w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>\3. 点击界面下方的RUN Collection，就会对Collection中选中的所有测试用例运行 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl6b4kwTE3lypBbt8AZOzHicYWnkWjbeK2tdDGAgvUo68Zwr3NzfGjCrg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>对上面的几个红框内的功能进行简单说明：</p>
<ul>
<li><strong>断言统计</strong>：左上角的两个0是统计当前Collection中断言成功的执行数和失败的执行数，如果没有编写断言默认都为0 。</li>
<li>Run Summary: 运行结果总览，点击它可以看到每个请求中具体的测试断言详细信息 。Export Result：导出运行结果，默认导出的结果json文件 。</li>
<li>Retry: 重新运行，点击它会把该Collection重新运行一遍</li>
<li>New：返回到Runner，可以重新选择用例的组合 。</li>
</ul>
<p>总体来说，这个功能主要是用于对一个Collection中的所有用例或部分用例进行批量运行，已达到手工回归测试的目的。</p>
<p><strong>5.日志调试</strong></p>
<p>在做接口测试时，经常会因为代码写的有问题导致报错，这时通过查看日志就显得非常重要了，postman也提供了这样的功能，它允许我们在脚本中编写打印语句，查看打印的结果 ; 同时也可以查看每个请求的日志信息 。</p>
<p>在postman中编写日志打印语句使用的是JavaScript，编写的位置可以是Pre-request Script 或Tests标签中。编写打印语句如：console.log(“我是一条日志”)</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlPJiauFRraOVSibfXSBicganibSkHeicJQzyE3n4R1Yicr4Ovu3GVM4galic1Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>那么打印的日如何看呢 ？在postman中有俩个入口，第一个入口就是：view-show postman console 。</p>
<p>第二个入口就是左下角第三个图标 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlsNmeiaCqkGIwLX2JRUgSaOTxyoMOrIEEd6H7uLC0QmCSrqjY4qL78Hg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>打开的日志界面：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl1ClyeJtoia7OxjLqMYTMvyoia3xicAXgJTXd8Phgx7Bo1qT8mrC7nkXRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>这里面有几个比较实用的功能：</p>
<ul>
<li>搜索日志：输入URL或者打印的日志就能直接搜索出我们想要的请求和日志，这对我们在众多日志中查找某一条日志是非常方便的 。</li>
<li>按级别搜索：可以查询log,info,warning,error级别的日志 ，有助于我们更快定位到错误 。</li>
<li>查看原始报文(Show raw log)：如果习惯看原始请求报文的话，这个功能可能更方便些 。</li>
<li>隐藏请求(Hide network)：把请求都隐藏掉，只查看输出日志 。</li>
</ul>
<p>总之，通过这个功能，我们在请求接口报错时，通过打印响应的日志，就能很轻松的找到问题原因了 。</p>
<p><strong>6.断言</strong></p>
<p>如果没有断言，我们只能做接口的功能测试，但有了断言后，就为我们做自动化提供了条件，并且在postman中的断言是非常方便和强大的 。</p>
<p>我们先来了解下postman断言的一些特点 ，具体如下</p>
<ul>
<li>断言编写位置：Tests标签</li>
<li>断言所用语言：JavaScript</li>
<li>断言执行顺序：在响应体数据返回后执行 。</li>
<li>断言执行结果查看：Test Results</li>
</ul>
<p>在上面我们介绍到，编写的断言代码是JavaScript，那如果不会写怎么办 ？不用担心，因为postman已经给我们内置了一些常用的断言 。用的时候，只需从右侧点击其中一个断言，就会在文本框中自动生成对应断言代码块 。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlGf6DyNBU8C9eyBXT3Whk0TgmG58Nibp9SEMVPrnqgfUYBwLM3X7293g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>接下来就让我们了解一些常用断言，还是按响应的组成来划分，分别是状态行，响应头，响应体。</p>
<p>状态行中又包括状态码，状态消息 。在postman也可以对这两个进行断言</p>
<p><strong>状态行中的断言</strong>：</p>
<ul>
<li>断言状态码：<strong>Status code: code is 200</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Status code is 200&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.status(200); &#x2F;&#x2F;这里填写的200是预期结果，实际结果是请求返回结果</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<ul>
<li>断言状态消息：<strong>Status code：code name has string</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Status code name has string&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.status(&quot;OK&quot;); &#x2F;&#x2F;断言响应状态消息包含OK</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>响应头中的断言</strong></p>
<ul>
<li>断言响应头中包含：Response headers:Content-Type header check</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Content-Type is present&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.header(&quot;Content-Type&quot;); &#x2F;&#x2F;断言响应头存在&quot;Content-Type&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>断言响应体(重点)</strong></p>
<ul>
<li>断言响应体中包含XXX字符串：Response body:Contains string</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Body matches string&quot;, function () &#123;</span><br><span class="line">    pm.expect(pm.response.text()).to.include(&quot;string_you_want_to_search&quot;);</span><br><span class="line">&#125;); </span><br><span class="line">&#x2F;&#x2F;注解</span><br><span class="line">pm.expect(pm.response.text()).to.include(&quot;string&quot;) 获取响应文本中包含string</span><br></pre></td></tr></table></figure>



<ul>
<li>断言响应体等于XXX字符串：Response body : is equal to a string</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Body is correct&quot;, function () &#123;</span><br><span class="line">    pm.response.to.have.body(&quot;response_body_string&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;注解</span><br><span class="line">pm.response.to.have.body(&quot;response_body_string&quot;); 获取响应体等于response_body_string</span><br></pre></td></tr></table></figure>



<ul>
<li>断言响应体(json)中某个键名对应的值：Response body : JSON value check</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Your test name&quot;, function () &#123;</span><br><span class="line">    var jsonData &#x3D; pm.response.json();</span><br><span class="line">    pm.expect(jsonData.value).to.eql(100);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;注解</span><br><span class="line">var jsonData &#x3D; pm.response.json() 获取响应体，以json显示，赋值给jsonData .注意：该响应体必须返会是的json，否则会报错</span><br><span class="line">pm.expect(jsonData.value).to.eql(100) 获取jsonData中键名为value的值，然后和100进行比较</span><br></pre></td></tr></table></figure>



<p><strong>响应时间(一般用于性能测试)</strong></p>
<ul>
<li>断言响应时间：Response time is less than 200ms</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm.test(&quot;Response time is less than 200ms&quot;, function () &#123;</span><br><span class="line">    pm.expect(pm.response.responseTime).to.be.below(200); &#x2F;&#x2F;断言响应时间&lt;200ms</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>案例说明</strong>：</p>
<p>针对以下接口返回的数据进行断言：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;cityid&quot;: &quot;101120101&quot;,</span><br><span class="line">    &quot;city&quot;: &quot;济南&quot;,</span><br><span class="line">    &quot;update_time&quot;: &quot;2020-04-17 10:50&quot;,</span><br><span class="line">    &quot;wea&quot;: &quot;晴&quot;,</span><br><span class="line">    &quot;wea_img&quot;: &quot;qing&quot;,</span><br><span class="line">    &quot;tem&quot;: &quot;16&quot;,</span><br><span class="line">    &quot;tem_day&quot;: &quot;20&quot;,</span><br><span class="line">    &quot;tem_night&quot;: &quot;9&quot;,</span><br><span class="line">    &quot;win&quot;: &quot;东北风&quot;,</span><br><span class="line">    &quot;win_speed&quot;: &quot;3级&quot;,</span><br><span class="line">    &quot;win_meter&quot;: &quot;小于12km&#x2F;h&quot;,</span><br><span class="line">    &quot;air&quot;: &quot;113&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>断言响应状态码为200</li>
<li>断言city等于济南</li>
<li>断言update_time包含2020-04-17</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlLFewBCYqrlHW20UmKudtFx9g8aOKia7ibEypul6AFseCFeicIics9Mak9g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>总结，整体来说，如果用postman做接口测试，这个断言功能必不可少，其中我们常断言的响应体包含和JSON这俩个断言又是重重之重。</p>
<p><strong>7. 变量（全局/集合/环境）</strong></p>
<p>变量可以使我们在请求或脚本中存储和重复使用其值，通过将值保存在变量中，可以在集合，环境或请求中引用。</p>
<p>对我们做接口测试来说，又是一个非常重要的功能 。</p>
<p>在postman常用的三种变量分别是全局变量，环境变量，集合变量 。</p>
<ul>
<li><strong>全局变量</strong>：一旦申明了全局变量，全局有效，也就是说postman中的任何集合，任何请求中都可以使用这个变量。它的作用域是最大的 。</li>
<li><strong>环境变量</strong>：要申明环境变量，首先的创建环境，然后在环境中才能创建变量 。如果要想使用环境变量，必须先选择(导入)这个环境，这样就可以使用这个环境下的变量了 。需要说明的是环境也可以创建多个 。每个环境下又可以有多个变量 。</li>
<li><strong>集合变量</strong>：集合变量是针对集合的，也就是说申明的变量必须基于某个集合，它的使用范围也只是针对这个集合有效 。</li>
</ul>
<p>其中，他们的作用域范围依次从大到小：全局变量&gt;集合变量&gt;环境变量 。当在几个不同的范围内都申明了相同的变量时，则会优先使用范围最小的变量使。</p>
<p>想要使用变量中的值只需俩个步骤，分别是定义变量和获取变量 。</p>
<ol>
<li>定义变量（设置变量）</li>
<li>获取变量（访问变量）</li>
</ol>
<p><strong>定义变量</strong></p>
<p>定义全局变量和环境变量，点击右上角的小齿轮，弹出如下界面，就可以根据需求定义全局变量或者环境变量了。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flx1HD6IJ11YoKCQav7eHoAic0qf8hbI1dbMB1nCxWSRmuP3deruv1how/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>已经定义的全局变量和环境变量，可以进行快速查看：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlTnuA0aOnQzo0wHQb0iaXEHfpQkod92E9zMOfVw0MZUNtibH8KZZqWJsA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>定义集合变量</strong></p>
<p>选择一个集合，打开查看更多动作(<strong>…</strong>)菜单，然后点击编辑 。选择“变量”选项卡以编辑或添加到集合变量。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Flwfwfc4K53NlbDpwhicnM1vwhGqrxCicHDMyqSoHuibDJ9rXKqPYmfxricw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>定义变量除了以上方式，还有另外一种方式 。但是这种方式在不同的位置定义，编写不一样。</p>
<p>在URL，Params , Authorization , Headers , Body中定义：</p>
<p>\1. 手工方式创建一个空的变量名</p>
<p>\2. 在以上的位置把想要的值选中右击，选中Set：环境|全局 ，选中一个变量名，点击后就会保存到这个变量中</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlYNjEy0GI4H1UNMMqdsydqb0OfIFqqFGDE85TxVrIQxuxOYD9ic2INIw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在Tests，Pre-requests Script：</p>
<ul>
<li>定义全局变量：pm.collectionVariables.set(“变量名”,变量值)</li>
<li>定义环境变量：pm.environment.set(“变量名”，变量值)</li>
<li>定义集合变量：pm.variables.set(“变量名”,变量值)</li>
</ul>
<p><strong>获取变量</strong></p>
<p>定义好变量，接下来就可以使用变量了 。需要注意的是，在不同的位置获取变量，编写的规则也是不一样的 。</p>
<p>如果在<strong>请求参数中</strong>获取变量，无论是获取全局变量，还是环境变量，还是集合变量，获取的方式都是一样的编写规则： 。</p>
<ul>
<li>请求参数指的是：URL，Params , Authorization , Headers , Body</li>
</ul>
<p>如果是在编写代码的位置(Tests,Pre-requests Script)获取变量，获取不同类型的变量，编写的代码都不相同，具体如下：</p>
<ul>
<li>获取环境变量：pm.environment.get(‘变量名’)</li>
<li>获取全局变量：pm.globals.get(‘变量名’)</li>
<li>获取集合变量：pm.pm.collectionVariables.get.get(‘变量名’)</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl0YA8QPHDpsdWAMfkWAxticSOeiax1HP8Sqnb4qu6nibiapXKTtyUeYnRqw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>变量的使用场景非常广泛，比如我们后面要提到的接口关联，请求前置脚本都会使用到变量 。</p>
<p><strong>8. 请求前置脚本</strong></p>
<p>前置脚本其实就是在Pre-requests Script中编写的JavaScript脚本，想要了解这个功能，需要先了解它的执行顺序。那么下面就来看下它的执行顺序 。</p>
<p>可以看出，一个请求在发送之前，会先去执行Pre Request Script（前置脚本）中的代码 。那么这个功能在实际工作中有什么作用呢 ？</p>
<p>主要场景：一般情况下，在发送请求前需要对接口的数据做进一步处理，就都可以使用这个功能，比如说，登录接口的密码，在发送前需要做加密处理，那么就可以在前置脚本中做加密处理，再比如说，有的接口的输入参数有一些随机数，每请求一次接口参数值都会发送变化，就可以在前置脚本中编写生成随机数的代码 。</p>
<p>总体来说，就是在请求接口之前对我们的请求数据进行进一步加工处理的都可以使用前置脚本这个功能。</p>
<p>接下来通过一个案例来看下该功能是如何使用 ？</p>
<p>案例：</p>
<ul>
<li><p>请求的登录接口URL，参数t的值要求的规则是每次请求都必须是一个随机数。</p>
</li>
<li><p>接口地址：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/index.php%EF%BC%9Fm=Home&amp;c=User&amp;a=do_login&amp;t=0.7102045930338428">http://localhost/index.php？m=Home&amp;c=User&amp;a=do_login&amp;t=0.7102045930338428</a></p>
</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8Fl90JA0Trd0rMBeq5HJcrlZBC4WfoqRIBqic1Gsib5GJLc32DUvTBTUg3Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>实现步骤：</p>
<ol>
<li>在前置脚本中编写生成随机数</li>
<li>将这个值保存成环境变量</li>
<li>将参数t的值替换成环境变量的值 。</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FliaWAtcJKFaOia5VfHSPk7ZBNhVDq1IQ7GGoR7DR43D4v77hdLlTxibp6g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>总之，这个前置脚本对我们做接口测试也非常有用，对一些复杂的场景，都可以使用前置脚本进行处理后再请求接口 。</p>
<p><strong>9. 接口关联</strong></p>
<p>在我们测试的接口中，经常出现这种情况 。上一个接口的返回数据是下一个接口的输入参数 ，那么这俩个接口就产生了关联。这种关联在做接口测试时非常常见，那么在postman中，如何实现这种关联关系呢 ？</p>
<p>实现思路：</p>
<ol>
<li>提取上一个接口的返回数据值，</li>
<li>将这个数据值保存到环境变量或全局变量中</li>
<li>在下一个接口获取环境变量或全局变量</li>
</ol>
<p>案例：</p>
<ul>
<li>用户上传头像功能，需要用户先上传一张图片，然后会自动预览 。那么在这个过程中，会调用到俩个接口 ，第一个上传头像接口，第二个预览图像接口 。</li>
<li>其中调用上传头像接口成功后会返回如下信息：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;url&quot;: &quot;&#x2F;public&#x2F;upload&#x2F;user&#x2F;&#x2F;head_pic&#x2F;&#x2F;ba51d1c2f7f7b98dfb5cad90846e2d79.jpg&quot;,</span><br><span class="line">    &quot;title&quot;: &quot;banner&quot;,</span><br><span class="line">    &quot;original&quot;: &quot;&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;SUCCESS&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;images&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>而图像预览接口URL为：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/public/upload/user//head_pic//ba51d1c2f7f7b98dfb5cad90846e2d79.jpg">http://localhost/public/upload/user//head_pic//ba51d1c2f7f7b98dfb5cad90846e2d79.jpg</a> 。可以看出这个接口的URL后半部分其实是上一个接口返回的url的值 。那么这俩个接口就产生了关联。那么在postman 可以通过以下三步完成这俩个接口的关联实现 。</p>
<p>实现步骤：</p>
<ol>
<li>获取上传头像接口返回url的值</li>
<li>将这个值保存成全局变量(环境变量也可以)</li>
<li>在图像预览中使用全局变量</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/RQueXibgo0KO86E3YaibgVlWrpeia0uc8FlehOIJJubLWOiczR2Zzib3y1iac2I1R3fxmGPU8O6orVSbjj0gdSPD1p2Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>可以看出，接口的关联的解决方案都是用的是变量中的知识，也就是说只要你明确了要提取的值，后面就是保存该值，然后在其他接口使用该值就可以了。</p>
<p><strong>10.常见返回值获取</strong></p>
<p>在做接口测试时，请求接口返回的数据都是很复杂的json数据，有着多层嵌套，这样的数据层级在postman怎么获取呢 ？</p>
<p>案例1：多层json嵌套, 获取user_id的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;message&quot;: &quot;请求成功！&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;user_id&quot;: &quot;1252163151781167104&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获取json体数据</span><br><span class="line">var jsonData &#x3D; pm.response.json()</span><br><span class="line">&#x2F;&#x2F; 获取user_id的值,通过.获取</span><br><span class="line">var user_id &#x3D; jsonData.data.user_id</span><br></pre></td></tr></table></figure>



<p>案例2：json中存在列表，获取points中的第二个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;message&quot;: &quot;请求成功！&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;roles&quot;: &#123;</span><br><span class="line">            &quot;api&quot;: [</span><br><span class="line">                &quot;API-USER-DELETE&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;points&quot;: [</span><br><span class="line">                &quot;point-user-delete&quot;,</span><br><span class="line">                &quot;POINT-USER-UPDATE&quot;,</span><br><span class="line">                &quot;POINT-USER-ADD&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;authCache&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获取json体数据</span><br><span class="line">var jsonData &#x3D; pm.response.json()</span><br><span class="line">&#x2F;&#x2F; 获取user_id的值,通过下标获取列表中某个元素</span><br><span class="line">var user_id &#x3D; jsonData.data.roles.points[1]</span><br></pre></td></tr></table></figure>



<p>案例3：列表中取最后一个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;message&quot;: &quot;请求成功！&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;total&quot;: 24,</span><br><span class="line">        &quot;rows&quot;: [</span><br><span class="line">           </span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: &quot;1066370498633486336&quot;,</span><br><span class="line">                &quot;mobile&quot;: &quot;15812340003&quot;,</span><br><span class="line">                &quot;username&quot;: &quot;zbz&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: &quot;1071632760222810112&quot;,</span><br><span class="line">                &quot;mobile&quot;: &quot;16612094236&quot;,</span><br><span class="line">                &quot;username&quot;: &quot;llx&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            ...</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: &quot;1075383133106425856&quot;,</span><br><span class="line">                &quot;mobile&quot;: &quot;13523679872&quot;,</span><br><span class="line">                &quot;username&quot;: &quot;test001&quot;,</span><br><span class="line">       </span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;获取json体数据</span><br><span class="line">var jsonData &#x3D; pm.response.json()</span><br><span class="line">&#x2F;&#x2F; 获取id的值,通过slice(-1)获取列表中最后一个元素。</span><br><span class="line">var id &#x3D; jsonData.data.rows.slice(-1)[0]</span><br></pre></td></tr></table></figure>
      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/18.1.Postman/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-17.1.Maven" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/17.1.Maven/">Maven</a>
    </h1>
  

        
        <a href="/2021/04/17/17.1.Maven/" class="archive-article-date">
  	<time datetime="2021-04-17T05:01:48.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="下载后maven的配置文件"><a href="#下载后maven的配置文件" class="headerlink" title="下载后maven的配置文件"></a>下载后maven的配置文件</h3><p>maven本地仓库，有个默认的位置，就是用户目录下的.m2/repository，最好更改本地仓库的位置，因为以后项目多了可能会导致C盘的maven文件过多占用过大空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将setting.xml文件中的这个配置更改为自己的配置</span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>C:\Users\AngelHHX\.m2\repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>中央仓库的配置（一般不需要配置）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>私服仓库的配置（一般也不需要配置）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">参照上面的中央仓库</span><br></pre></td></tr></table></figure>

<p>镜像的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JDK的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--設定jdk為1.8--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.targer</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.targer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="pom文件（project-object-model）"><a href="#pom文件（project-object-model）" class="headerlink" title="pom文件（project object model）"></a>pom文件（project object model）</h2><p>pom.xml文件为Maven项目的核心配置文件，Maven的各项插件以及依赖均可以在这里配置javascript</p>
<p>pom文件能够继承，超级pom文件等等，好比pom文件定义了一些东西，另外一个pom也想定义 就能够继承</p>
<p>配置项目中须要哪些jar包，就是在Pom中dependency配置<br>maven项目中要想下载指定jar包，查找所需jar包的官网：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a><br>以mybatis为例：<br><img src="/17.1.Maven/106f9201d6a548cd86de2e40941c385f-1.jpg" alt="在这里插入图片描述"></p>
<p><img src="/17.1.Maven/f622f4810316451e8a0c15a76629498c-1.jpg" alt="在这里插入图片描述"></p>
<p><img src="https://resource.shangmayuan.com/droxy-blog/2020/07/10/00c471b3ff8245b3b93bcaddcbe9dd96-1.jpg" alt="在这里插入图片描述">java</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置以后 编译完会在本地仓库里下载jar包<br>不只把指定jar包下载 并且还会把它所依赖的包下载<br>已经下载过的jar包，不会从新下载（maven仓库是同一个仓库,若是换了仓库，也是会从新下载的），若是Jar包版本不同 maven认为是不一样的jar包web</p>
<h2 id="标签和插件"><a href="#标签和插件" class="headerlink" title="标签和插件"></a>标签和插件</h2><h3 id="project标签"><a href="#project标签" class="headerlink" title="project标签"></a>project标签</h3><p>新建spring-boot项目后自动生成，从头至尾，中间包含所有的标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="modelVersion标签"><a href="#modelVersion标签" class="headerlink" title="modelVersion标签"></a>modelVersion标签</h4><p>modelVersion 描述这个POM文件是遵从哪个版本的项目描述符</p>
<p>modelVersion：指定了当前POM模型的版本，对于Maven2及Maven 3来说，它只能是4.0.0；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="parent标签"><a href="#parent标签" class="headerlink" title="parent标签"></a>parent标签</h4><p>springboot-starter-parent主要作用是用来控制引入依赖包的版本控制的,继续点击artifactId进去会看到真正依赖的版本</p>
<p>spring-boot-starter-parent是一个特殊的starter，它用来提供相关的Maven默认依赖。使用它之后，常用的包依赖可以省去version标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span> <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="项目说明标签"><a href="#项目说明标签" class="headerlink" title="项目说明标签"></a>项目说明标签</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">三个必填标签</span><br><span class="line"></span><br><span class="line">groupid 公司名 com.xxx</span><br><span class="line"></span><br><span class="line">artifactId 项目名</span><br><span class="line"></span><br><span class="line">version 版本号</span><br><span class="line">可选填</span><br><span class="line">name</span><br><span class="line">description</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yxtl.server<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yxtl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>film<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span>		</span><br></pre></td></tr></table></figure>



<h4 id="scope依赖范围"><a href="#scope依赖范围" class="headerlink" title="scope依赖范围"></a>scope依赖范围</h4><p>scope:该标签指定依赖的作用域。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="properties标签"><a href="#properties标签" class="headerlink" title="properties标签"></a><strong>properties标签</strong></h4><p>用来定义pom一些属性</p>
<p>比如spring的jar包，各个模块的jar包须要同一个版本，这样就能够把这个版本号维护到properties标签里spring</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus-boot-starter.version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">mybatis-plus-boot-starter.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.40<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-lang3.version</span>&gt;</span>3.6<span class="tag">&lt;/<span class="name">commons-lang3.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hutool-all.version</span>&gt;</span>4.6.2<span class="tag">&lt;/<span class="name">hutool-all.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springfox.version</span>&gt;</span>2.9.1<span class="tag">&lt;/<span class="name">springfox.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.13<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="package标签"><a href="#package标签" class="headerlink" title="package标签"></a>package标签</h4><p>指定如何构建项目的类型（war jar pom…），默认是jar</p>
<p>jar包就是java的类进行编译生成的class文件就行打包的压缩包。里面就是一些class文件</p>
<p>war包就是一个web程序进行打包便于部署的压缩包，里面包含我们web程序需要的一些东西，其中包括web.xml的配置文件，前端的页面文件，以及依赖的jar</p>
<p>文件数量对于jar包，这样便于我们部署工程，直接放到tomcat的webapps目录下，直接启动tomcat即可。同时可以使用WinRAR查看war包，直接将后缀.war改成.rar</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="distributionManagement标签"><a href="#distributionManagement标签" class="headerlink" title="distributionManagement标签"></a>distributionManagement标签</h4><p>mvn install 会将项目生成的构件安装到本地Maven仓库<br>mvn deploy 用来将项目生成的构件分发到远程Maven仓库<br>本地Maven仓库的构件只能供当前用户使用，在分发到远程Maven仓库之后，所有能访问该仓库的用户都能使用你的构件。</p>
<p>Maven区别对待release版本的构件和snapshot版本的构件，snapshot为开发过程中的版本，实时，但不稳定，release版本则比较稳定</p>
<p>我们需要配置POM的distributionManagement来指定Maven分发构件的位置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonatype-nexus-staging<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="scm标签"><a href="#scm标签" class="headerlink" title="scm标签"></a>scm标签</h4><p>SCM：Software Configuration Management。可以支持我们常用SVN、CVS等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">connection</span>&gt;</span><span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span><span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="dependencies标签"><a href="#dependencies标签" class="headerlink" title="dependencies标签"></a>dependencies标签</h4><p>包含不少dependency标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 注：如提示报错，先升级基础包版，无法解决可联系技术支持 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>         </span><br></pre></td></tr></table></figure>

<h4 id="repositories标签"><a href="#repositories标签" class="headerlink" title="repositories标签"></a>repositories标签</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>always<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>jcenter-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>jcenter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jcenter.bintray.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="bulid构建行为列表"><a href="#bulid构建行为列表" class="headerlink" title="bulid构建行为列表"></a>bulid构建行为列表</h4><p>bulid标签配置maven构建项目时的需要执行的各种行为，一般都是maven的插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="resources"><a href="#resources" class="headerlink" title="resources"></a>resources</h5><p>指定当前构建的source目录</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否替换资源中的属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h5><p>指定进行构建时使用的插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.sonatype.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nexus-staging-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">serverId</span>&gt;</span>sonatype-nexus-staging<span class="tag">&lt;/<span class="name">serverId</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">nexusUrl</span>&gt;</span>https://oss.sonatype.org/<span class="tag">&lt;/<span class="name">nexusUrl</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">autoReleaseAfterClose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">autoReleaseAfterClose</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>maven插件</p>
<p>maven 其实是一个依赖插件执行的框架，每一个任务都是插件执行的mybatis</p>
<p>两种插件类型:</p>
<p>Build plugins 在构建中执行，在pom里配置<br>reporting plugins 在网站生成中执行的，也须要在pom中配置 框架</p>
<p>经常使用插件列表:</p>
<p>clean 项目构建以后 用于清理项目<br>compiler 编译java源代码的<br>jar 构建jar文件<br>war 构建war文件<br>tomcat…<br>各个插件官网文档都有做用的说明maven</p>
<h3 id="modules完成项目聚合"><a href="#modules完成项目聚合" class="headerlink" title="modules完成项目聚合"></a>modules完成项目聚合</h3><p>把多个模块聚合到一块。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--demo-parent聚合demo1、demo2、demo3、demo4模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo1<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo2<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo3<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo4<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> demo-parent为父工程，聚合如下四个子工程：</span><br><span class="line">//demo-parent下的子工程，同事子工程之间存在相互依赖，demo-admin依赖demo-core</span><br><span class="line">  <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-admin<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-core<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-rest<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>../demo-generator<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>package打包注意</p>
<p><code>demo-admin</code> 依赖 <code>demo-core</code>，如果在 <code>demo-core</code> 未打包的情况下，单独打包子工程 <code>demo-admin</code>，此时会报错，说找不到 <code>demo-core</code>，因为打包的时候通过pom去maven仓库寻找 <code>demo-core</code>，因 <code>demo-core</code> 不存在所以报错。</p>
<p>如果给 <code>demo-core</code> 执行package命令后，去给 <code>demo-admin</code> 打包还会报同样的错，因为package命令仅仅是在 <code>demo-core</code> 的target目录下生成jar包，并未放入到maven仓库中，所以还是找不到。</p>
<p>所以最终解决方案是执行完package命令后，再执行install命令，此时会把jar安装到maven仓库中。</p>
<h3 id="properties和parent完成依赖继承"><a href="#properties和parent完成依赖继承" class="headerlink" title="properties和parent完成依赖继承"></a>properties和parent完成依赖继承</h3><p>把各个模块公用的依赖抽取成父类，供子模块继承使用。</p>
<ul>
<li>父pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--版本管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql驱动依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql-connector-java.version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">mysql-connector-java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dependencyManagement:管理父类的依赖，把版本号抽取出来放到properties标签中统一管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-java.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>子pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--子类的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-children<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-children<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--继承父类的pom依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.asia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="依赖冲突时"><a href="#依赖冲突时" class="headerlink" title="依赖冲突时"></a>依赖冲突时</h3><ul>
<li>依赖路径最短优先</li>
<li>pom中谁写在前面谁优先</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A--&gt;B</span><br><span class="line">B--&gt;C</span><br><span class="line">C--&gt;common-2.0.jar</span><br><span class="line"></span><br><span class="line">A--&gt;B</span><br><span class="line">B--&gt;common-3.0.jar</span><br></pre></td></tr></table></figure>

<p>介绍：项目依赖了两个版本的common.jar，在打包时会采用依赖路径最短的common.3.0.jar。</p>
<h3 id="exclusions依赖传递排除"><a href="#exclusions依赖传递排除" class="headerlink" title="exclusions依赖传递排除"></a>exclusions依赖传递排除</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;shiro.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--排除依赖传递列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="maven仓库分类"><a href="#maven仓库分类" class="headerlink" title="maven仓库分类"></a>maven仓库分类</h2><p>在maven中，仓库可以分为：</p>
<p>本地仓库、远程仓库。</p>
<ul>
<li>远程仓库可以分为：中央仓库、私服仓库。<br>中央仓库是maven官方指定的仓库，可以理解为“寻找的最后一站”。</li>
<li>私服仓库可以是自己建的，也可以是其它主体建的（比如aliyun的maven仓库，jboss的maven仓库等）。<br>私服可以分为：全局应用的私服仓库、应用到项目自身的私服仓库。</li>
</ul>
<p>maven寻找得顺序大致可以理解为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本地仓库--&gt;私服</span><br><span class="line">私服--&gt;远程仓库</span><br></pre></td></tr></table></figure>

<ol>
<li>在本地仓库中寻找，如果没有则进入下一步。</li>
<li>在全局应用的私服仓库中寻找，如果没有则进入下一步。</li>
<li>在项目自身的私服仓库中寻找，如果没有则进入下一步。</li>
<li>在中央仓库中寻找，如果没有则终止寻找。</li>
</ol>
<h2 id="maven常用命令"><a href="#maven常用命令" class="headerlink" title="maven常用命令"></a>maven常用命令</h2><ul>
<li>package命令完成了项目编译、单元测试、打包功能，但没有把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库和远程maven私服仓库</li>
<li>install命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库，==但没有布署到远程maven私服仓库==</li>
<li>deploy命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到==本地maven仓库和远程maven私服仓库==　　</li>
</ul>
<blockquote>
<p>后一个命令会覆盖前一个命令的操作</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//分别是打包、安装、发布跳过测试命令</span><br><span class="line">mvn package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">mvn install -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">mvn deploy -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure>



<h2 id="Nexus搭建私服"><a href="#Nexus搭建私服" class="headerlink" title="Nexus搭建私服"></a>Nexus搭建私服</h2><p>使用Maven进行项目的声明周期管理，方便对项目依赖和插件进行管理，同时便于项目的统一管理，提升项目开发效率。但是实际工作中会有以下问题：</p>
<p>1  因为安全考虑，有些公司不给开发人员提供外网。因此不能使用maven访问远程的仓库地址。</p>
<p>2  大家同时上网，导致网速比较慢，maven下载构件效率比较低。</p>
<p>3  由于版权的问题，有些第三方jar包无法从远程仓库下载。</p>
<p>4  有些jar包是公司内部使用的，自然也无法从远程maven仓库下载。</p>
<p>所以可以使用Nexus搭建私服：<a target="_blank" rel="noopener" href="https://oss.sonatype.org/#welcome">https://oss.sonatype.org/#welcome</a></p>
<p>所谓私服，是一种特殊的远程服务器，代理广域网上的远程仓库，供局域网内Maven用户使用。需要下载maven构件时候， 先从私服请求，不存在则从外部远程仓库下载，缓存到私服后供下载。对于 一些无法从外部下载的构件，就可以上传到私服供下载使用。</p>
<p>Nexus是常用的私用Maven服务器，一般是公司内部使用。下载地址是<a target="_blank" rel="noopener" href="http://www.sonatype.org/nexus/go%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A38081,%E8%BF%99%E9%87%8C%E6%88%91%E9%80%89%E6%8B%A9%E6%9C%80%E6%96%B0%E7%89%88nexus-2.5.0-04%E3%80%82">http://www.sonatype.org/nexus/go，默认端口8081,这里我选择最新版nexus-2.5.0-04。</a></p>
<p><strong>一 下载安装</strong></p>
<p>地址 <a target="_blank" rel="noopener" href="http://www.sonatype.com/download-oss-sonatype">http://www.sonatype.com/download-oss-sonatype</a></p>
<p>环境 win32  选择版本：nexus-2.13.0-01-bundle.tar.zip</p>
<p>解压安装</p>
<p><img src="/17.1.Maven/201811091422528.png" alt="img"></p>
<p>访问<a target="_blank" rel="noopener" href="http://localhost:8081/nexus/">http://localhost:8081/nexus/</a> 启动后如下页面，在右上角有个Log in 的超链接，点击登录</p>
<p>默认的用户名是 admin 密码是 admin123</p>
<p><img src="/17.1.Maven/201811091422529.png" alt="img"></p>
<p>Public Repositories:  仓库组</p>
<p>3rd party: 无法从公共仓库获得的第三方发布版本的构件仓库</p>
<p>Apache Snapshots: 用来代理ApacheMaven仓库快照版本的构件仓库</p>
<p>Central: 用来代理maven中央仓库中发布版本构件的仓库</p>
<p>Central M1 shadow: 用于提供中央仓库中M1格式的发布版本的构件镜像仓库</p>
<p>Releases: 用来部署管理内部的发布版本构件的宿主类型仓库</p>
<p>Snapshots:用来部署管理内部的快照版本构件的宿主类型仓库</p>
<p><strong>二  IntelliJ IDE使用私服配置</strong></p>
<p>找到maven的安装目录 D:\JetBrains\IntelliJ IDEA 14.1.5\plugins\maven\lib\maven3\conf</p>
<p>修改setting.xml 添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;&#96;&#96;mirrors&#96;&#96;&gt;&#96;&#96; &#96;&#96;&lt;&#96;&#96;mirror&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;id&#96;&#96;&gt;central&lt;&#x2F;&#96;&#96;id&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;mirrorOf&#96;&#96;&gt;*&lt;&#x2F;&#96;&#96;mirrorOf&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;name&#96;&#96;&gt;Central Repository&lt;&#x2F;&#96;&#96;name&#96;&#96;&gt;&#96;&#96;   &#96;&#96;&lt;&#96;&#96;url&#96;&#96;&gt;http:&#x2F;&#x2F;192.168.1.7:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;&#96;&#96;url&#96;&#96;&gt;&#96;&#96;  &#96;&#96;&lt;&#x2F;&#96;&#96;mirror&#96;&#96;&gt;&#96;&#96; &#96;&#96;&lt;&#x2F;&#96;&#96;mirrors&#96;&#96;&gt;</span><br></pre></td></tr></table></figure>

<p>修改 工程设置，一定要把user setting file  钩给勾上 .  OK 工程无需其它配置 就可以使用私服了</p>
<p><img src="/17.1.Maven/2018110914225210.png" alt="img"></p>
<p><strong>三上传构建到私服</strong> </p>
<p>直接用  idea  中的  deploy按钮就可以将 打好的 jar 包或者 war包上传到 私服中  （install  是将jar包 拷贝到本地仓库）<br>maven setting.xml 添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;servers&gt;  </span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;username&gt;admin&lt;&#x2F;username&gt;</span><br><span class="line">    &lt;password&gt;admin123&lt;&#x2F;password&gt;</span><br><span class="line">  &lt;&#x2F;server&gt;</span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;username&gt;admin&lt;&#x2F;username&gt;</span><br><span class="line">    &lt;password&gt;admin123&lt;&#x2F;password&gt;</span><br><span class="line">  &lt;&#x2F;server&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;servers&gt;</span><br></pre></td></tr></table></figure>

<p>工程pom.xml 添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Nexus Release Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.7:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;releases&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;snapshotRepository&gt;</span><br><span class="line">      &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Nexus Snapshot Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.7:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;snapshots&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;snapshotRepository&gt;</span><br><span class="line">  &lt;&#x2F;distributionManagement&gt;</span><br></pre></td></tr></table></figure>





<p>常用功能<br>Nexus常用功能就是：指定私服的中央地址、将自己的Maven项目指定到私服地址、从私服下载中央库的项目索引、从私服仓库下载依赖组件、将第三方项目jar上传到私服供其他项目组使用。<br>开启Nexus服务后访问url地址<a target="_blank" rel="noopener" href="http://localhost:8081/nexus/(%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84ip%E5%9C%B0%E5%9D%80)%EF%BC%8C%E4%B9%8B%E5%90%8E%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E5%88%86%E5%88%AB%E6%98%AF%EF%BC%9Aadmin/admin123">http://localhost:8081/nexus/(推荐使用自己的ip地址)，之后登录系统，用户名密码分别是：admin/admin123</a>.<br>最频繁的就是点击左侧菜单栏的Repositories按钮</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxMzU2MjcyNjktMTA5MDQ4MTg2LmpwZw" alt="img"></p>
<p>一般用到的仓库种类是hosted、proxy。Hosted代表宿主仓库，用来发布一些第三方不允许的组件，比如Oracle驱动、比如商业软件jar包。Proxy代表代理远程的仓库，最典型的就是Maven官方中央仓库、JBoss仓库等等。如果构建的Maven项目本地仓库没有依赖包，那么就会去这个代理站点去下载，那么如果代理站点也没有此依赖包，就回去远程中央仓库下载依赖，这些中央仓库就是proxy。代理站点下载成功后再下载至本机。笔者认为，其实Maven这个自带的默认仓库一般情况下已经够大多数项目使用了。特殊情况时在配置新的仓库，指定url即可，一般熟悉ExtJS的人操作这个Nexus都没什么问题，单词不是很难，不明白的查查单词基本差不多。就是如果Sonatype公司对其做了国际化一的处理就更好了。</p>
<p>hosted    类型的仓库，内部项目的发布仓库<br>releases    内部的模块中release模块的发布仓库<br>snapshots    发布内部的SNAPSHOT模块的仓库<br>3rd party    第三方依赖的仓库，这个数据通常是由内部人员自行下载之后发布上去<br>proxy    类型的仓库，从远程中央仓库中寻找数据的仓库<br>group    类型的仓库，组仓库用来方便我们开发人员进行设置的仓库<br>maven项目索引<br>下载Maven项目索引，项目索引是为了使用者能够在私服站点查找依赖使用的功能</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDA0MjA1ODItMTk4ODI4Njk5LmpwZw" alt="img"></p>
<p>保存后后台会运行一个任务，点击菜单栏的Scheduled Tasks选项即可看到有个任务在RUNNING。 下载完成后，Maven索引就可以使用了，在搜索栏输入要搜索的项，就可以查到相关的信息。例如spring-core</p>
<p> <img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDA1NDkyMzgtMTIwNzAwOTYyOC5qcGc" alt="img"></p>
<p>就可以检索出它的相关信息，包括怎么配置依赖信息。我们要想使用这个私服仓库，先在项目pom中配置相关私服信息</p>
<p>指定仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;repositories&gt;</span><br><span class="line"></span><br><span class="line">&lt;repository&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;id&gt;nexus&lt;&#x2F;id&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;name&gt;nexus&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;url&gt;http:&#x2F;&#x2F;192.168.1.103:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;releases&gt;</span><br><span class="line"></span><br><span class="line">​        &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;&#x2F;releases&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;snapshots&gt;</span><br><span class="line"></span><br><span class="line">​        &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line"></span><br><span class="line">​    &lt;&#x2F;snapshots&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;repository&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;repositories&gt;</span><br></pre></td></tr></table></figure>

<p>这样只有本项目才在私服下载组件</p>
<p>这样这个Maven项目构建的时候会从私服下载相关依赖。当然这个配置仅仅是在此项目中生效，对于其他项目还是不起作用。如果相对Maven的其他项目也生效的话。需要修改全局的settings.xml文件。</p>
<p>修改settings.xml为</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEwMjgyODUtMTEzODE2ODYwOC5qcGc" alt="img"></p>
<p>追加激活profile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;activeProfiles&gt;</span><br><span class="line"></span><br><span class="line">    &lt;activeProfile&gt;central&lt;&#x2F;activeProfile&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;activeProfiles&gt;</span><br></pre></td></tr></table></figure>

<p>之后所有本机的Maven项目就在私服下载组件。（这样比较好）</p>
<p>项目的发布</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;id&gt;user-release&lt;&#x2F;id&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;name&gt;User Project Release&lt;&#x2F;name&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;192.168.1.103:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;releases&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;snapshotRepository&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;id&gt;user-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;name&gt;User Project SNAPSHOTS&lt;&#x2F;name&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;192.168.1.103:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;snapshots&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;&#x2F;snapshotRepository&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;distributionManagement&gt;</span><br></pre></td></tr></table></figure>

<p>注意配置了还是发布项目到私服失败，原因为没有权限</p>
<p>配置权限在settings.xml</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEzMDEwNjYtMTQwMjI0ODA2Ny5qcGc" alt="img"></p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEzMTQ3MDctODI4Njg2ODY3LmpwZw" alt="img"></p>
<p>然后运行发布<br>clean deploy<br>在控制台发布成功<br>然后进入到私服上的仓库中，看一下确实存在刚刚发布的项目</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDEzNDQ2NDQtNTc5NzgxNTQ5LmpwZw" alt="img"></p>
<p>宿主库——3rd party<br>假如我们下载了Oracle的驱动程序jar包想给其他项目组使用，就需要上传该jar包。选中宿主库——3rd party，之后选择Artifact Upload上传至宿主空间。</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDE0MzA5NDEtNzMzNTkxNDk1LmpwZw" alt="img"></p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDE0NTAyODUtNjAwODE1MDc2LmpwZw" alt="img"></p>
<p>最后点击上传</p>
<p><img src="/17.1.Maven/aHR0cHM6Ly9pbWFnZXMyMDE1LmNuYmxvZ3MuY29tL2Jsb2cvNjI5MjUwLzIwMTcwNC82MjkyNTAtMjAxNzA0MDcxNDE1MTMyMzgtMTAwNjI4NTM4MC5qcGc" alt="img"></p>
<h2 id="复习标签"><a href="#复习标签" class="headerlink" title="复习标签"></a>复习标签</h2><p>pom作为项目对象模型。通过xml表示maven项目，使用pom.xml来实现。主要描述了项目：包括配置文件；开发者需要遵循的规则，缺陷管理系统，组织和licenses，项目的url，项目的依赖性，以及其他所有的项目相关因素。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>   </span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--父项目的坐标。如果项目中没有规定某个元素的值，那么父项目中的对应值即为项目的默认值。 坐标包括group ID，artifact ID和 version。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--被继承的父项目的构件标识符--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--被继承的父项目的全球唯一标识符--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--被继承的父项目的版本--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!-- 父项目的pom.xml文件的相对路径。相对路径允许你选择一个不同的路径。默认值是../pom.xml。Maven首先在构建当前项目的地方寻找父项 目的pom，其次在文件系统的这个位置（relativePath位置），然后在本地仓库，最后在远程仓库寻找父项目的pom。--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>  </span><br><span class="line"> <span class="comment">&lt;!--声明项目描述符遵循哪一个POM模型版本。模型本身的版本很少改变，虽然如此，但它仍然是必不可少的，这是为了当Maven引入了新的特性或者其他模型变更的时候，确保稳定性。--&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目的全球唯一标识符，通常使用全限定的包名区分该项目和其他项目。并且构建时生成的路径也是由此生成， 如com.mycompany.app生成的相对路径为：/com/mycompany/app--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>asia.banseon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!-- 构件的标识符，它和group ID一起唯一标识一个构件。换句话说，你不能有两个不同的项目拥有同样的artifact ID和groupID；在某个 特定的group ID下，artifact ID也必须是唯一的。构件是项目产生的或使用的一个东西，Maven为项目产生的构件包括：JARs，源 码，二进制发布和WARs等。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>banseon-maven2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目产生的构件类型，例如jar、war、ear、pom。插件可以创建他们自己的构件类型，所以前面列的不是全部构件类型--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目当前版本，格式为:主版本.次版本.增量版本-限定版本号--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目的名称, Maven产生的文档用--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon-maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目主页的URL, Maven产生的文档用--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!-- 项目的详细描述, Maven 产生的文档用。  当这个元素能够用HTML格式描述时（例如，CDATA中的文本会被解析器忽略，就可以包含HTML标 签）， 不鼓励使用纯文本描述。如果你需要修改产生的web站点的索引页面，你应该修改你自己的索引页文件，而不是调整这里的文档。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>A maven project to study maven.<span class="tag">&lt;/<span class="name">description</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--描述了这个项目构建环境中的前提条件。--&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--构建该项目或使用该插件所需要的Maven的最低版本--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">maven</span>/&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span>  </span><br><span class="line"> <span class="comment">&lt;!--项目的问题管理系统(Bugzilla, Jira, Scarab,或任何你喜欢的问题管理系统)的名称和URL，本例为 jira--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--问题管理系统（例如jira）的名字，--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">system</span>&gt;</span>jira<span class="tag">&lt;/<span class="name">system</span>&gt;</span>   </span><br><span class="line">        <span class="comment">&lt;!--该项目使用的问题管理系统的URL--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jira.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目持续集成信息--&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--持续集成系统的名字，例如continuum--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">system</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--该项目使用的持续集成系统的URL（如果持续集成系统有web接口的话）。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--构建完成时，需要通知的开发者/用户的配置项。包括被通知者信息和通知条件（错误，失败，成功，警告）--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">notifiers</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--配置一种方式，当构建中断时，以该方式通知用户/开发者--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">notifier</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--传送通知的途径--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--发生错误时是否通知--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">sendOnError</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--构建失败时是否通知--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">sendOnFailure</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--构建成功时是否通知--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">sendOnSuccess</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--发生警告时是否通知--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">sendOnWarning</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--不赞成使用。通知发送到哪里--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">address</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--扩展配置项--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">notifier</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">notifiers</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span>  </span><br><span class="line"> <span class="comment">&lt;!--项目创建年份，4位数字。当产生版权信息时需要使用这个值。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">inceptionYear</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--项目相关邮件列表信息--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--该元素描述了项目相关的所有邮件列表。自动产生的网站引用这些信息。--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">mailingList</span>&gt;</span>   </span><br><span class="line">         <span class="comment">&lt;!--邮件的名称--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--发送邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建--&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">post</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">post</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建--&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">subscribe</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">subscribe</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--取消订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建--&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">unsubscribe</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">unsubscribe</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--你可以浏览邮件信息的URL--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">archive</span>&gt;</span>http:/hi.baidu.com/banseon/demo/dev/<span class="tag">&lt;/<span class="name">archive</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">mailingList</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目开发者列表--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">developers</span>&gt;</span>   </span><br><span class="line">     <span class="comment">&lt;!--某个项目开发者的信息--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">developer</span>&gt;</span>   </span><br><span class="line">         <span class="comment">&lt;!--SCM里项目开发者的唯一标识符--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>HELLO WORLD<span class="tag">&lt;/<span class="name">id</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--项目开发者的全名--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--项目开发者的email--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">email</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--项目开发者的主页的URL--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>/&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!--项目开发者在项目中扮演的角色，角色元素描述了各种角色--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">roles</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">role</span>&gt;</span>Project Manager<span class="tag">&lt;/<span class="name">role</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">role</span>&gt;</span>Architect<span class="tag">&lt;/<span class="name">role</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">roles</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!--项目开发者所属组织--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">organization</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">organization</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--项目开发者所属组织的URL--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>http://hi.baidu.com/banseon<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--项目开发者属性，如即时消息如何处理等--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">dept</span>&gt;</span>No<span class="tag">&lt;/<span class="name">dept</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!--项目开发者所在时区， -11到12范围内的整数。--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>-5<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">developer</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">developers</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--项目的其他贡献者列表--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">contributors</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--项目的其他贡献者。参见developers/developer元素--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">contributor</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>/&gt;</span><span class="tag">&lt;<span class="name">email</span>/&gt;</span><span class="tag">&lt;<span class="name">url</span>/&gt;</span><span class="tag">&lt;<span class="name">organization</span>/&gt;</span><span class="tag">&lt;<span class="name">organizationUrl</span>/&gt;</span><span class="tag">&lt;<span class="name">roles</span>/&gt;</span><span class="tag">&lt;<span class="name">timezone</span>/&gt;</span><span class="tag">&lt;<span class="name">properties</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">contributor</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">contributors</span>&gt;</span>     </span><br><span class="line">    <span class="comment">&lt;!--该元素描述了项目所有License列表。 应该只列出该项目的license列表，不要列出依赖项目的 license列表。如果列出多个license，用户可以选择它们中的一个而不是接受所有license。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">licenses</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--描述了项目的license，用于生成项目的web站点的license页面，其他一些报表和validation也会用到该元素。--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">license</span>&gt;</span>  </span><br><span class="line">         <span class="comment">&lt;!--license用于法律上的名称--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Apache 2<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--官方的license正文页面的URL--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.baidu.com/banseon/LICENSE-2.0.txt<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--项目分发的主要方式：  </span></span><br><span class="line"><span class="comment">              repo，可以从Maven库下载  </span></span><br><span class="line"><span class="comment">              manual， 用户必须手动下载和安装依赖--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--关于license的补充信息--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">comments</span>&gt;</span>A business-friendly OSS license<span class="tag">&lt;/<span class="name">comments</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">license</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">licenses</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--SCM(Source Control Management)标签允许你配置你的代码库，供Maven web站点和其它插件使用。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">scm</span>&gt;</span>   </span><br><span class="line">        <span class="comment">&lt;!--SCM的URL,该URL描述了版本库和如何连接到版本库。欲知详情，请看SCMs提供的URL格式和列表。该连接只读。--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">connection</span>&gt;</span>   </span><br><span class="line">            scm:svn:http://svn.baidu.com/banseon/maven/banseon/banseon-maven2-trunk(dao-trunk)    </span><br><span class="line">        <span class="tag">&lt;/<span class="name">connection</span>&gt;</span>   </span><br><span class="line">        <span class="comment">&lt;!--给开发者使用的，类似connection元素。即该连接不仅仅只读--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>   </span><br><span class="line">            scm:svn:http://svn.baidu.com/banseon/maven/banseon/dao-trunk    </span><br><span class="line">        <span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!--当前代码的标签，在开发阶段默认为HEAD--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span>/&gt;</span>         </span><br><span class="line">        <span class="comment">&lt;!--指向项目的可浏览SCM库（例如ViewVC或者Fisheye）的URL。--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://svn.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">scm</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!--描述项目所属组织的各种属性。Maven产生的文档用--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">organization</span>&gt;</span>   </span><br><span class="line">     <span class="comment">&lt;!--组织的全名--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">        <span class="comment">&lt;!--组织主页的URL--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">organization</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--构建项目需要的信息--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--该元素设置了项目源码目录，当构建项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">sourceDirectory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--该元素设置了项目脚本源码目录，该目录和源码目录不同：绝大多数情况下，该目录下的内容 会被拷贝到输出目录(因为脚本是被解释的，而不是被编译的)。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">scriptSourceDirectory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--该元素设置了项目单元测试使用的源码目录，当测试项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">testSourceDirectory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--被编译过的应用程序class文件存放的目录。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">outputDirectory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--被编译过的测试class文件存放的目录。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">testOutputDirectory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--使用来自该项目的一系列构建扩展--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--描述使用到的构建扩展。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">extension</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--构建扩展的groupId--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--构建扩展的artifactId--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--构建扩展的版本--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">extension</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--当项目没有规定目标（Maven2 叫做阶段）时的默认值--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">defaultGoal</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--这个元素描述了项目相关的所有资源路径列表，例如和项目相关的属性文件，这些资源被包含在最终的打包文件里。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">resources</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--这个元素描述了项目相关或测试相关的所有资源路径--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">resource</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 描述了资源的目标路径。该路径相对target/classes目录（例如$&#123;project.build.outputDirectory&#125;）。举个例 子，如果你想资源在特定的包里(org.apache.maven.messages)，你就必须该元素设置为org/apache/maven /messages。然而，如果你只是想把资源放到源码目录结构里，就不需要该配置。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">targetPath</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--是否使用参数值代替参数名。参数值取自properties元素或者文件里配置的属性，文件在filters元素里列出。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filtering</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--描述存放资源的目录，该路径相对POM路径--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--包含的模式列表，例如**/*.xml.--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">includes</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--排除的模式列表，例如**/*.xml--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">excludes</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">resource</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resources</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--这个元素描述了单元测试相关的所有资源路径，例如和单元测试相关的属性文件。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">testResources</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--这个元素描述了测试相关的所有资源路径，参见build/resources/resource元素的说明--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">testResource</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">targetPath</span>/&gt;</span><span class="tag">&lt;<span class="name">filtering</span>/&gt;</span><span class="tag">&lt;<span class="name">directory</span>/&gt;</span><span class="tag">&lt;<span class="name">includes</span>/&gt;</span><span class="tag">&lt;<span class="name">excludes</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--构建产生的所有文件存放的目录--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">directory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--产生的构件的文件名，默认值是$&#123;artifactId&#125;-$&#123;version&#125;。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">finalName</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--当filtering开关打开时，使用到的过滤器属性文件列表--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">filters</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--子项目可以引用的默认插件信息。该插件配置项直到被引用时才会被解析或绑定到生命周期。给定插件的任何本地配置都会覆盖这里的配置--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--使用的插件列表 。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--plugin元素包含描述插件所需要的信息。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--插件在仓库里的group ID--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--插件在仓库里的artifact ID--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--被使用的插件的版本（或版本范围）--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--是否从该插件下载Maven扩展（例如打包和类型处理器），由于性能原因，只有在真需要下载时，该元素才被设置成enabled。--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">extensions</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--在构建生命周期中执行一组目标的配置。每个目标可能有不同的配置。--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">executions</span>&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--execution元素包含了插件执行需要的信息--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">execution</span>&gt;</span>  </span><br><span class="line">       <span class="comment">&lt;!--执行目标的标识符，用于标识构建过程中的目标，或者匹配继承过程中需要合并的执行目标--&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>/&gt;</span>  </span><br><span class="line">       <span class="comment">&lt;!--绑定了目标的构建生命周期阶段，如果省略，目标会被绑定到源数据里配置的默认阶段--&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">phase</span>/&gt;</span>  </span><br><span class="line">       <span class="comment">&lt;!--配置的执行目标--&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">goals</span>/&gt;</span>  </span><br><span class="line">       <span class="comment">&lt;!--配置是否被传播到子POM--&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">inherited</span>/&gt;</span>  </span><br><span class="line">       <span class="comment">&lt;!--作为DOM对象的配置--&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">execution</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">executions</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--项目引入插件所需要的额外依赖--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">       ......  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>       </span><br><span class="line">     <span class="comment">&lt;!--任何配置是否被传播到子项目--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">inherited</span>/&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--作为DOM对象的配置--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--使用的插件列表--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span><span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span><span class="tag">&lt;<span class="name">version</span>/&gt;</span><span class="tag">&lt;<span class="name">extensions</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">execution</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">phase</span>/&gt;</span><span class="tag">&lt;<span class="name">goals</span>/&gt;</span><span class="tag">&lt;<span class="name">inherited</span>/&gt;</span><span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">execution</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">      ......  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">goals</span>/&gt;</span><span class="tag">&lt;<span class="name">inherited</span>/&gt;</span><span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span>  </span><br><span class="line"> <span class="comment">&lt;!--在列的项目构建profile，如果被激活，会修改构建处理--&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--根据环境参数或命令行参数激活某个构建处理--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--构建配置的唯一标识符。即用于命令行激活，也用于在继承时合并具有相同标识符的profile。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>/&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--自动触发profile的条件逻辑。Activation是profile的开启钥匙。profile的力量来自于它  </span></span><br><span class="line"><span class="comment">   能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。activation元素并不是激活profile的唯一方式。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">activation</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--profile默认是否激活的标志--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">os</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--激活profile的操作系统的名字--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--激活profile的操作系统所属家族(如 &#x27;windows&#x27;)--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--激活profile的操作系统体系结构 --&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--激活profile的操作系统版本--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">os</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;名称&#125;引用），其拥有对应的名称和值，Profile就会被激活。如果值  </span></span><br><span class="line"><span class="comment">    字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--激活profile的属性的名称--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenVersion<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--激活profile的属性的值--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活  </span></span><br><span class="line"><span class="comment">    profile。另一方面，exists则会检查文件是否存在，如果存在则激活profile。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--如果指定的文件存在，则激活profile。--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">exists</span>&gt;</span>/usr/local/hudson/hudson-home/jobs/maven-guide-zh-to-production/workspace/<span class="tag">&lt;/<span class="name">exists</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--如果指定的文件不存在，则激活profile。--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">missing</span>&gt;</span>/usr/local/hudson/hudson-home/jobs/maven-guide-zh-to-production/workspace/<span class="tag">&lt;/<span class="name">missing</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">file</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">activation</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--构建项目所需要的信息。参见build元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultGoal</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">resource</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">targetPath</span>/&gt;</span><span class="tag">&lt;<span class="name">filtering</span>/&gt;</span><span class="tag">&lt;<span class="name">directory</span>/&gt;</span><span class="tag">&lt;<span class="name">includes</span>/&gt;</span><span class="tag">&lt;<span class="name">excludes</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">resource</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">testResources</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">testResource</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">targetPath</span>/&gt;</span><span class="tag">&lt;<span class="name">filtering</span>/&gt;</span><span class="tag">&lt;<span class="name">directory</span>/&gt;</span><span class="tag">&lt;<span class="name">includes</span>/&gt;</span><span class="tag">&lt;<span class="name">excludes</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">directory</span>/&gt;</span><span class="tag">&lt;<span class="name">finalName</span>/&gt;</span><span class="tag">&lt;<span class="name">filters</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span><span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span><span class="tag">&lt;<span class="name">version</span>/&gt;</span><span class="tag">&lt;<span class="name">extensions</span>/&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">executions</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">phase</span>/&gt;</span><span class="tag">&lt;<span class="name">goals</span>/&gt;</span><span class="tag">&lt;<span class="name">inherited</span>/&gt;</span><span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;/<span class="name">executions</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">         ......  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">goals</span>/&gt;</span><span class="tag">&lt;<span class="name">inherited</span>/&gt;</span><span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span><span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span><span class="tag">&lt;<span class="name">version</span>/&gt;</span><span class="tag">&lt;<span class="name">extensions</span>/&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">executions</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">execution</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">phase</span>/&gt;</span><span class="tag">&lt;<span class="name">goals</span>/&gt;</span><span class="tag">&lt;<span class="name">inherited</span>/&gt;</span><span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;/<span class="name">execution</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">executions</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">       <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">        ......  </span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>/&gt;</span><span class="tag">&lt;<span class="name">inherited</span>/&gt;</span><span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">modules</span>/&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--参见repositories/repository元素--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">releases</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">name</span>/&gt;</span><span class="tag">&lt;<span class="name">url</span>/&gt;</span><span class="tag">&lt;<span class="name">layout</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息.参见repositories/repository元素--&gt;</span>      </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">releases</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>/&gt;</span><span class="tag">&lt;<span class="name">name</span>/&gt;</span><span class="tag">&lt;<span class="name">url</span>/&gt;</span><span class="tag">&lt;<span class="name">layout</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 这些依赖组成了项目构建过程中的一个个环节。它们自动从项目定义的仓库中下载。要获取更多信息，请看项目依赖机制。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">     ......  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--不赞成使用. 现在Maven忽略该元素.--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">reports</span>/&gt;</span>     </span><br><span class="line">   <span class="comment">&lt;!--该元素包括使用报表插件产生报表的规范。当用户执行“mvn site”，这些报表就会运行。 在页面导航栏能看到所有报表的链接。参见reporting元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">reporting</span>&gt;</span>  </span><br><span class="line">    ......  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--参见dependencyManagement元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">      ......  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--参见distributionManagement元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span>  </span><br><span class="line">    ......  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--参见properties元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>/&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span>  </span><br><span class="line"> <span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径--&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">modules</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>   </span><br><span class="line">     <span class="comment">&lt;!--包含需要连接到远程仓库的信息--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">         <span class="comment">&lt;!--如何处理远程仓库里发布版本的下载--&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">releases</span>&gt;</span>  </span><br><span class="line">          <span class="comment">&lt;!--true或者false表示该仓库是否为下载某种类型构件（发布版，快照版）开启。 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳。这里的选项是：always（一直），daily（默认，每日），interval：X（这里X是以分钟为单位的时间间隔），或者never（从不）。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--当Maven验证构件校验文件失败时该怎么做：ignore（忽略），fail（失败），或者warn（警告）。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!-- 如何处理远程仓库里快照版本的下载。有了releases和snapshots这两组配置，POM就可以在每个单独的仓库中，为每种类型的构件采取不同的 策略。例如，可能有人会决定只为开发目的开启对快照版本下载的支持。参见repositories/repository/releases元素 --&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">enabled</span>/&gt;</span><span class="tag">&lt;<span class="name">updatePolicy</span>/&gt;</span><span class="tag">&lt;<span class="name">checksumPolicy</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--远程仓库唯一标识符。可以用来匹配在settings.xml文件里配置的远程仓库--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-repository-proxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span>   </span><br><span class="line">   <span class="comment">&lt;!--远程仓库名称--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon-repository-proxy<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--远程仓库URL，按protocol://hostname/path形式--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.169:9999/repository/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!-- 用于定位和排序构件的仓库布局类型-可以是default（默认）或者legacy（遗留）。Maven 2为其仓库提供了一个默认的布局；然 而，Maven 1.x有一种不同的布局。我们可以使用该元素指定布局是default（默认）还是legacy（遗留）。--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span>             </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息.参见repositories/repository元素--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">   ......  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 这些依赖组成了项目构建过程中的一个个环节。它们自动从项目定义的仓库中下载。要获取更多信息，请看项目依赖机制。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--依赖的group ID--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--依赖的artifact ID--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-artifact<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--依赖的版本号。 在Maven 2里, 也可以配置成版本号的范围。--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!-- 依赖类型，默认类型是jar。它通常表示依赖的文件的扩展名，但也有例外。一个类型可以被映射成另外一个扩展名或分类器。类型经常和使用的打包方式对应， 尽管这也有例外。一些类型的例子：jar，war，ejb-client和test-jar。如果设置extensions为 true，就可以在 plugin里定义新的类型。所以前面的类型的例子不完整。--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!-- 依赖的分类器。分类器可以区分属于同一个POM，但不同构建方式的构件。分类器名被附加到文件名的版本号后面。例如，如果你想要构建两个单独的构件成 JAR，一个使用Java 1.4编译器，另一个使用Java 6编译器，你就可以使用分类器来生成两个单独的JAR构件。--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">classifier</span>&gt;</span><span class="tag">&lt;/<span class="name">classifier</span>&gt;</span>  </span><br><span class="line">            <span class="comment">&lt;!--依赖范围。在项目发布过程中，帮助决定哪些构件被包括进来。欲知详情请参考依赖机制。  </span></span><br><span class="line"><span class="comment">                - compile ：默认范围，用于编译    </span></span><br><span class="line"><span class="comment">                - provided：类似于编译，但支持你期待jdk或者容器提供，类似于classpath    </span></span><br><span class="line"><span class="comment">                - runtime: 在执行时需要使用    </span></span><br><span class="line"><span class="comment">                - test:    用于test任务时使用    </span></span><br><span class="line"><span class="comment">                - system: 需要外在提供相应的元素。通过systemPath来取得    </span></span><br><span class="line"><span class="comment">                - systemPath: 仅用于范围为system。提供相应的路径    </span></span><br><span class="line"><span class="comment">                - optional:   当项目自身被依赖时，标注依赖是否传递。用于连续依赖时使用--&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>     </span><br><span class="line">            <span class="comment">&lt;!--仅供system范围使用。注意，不鼓励使用这个元素，并且在新的版本中该元素可能被覆盖掉。该元素为依赖规定了文件系统上的路径。需要绝对路径而不是相对路径。推荐使用属性匹配绝对路径，例如$&#123;java.home&#125;。--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span><span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--当计算传递依赖时， 从依赖构件列表里，列出被排除的依赖构件集。即告诉maven你只依赖指定的项目，不依赖项目的依赖。此元素主要用于解决版本冲突问题--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span>  </span><br><span class="line">             <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span>   </span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span>     </span><br><span class="line">            <span class="comment">&lt;!--可选依赖，如果你在项目B中把C依赖声明为可选，你就需要在依赖于B的项目（例如项目A）中显式的引用对C的依赖。可选依赖阻断依赖的传递性。--&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--不赞成使用. 现在Maven忽略该元素.--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">reports</span>&gt;</span><span class="tag">&lt;/<span class="name">reports</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--该元素描述使用报表插件产生报表的规范。当用户执行“mvn site”，这些报表就会运行。 在页面导航栏能看到所有报表的链接。--&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">reporting</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--true，则，网站不包括默认的报表。这包括“项目信息”菜单中的报表。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">excludeDefaults</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--所有产生的报表存放到哪里。默认值是$&#123;project.build.directory&#125;/site。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">outputDirectory</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--使用的报表插件和他们的配置。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--plugin元素包含描述报表插件需要的信息--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--报表插件在仓库里的group ID--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--报表插件在仓库里的artifact ID--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--被使用的报表插件的版本（或版本范围）--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--任何配置是否被传播到子项目--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">inherited</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--报表插件的配置--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--一组报表的多重规范，每个规范可能有不同的配置。一个规范（报表集）对应一个执行目标 。例如，有1，2，3，4，5，6，7，8，9个报表。1，2，5构成A报表集，对应一个执行目标。2，5，8构成B报表集，对应另一个执行目标--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">reportSets</span>&gt;</span>  </span><br><span class="line">     <span class="comment">&lt;!--表示报表的一个集合，以及产生该集合的配置--&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">reportSet</span>&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--报表集合的唯一标识符，POM继承时用到--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>/&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--产生报表集合时，被使用的报表的配置--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>/&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--配置是否被继承到子POMs--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">inherited</span>/&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!--这个集合里使用到哪些报表--&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">reports</span>/&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;/<span class="name">reportSet</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">reportSets</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span>  </span><br><span class="line"> <span class="comment">&lt;!-- 继承自该项目的所有子项目的默认依赖信息。这部分的依赖信息不会被立即解析,而是当子项目声明一个依赖（必须描述group ID和 artifact ID信息），如果group ID和artifact ID以外的一些信息没有描述，则通过group ID和artifact ID 匹配到这里的依赖，并使用这里的依赖信息。--&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--参见dependencies/dependency元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    ......  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span>     </span><br><span class="line">    <span class="comment">&lt;!--项目分发信息，在执行mvn deploy后表示要发布的位置。有了这些信息就可以把网站部署到远程服务器或者把构件部署到远程仓库。--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!--部署项目产生的构件到远程仓库需要的信息--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span>  </span><br><span class="line">         <span class="comment">&lt;!--是分配给快照一个唯一的版本号（由时间戳和构建流水号）？还是每次都使用相同的版本号？参见repositories/repository元素--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">uniqueVersion</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span>   </span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon maven2<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;basedir&#125;/target/deploy<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span>/&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--构件的快照部署到哪里？如果没有配置该元素，默认部署到repository元素配置的仓库，参见distributionManagement/repository元素--&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">uniqueVersion</span>/&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Banseon-maven2 Snapshot Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://svn.baidu.com/banseon:/usr/local/maven-snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">   <span class="tag">&lt;<span class="name">layout</span>/&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--部署项目的网站需要的信息--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">site</span>&gt;</span>  </span><br><span class="line">         <span class="comment">&lt;!--部署位置的唯一标识符，用来匹配站点和settings.xml文件里的配置--&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-site<span class="tag">&lt;/<span class="name">id</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--部署位置的名称--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>business api website<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">            <span class="comment">&lt;!--部署位置的URL，按protocol://hostname/path形式--&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>   </span><br><span class="line">                scp://svn.baidu.com/banseon:/var/www/localhost/banseon-web    </span><br><span class="line">            <span class="tag">&lt;/<span class="name">url</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">site</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--项目下载页面的URL。如果没有该元素，用户应该参考主页。使用该元素的原因是：帮助定位那些不在仓库里的构件（由于license限制）。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">downloadUrl</span>/&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--如果构件有了新的group ID和artifact ID（构件移到了新的位置），这里列出构件的重定位信息。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">relocation</span>&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--构件新的group ID--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>/&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--构件新的artifact ID--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>/&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--构件新的版本号--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>/&gt;</span>  </span><br><span class="line">   <span class="comment">&lt;!--显示给用户的，关于移动的额外信息，例如原因。--&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">message</span>/&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- 给出该构件在远程仓库的状态。不得在本地项目中设置该元素，因为这是工具自动更新的。有效的值有：none（默认），converted（仓库管理员从 Maven 1 POM转换过来），partner（直接从伙伴Maven 2仓库同步过来），deployed（从Maven 2实例部 署），verified（被核实时正确的和最终的）。--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">status</span>/&gt;</span>         </span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--以值替代名称，Properties可以在整个POM中使用，也可以作为触发条件（见settings.xml配置文件里activation元素的说明）。格式是&lt;name&gt;value&lt;/name&gt;。--&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span>  </span><br></pre></td></tr></table></figure>



<h2 id="springboot的依赖"><a href="#springboot的依赖" class="headerlink" title="springboot的依赖"></a>springboot的依赖</h2><h3 id="spring-boot-starter-parent"><a href="#spring-boot-starter-parent" class="headerlink" title="spring-boot-starter-parent"></a>spring-boot-starter-parent</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.8.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">Maven的用户可以通过继承spring-boot-starter-parent项目来获得一些合理的默认配置</span><br><span class="line">官方提供的覆盖默认配置的方式：</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">        &lt;mybatis-plus-boot-starter.version&gt;3.4.0&lt;&#x2F;mybatis-plus-boot-starter.version&gt;</span><br><span class="line">        &lt;mysql.version&gt;5.1.40&lt;&#x2F;mysql.version&gt;</span><br><span class="line">        &lt;commons-lang3.version&gt;3.6&lt;&#x2F;commons-lang3.version&gt;</span><br><span class="line">        &lt;hutool-all.version&gt;4.6.2&lt;&#x2F;hutool-all.version&gt;</span><br><span class="line">        &lt;springfox.version&gt;2.9.1&lt;&#x2F;springfox.version&gt;</span><br><span class="line">        &lt;fastjson.version&gt;1.2.13&lt;&#x2F;fastjson.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>

<h3 id="spring-boot-starter-thymeleaf"><a href="#spring-boot-starter-thymeleaf" class="headerlink" title="spring-boot-starter-thymeleaf"></a>spring-boot-starter-thymeleaf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这个包有坑，这个包包含了spring-boot-starter</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="spring-boot-starter"><a href="#spring-boot-starter" class="headerlink" title="spring-boot-starter"></a>spring-boot-starter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">此包包含了很多配置</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="spring-boot-starter-logging"><a href="#spring-boot-starter-logging" class="headerlink" title="spring-boot-starter-logging"></a>spring-boot-starter-logging</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此依赖默认在spring-boot-starter-web下</span><br></pre></td></tr></table></figure>

<h3 id="spring-boot-starter-web"><a href="#spring-boot-starter-web" class="headerlink" title="spring-boot-starter-web"></a>spring-boot-starter-web</h3><p>针对Web应用与网络接口</p>
<h3 id="spring-boot-starter-test"><a href="#spring-boot-starter-test" class="headerlink" title="spring-boot-starter-test"></a>spring-boot-starter-test</h3><h3 id="spring-boot-starter-jdbc"><a href="#spring-boot-starter-jdbc" class="headerlink" title="spring-boot-starter-jdbc"></a>spring-boot-starter-jdbc</h3><p>针对JDBC</p>
<h3 id="spring-boot-starter-aop"><a href="#spring-boot-starter-aop" class="headerlink" title="spring-boot-starter-aop"></a>spring-boot-starter-aop</h3><h3 id="spring-boot-starter-data-jpa"><a href="#spring-boot-starter-data-jpa" class="headerlink" title="spring-boot-starter-data-jpa"></a>spring-boot-starter-data-jpa</h3><p>一套JPA应用框架</p>
<h3 id="spring-boot-starter-cache"><a href="#spring-boot-starter-cache" class="headerlink" title="spring-boot-starter-cache"></a>spring-boot-starter-cache</h3><p>针对缓存支持</p>
<h3 id="mybatis-plus-boot-starter"><a href="#mybatis-plus-boot-starter" class="headerlink" title="mybatis-plus-boot-starter"></a>mybatis-plus-boot-starter</h3><h3 id="mybatis-plus-generator"><a href="#mybatis-plus-generator" class="headerlink" title="mybatis-plus-generator"></a>mybatis-plus-generator</h3><h3 id="velocity-engine-core"><a href="#velocity-engine-core" class="headerlink" title="velocity-engine-core"></a>velocity-engine-core</h3><h3 id="spring-boot-starter-data-redis"><a href="#spring-boot-starter-data-redis" class="headerlink" title="spring-boot-starter-data-redis"></a>spring-boot-starter-data-redis</h3><h3 id="spring-boot-maven-plugin"><a href="#spring-boot-maven-plugin" class="headerlink" title="spring-boot-maven-plugin"></a>spring-boot-maven-plugin</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">放在dependencies之后，可以把项目打包成一个可执行的jar包</span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>


      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">maven</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/17.1.Maven/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-16.1.Docker" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/16.1.Docker/">Docker</a>
    </h1>
  

        
        <a href="/2021/04/17/16.1.Docker/" class="archive-article-date">
  	<time datetime="2021-04-17T05:01:17.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="容器简介"><a href="#容器简介" class="headerlink" title="容器简介"></a><strong>容器简介</strong></h2><h3 id="什么是-Linux-容器"><a href="#什么是-Linux-容器" class="headerlink" title="什么是 Linux 容器"></a><strong>什么是 Linux 容器</strong></h3><p>Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。</p>
<p>容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNJHb3Q3iaoePFedxGK0NdPncQfl6aotsbonTG2FicsX4Bziaw97H4FgQUw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>更加详细地来说，请您假定您在开发一个应用。您使用的是一台笔记本电脑，而且您的开发环境具有特定的配置。其他开发人员身处的环境配置可能稍有不同。您正在开发的应用依赖于您当前的配置，还要依赖于某些特定文件。</p>
<p>与此同时，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文件。</p>
<p>您希望尽可能多在本地模拟这些环境，而不产生重新创建服务器环境的开销。</p>
<p>因此，您要如何确保应用能够在这些环境中运行和通过质量检测，并且在部署过程中不出现令人头疼的问题，也无需重新编写代码和进行故障修复？答案就是使用容器。</p>
<p>容器可以确保您的应用拥有必需的配置和文件，使得这些应用能够在从开发到测试、再到生产的整个流程中顺利运行，而不出现任何不良问题。这样可以避免危机，做到皆大欢喜。</p>
<p>虽然这只是简化的示例，但在需要很高的可移植性、可配置性和隔离的情况下，我们可以利用 Linux 容器通过很多方式解决难题。</p>
<p>无论基础架构是在企业内部还是在云端，或者混合使用两者，容器都能满足您的需求。</p>
<h3 id="容器和虚拟化"><a href="#容器和虚拟化" class="headerlink" title="容器和虚拟化"></a><strong>容器和虚拟化</strong></h3><p>容器和虚拟化不是等同的。</p>
<p>虚拟化使得许多操作系统可同时在单个系统上运行。</p>
<p>容器则可共享同一个操作系统内核，将应用进程与系统其他部分隔离开。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNttwRxBsGRT1zsefq4qcWZO9lPmsSpiaS9VIMRSF7a20APn22Vn4lNqQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>​                                                                                                图 - 普通虚拟化技术和Docker的对比</p>
<p>这意味着什么？首先，让多个操作系统在单个虚拟机监控程序上运行以实现虚拟化，并不能达成和使用容器同等的轻量级效果。</p>
<p>事实上，在仅拥有容量有限的有限资源时，您需要能够可以进行密集部署的轻量级应用。</p>
<p>Linux 容器可从单个操作系统运行，在所有容器中共享该操作系统，因此应用和服务能够保持轻量级，并行快速运行。</p>
<h3 id="容器发展简史"><a href="#容器发展简史" class="headerlink" title="容器发展简史"></a><strong>容器发展简史</strong></h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNNC2uBib5YZeRTnyY86wBNeOVicVUQDj8LKpD5TUibRBArAxd2M6tHtDrw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>我们现在称为容器技术的概念最初出现在 2000 年，当时称为 FreeBSD jail，这种技术可将 FreeBSD 系统分区为多个子系统（也称为 Jail）。</p>
<p>Jail 是作为安全环境而开发的，系统管理员可与企业内部或外部的多个用户共享这些 Jail。</p>
<p>Jail 的目的是让进程在经过修改的 chroot 环境中创建，而不会脱离和影响整个系统 — 在 chroot 环境中，对文件系统、网络和用户的访问都实现了虚拟化。</p>
<p>尽管 Jail 在实施方面存在局限性，但最终人们找到了脱离这种隔离环境的方法。</p>
<p>但这个概念非常有吸引力。</p>
<p>2001 年，通过 Jacques Gélinas 的 VServer 项目，隔离环境的实施进入了 Linux 领域。</p>
<p>正如 Gélinas 所说，这项工作的目的是“在高度独立且安全的单一环境中运行多个通用 Linux 服务器 [sic]。” </p>
<p>在完成了这项针对 Linux 中多个受控制用户空间的基础性工作后，Linux 容器开始逐渐成形并最终发展成了现在的模样。</p>
<h2 id="什么是-Docker？"><a href="#什么是-Docker？" class="headerlink" title="什么是 Docker？"></a><strong>什么是 Docker？</strong></h2><p>“Docker” 一词指代多种事物，包括开源社区项目、开源项目使用的工具、主导支持此类项目的公司 Docker Inc. 以及该公司官方支持的工具。技术产品和公司使用同一名称，的确让人有点困惑。</p>
<p>我们来简单说明一下：</p>
<p>🎍 IT 软件中所说的 “Docker” ，是指容器化技术，用于支持创建和使用 Linux 容器。</p>
<p>🎍 开源 Docker 社区致力于改进这类技术，并免费提供给所有用户，使之获益。</p>
<p>🎍 Docker Inc. 公司凭借 Docker 社区产品起家，它主要负责提升社区版本的安全性，并将改进后的版本与更广泛的技术社区分享。此外，它还专门对这些技术产品进行完善和安全固化，以服务于企业客户。</p>
<p>借助 Docker ，您可将容器当做重量轻、模块化的虚拟机使用。同时，您还将获得高度的灵活性，从而实现对容器的高效创建、部署及复制，并能将其从一个环境顺利迁移至另一个环境。</p>
<h3 id="Docker-如何工作？"><a href="#Docker-如何工作？" class="headerlink" title="Docker 如何工作？"></a><strong>Docker 如何工作？</strong></h3><p>Docker 技术使用 Linux 内核和内核功能（例如 Cgroups 和 namespaces）来分隔进程，以便各进程相互独立运行。</p>
<p>这种独立性正是采用容器的目的所在；它可以独立运行多种进程、多个应用程序，更加充分地发挥基础设施的作用，同时保持各个独立系统的安全性。</p>
<p>容器工具（包括 Docker）可提供基于镜像的部署模式。这使得它能够轻松跨多种环境，与其依赖程序共享应用或服务组。Docker 还可在这一容器环境中自动部署应用程序（或者合并多种流程，以构建单个应用程序）。</p>
<p>此外，由于这些工具基于 Linux 容器构建，使得 Docker 既易于使用，又别具一格 —— 它可为用户提供前所未有的高度应用程访问权限、快速部署以及版本控制和分发能力。</p>
<h3 id="Docker-技术是否与传统的-Linux-容器相同？"><a href="#Docker-技术是否与传统的-Linux-容器相同？" class="headerlink" title="Docker 技术是否与传统的 Linux 容器相同？"></a><strong>Docker 技术是否与传统的 Linux 容器相同？</strong></h3><p>否。Docker 技术最初是基于 LXC 技术构建（大多数人都会将这一技术与“传统的” Linux 容器联系在一起），但后来它逐渐摆脱了对这种技术的依赖。</p>
<p><strong>就轻量级 虚拟化 这一功能来看，LXC 非常有用</strong>，但它无法提供出色的开发人员或用户体验。除了运行容器之外，Docker 技术还具备其他多项功能，包括简化用于构建容器、传输镜像以及控制镜像版本的流程。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNSTduDPY6VjYcM953tjoDMvSQ7NQRIB4iadxRetGb582Fz7t2wBkJIyw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>传统的 Linux 容器使用 init 系统来管理多种进程。这意味着，所有应用程序都作为一个整体运行。与此相反，Docker 技术鼓励应用程序各自独立运行其进程，并提供相应工具以实现这一功能。这种精细化运作模式自有其优势。</p>
<h3 id="docker的目标"><a href="#docker的目标" class="headerlink" title="docker的目标"></a><strong>docker的目标</strong></h3><p>docker的主要目标是”Build,Ship and Run any App,Anywhere”,构建，运输，处处运行</p>
<ul>
<li><strong>构建：</strong>做一个docker镜像</li>
<li><strong>运输：</strong>docker pull</li>
<li><strong>运行：</strong>启动一个容器</li>
</ul>
<p>每一个容器，他都有自己的文件系统rootfs</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a><strong>安装Docker</strong></h2><p>环境说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 需要两台节点进行安装</span><br><span class="line">[root@docker01 ~]# cat &#x2F;etc&#x2F;redhat-release </span><br><span class="line">CentOS Linux release 7.2.1511 (Core) </span><br><span class="line">[root@docker01 ~]# uname  -r </span><br><span class="line">3.10.0-327.el7.x86_64</span><br><span class="line">[root@docker01 ~]# hostname -I</span><br><span class="line">10.0.0.100 172.16.1.100 </span><br><span class="line">[root@docker02 ~]# hostname -I</span><br><span class="line">10.0.0.101 172.16.1.101</span><br></pre></td></tr></table></figure>



<p>在<strong>两个节点</strong>上都进行操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">sed -i &#39;s#download.docker.com#mirrors.ustc.edu.cn&#x2F;docker-ce#g&#39; &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</span><br><span class="line">yum install docker-ce -y</span><br></pre></td></tr></table></figure>



<p>修改在docker01配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 修改启动文件，监听远程端口</span><br><span class="line">vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock -H tcp:&#x2F;&#x2F;10.0.0.100:2375</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable docker.service </span><br><span class="line">systemctl restart docker.service</span><br><span class="line"># ps -ef检查进行，是否启动</span><br></pre></td></tr></table></figure>



<p>在docker02测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker -H 10.0.0.100 info</span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.12.0-ce</span><br><span class="line">Storage Driver: devicemapper</span><br><span class="line">···</span><br></pre></td></tr></table></figure>



<h3 id="Docker基础命令操作"><a href="#Docker基础命令操作" class="headerlink" title="Docker基础命令操作"></a><strong>Docker基础命令操作</strong></h3><p>查看docker相关信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#  docker version  </span><br><span class="line">Client:</span><br><span class="line"> Version:    17.12.0-ce</span><br><span class="line"> API version:    1.35</span><br><span class="line"> Go version:    go1.9.2</span><br><span class="line"> Git commit:    c97c6d6</span><br><span class="line"> Built:    Wed Dec 27 20:10:14 2017</span><br><span class="line"> OS&#x2F;Arch:    linux&#x2F;amd64</span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:    17.12.0-ce</span><br><span class="line">  API version:    1.35 (minimum version 1.12)</span><br><span class="line">  Go version:    go1.9.2</span><br><span class="line">  Git commit:    c97c6d6</span><br><span class="line">  Built:    Wed Dec 27 20:12:46 2017</span><br><span class="line">  OS&#x2F;Arch:    linux&#x2F;amd64</span><br><span class="line">  Experimental:    false</span><br></pre></td></tr></table></figure>



<p>配置docker镜像加速</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;]</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>



<h3 id="启动第一个容器"><a href="#启动第一个容器" class="headerlink" title="启动第一个容器"></a><strong>启动第一个容器</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 80:80 nginx</span><br><span class="line">Unable to find image &#39;nginx:latest&#39; locally</span><br><span class="line">latest: Pulling from library&#x2F;nginx</span><br><span class="line">e7bb522d92ff: Pull complete </span><br><span class="line">6edc05228666: Pull complete </span><br><span class="line">cd866a17e81f: Pull complete </span><br><span class="line">Digest: sha256:285b49d42c703fdf257d1e2422765c4ba9d3e37768d6ea83d7fe2043dad6e63d</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">8d8f81da12b5c10af6ba1a5d07f4abc041cb95b01f3d632c3d638922800b0b4d</span><br><span class="line"># 容器启动后，在浏览器进行访问测试 </span><br></pre></td></tr></table></figure>



<p>参数说明</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNjMMEyibP61FMtxGnq1XdbQH5fiaYBtyQfQ1gew4gzqQbc9QnzRIuibEdw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="Docker镜像生命周期"><a href="#Docker镜像生命周期" class="headerlink" title="Docker镜像生命周期"></a><strong>Docker镜像生命周期</strong></h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNSxPFC21wFyyxKXFJRmXXwg45brbOIr6oI52Xo12opMk4YKmtLICv5Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="Docker镜像相关操作"><a href="#Docker镜像相关操作" class="headerlink" title="Docker镜像相关操作"></a><strong>Docker镜像相关操作</strong></h2><h3 id="搜索官方仓库镜像"><a href="#搜索官方仓库镜像" class="headerlink" title="搜索官方仓库镜像"></a><strong>搜索官方仓库镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#  docker search centos</span><br><span class="line">NAME                      DESCRIPTION                    STARS    OFFICIAL               AUTOMATED</span><br><span class="line">centos                    The official build of CentOS.  3992     [OK]      </span><br><span class="line">ansible&#x2F;centos7-ansible   Ansible on Centos7             105                              [OK]</span><br></pre></td></tr></table></figure>



<p>列表说明</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNYehuNNwtQs3FPDfhGoocqoic7OuBpAicn1SOW3ANVkQDxb9LMsDGicUYg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a><strong>获取镜像</strong></h3><p>根据镜像名称拉取镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library&#x2F;centos</span><br><span class="line">af4b0a2388c6: Downloading  34.65MB&#x2F;73.67MB</span><br></pre></td></tr></table></figure>



<p>查看当前主机镜像列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              ff426288ea90        3 weeks ago         207MB</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br></pre></td></tr></table></figure>



<p>拉第三方镜像方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull index.tenxcloud.com&#x2F;tenxcloud&#x2F;httpd</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a><strong>导出镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              ff426288ea90        3 weeks ago         207MB</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br><span class="line"># 导出</span><br><span class="line">[root@docker01 ~]# docker image save centos &gt; docker-centos.tar.gz</span><br></pre></td></tr></table></figure>



<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a><strong>删除镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image rm centos:latest</span><br><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br></pre></td></tr></table></figure>



<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a><strong>导入镜像</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image load -i docker-centos.tar.gz  </span><br><span class="line">e15afa4858b6: Loading layer  215.8MB&#x2F;215.8MB</span><br><span class="line">Loaded image: centos:latest</span><br><span class="line">[root@docker01 ~]# docker image list </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              ff426288ea90        3 weeks ago         207MB</span><br><span class="line">nginx               latest              3f8a4339aadd        5 weeks ago         108MB</span><br></pre></td></tr></table></figure>



<h3 id="查看镜像的详细信息"><a href="#查看镜像的详细信息" class="headerlink" title="查看镜像的详细信息"></a><strong>查看镜像的详细信息</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker image inspect centos</span><br></pre></td></tr></table></figure>



<h2 id="容器的日常管理"><a href="#容器的日常管理" class="headerlink" title="容器的日常管理"></a><strong>容器的日常管理</strong></h2><h3 id="容器的起-停"><a href="#容器的起-停" class="headerlink" title="容器的起/停"></a><strong>容器的起/停</strong></h3><p>最简单的运行一个容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run nginx</span><br></pre></td></tr></table></figure>



<p>创建容器，两步走（不常用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker create centos:latest  &#x2F;bin&#x2F;bash</span><br><span class="line">bb7f32368ecf0492adb59e20032ab2e6cf6a563a0e6751e58930ee5f7aaef204</span><br><span class="line">[root@docker01 ~]# docker start stupefied_nobel</span><br><span class="line">stupefied_nobel</span><br></pre></td></tr></table></figure>



<p>快速启动容器方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  centos:latest  &#x2F;usr&#x2F;bin&#x2F;sleep 20;</span><br></pre></td></tr></table></figure>



<p><strong>容器内的第一个进程必须一直处于运行的状态，否则这个容器，就会处于退出状态！</strong></p>
<p>查看正在运行的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker container ls</span><br><span class="line">    或</span><br><span class="line">[root@docker01 ~]# docker ps </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">8708e93fd767        nginx               &quot;nginx -g &#39;daemon of…&quot;   6 seconds ago       Up 4 seconds        80&#x2F;tcp              keen_lewin</span><br></pre></td></tr></table></figure>



<p>查看你容器详细信息/ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker container  inspect  容器名称&#x2F;id</span><br></pre></td></tr></table></figure>



<p>查看你所有容器（包括未运行的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">8708e93fd767        nginx               &quot;nginx -g &#39;daemon of…&quot;   4 minutes ago       Exited (0) 59 seconds ago                       keen_lewin</span><br><span class="line">f9f3e6af7508        nginx               &quot;nginx -g &#39;daemon of…&quot;   5 minutes ago       Exited (0) 5 minutes ago                        optimistic_haibt</span><br><span class="line">8d8f81da12b5        nginx               &quot;nginx -g &#39;daemon of…&quot;   3 hours ago         Exited (0) 3 hours ago                          lucid_bohr</span><br></pre></td></tr></table></figure>



<p>停止容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker stop 容器名称&#x2F;id </span><br><span class="line">或</span><br><span class="line">[root@docker01 ~]# docker container  kill  容器名称&#x2F;id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="进入容器方法"><a href="#进入容器方法" class="headerlink" title="进入容器方法"></a><strong>进入容器方法</strong></h3><p><strong>启动时进去方法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -it #参数：-it 可交互终端</span><br><span class="line">[root@docker01 ~]# docker run -it nginx:latest  &#x2F;bin&#x2F;bash</span><br><span class="line">root@79241093859e:&#x2F;#</span><br></pre></td></tr></table></figure>



<p>退出/离开容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl+p &amp; ctrl+q</span><br></pre></td></tr></table></figure>



<p><strong>启动后进入容器的方法</strong></p>
<p>启动一个docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -it centos:latest </span><br><span class="line">[root@1bf0f43c4d2f &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 15:47 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         13      1  0 15:47 pts&#x2F;0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>



<p>attach进入容器，使用pts/0 ，会让所用通过此方法进如放入用户看到同样的操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker attach 1bf0f43c4d2f</span><br><span class="line">[root@1bf0f43c4d2f &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 15:47 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         14      1  0 15:49 pts&#x2F;0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>



<p>自命名启动一个容器 –name</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker attach 1bf0f43c4d2f</span><br><span class="line">[root@1bf0f43c4d2f &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 15:47 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         14      1  0 15:49 pts&#x2F;0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>



<p>exec 进入容器方法（推荐使用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker exec -it clsn1  &#x2F;bin&#x2F;bash </span><br><span class="line">[root@b20fa75b4b40 &#x2F;]# 重新分配一个终端</span><br><span class="line">[root@b20fa75b4b40 &#x2F;]# ps -ef </span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 16:11 pts&#x2F;0    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         13      0  0 16:14 pts&#x2F;1    00:00:00 &#x2F;bin&#x2F;bash</span><br><span class="line">root         26     13  0 16:14 pts&#x2F;1    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<h3 id="删除所有容器"><a href="#删除所有容器" class="headerlink" title="删除所有容器"></a><strong>删除所有容器</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker rm -f  &#96;docker ps -a -q&#96;</span><br><span class="line"># -f 强制删除</span><br></pre></td></tr></table></figure>



<h3 id="启动时进行端口映射"><a href="#启动时进行端口映射" class="headerlink" title="启动时进行端口映射"></a><strong>启动时进行端口映射</strong></h3><p>-p参数端口映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 8888:80  nginx:latest </span><br><span class="line">287bec5c60263166c03e1fc5b0b8262fe76507be3dfae4ce5cd2ee2d1e8a89a9</span><br></pre></td></tr></table></figure>



<p>不同指定映射方法</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNuZQOkTKHYyYzsuYxRnOgYo1VXicesHlyCghOXo4sj5zaiaHry6jqcZSw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>随机映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -P （大P）# 需要镜像支持</span><br></pre></td></tr></table></figure>



<h2 id="容器内日志的管理"><a href="#容器内日志的管理" class="headerlink" title="容器内日志的管理"></a>容器内日志的管理</h2><h3 id="查看日志文件"><a href="#查看日志文件" class="headerlink" title="查看日志文件"></a>查看日志文件</h3><p>在linux上，容器日志一般存放在/var/lib/docker/containers/container_id/下面， 以json.log结尾的文件（业务日志）很大，查看各个日志文件大小的脚本docker_log_size.sh，内容如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;======== docker containers logs file size ========&quot;</span>  </span><br><span class="line"></span><br><span class="line">logs=$(find /var/lib/docker/containers/ -name *-json.log)  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">log</span> <span class="keyword">in</span> <span class="variable">$logs</span>  </span><br><span class="line">        <span class="keyword">do</span>  </span><br><span class="line">             ls -lh <span class="variable">$log</span>   </span><br><span class="line">        <span class="keyword">done</span>  </span><br><span class="line"><span class="comment"># 脚本赋权</span></span><br><span class="line">chmod +x docker_log_size.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line">./docker_log_size.sh</span><br></pre></td></tr></table></figure>

<h3 id="清理Docker容器日志（治标）"><a href="#清理Docker容器日志（治标）" class="headerlink" title="清理Docker容器日志（治标）"></a>清理Docker容器日志（治标）</h3><p>就是可以写一个脚本清理容器的日志，写完脚本给这个脚本赋予权限，然后开一个定时器执行这个脚本</p>
<p>如果docker容器正在运行，那么使用rm -rf方式删除日志后，通过df -h会发现磁盘空间并没有释放。原因是在Linux或者Unix系统中，通过rm -rf或者文件管理器删除文件，将会从文件系统的目录结构上解除链接（unlink）。如果文件是被打开的（有一个进程正在使用），那么进程将仍然可以读取该文件，磁盘空间也一直被占用。正确姿势是cat /dev/null &gt; *-json.log，当然你也可以通过rm -rf删除后重启docker。接下来，提供一个日志清理脚本clean_docker_log.sh，内容如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;======== start clean docker containers logs ========&quot;</span>  </span><br><span class="line"></span><br><span class="line">logs=$(find /var/lib/docker/containers/ -name *-json.log)  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">log</span> <span class="keyword">in</span> <span class="variable">$logs</span>  </span><br><span class="line">        <span class="keyword">do</span>  </span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;clean logs : <span class="variable">$log</span>&quot;</span>  </span><br><span class="line">                cat /dev/null &gt; <span class="variable">$log</span>  </span><br><span class="line">        <span class="keyword">done</span>  </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;======== end clean docker containers logs ========&quot;</span>  </span><br><span class="line"><span class="comment"># 脚本赋权</span></span><br><span class="line">chmod +x clean_docker_log.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line">./clean_docker_log.sh</span><br></pre></td></tr></table></figure>

<h3 id="全局设置日志大小（治本）"><a href="#全局设置日志大小（治本）" class="headerlink" title="全局设置日志大小（治本）"></a>全局设置日志大小（治本）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<p>新建/etc/docker/daemon.json，若有就不用新建了。添加log-dirver和log-opts参数，样例如下：<br><code>registry-mirrors</code>是容器镜像地址，你可以用阿里云的（免费的）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;http://f613ce8f.m.daocloud.io&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span>:<span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span>: &#123;<span class="attr">&quot;max-size&quot;</span>:<span class="string">&quot;500m&quot;</span>, <span class="attr">&quot;max-file&quot;</span>:<span class="string">&quot;3&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>max-size=500m，意味着一个容器日志大小上限是500M，<br>max-file=3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启docker守护进程</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>如果不收集日志，建议定时执行日志清理就可以了。比如服务崩了，一直在刷错误日志，这个时候就需要清理掉</p>
<h3 id="清理日志的实际方法："><a href="#清理日志的实际方法：" class="headerlink" title="清理日志的实际方法："></a>清理日志的实际方法：</h3><p><strong>治标</strong></p>
<p>一、linux脚本指定删除某个日志文件</p>
<p>/usr/local/bin/docker-clear-log 写：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash -e</span></span><br><span class="line"></span><br><span class="line">CONTAINER=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$CONTAINER</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No container specified&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="subst">$(docker ps -aq -f name=^/<span class="string">&quot;<span class="variable">$CONTAINER</span>&quot;</span>$ 2&gt; /dev/null)</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    CONTAINER=<span class="string">&quot;<span class="subst">$(docker-compose ps <span class="string">&quot;<span class="variable">$CONTAINER</span>&quot;</span> 2&gt; /dev/null | awk &#x27;END &#123;print $1&#125;&#x27;)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [[ -z <span class="variable">$CONTAINER</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Container \&quot;<span class="variable">$1</span>\&quot; does not exist, exiting.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">LOG=$(docker inspect -f <span class="string">&#x27;&#123;&#123;.LogPath&#125;&#125;&#x27;</span> <span class="string">&quot;<span class="variable">$CONTAINER</span>&quot;</span> 2&gt; /dev/null)</span><br><span class="line">truncate -s 0 <span class="string">&quot;<span class="variable">$LOG</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>赋予权限：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /usr/<span class="built_in">local</span>/bin/docker-clear-log</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-clear-log &lt;container&gt;</span><br></pre></td></tr></table></figure>

<p>二、linux脚本定时删除日志文件</p>
<p><strong>前提</strong></p>
<ul>
<li>1.Ubuntu 下先判断cron是否启动 #ps aux |cron   重启：sudo /etc/init.d/cron restart 重新载入配置：sudo /etc/init.d/cron reload</li>
<li>ubuntu 下需要先设置cron运行日志存放路径才能查看crontab的日志：sudo vi /etc/rsyslog.d/50-default.conf 去掉cron 前面的# 保存。</li>
<li>重启rsyslog服务：sudo service rsyslog</li>
<li>restart 重启cron服务：sudo service cron restart</li>
<li>停止cron服务：sudo service cron stop</li>
<li>添加定时任务</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">例子 : </span><br><span class="line">#每天早上7点执行一次 /bin/ls : </span><br><span class="line">0 7 * * * /bin/ls </span><br><span class="line">在 12 月内, 每天的早上 6 点到 12 点中，每隔3个小时执行一次 /usr/bin/backup : </span><br><span class="line">0 6-12/3 * 12 * /usr/bin/backup </span><br><span class="line">周一到周五每天下午 5:00 寄一封信给 alex@domain.name : </span><br><span class="line">0 17 * * 1-5 mail -s &quot;hi&quot; alex@domain.name &lt; /tmp/maildata </span><br><span class="line">每月每天的午夜 0 点 20 分, 2 点 20 分, 4 点 20 分....执行 echo &quot;haha&quot; </span><br><span class="line">20 0-23/2 * * * echo &quot;haha&quot; </span><br><span class="line">每天早晨1点定时跑任务</span><br><span class="line">0 * 1 * * *</span><br><span class="line">每周一早晨1点定时跑任务</span><br><span class="line">0 * 1 * * 1</span><br></pre></td></tr></table></figure>



<p><strong>命令</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">基本的指令：</span><br><span class="line">参数 : </span><br><span class="line">crontab -e : 执行文字编辑器来设定时程表，内定的文字编辑器是 VI，如果你想用别的文字编辑器，则请先设定 VISUAL 环境变数 </span><br><span class="line">来指定使用那个文字编辑器(比如说 setenv VISUAL joe) </span><br><span class="line">crontab -r : 删除目前的时程表 </span><br><span class="line">crontab -l : 列出目前的时程表 </span><br><span class="line">crontab file [-u user]-用指定的文件替代目前的crontab。 </span><br></pre></td></tr></table></figure>

<p>找出Docker容器日志：在linux上，容器日志一般存放在/var/lib/docker/containers/container_id/下面，查看各个日志文件大小的脚本docker_log_size.sh，内容如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line">echo &quot;======== docker containers logs file size ========&quot;  </span><br><span class="line"></span><br><span class="line">logs=$(find /var/lib/docker/containers/ -name *-json.log)  </span><br><span class="line"></span><br><span class="line">for log in $logs  </span><br><span class="line">        do  </span><br><span class="line">             ls -lh $log   </span><br><span class="line">        done</span><br></pre></td></tr></table></figure>

<p>给脚本赋权</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x docker_log_size.sh ./docker_log_size.sh </span><br></pre></td></tr></table></figure>

<p>清理Docker容器日志</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh </span><br><span class="line">echo &quot;======== start clean docker containers logs ========&quot;  </span><br><span class="line"></span><br><span class="line">logs=$(find /var/lib/docker/containers/ -name *-json.log)  </span><br><span class="line"></span><br><span class="line">for log in $logs  </span><br><span class="line">        do  </span><br><span class="line">                echo &quot;clean logs : $log&quot;  </span><br><span class="line">                cat /dev/null &gt; $log  </span><br><span class="line">        done  </span><br><span class="line"></span><br><span class="line">echo &quot;======== end clean docker containers logs ========&quot;</span><br></pre></td></tr></table></figure>

<p>给脚本赋权</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x clean_docker_log.sh ./clean_docker_log.sh </span><br></pre></td></tr></table></figure>

<p>在/etc/crontab中添加定时任务</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/crontab </span><br></pre></td></tr></table></figure>

<p><img src="/16.1.Docker/v2-bb00f243d64f0c9e639fe7ff1a237158_720w.jpg" alt="img"></p>
<p>最后一行添加 </p>
<p>0 */1 * * * root cd /data &amp;&amp; bash clean_docker_log.sh </p>
<p>查看crontab服务状态：service cron status</p>
<p>重启服务： service cron restart</p>
<p><strong>治本</strong></p>
<p>全局设置</p>
<p>新建/etc/docker/daemon.json，若有就不用新建了。添加log-dirver和log-opts参数，样例如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/docker/daemon.json  </span><br><span class="line">&#123;</span><br><span class="line">  &quot;insecure-registries&quot; : [</span><br><span class="line">    &quot;registry.docker-cn.com&quot;,</span><br><span class="line">    &quot;docker.mirrors.ustc.edu.cn&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;debug&quot; : true,</span><br><span class="line">  &quot;experimental&quot; : true,</span><br><span class="line">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;log-driver&quot;:&quot;json-file&quot;,</span><br><span class="line">    &quot;log-opts&quot;:&#123;</span><br><span class="line">        &quot;max-size&quot; :&quot;500m&quot;,&quot;max-file&quot;:&quot;3&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>max-size=500m，意味着一个容器日志大小上限是500M，</p>
<p>max-file=3，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。</p>
<p>// 重启docker守护进程</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl daemon-reload </span><br><span class="line"># systemctl restart docker </span><br></pre></td></tr></table></figure>

<p>注意：设置的日志大小，只对新建的容器有效</p>
<p><img src="/16.1.Docker/image-20210806173035745.png" alt="image-20210806173035745"></p>
<h2 id="Docker-数据卷的管理"><a href="#Docker-数据卷的管理" class="headerlink" title="Docker 数据卷的管理"></a><strong>Docker 数据卷的管理</strong></h2><h3 id="挂载时创建卷"><a href="#挂载时创建卷" class="headerlink" title="挂载时创建卷"></a><strong>挂载时创建卷</strong></h3><p>挂载卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 80:80 -v &#x2F;data:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest</span><br><span class="line">079786c1e297b5c5031e7a841160c74e91d4ad06516505043c60dbb78a259d09</span><br></pre></td></tr></table></figure>



<p>容器内站点目录: /usr/share/nginx/html</p>
<p>在宿主机写入数据，查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# echo &quot;http:&#x2F;&#x2F;www.nmtui.com&quot; &gt;&#x2F;data&#x2F;index.html</span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100</span><br><span class="line">http:&#x2F;&#x2F;www.nmtui.com</span><br></pre></td></tr></table></figure>



<p>设置共享卷，使用同一个卷启动一个新的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 8080:80 -v &#x2F;data:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest </span><br><span class="line">351f0bd78d273604bd0971b186979aa0f3cbf45247274493d2490527babb4e42</span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100:8080</span><br><span class="line">http:&#x2F;&#x2F;www.nmtui.com</span><br></pre></td></tr></table></figure>



<p>查看卷列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br></pre></td></tr></table></figure>

<h3 id="创建卷后挂载"><a href="#创建卷后挂载" class="headerlink" title="创建卷后挂载"></a><strong>创建卷后挂载</strong></h3><p>创建一个卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume create </span><br><span class="line">f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521</span><br><span class="line">[root@docker01 ~]# docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521</span><br></pre></td></tr></table></figure>



<p>指定卷名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume ls </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               clsn</span><br><span class="line">local               f3b95f7bd17da220e63d4e70850b8d7fb3e20f8ad02043423a39fdd072b83521</span><br></pre></td></tr></table></figure>



<p>查看卷路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker volume inspect clsn </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2018-02-01T00:39:25+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;clsn&#x2F;_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;clsn&quot;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>使用卷创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 9000:80 -v clsn:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx:latest </span><br><span class="line">1434559cff996162da7ce71820ed8f5937fb7c02113bbc84e965845c219d3503</span><br><span class="line"># 宿主机测试</span><br><span class="line">[root@docker01 ~]# echo &#39;blog.nmtui.com&#39; &gt;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;clsn&#x2F;_data&#x2F;index.html </span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100:9000</span><br><span class="line">blog.nmtui.com</span><br></pre></td></tr></table></figure>



<p>设置卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -d  -P  --volumes-from 079786c1e297 nginx:latest </span><br><span class="line">b54b9c9930b417ab3257c6e4a8280b54fae57043c0b76b9dc60b4788e92369fb</span><br></pre></td></tr></table></figure>



<p>查看使用的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# netstat -lntup </span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID&#x2F;Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1400&#x2F;sshd           </span><br><span class="line">tcp        0      0 10.0.0.100:2375         0.0.0.0:*               LISTEN      26218&#x2F;dockerd       </span><br><span class="line">tcp6       0      0 :::9000                 :::*                    LISTEN      32015&#x2F;docker-proxy  </span><br><span class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      31853&#x2F;docker-proxy  </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      31752&#x2F;docker-proxy  </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1400&#x2F;sshd           </span><br><span class="line">tcp6       0      0 :::32769                :::*                    LISTEN      32300&#x2F;docker-proxy  </span><br><span class="line">[root@docker01 ~]# curl 10.0.0.100:32769</span><br><span class="line">http:&#x2F;&#x2F;www.nmtui.com</span><br></pre></td></tr></table></figure>



<h3 id="手动将容器保存为镜像"><a href="#手动将容器保存为镜像" class="headerlink" title="手动将容器保存为镜像"></a><strong>手动将容器保存为镜像</strong></h3><p>本次是基于docker官方centos 6.8 镜像创建</p>
<p>官方镜像列表：</p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/explore/">https://hub.docker.com/explore/</a></p>
<p>启动一个centos6.8的镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker pull  centos:6.8</span><br><span class="line">[root@docker01 ~]# docker run -it -p 1022:22 centos:6.8  &#x2F;bin&#x2F;bash</span><br><span class="line"># 在容器种安装sshd服务，并修改系统密码</span><br><span class="line">[root@582051b2b92b ~]# yum install  openssh-server -y </span><br><span class="line">[root@582051b2b92b ~]# echo &quot;root:123456&quot; |chpasswd</span><br><span class="line">[root@582051b2b92b ~]#  &#x2F;etc&#x2F;init.d&#x2F;sshd start</span><br></pre></td></tr></table></figure>



<p>启动完成后镜像ssh连接测试</p>
<p>将容器提交为镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker commit brave_mcclintock  centos6-ssh</span><br></pre></td></tr></table></figure>





<p>使用新的镜像启动容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d  -p 1122:22  centos6-ssh:latest  &#x2F;usr&#x2F;sbin&#x2F;sshd -D </span><br><span class="line">5b8161fda2a9f2c39c196c67e2eb9274977e7723fe51c4f08a0190217ae93094</span><br></pre></td></tr></table></figure>





<p>在容器安装httpd服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@5b8161fda2a9 &#x2F;]#  yum install httpd -y</span><br></pre></td></tr></table></figure>



<p>编写启动脚本脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@5b8161fda2a9 &#x2F;]# cat  init.sh </span><br><span class="line">#!&#x2F;bin&#x2F;bash </span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;httpd start </span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;sshd -D</span><br><span class="line">[root@5b8161fda2a9 &#x2F;]# chmod +x init.sh </span><br><span class="line"># 注意执行权限</span><br></pre></td></tr></table></figure>





<p>再次提交为新的镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker commit  5b8161fda2a9 centos6-httpd </span><br><span class="line">sha256:705d67a786cac040800b8485cf046fd57b1828b805c515377fc3e9cea3a481c1</span><br></pre></td></tr></table></figure>





<p>启动镜像，做好端口映射。并在浏览器中测试访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p 1222:22 -p 80:80  centos6-httpd &#x2F;init.sh </span><br><span class="line">46fa6a06644e31701dc019fb3a8c3b6ef008d4c2c10d46662a97664f838d8c2c</span><br></pre></td></tr></table></figure>



<h2 id="Dockerfile自动构建docker镜像"><a href="#Dockerfile自动构建docker镜像" class="headerlink" title="Dockerfile自动构建docker镜像"></a><strong>Dockerfile自动构建docker镜像</strong></h2><p>官方构建dockerffile文件参考</p>
<p><a target="_blank" rel="noopener" href="https://github.com/CentOS/CentOS-Dockerfiles">https://github.com/CentOS/CentOS-Dockerfiles</a></p>
<h3 id="Dockerfile指令集"><a href="#Dockerfile指令集" class="headerlink" title="Dockerfile指令集"></a><strong>Dockerfile指令集</strong></h3><p>dockerfile主要组成部分：</p>
<ul>
<li>基础镜像信息 FROM centos:6.8</li>
<li>制作镜像操作指令RUN yum insatll openssh-server -y</li>
<li>容器启动时执行指令 CMD [“/bin/bash”]</li>
</ul>
<p>dockerfile常用指令：</p>
<ul>
<li>FROM 这个镜像的妈妈是谁？（指定基础镜像）</li>
<li>MAINTAINER 告诉别人，谁负责养它？（指定维护者信息，可以没有）</li>
<li>RUN 你想让它干啥（在命令前面加上RUN即可）</li>
<li>ADD 给它点创业资金（COPY文件，会自动解压）</li>
<li>WORKDIR 我是cd,今天刚化了妆（设置当前工作目录）</li>
<li>VOLUME 给它一个存放行李的地方（设置卷，挂载主机目录）</li>
<li>EXPOSE 它要打开的门是啥（指定对外的端口）</li>
<li>CMD 奔跑吧，兄弟！（指定容器启动后的要干的事情）</li>
</ul>
<p>dockerfile其他指令： </p>
<ul>
<li>COPY 复制文件</li>
<li>ENV 环境变量</li>
<li>ENTRYPOINT 容器启动后执行的命令</li>
</ul>
<h3 id="创建一个Dockerfile"><a href="#创建一个Dockerfile" class="headerlink" title="创建一个Dockerfile"></a><strong>创建一个Dockerfile</strong></h3><p>创建第一个Dockerfile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 创建目录</span><br><span class="line">[root@docker01 base]# cd &#x2F;opt&#x2F;base</span><br><span class="line"># 创建Dcokerfile文件，注意大小写</span><br><span class="line">[root@docker01 base]# vim Dockerfile</span><br><span class="line">FROM centos:6.8</span><br><span class="line">RUN yum install openssh-server -y </span><br><span class="line">RUN echo &quot;root:123456&quot; |chpasswd</span><br><span class="line">RUN &#x2F;etc&#x2F;init.d&#x2F;sshd start </span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,&quot;-D&quot;]</span><br></pre></td></tr></table></figure>



<p>构建docker镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 base]# docker image build  -t centos6.8-ssh . </span><br><span class="line">-t 为镜像标签打标签  . 表示当前路径</span><br></pre></td></tr></table></figure>



<p>使用自构建的镜像启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 base]# docker run  -d -p 2022:22 centos6.8-ssh-b </span><br><span class="line">dc3027d3c15dac881e8e2aeff80724216f3ac725f142daa66484f7cb5d074e7a</span><br></pre></td></tr></table></figure>



<h3 id="使用Dcokerfile安装kodexplorer"><a href="#使用Dcokerfile安装kodexplorer" class="headerlink" title="使用Dcokerfile安装kodexplorer"></a><strong>使用Dcokerfile安装kodexplorer</strong></h3><p>Dockerfile文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:6.8</span><br><span class="line">RUN yum install wget unzip php php-gd php-mbstring -y &amp;&amp; yum clean all</span><br><span class="line"># 设置工作目录，之后的操作都在这个目录中</span><br><span class="line">WORKDIR &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">RUN wget -c http:&#x2F;&#x2F;static.kodcloud.com&#x2F;update&#x2F;download&#x2F;kodexplorer4.25.zip</span><br><span class="line">RUN unzip kodexplorer4.25.zip &amp;&amp; rm -f kodexplorer4.25.zip</span><br><span class="line">RUN chown -R apache.apache .</span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;sbin&#x2F;apachectl&quot;,&quot;-D&quot;,&quot;FOREGROUND&quot;]</span><br></pre></td></tr></table></figure>



<p>更多的Dockerfile可以参考官方方法。</p>
<h2 id="Docker中的镜像分层"><a href="#Docker中的镜像分层" class="headerlink" title="Docker中的镜像分层"></a><strong>Docker中的镜像分层</strong></h2><p>参考文档：</p>
<p><a target="_blank" rel="noopener" href="http://www.maiziedu.com/wiki/cloud/dockerimage/">http://www.maiziedu.com/wiki/cloud/dockerimage/</a></p>
<p>Docker 支持通过扩展现有镜像，创建新的镜像。实际上，Docker Hub 中 99% 的镜像都是通过在 base 镜像中安装和配置需要的软件构建出来的。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNibl4DQ5TJSKSloMYjYBFUd7pAKNFNJib9icRyhJtar11gYTl3l84Uc4Ew/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>从上图可以看到，新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层。</p>
<h3 id="Docker-镜像为什么分层"><a href="#Docker-镜像为什么分层" class="headerlink" title="Docker 镜像为什么分层"></a><strong>Docker 镜像为什么分层</strong></h3><p>镜像分层最大的一个好处就是共享资源。</p>
<p>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<p>如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是不会被修改的，修改只会被限制在单个容器内。这就是容器 Copy-on-Write 特性。</p>
<h3 id="可写的容器层"><a href="#可写的容器层" class="headerlink" title="可写的容器层"></a><strong>可写的容器层</strong></h3><p>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNz0xkGTOibTgYUxoHsGCYquqrg1eWfSV2gibNKb4xAibJ07OvGluaCtX5w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有<strong>容器层是可写的，容器层下面的所有镜像层都是只读的。</strong></p>
<h3 id="容器层的细节说明"><a href="#容器层的细节说明" class="headerlink" title="容器层的细节说明"></a><strong>容器层的细节说明</strong></h3><p>镜像层数量可能会很多，所有镜像层会联合在一起组成一个统一的文件系统。如果不同层中有一个相同路径的文件，比如 /a，上层的 /a 会覆盖下层的 /a，也就是说用户只能访问到上层中的文件 /a。在容器层中，用户看到的是一个叠加之后的文件系统。</p>
<p>文件操作的</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNKtF3xCJ5nxAmYVavUW4uSFBoPaZFhSMqEWFkfhkyTTgjEMht0dqqkA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>只有当需要修改时才复制一份数据，这种特性被称作 Copy-on-Write。可见，容器层保存的是镜像变化的部分，不会对镜像本身进行任何修改。</p>
<p>这样就解释了我们前面提出的问题：容器层记录对镜像的修改，所有镜像层都是只读的，不会被容器修改，所以镜像可以被多个容器共享。</p>
<h2 id="使用docker运行zabbix-server"><a href="#使用docker运行zabbix-server" class="headerlink" title="使用docker运行zabbix-server"></a><strong>使用docker运行zabbix-server</strong></h2><h3 id="容器间的互联"><a href="#容器间的互联" class="headerlink" title="容器间的互联"></a><strong>容器间的互联</strong></h3><p>在运行zabbix之前务必要了解容器间互联的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个nginx容器</span><br><span class="line">docker run -d -p 80:80 nginx</span><br><span class="line"># 创建容器，做link，并进入容器中</span><br><span class="line">docker run -it --link quirky_brown:web01 centos-ssh &#x2F;bin&#x2F;bash</span><br><span class="line"># 在容器中访问nginx容器可以ping通</span><br><span class="line">ping web01 </span><br></pre></td></tr></table></figure>



<p>命令执行过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 启动apache容器</span><br><span class="line">[root@docker01 ~]# docker run -d httpd:2.4  </span><br><span class="line">3f1f7fc554720424327286bd2b04aeab1b084a3fb011a785b0deab6a34e56955</span><br><span class="line">^[[A[root@docker01 docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3f1f7fc55472        httpd:2.4           &quot;httpd-foreground&quot;   6 seconds ago       Up 5 seconds        80&#x2F;tcp              determined_clarke</span><br><span class="line"># 拉取一个busybox 镜像</span><br><span class="line">[root@docker01 ~]# docker pull busybox </span><br><span class="line"># 启动容器</span><br><span class="line">[root@docker01 ~]# docker run -it  --link determined_clarke:web busybox:latest   &#x2F;bin&#x2F;sh </span><br><span class="line">&#x2F; # </span><br><span class="line"># 使用新的容器访问最初的web容器</span><br><span class="line">&#x2F; # ping web </span><br><span class="line">PING web (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.058 ms</span><br><span class="line">^C</span><br><span class="line">--- web ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.058&#x2F;0.058&#x2F;0.058 ms   </span><br></pre></td></tr></table></figure>



<h3 id="启动zabbix容器"><a href="#启动zabbix容器" class="headerlink" title="启动zabbix容器"></a><strong>启动zabbix容器</strong></h3><p>1、启动一个mysql的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-server -t \</span><br><span class="line">      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \</span><br><span class="line">      -d mysql:5.7 \</span><br><span class="line">      --character-set-server&#x3D;utf8 --collation-server&#x3D;utf8_bin </span><br></pre></td></tr></table></figure>



<p>2、启动java-gateway容器监控java服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zabbix-java-gateway -t \</span><br><span class="line">      -d zabbix&#x2F;zabbix-java-gateway:latest</span><br></pre></td></tr></table></figure>



<p>3、启动zabbix-mysql容器使用link连接mysql与java-gateway。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">      -e DB_SERVER_HOST&#x3D;&quot;mysql-server&quot; \</span><br><span class="line">      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \</span><br><span class="line">      -e ZBX_JAVAGATEWAY&#x3D;&quot;zabbix-java-gateway&quot; \</span><br><span class="line">      --link mysql-server:mysql \</span><br><span class="line">      --link zabbix-java-gateway:zabbix-java-gateway \</span><br><span class="line">      -p 10051:10051 \</span><br><span class="line">      -d zabbix&#x2F;zabbix-server-mysql:latest</span><br></pre></td></tr></table></figure>



<p>4、启动zabbix web显示，使用link连接zabbix-mysql与mysql。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">      -e DB_SERVER_HOST&#x3D;&quot;mysql-server&quot; \</span><br><span class="line">      -e MYSQL_DATABASE&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_USER&#x3D;&quot;zabbix&quot; \</span><br><span class="line">      -e MYSQL_PASSWORD&#x3D;&quot;zabbix_pwd&quot; \</span><br><span class="line">      -e MYSQL_ROOT_PASSWORD&#x3D;&quot;root_pwd&quot; \</span><br><span class="line">      --link mysql-server:mysql \</span><br><span class="line">      --link zabbix-server-mysql:zabbix-server \</span><br><span class="line">      -p 80:80 \</span><br><span class="line">      -d zabbix&#x2F;zabbix-web-nginx-mysql:latest</span><br></pre></td></tr></table></figure>



<h3 id="关于zabbix-API"><a href="#关于zabbix-API" class="headerlink" title="关于zabbix API"></a><strong>关于zabbix API</strong></h3><p>关于zabbix API可以参考官方文档：</p>
<p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/3.4/zh/manual/api">https://www.zabbix.com/documentation/3.4/zh/manual/api</a></p>
<p>1、获取token方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 获取token</span><br><span class="line">[root@docker02 ~]# curl -s -X POST -H &#39;Content-Type:application&#x2F;json&#39; -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">&quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">&quot;method&quot;: &quot;user.login&quot;,</span><br><span class="line">&quot;params&quot;: &#123;</span><br><span class="line">&quot;user&quot;: &quot;Admin&quot;,</span><br><span class="line">&quot;password&quot;: &quot;zabbix&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;id&quot;: 1</span><br><span class="line">&#125;&#39; http:&#x2F;&#x2F;10.0.0.100&#x2F;api_jsonrpc.php</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;d3be707f9e866ec5d0d1c242292cbebd&quot;,&quot;id&quot;:1&#125;</span><br></pre></td></tr></table></figure>



<h2 id="docker-仓库（registry）"><a href="#docker-仓库（registry）" class="headerlink" title="docker 仓库（registry）"></a><strong>docker 仓库（registry）</strong></h2><h3 id="创建一个普通仓库"><a href="#创建一个普通仓库" class="headerlink" title="创建一个普通仓库"></a><strong>创建一个普通仓库</strong></h3><p>1、创建仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart&#x3D;always --name registry -v &#x2F;opt&#x2F;myregistry:&#x2F;var&#x2F;lib&#x2F;registry  registry </span><br></pre></td></tr></table></figure>





<p>2、修改配置文件，使之支持http</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# cat  &#x2F;etc&#x2F;docker&#x2F;daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;],</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>重启docker让修改生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# systemctl restart  docker.service</span><br></pre></td></tr></table></figure>



<p>3、修改镜像标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker tag  busybox:latest  10.0.0.100:5000&#x2F;clsn&#x2F;busybox:1.0</span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos6-ssh                     latest              3c2b1e57a0f5        18 hours ago        393MB</span><br><span class="line">httpd                           2.4                 2e202f453940        6 days ago          179MB</span><br><span class="line">10.0.0.100:5000&#x2F;clsn&#x2F;busybox    1.0                 5b0d59026729        8 days ago          1.15MB</span><br></pre></td></tr></table></figure>



<p>4、将新打标签的镜像上传镜像到仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker push   10.0.0.100:5000&#x2F;clsn&#x2F;busybox</span><br></pre></td></tr></table></figure>



<h3 id="带basic认证的仓库"><a href="#带basic认证的仓库" class="headerlink" title="带basic认证的仓库"></a><strong>带basic认证的仓库</strong></h3><p>1、安装加密工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 clsn]# yum install httpd-tools  -y</span><br></pre></td></tr></table></figure>



<p>2、设置认证密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;opt&#x2F;registry-var&#x2F;auth&#x2F; -p</span><br><span class="line">htpasswd  -Bbn clsn 123456  &gt; &#x2F;opt&#x2F;registry-var&#x2F;auth&#x2F;htpasswd</span><br></pre></td></tr></table></figure>



<p>3、启动容器，在启动时传入认证参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v &#x2F;opt&#x2F;registry-var&#x2F;auth&#x2F;:&#x2F;auth&#x2F; -e &quot;REGISTRY_AUTH&#x3D;htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM&#x3D;Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH&#x3D;&#x2F;auth&#x2F;htpasswd registry</span><br></pre></td></tr></table></figure>



<p>4、使用验证用户测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 登陆用户</span><br><span class="line">[root@docker01 ~]# docker login 10.0.0.100:5000 </span><br><span class="line">Username: clsn  </span><br><span class="line">Password: 123456</span><br><span class="line">Login Succeeded</span><br><span class="line"># 推送镜像到仓库</span><br><span class="line">[root@docker01 ~]# docker push 10.0.0.100:5000&#x2F;clsn&#x2F;busybox </span><br><span class="line">The push refers to repository [10.0.0.100:5000&#x2F;clsn&#x2F;busybox]</span><br><span class="line">4febd3792a1f: Pushed </span><br><span class="line">1.0: digest: sha256:4cee1979ba0bf7db9fc5d28fb7b798ca69ae95a47c5fecf46327720df4ff352d size: 527</span><br><span class="line">#认证文件的保存位置</span><br><span class="line">[root@docker01 ~]# cat .docker&#x2F;config.json </span><br><span class="line">&#123;</span><br><span class="line">    &quot;auths&quot;: &#123;</span><br><span class="line">        &quot;10.0.0.100:5000&quot;: &#123;</span><br><span class="line">            &quot;auth&quot;: &quot;Y2xzbjoxMjM0NTY&#x3D;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;https:&#x2F;&#x2F;index.docker.io&#x2F;v1&#x2F;&quot;: &#123;</span><br><span class="line">            &quot;auth&quot;: &quot;Y2xzbjpIenNAMTk5Ng&#x3D;&#x3D;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;HttpHeaders&quot;: &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Docker-Client&#x2F;17.12.0-ce (linux)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，一个简单的docker镜像仓库搭建完成</p>
<h2 id="docker-compose编排工具"><a href="#docker-compose编排工具" class="headerlink" title="docker-compose编排工具"></a><strong>docker-compose编排工具</strong></h2><h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a><strong>安装docker-compose</strong></h3><p>安装docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 下载pip软件</span><br><span class="line">yum install -y python2-pip</span><br><span class="line"># 下载 docker-compose</span><br><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure>



<p>国内开启pip 下载加速：</p>
<p><a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/help/pypi">http://mirrors.aliyun.com/help/pypi</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~&#x2F;.pip&#x2F;</span><br><span class="line">cat &gt; ~&#x2F;.pip&#x2F;pip.conf &lt;&lt;&#39;EOF&#39;</span><br><span class="line">[global]</span><br><span class="line">index-url &#x3D; https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;pypi&#x2F;simple&#x2F;</span><br><span class="line">[install]</span><br><span class="line">trusted-host&#x3D;mirrors.aliyun.com</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h3 id="编排启动镜像"><a href="#编排启动镜像" class="headerlink" title="编排启动镜像"></a><strong>编排启动镜像</strong></h3><p>1、创建文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# mkdir &#x2F;opt&#x2F;my_wordpress&#x2F;</span><br><span class="line">[root@docker01 ~]# cd &#x2F;opt&#x2F;my_wordpress&#x2F;</span><br></pre></td></tr></table></figure>



<p>2、编写编排文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# vim docker-compose.yml</span><br><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">   db:</span><br><span class="line">     image: mysql:5.7</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;db_data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">       MYSQL_DATABASE: wordpress</span><br><span class="line">       MYSQL_USER: wordpress</span><br><span class="line">       MYSQL_PASSWORD: wordpress</span><br><span class="line">   wordpress:</span><br><span class="line">     depends_on:</span><br><span class="line">       - db</span><br><span class="line">     image: wordpress:latest</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;web_data:&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">     ports: </span><br><span class="line">       - &quot;8000:80&quot;</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       WORDPRESS_DB_HOST: db:3306</span><br><span class="line">       WORDPRESS_DB_USER: wordpress</span><br><span class="line">       WORDPRESS_DB_PASSWORD: wordpress</span><br></pre></td></tr></table></figure>



<p>3、启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# docker-compose up</span><br><span class="line">　　#启动方法：docker-compose up</span><br><span class="line">　　#后台启动方法：docker-compose up -d</span><br></pre></td></tr></table></figure>



<p>4、浏览器上访问<a target="_blank" rel="noopener" href="http://10.0.0.100:8000/">http://10.0.0.100:8000</a></p>
<p>进行wordpress的安装即可</p>
<h3 id="haproxy代理后端docker容器"><a href="#haproxy代理后端docker容器" class="headerlink" title="haproxy代理后端docker容器"></a><strong>haproxy代理后端docker容器</strong></h3><p>1、修改编排脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# cat docker-compose.yml </span><br><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">   db:</span><br><span class="line">     image: mysql:5.7</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;db_data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">       MYSQL_DATABASE: wordpress</span><br><span class="line">       MYSQL_USER: wordpress</span><br><span class="line">       MYSQL_PASSWORD: wordpress</span><br><span class="line">   wordpress:</span><br><span class="line">     depends_on:</span><br><span class="line">       - db</span><br><span class="line">     image: wordpress:latest</span><br><span class="line">     volumes:</span><br><span class="line">       - &#x2F;data&#x2F;web_data:&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">     ports: </span><br><span class="line">       - &quot;80&quot;</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       WORDPRESS_DB_HOST: db:3306</span><br><span class="line">       WORDPRESS_DB_USER: wordpress</span><br><span class="line">       WORDPRESS_DB_PASSWORD: wordpress</span><br></pre></td></tr></table></figure>



<p>2、同时启动两台wordpress</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 my_wordpress]# docker-compose scale wordpress&#x3D;2 </span><br><span class="line">WARNING: The scale command is deprecated. Use the up command with the --scale flag instead.</span><br><span class="line">Starting mywordpress_wordpress_1 ... done</span><br><span class="line">Creating mywordpress_wordpress_2 ... done</span><br></pre></td></tr></table></figure>



<p>3、安装haproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# yum install haproxy -y</span><br></pre></td></tr></table></figure>



<p>4、修改haproxy配置文件</p>
<p>关于配置文件的详细说明，参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/MacoLee/p/5853413.html">https://www.cnblogs.com/MacoLee/p/5853413.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#cp &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg&#123;,.bak&#125;</span><br><span class="line">[root@docker01 ~]# vim &#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg</span><br><span class="line">global</span><br><span class="line">    log         127.0.0.1 local2</span><br><span class="line">    chroot      &#x2F;var&#x2F;lib&#x2F;haproxy</span><br><span class="line">    pidfile     &#x2F;var&#x2F;run&#x2F;haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line">    stats socket &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats level admin  #支持命令行控制</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0&#x2F;8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           1m</span><br><span class="line">    timeout connect         10s</span><br><span class="line">    timeout client          1m</span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">listen stats</span><br><span class="line">    mode http</span><br><span class="line">    bind 0.0.0.0:8888</span><br><span class="line">    stats enable</span><br><span class="line">    stats uri     &#x2F;haproxy-status </span><br><span class="line">    stats auth    admin:123456</span><br><span class="line">frontend frontend_www_example_com</span><br><span class="line">    bind 10.0.0.100:8000</span><br><span class="line">    mode http</span><br><span class="line">    option httplog</span><br><span class="line">    log global</span><br><span class="line">    default_backend backend_www_example_com</span><br><span class="line">backend backend_www_example_com</span><br><span class="line">    option forwardfor header X-REAL-IP</span><br><span class="line">    option httpchk HEAD &#x2F; HTTP&#x2F;1.0</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server web-node1  10.0.0.100:32768 check inter 2000 rise 30 fall 15</span><br><span class="line">    server web-node2  10.0.0.100:32769 check inter 2000 rise 30 fall 15</span><br></pre></td></tr></table></figure>



<p>5、启动haproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start haproxy</span><br><span class="line">systemctl enable haproxy</span><br></pre></td></tr></table></figure>



<p>6、使用浏览器访问hapeoxy监听的8000端口可以看到负载的情况</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNic9DpCJXcR95mfbGbd9FGYfuIDH4vibYWmBCqTCVdDmlyiaP8j7PBkw3w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>7、使用浏览器访问 </p>
<p><a target="_blank" rel="noopener" href="http://10.0.0.100:8888/haproxy-status">http://10.0.0.100:8888/haproxy-status</a></p>
<p>可以看到后端节点的监控状况，</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNEnaATu6gVIjdjfqpZlrk5uhiaKM9yTYic80Q3Pq4qibnrWBibeiauLGDuwQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="安装socat-直接操作socket控制haproxy"><a href="#安装socat-直接操作socket控制haproxy" class="headerlink" title="安装socat 直接操作socket控制haproxy"></a><strong>安装socat 直接操作socket控制haproxy</strong></h3><p>1、安装软件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install socat.x86_64 -y</span><br></pre></td></tr></table></figure>



<p>2、查看帮助</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 web_data]# echo &quot;help&quot;|socat stdio &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats</span><br></pre></td></tr></table></figure>



<p>3、下线后端节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;disable server backend_www_example_com&#x2F;web-node2&quot;|socat stdio &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats</span><br></pre></td></tr></table></figure>



<p>4、上线后端节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;enable server backend_www_example_com&#x2F;web-node3&quot;|socat stdio &#x2F;var&#x2F;lib&#x2F;haproxy&#x2F;stats</span><br></pre></td></tr></table></figure>



<p>5、编写php测试页，放到/data/web_data下，在浏览器中访问可以查看当前的节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 web_data]# vim check.php</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;PHP测试&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;?php  echo &#39;&lt;p&gt;Hello World &lt;&#x2F;p&gt;&#39;; ?&gt;</span><br><span class="line">        &lt;?php  echo &quot;访问的服务器地址是:&quot;.&quot;&lt;fontcolor&#x3D;red&gt;&quot;.$_SERVER[&#39;SERVER_ADDR&#39;].&quot;&lt;&#x2F;font&gt;&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">        echo&quot;访问的服务器域名是:&quot;.&quot;&lt;fontcolor&#x3D;red&gt;&quot;.$_SERVER[&#39;SERVER_NAME&#39;].&quot;&lt;&#x2F;font&gt;&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">        ?&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<h2 id="重启docker服务，容器全部退出的解决办法"><a href="#重启docker服务，容器全部退出的解决办法" class="headerlink" title="重启docker服务，容器全部退出的解决办法"></a>重启docker服务，容器全部退出的解决办法</h2><h3 id="在启动是指定自动重启"><a href="#在启动是指定自动重启" class="headerlink" title="在启动是指定自动重启"></a><strong>在启动是指定自动重启</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  --restart&#x3D;always</span><br></pre></td></tr></table></figure>



<h3 id="修改docker默认配置文件"><a href="#修改docker默认配置文件" class="headerlink" title="修改docker默认配置文件"></a><strong>修改docker默认配置文件</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 添加上下面这行</span><br><span class="line">&quot;live-restore&quot;: true</span><br></pre></td></tr></table></figure>





<p>docker server配置文件 /etc/docker/daemon.json 参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# cat  &#x2F;etc&#x2F;docker&#x2F;daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;registry.docker-cn.com&quot;],</span><br><span class="line">  &quot;graph&quot;: &quot;&#x2F;opt&#x2F;mydocker&quot;, # 修改数据的存放目录到&#x2F;opt&#x2F;mydocker&#x2F;，原&#x2F;var&#x2F;lib&#x2F;docker&#x2F;</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;],</span><br><span class="line">  &quot;live-restore&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>重启生效，只对在此之后启动的容器生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# systemctl restart  docker.service</span><br></pre></td></tr></table></figure>



<h2 id="Docker网络类型"><a href="#Docker网络类型" class="headerlink" title="Docker网络类型"></a><strong>Docker网络类型</strong></h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyN3O8G4N3W0f7o9MMbdtXhrkok419zbBSNicK98KFOeuibry2onlibKMxAw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="docker的网络类型"><a href="#docker的网络类型" class="headerlink" title="docker的网络类型"></a><strong>docker的网络类型</strong></h3><p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNecj4bBrkKJa3jfnpKxpicTtyPGbqbbLBZ2Pp3Bp3BCC0xCT2QIRVPTw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>Bridge默认docker网络隔离基于网络命名空间，在物理机上创建docker容器时会为每一个docker容器分配网络命名空间，并且把容器IP桥接到物理机的虚拟网桥上。</p>
<h3 id="不为容器配置网络功能-none"><a href="#不为容器配置网络功能-none" class="headerlink" title="不为容器配置网络功能(none)"></a><strong>不为容器配置网络功能(none)</strong></h3><p>此模式下创建容器是不会为容器配置任何网络参数的，如：容器网卡、IP、通信路由等，全部需要自己去配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -it --network none busybox:latest  &#x2F;bin&#x2F;sh </span><br><span class="line">&#x2F; # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue </span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>



<h3 id="与其他容器共享网络配置-Container）"><a href="#与其他容器共享网络配置-Container）" class="headerlink" title="与其他容器共享网络配置(Container）"></a><strong>与其他容器共享网络配置(Container）</strong></h3><p>此模式和host模式很类似，只是此模式创建容器共享的是其他容器的IP和端口而不是物理机，此模式容器自身是不会配置网络和端口，创建此模式容器进去后，你会发现里边的IP是你所指定的那个容器IP并且端口也是共享的，而且其它还是互相隔离的，如进程等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -it --network container:mywordpress_db_1  busybox:latest  &#x2F;bin&#x2F;sh </span><br><span class="line">&#x2F; # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue </span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">105: eth0@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link&#x2F;ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.3&#x2F;16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>



<h3 id="使用宿主机网络-host"><a href="#使用宿主机网络-host" class="headerlink" title="使用宿主机网络(host)"></a><strong>使用宿主机网络(host)</strong></h3><p>此模式创建的容器没有自己独立的网络命名空间，是和物理机共享一个Network Namespace，并且共享物理机的所有端口与IP，并且这个模式认为是不安全的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -it --network host  busybox:latest  &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>



<h3 id="查看网络列表"><a href="#查看网络列表" class="headerlink" title="查看网络列表"></a><strong>查看网络列表</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker network list </span><br><span class="line">NETWORK ID          NAME                  DRIVER              SCOPE</span><br><span class="line">b15e8a720d3b        bridge                bridge              local</span><br><span class="line">345d65b4c2a0        host                  host                local</span><br><span class="line">bc5e2a32bb55        mywordpress_default   bridge              local</span><br><span class="line">ebf76eea91bb        none                  null                local</span><br></pre></td></tr></table></figure>



<h3 id="用PIPEWORK为docker容器配置独立IP"><a href="#用PIPEWORK为docker容器配置独立IP" class="headerlink" title="用PIPEWORK为docker容器配置独立IP"></a><strong>用PIPEWORK为docker容器配置独立IP</strong></h3><ul>
<li><p>参考文档：</p>
<p>blog.csdn.net/design321/article/details/48264825</p>
</li>
</ul>
<ul>
<li><p>官方网站：</p>
<p>github.com/jpetazzo/pipework</p>
</li>
</ul>
<ul>
<li>宿主环境：centos7.2</li>
</ul>
<p>1、安装pipework</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;jpetazzo&#x2F;pipework&#x2F;archive&#x2F;master.zip</span><br><span class="line">unzip master.zip </span><br><span class="line">cp pipework-master&#x2F;pipework  &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class="line">chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pipework</span><br></pre></td></tr></table></figure>



<p>2、配置桥接网卡</p>
<p>安装桥接工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install bridge-utils.x86_64 -y</span><br></pre></td></tr></table></figure>



<p>修改网卡配置，实现桥接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 修改eth0配置，让br0实现桥接</span><br><span class="line">[root@docker01 ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0 </span><br><span class="line">TYPE&#x3D;Ethernet</span><br><span class="line">BOOTPROTO&#x3D;static</span><br><span class="line">NAME&#x3D;eth0</span><br><span class="line">DEVICE&#x3D;eth0</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">BRIDGE&#x3D;br0</span><br><span class="line">[root@docker01 ~]# cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-br0 </span><br><span class="line">TYPE&#x3D;Bridge</span><br><span class="line">BOOTPROTO&#x3D;static</span><br><span class="line">NAME&#x3D;br0</span><br><span class="line">DEVICE&#x3D;br0</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">IPADDR&#x3D;10.0.0.100</span><br><span class="line">NETMASK&#x3D;255.255.255.0</span><br><span class="line">GATEWAY&#x3D;10.0.0.254</span><br><span class="line">DNS1&#x3D;223.5.5.5</span><br><span class="line"># 重启网络</span><br><span class="line">[root@docker01 ~]# &#x2F;etc&#x2F;init.d&#x2F;network restart</span><br></pre></td></tr></table></figure>



<p>3、运行一个容器镜像测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipework br0 $(docker run -d -it -p 6880:80 --name  httpd_pw httpd) 10.0.0.220&#x2F;24@10.0.0.254</span><br></pre></td></tr></table></figure>



<p>在其他主机上测试端口及连通性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# curl 10.0.0.220</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;&#x2F;h1&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br><span class="line">[root@docker01 ~]# ping 10.0.0.220 -c 1</span><br><span class="line">PING 10.0.0.220 (10.0.0.220) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.0.0.220: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.043 ms</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4、再运行一个容器，设置网路类型为none：</span><br><span class="line">pipework br0 $(docker run -d -it --net&#x3D;none --name test httpd:2.4) 10.0.0.221&#x2F;24@10.0.0.254</span><br></pre></td></tr></table></figure>





<p>进行访问测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# curl 10.0.0.221</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;&#x2F;h1&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>



<p>5、重启容器后需要再次指定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipework br0 testduliip  172.16.146.113&#x2F;24@172.16.146.1</span><br><span class="line">pipework br0 testduliip01  172.16.146.112&#x2F;24@172.16.146.1</span><br></pre></td></tr></table></figure>



<p>Dcoker跨主机通信之overlay可以参考：</p>
<p>cnblogs.com/CloudMan6/p/7270551.html</p>
<h3 id="Docker跨主机通信之macvlan"><a href="#Docker跨主机通信之macvlan" class="headerlink" title="Docker跨主机通信之macvlan"></a><strong>Docker跨主机通信之macvlan</strong></h3><p>创建网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker network  create --driver macvlan  --subnet 10.1.0.0&#x2F;24 --gateway 10.1.0.254 -o parent&#x3D;eth0  macvlan_1</span><br><span class="line">33a1f41dcc074f91b5bd45e7dfedabfb2b8ec82db16542f05213839a119b62ca</span><br></pre></td></tr></table></figure>



<p>设置网卡为混杂模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set eth0 promisc on</span><br></pre></td></tr></table></figure>



<p>创建使用macvlan网络容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker run  -it --network macvlan_1  --ip&#x3D;10.1.0.222 busybox &#x2F;b</span><br></pre></td></tr></table></figure>



<h2 id="docker企业级镜像仓库harbor"><a href="#docker企业级镜像仓库harbor" class="headerlink" title="docker企业级镜像仓库harbor"></a><strong>docker企业级镜像仓库harbor</strong></h2><p>容器管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]# pwd</span><br><span class="line">&#x2F;opt&#x2F;harbor</span><br><span class="line">[root@docker01 harbor]# docker-compose stop</span><br></pre></td></tr></table></figure>



<p>1、安装docker、docker-compose</p>
<p>下载 harbor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt &amp;&amp; https:&#x2F;&#x2F;storage.googleapis.com&#x2F;harbor-releases&#x2F;harbor-offline-installer-v1.3.0.tgz</span><br><span class="line">tar xf harbor-offline-installer-v1.3.0.tgz</span><br></pre></td></tr></table></figure>



<p>2、修改主机及web界面密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]# vim harbor.cfg </span><br><span class="line">    ···</span><br><span class="line">    hostname &#x3D; 10.0.0.100</span><br><span class="line">    harbor_admin_password &#x3D; Harbor12345</span><br><span class="line">    ···</span><br></pre></td></tr></table></figure>



<p>3、执行安装脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]# .&#x2F;install.sh</span><br></pre></td></tr></table></figure>



<p>浏览器访问 <a target="_blank" rel="noopener" href="http://10.0.0.11/">http://10.0.0.11</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNdibRRbq9WzbzMkicCf1xrbuZgmXVIQFxrvsalTniaFibq0XVnuxezP4JRA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"> </p>
<p>添加一个项目</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyND9aeaeciacdebb7mWbrm4lGHHju8zVianusKOBbbJic3vcY3o7nLbV8tQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>4、镜像推送到仓库的指定项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker  tag centos:6.8  10.0.0.100&#x2F;clsn&#x2F;centos6.8:1.0</span><br><span class="line">[root@docker02 ~]#  </span><br><span class="line">[root@docker02 ~]# docker images </span><br><span class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">busybox                     latest              5b0d59026729        8 days ago          1.15MB</span><br><span class="line">10.0.0.100&#x2F;clsn&#x2F;centos6.8   1.0                 6704d778b3ba        2 months ago        195MB</span><br><span class="line">centos                      6.8                 6704d778b3ba        2 months ago        195MB</span><br><span class="line">[root@docker02 ~]# docker login 10.0.0.100</span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>



<p>5、推送镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker push 10.0.0.100&#x2F;clsn&#x2F;centos6.8 </span><br><span class="line">The push refers to repository [10.0.0.100&#x2F;clsn&#x2F;centos6.8]</span><br><span class="line">e00c9229b481: Pushing  13.53MB&#x2F;194.5MB</span><br></pre></td></tr></table></figure>



<p>6、在web界面里查看</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaicIibGNyuxJNbNay2XqjcyNQAAEboIdByNZWVv08D9ibvalrm9vefENnpY5lCWhEYQWS7oMK7cJx4A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"> </p>
<h3 id="使用容器的建议"><a href="#使用容器的建议" class="headerlink" title="使用容器的建议"></a><strong>使用容器的建议</strong></h3><ol>
<li><p>不要以拆分方式进行应用程序发布</p>
</li>
<li><p>不要创建大型镜像</p>
</li>
<li><p>不要在单个容器中运行多个进程</p>
</li>
<li><p>不要再镜像内保存凭证，不要依赖IP地址</p>
</li>
<li><p>以非root用户运行进程</p>
</li>
<li><p>不要使用“最新”标签</p>
</li>
<li><p>不要利用运行中的容器创建镜像</p>
</li>
<li><p>不要使用单层镜像</p>
</li>
<li><p>不要将数据存放在容器内</p>
</li>
</ol>
<h3 id="关于Docker容器的监控"><a href="#关于Docker容器的监控" class="headerlink" title="关于Docker容器的监控"></a><strong>关于Docker容器的监控</strong></h3><p><strong>容器的基本信息</strong></p>
<ul>
<li>包括容器的数量、ID、名称、镜像、启动命令、端口等信息</li>
</ul>
<p><strong>容器的运行状态</strong></p>
<ul>
<li>统计各状态的容器的数量，包括运行中、暂停、停止及异常退出</li>
</ul>
<p><strong>容器的用量信息</strong></p>
<ul>
<li>统计容器的CPU使用率、内存使用量、块设备I/O使用量、网络使用情况等资源的使用情况</li>
</ul>
<p>在docker运行过程中，防火墙关闭或者重启后，会清空docker规则。需要重新启动docker服务和容器<br>docker里容器有一部分不能启动，是因为端口被占用，将端口杀死，重启就好了。</p>
<p>将宿主机的文件复制到docker容器内/usr/文件下的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp 要拷贝的文件路径 容器名（容器id）：要拷贝到容器里面对应的路径</span><br><span class="line">eg： docker cp &#x2F;java&#x2F;jar.txt 容器id:&#x2F;usr&#x2F;</span><br></pre></td></tr></table></figure>

<p>从容器里面拷文件到宿主机：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器名（容器id）：要拷贝的文件在容器里面的路径       要拷贝到宿主机的相应路径 </span><br><span class="line">eg： docker cp testtomcat：&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;test&#x2F;js&#x2F;test.js &#x2F;opt</span><br></pre></td></tr></table></figure>

<p>注：不管容器有没有启动，拷贝命令都会生效</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/16.1.Docker/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-26.1.ElasticSearch" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/17/26.1.ElasticSearch/">ElasticSearch</a>
    </h1>
  

        
        <a href="/2021/04/17/26.1.ElasticSearch/" class="archive-article-date">
  	<time datetime="2021-04-17T05:00:52.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-17</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>ElasticSearch 入门</strong></p>
<ul>
<li>新增数据</li>
<li>查询数据</li>
<li>更新数据</li>
<li>删除数据</li>
<li>批量操作</li>
</ul>
<p><strong>ElasticSearch 高级使用</strong></p>
<ul>
<li>聚合操作</li>
<li>映射操作</li>
<li>分词操作</li>
</ul>
<p><strong>Spring Boot 整合 ElasticSearch</strong></p>
<ul>
<li> <strong>…</strong></li>
</ul>
<blockquote>
<p>本篇文章的内容均以 Docker 环境为基础。</p>
</blockquote>
<p>首先拉取镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.4.2</span><br></pre></td></tr></table></figure>

<p>然后下载kibana，这是一个可视化检索数据的工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:7.4.2</span><br></pre></td></tr></table></figure>

<p>创建两个文件夹用作数据卷：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;mydata&#x2F;elasticsearch&#x2F;config</span><br><span class="line">mkdir -p &#x2F;mydata&#x2F;elasticsearch&#x2F;data</span><br></pre></td></tr></table></figure>

<p>创建一个配置文件并写入配置，使得外部机器能够访问 elasticsearch：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;http.host: 0.0.0.0&quot; &gt;&gt; &#x2F;mydata&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml</span><br></pre></td></tr></table></figure>

<p>这样就可以启动 elasticsearch 了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --name elasticsearch -p 9200:9200 -p 9300:9300 \</span><br><span class="line">-e &quot;discovery.type&#x3D;single-node&quot; \</span><br><span class="line">-e ES_JAVA_OPTS&#x3D;&quot;-Xms64m -Xmx128m&quot; \</span><br><span class="line">-v &#x2F;mydata&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml \</span><br><span class="line">-v &#x2F;mydata&#x2F;elasticsearch&#x2F;data:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data \</span><br><span class="line">-v &#x2F;mydata&#x2F;elasticsearch&#x2F;plugins:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins \</span><br><span class="line">-d elasticsearch:7.4.2</span><br></pre></td></tr></table></figure>

<p>其中开放的 <code>9200</code> 端口为向elasticsearch发送请求的端口，而 <code>9300</code> 为集群环境下elasticsearch之间互相通信的端口；<code>&quot;discovery.type=single-node&quot;</code> 表示以单节点运行elasticsearch；<code>ES_JAVA_OPTS=&quot;-Xms64m -Xmx128m&quot;</code> 用于指定elasticsearch的内存占用，而且必须指定，否则elasticsearch将占用系统的全部内存；最后设置elasticsearch的挂载点。</p>
<p>若是启动报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Caused by: java.nio.file.AccessDeniedException: &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data&#x2F;nodes&quot;,</span><br></pre></td></tr></table></figure>

<p>这是因为我们的挂载点权限不足导致的，此时修改挂载点权限重新启动elasticsearch即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 &#x2F;mydata&#x2F;elasticsearch&#x2F;data&#x2F;</span><br></pre></td></tr></table></figure>

<p>然后启动 Kibana：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name kibana -e ELASTICSEARCH_HOSTS&#x3D;http:&#x2F;&#x2F;www.ithui.top:9200 -p 5601:5601 -d kibana:7.4.2</span><br></pre></td></tr></table></figure>

<p>启动完成后访问 <a target="_blank" rel="noopener" href="http://www.ithui.top:5601/%EF%BC%9A">http://www.ithui.top:5601/：</a></p>
<p><strong>ElasticSearch 入门</strong></p>
<p>ElasticSearch 通过接收请求的方式来对数据进行处理，接下来对elasticsearch进行一个简单的入门。首先是 <code>_cat</code> 请求，通过该请求能够查询elasticsearch的一些基本信息，具体如下：</p>
<ul>
<li>GET   /_cat/nodes：查看所有节点</li>
<li>GET   /_cat/health：查看elasticsearch的健康状况</li>
<li>GET   /_cat/master：查看主节点</li>
<li>GET   /_cat/indices：查看所有索引</li>
</ul>
<p>比如查看 elasticsearch 的所有节点，则需要发送 <a target="_blank" rel="noopener" href="http://www.ithui.top/_cat/nodes">http://www.ithui.top/_cat/nodes</a> 请求，结果如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYYCgx7Mr24OE1uricCibBTgrnPGXpSF7zoe63LK8l4ibPHXIggHKA9eE5g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>若是想查看 elasticsearch 的健康状态，则发送 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/_cat/health">http://www.ithui.top:9200/_cat/health</a> 请求，结果如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYCGicdO6fXicBKqibNd7icibicJzOboF6ZMlO1cPqL4qu7EWTickPIb9ibjaOCA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h2><p>elasticsearch通过接收PUT和POST请求来新增数据，然而在新增数据之前，我们需要来了解elasticsearch中的几个概念：</p>
<ul>
<li>索引</li>
<li>类型</li>
<li>文档</li>
<li>属性</li>
</ul>
<p>我们可以类比一下mysql中的概念来更形象地理解它们。在mysql中，若是想保存一条数据，我们首先需要创建数据库，然后在数据库中创建数据表，最后将数据作为一条记录插入数据表；而elasticsearch中的索引就相当于mysql中的数据库，类型就相当于数据表，文档就相当于一条记录。</p>
<p>所以，若是想在elasticsearch中新增一条数据，我们就需要指定这条数据放在哪个索引的哪个类型下，该条数据也被称为一个文档，而且这些数据是json格式的，json中的键被称为属性。</p>
<p>在elasticsearch中新增一条数据我们有更加专业的说法，称其为 <code>索引一个文档</code> ，接下来就可以发送一个请求 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1">http://www.ithui.top:9200/customer/external/1</a> ，该请求表示向customer索引下的external文档存放一个标识为1的数据，数据可以存放在请求体中携带过去：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYIuEnrjuHLFtYdQFAzv9s5OMScURf3WMNiaF52oVHqcbaxgF5BhtUQqQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>我们来分析一下该请求的返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;_index&quot;</span>: <span class="string">&quot;customer&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_type&quot;</span>: <span class="string">&quot;external&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;created&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;total&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">&quot;successful&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;failed&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;_seq_no&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;_primary_term&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中以 <code>_</code> 开头的属性称为元数据，它表示的是elasticsearch中的基本信息，比如 <code>_index</code> 表示当前索引；<code>_type</code> 表示当前类型；<code>_id</code> 表示当前数据的标识；<code>_version</code> 表示版本；<code>result</code> 表示当前操作的状态，这里是新建状态，若是索引的文档已经存在，则状态为更新状态。</p>
<p>PUT请求方式同样也能够新增数据，然而它与POST有些许不同，POST能够不携带id进行数据的保存，比如：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYHcqBIEf8ywlbBCPXnVJBczmkFxmXz0FPUtFmpQeXDHOJJCHveicDW6w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>此时elasticsearch会自动为我们分配一个唯一的id，所以若是不携带id，则每次请求都将是一次新增数据的操作。然而PUT请求方式是无法实现这样的效果的，也就是说，若是使用PUT方式发送请求，则必须携带id，否则就会报错：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIY6DA3hBB9GnF19uZWh8pauaTlXNbt4KjTGQEILhNfnicdRzcvepAibuCw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>elasticsearch接收GET请求用于查询数据，比如发送 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1">http://www.ithui.top:9200/customer/external/1</a> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYJBjaqcJia8m721wZia0xcUr5D0ZcYYzU2K9voVoYSstibIK0B04cbBr7w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>其中数据存放在 <code>_source</code> 中， <code>_seq_no</code> 属性和 <code>_primary_term</code> 属性是用来做并发控制的，数据在每次更新之后都会加1，是乐观锁机制。</p>
<p>它的原理是这样的，假设此时有两个请求同时来到并且均想要修改id为1的数据，那么可以让这两个请求去判断一下当前的数据是否是最新的，怎么知道数据是最新的呢？</p>
<p>就是判断 <code>seq_no</code> 和 <code>_primary_term</code> 属性，比如这个请求：<a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1?if_seq_no=0&amp;if_primary_term=1">http://www.ithui.top:9200/customer/external/1?if_seq_no=0&amp;if_primary_term=1</a> 。</p>
<p>它在更新数据前会去判断 <code>seq_no</code> 是否等于0， <code>_primary_term</code> 是否等于1，若成立，则证明数据是最新的，所以它能够修改成功：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYVXicgTUz21KT7A16H9CGLN7uYkIUiaJaCLxfwVRLysdfHZOSudOS4HdQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>此时需要注意了，当数据更新成功后， <code>_seq_no</code> 属性便会自动向上递增，此时第二个请求就无法更新了：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYAzMN5obb1GS91mz9esw5shJzfYDgGTLEIDqciaRR6eOJrxhcZPJdMkQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>原因就是当前的版本与期望的版本不一致，此时若想继续更新，就需要重新查询数据，得到并发控制属性值，再进行更新。</p>
<p><strong>更新数据</strong></p>
<p>在新增数据中我们已然接触了更新数据，当要新增的数据已经存在时，新增操作就会变为更新操作，当然了，elasticsearch还是为我们提供了另外一种更新方式。比如 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1/_update">http://www.ithui.top:9200/customer/external/1/_update</a> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYfssgzP3mibvUTNlTY2QbTjh9QdoHp5qWazcn8F6ZqXxWAxv1RGeYZhQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>需要注意的是，若是以这样的方式进行数据更新，则请求体数据必须用 <code>doc</code> 属性进行封装，它与不携带 <code>_update</code> 进行数据更新的方式有什么区别呢？</p>
<p>若是不携带 <code>_update</code> 更新数据，则每次发送请求elasticsearch都认为是一次更新，而携带 <code>_update</code> 更新数据，则elasticsearch会检查当前数据是否与原数据一致，若一致，则不会进行任何的操作，包括版本号、并发控制属性等都不会发生变化。</p>
<p>这里的PUT方式与POST方式效果一样，没有任何区别。</p>
<p><strong>删除数据</strong></p>
<p>elasticsearch通过接收DELETE请求来完成数据的删除操作。比如 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer/external/1">http://www.ithui.top:9200/customer/external/1</a> ，通过该请求能够删除id为1的数据；elasticsearch还支持直接删除索引，比如 <a target="_blank" rel="noopener" href="http://www.ithui.top:9200/customer">http://www.ithui.top:9200/customer</a> ，该请求将删除customer索引；但是我们无法直接删除类型，elasticsearch是不支持直接删除类型的。</p>
<p><strong>批量操作</strong></p>
<p>elasticsearch还支持批量操作，不过批量操作我们就需要在kibana中进行测试了，我们在前面已经启动了kibana的镜像，只需访问 <a target="_blank" rel="noopener" href="http://www.ithui.top:5601/">http://www.ithui.top:5601/</a> 即可来到kibana的界面：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYia7rb9xv7Ric9z64r8ckVMLic23rCKR3843PF3HqeQ1yQUOiauK3Ricnnwg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>点击左侧导航栏的 <code>Dev Tools</code> 进入到开发工具：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYkJdlCQCic3kvjo2Jlia6YuY9bgLIeoXjbic10thd5ictEzAQSGtr4HBZPg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>编写好请求后点击运行图标即可发送请求，批量操作的数据格式非常有讲究：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;lisi&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 <code>&quot;index&quot;</code> 表示新增操作，并且指定了数据的id为1，而具体需要新增的数据值是在第二行存放着：<code>&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;</code> ；第三行也是如此，仍然是新增操作，指定数据id为2，数据值为：<code>&#123;&quot;name&quot;:&quot;lisi&quot;&#125;</code>，这样运行之后elasticsearch会执行两个新增操作，将这两个数据保存起来。</p>
<p>再比如这样一段复杂的批量操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;_bulk</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Test Title&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Test Title2&quot;&#125;</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Update Title&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>首先是第一行， <code>_bulk</code> 指定了这次操作为批量操作，因为没有设置其它的任何信息，所以接下来的所有操作都需要指定索引、类型等信息；</p>
<p>第二行 <code>delete</code> 表示一个删除操作，其后指定了索引、类型以及要删除的数据id，因为删除操作不需要携带请求体数据，所以我们可以直接在下一行编写第二个操作；</p>
<p>第三行 <code>create</code> 表示一个新增操作，并指定了索引、类型、数据id，第四行就是需要新增的数据值了；第五行与第六行也是一个新增操作；第七行和第八行是一个更新操作，而且因为是update更新，所以请求体数据需要用 <code>doc</code> 属性包装。</p>
<p>运行该操作，得到结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIY7r7ThL49nhG1e6WZLx14lKamwicjXuBPjsslTDuiaEvVxUyHwyJfoqAQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>第一个删除操作，因为不存在这样的一个数据，所以删除失败了，状态为404，但是后面的操作却成功了，从这里可以说明，elasticsearch批量操作中的每个操作都是相互独立的，互相不会造成任何影响。</p>
<p><strong>ElasticSearch高级使用</strong></p>
<p>elasticsearch有两种检索方式，一种是前面说过的，发送REST请求，将数据以请求体的方式携带，还有一种方式就是直接将数据拼接在url路径上，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search?q&#x3D;*&amp;sort&#x3D;account_number:asc</span><br></pre></td></tr></table></figure>

<p>它表示这是一个GET请求，要操作的索引是bank， <code>_search</code> 表示这是一次检索， <code>q=*</code> 表示查询所有， <code>sort=account_number:asc</code> 表示以 <code>account_number</code> 的值进行升序排序。</p>
<p>我们还可以这样进行检索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;asc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两种检索方式得到的结果是一样的，来介绍一下这种检索方式的语法。首先是 <code>query</code> ，它用于指定查询条件， <code>match_all</code> 表示匹配所有，大括号后面可以编写匹配的规则；其次是 <code>sort</code> ，它用于指定排序条件， <code>account_number:asc</code> 则表示以该属性的值进行升序排序，若是想指定多个规则，可以继续在 <code>sort</code> 属性中进行编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;asc&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;balance&quot;: &quot;desc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<p>此时则表示先按 <code>account_number</code> 进行升序，再按 <code>balance</code> 进行降序排序。</p>
<p>通过请求体数据进行检索的方式被称为 <code>Query DSL</code> ，即：查询领域对象语言，在elasticsearch中我们将会大量地编写这种语言。查询领域对象语言的基本语法是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> QUERY_NAME:&#123;</span><br><span class="line">   ARGUMENT:VALUE,</span><br><span class="line">    ARGUMENT:VALUE,</span><br><span class="line">    ....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先整个语句需要被一对大括号包含，在大括号内需要编写对应的操作，比如查询，就编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;query&quot;:&#123;</span><br><span class="line">   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>query</code> 中又需要指定查询的条件，比如匹配部分、匹配所有，以及匹配的规则等等，若是想要排序，则编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;sort&quot;:[</span><br><span class="line">  </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sort</code> 是一个数组，表示可以指定多个排序的规则。在其中还可以指定分页，只需要设置 <code>from</code>和<code>size</code> 属性值即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里表示从第一条数据开始，每页显示5条数据。我们还能通过指定 <code>_source</code> 属性来决定 elasticsearch 检索出的数据中包含哪些属性值，以剔除不必要的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;asc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 5,</span><br><span class="line">  &quot;_source&quot;: [&quot;balance&quot;,&quot;firstname&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示只返回 <code>balance</code> 和 <code>firstname</code> 属性值。匹配规则中除了可以指定匹配全部外，还可以匹配指定的属性值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;account_number&quot;: &quot;20&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示检索 <code>account_number</code> 为20的数据，这是一个精确检索的操作。它当然还支持模糊检索，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill lane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示检索 <code>address</code> 中包含mill和lane的数据，我们来看看elasticsearch返回的结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYBB3AnlOrTxSgiag803nbuOyuYvyAb23ZueCiatM2VsvSbP0ziaXjMSVDA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>来观察一下这两条数据，第一条数据有一个 <code>_score</code> 的属性，它表示的是当前数据的得分情况，因为该数据中包含了Mill lane字符串，所以能够最大程度地匹配上我们的匹配规则，故它的得分最高；再看第二条数据，因为该数据中只包含了Mill而没有Lane，所以它的匹配度更低一些，故而得分低一些。</p>
<p>由此可知，elasticsearch会将匹配规则中包含的所有字符串都去与待检索的数据进行匹配，实际上，elasticsearch底层采用的是分词策略，具体是如何进行分词的我们暂且先不做了解。我们还可以根据得分情况去获知哪些数据与我们想要的数据匹配度更接近。</p>
<p>虽然elasticsearch可以进行分词模糊匹配，但我们若是就想查询哪些数据中含有mill road呢？这个时候，我们可以采用 <code>match_phrase</code> 来实现短语匹配，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill lane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还可以进行多字段匹配，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;mill&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;address&quot;,&quot;city&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时表示在 <code>address</code> 和 <code>city</code> 属性中匹配mill字符串，倘若有一个满足，都符合我们的匹配规则。</p>
<p>当我们需要同时指定多个检索规则的时候，我们可以使用 <code>bool</code> 属性完成复合检索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;gender&quot;: &quot;F&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &quot;mill&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;age&quot;: &quot;28&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;lastname&quot;: &quot;Wallace&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段语句中，首先是 <code>bool</code> 属性复合了四个检索条件，然后是 <code>must</code> 属性，它表示必须满足检索条件，条件为 <code>gender</code> 等于F， <code>address</code> 包含mill；而 <code>must_not</code> 表示必须排除检索条件，条件为 <code>age</code> 等于28；最后是 <code>should</code> ，它表示应该满足检索条件，检索条件为<code>lastname</code> 等于Wallace。</p>
<p>它的关键在于即使不满足该条件，这条数据也可以被查询出来，但如果某条数据满足了 <code>should</code>指定的条件，它就会得到相应的得分，可以认为这是一个加分项。</p>
<p>我们还可以通过 <code>filter</code> 过滤器实现检索，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 18,</span><br><span class="line">            &quot;lte&quot;: 30</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段语句表示检索年龄在18~30之间的数据，但需要注意的是，使用 <code>filter</code> 属性并不会影响数据的得分。</p>
<p>使用 <code>match</code> 能够实现精确检索，但elasticsearch推荐我们使用 <code>match</code> 属性进行模糊检索，而使用 <code>term</code> 进行精确检索，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;balance&quot;: &quot;32838&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>聚合</strong></p>
<p>elasticsearch 除了能够检索数据，它还能够对数据进行分析，elasticsearch 中的聚合就提供了从数据中分组和提取数据的能力。</p>
<p>比如这样的一个需求，检索地址中包含mill的所有人的年龄分布以及平均年龄，该如何编写语句呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;mill&quot;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;ageAgg&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ageAvg&quot;:&#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先通过 <code>query</code> 属性检索地址中包含mill的人，然后通过 <code>aggs</code> 指定聚合操作，第一个聚合为 <code>ageAgg</code> ，这是聚合操作的名字，可以取任意值，其中 <code>terms</code> 表示分布情况；第二个聚合为 <code>ageAvg</code> ，其中 <code>avg</code> 表示平均值，来看检索得到的结果：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYcGjVhJKWv1sLTyBNZRa31BGoFqdUd4iaLINfS9LZkXMnaHwH8xP8Ifw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>其中 <code>buckers</code> 中的数据是每种年龄的分布情况，比如38岁的有2人，28岁的有1人；<code>ageAvg</code>中的就是年龄的平均值了，为34.0。</p>
<p>又比如这个需求，按照年龄聚合，并求这些年龄段的人的平均薪资，语句就该这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;bank&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;ageAgg&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 100</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;ageAvg&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;balance&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个嵌套的聚合操作，首先通过 <code>terms</code> 按照年龄聚合， <code>size</code> 表示分布有多少种情况，这里假设有100种，然后在该聚合的基础上进行平均聚合，这里需要注意平均聚合语句的位置是在年龄聚合的里面的。</p>
<p><strong>映射</strong></p>
<p>映射是用来定义一个文档，以及它所包含的属性是如何存储和索引的，但我们发现，在使用elasticsearch的过程中，我们并没有对数据进行类型的指定，这是因为elasticsearch会自动猜测映射类型，我们可以通过请求查看映射信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET bank&#x2F;_mapping</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;bank&quot; : &#123;</span><br><span class="line">    &quot;mappings&quot; : &#123;</span><br><span class="line">      &quot;properties&quot; : &#123;</span><br><span class="line">        &quot;account_number&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;address&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">          &quot;fields&quot; : &#123;</span><br><span class="line">            &quot;keyword&quot; : &#123;</span><br><span class="line">              &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">              &quot;ignore_above&quot; : 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;long&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每个属性的 <code>type</code> 中都显示了它的类型。然而有些属性的类型并不是我们想要的，这个时候我们可以修改指定属性的类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my_index</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;age&quot;:&#123;&quot;type&quot;: &quot;integer&quot;&#125;,</span><br><span class="line">      &quot;email&quot;:&#123;&quot;type&quot;: &quot;keyword&quot;&#125;,</span><br><span class="line">      &quot;name&quot;:&#123;&quot;type&quot;: &quot;text&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照我们获取到的映射规则对其进行设置即可。此时我们获取my_index索引的映射信息进行查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;my_index&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123; &#125;,</span><br><span class="line">    &quot;mappings&quot; : &#123;</span><br><span class="line">      &quot;properties&quot; : &#123;</span><br><span class="line">        &quot;age&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;email&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;keyword&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;name&quot; : &#123;</span><br><span class="line">          &quot;type&quot; : &quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明设置是成功的。但这种方式仅限于设置不存在的索引，若是需要设置的索引已经存在，则我们无法通过这种方式来改变属性的类型。我们需要采用另外一种方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my_index&#x2F;_mapping</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;:&#123;</span><br><span class="line">    &quot;id&quot;:&#123;&quot;type&quot;:&quot;long&quot;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而这种方式只能用于添加新的映射规则， 而不能修改之前属性的类型。所以若是想要修改已存在的属性类型，只能再创建一个新的索引，并指定好映射规则，再将之前的数据迁移到新的索引中来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 创建新的映射规则索引</span><br><span class="line">PUT &#x2F;newbank</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;balance&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;city&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 数据迁移</span><br><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;bank&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;newbank&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h2><p>在前面有说到elasticsearch是通过分词来进行模糊检索的，而分词在elasticsearch中是通过tokenizer分词器实现的，分词器通过接收一个字符流，将其分割为独立的tokens词元。</p>
<p>elasticsearch中默认有一些分词器，但它们都只支持英文的分词，对于中文，我们需要额外安装一个分词器，这里以 <code>ik</code> 分词器为例，首先下载ik分词器，下载地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIY62y3nibUQHvUJvceyjPC0xQXlW1ghYe4JPj7ud9kiadianpiabb2ocpib8Q/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>同样下载 7.4.2 版本的 ik 分词器：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYbWoJCYJgfwMVicMRealpxaQel40T4SRAA0u94maCXVDicyarAUjYgJuQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>在该位置复制下载地址，然后在服务器上进行安装，因为在启动 elasticsearch 镜像的时候我们做了数据卷的映射，所以只需将其下载好存放在 <code>/mydata/elasticsearch/plugins</code> 目录下即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;mydata&#x2F;elasticsearch&#x2F;plugins</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;medcl&#x2F;elasticsearch-analysis-ik&#x2F;releases&#x2F;download&#x2F;v7.4.2&#x2F;elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>

<p>下载完成后解压一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>

<p>解压完成后重启elasticsearch，这样我们就安装好了ik分词器，可以来测试一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;分词器检索。&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;分词器&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;检索&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来看看elasticsearch默认使用的分词器的分词效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;分词器检索。&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;分&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 1,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;词&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 1,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;器&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 2,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;检&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;索&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很显然，默认的分词器只是把每个字都当成了一个词而已，在中文的处理上与ik分词器相比就要逊色很多了。</p>
<p>但有时候ik分词器仍然达不到我们的需求，比如最近才流行起来的网络热词，ik分词器肯定是没有办法对其进行分词的，所以我们需要对其定制扩展词库，找到nginx映射目录下的html文件夹，在该文件夹下创建es文件夹用于存放ik分词器需要使用到的一些资源( <code>关于nginx的运行与配置请看文章最后一节</code> )：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd cd &#x2F;mydata&#x2F;nginx&#x2F;html&#x2F;</span><br><span class="line">mkdir es</span><br></pre></td></tr></table></figure>

<p>然后在es目录下新建一个文本信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@izrcf5u3j3q8xaz es]# vim fenci.txt</span><br><span class="line">[root@izrcf5u3j3q8xaz es]# cat fenci.txt </span><br><span class="line">乔碧萝</span><br></pre></td></tr></table></figure>

<p>将需要定制的词放在该文本中即可，此时我们测试一下访问</p>
<p><a target="_blank" rel="noopener" href="http://www.ithui.top/es/fenci.txt">http://www.ithui.top/es/fenci.txt</a> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYRt3nHT9iaEVob3nenSh9IKtJpnKvvnwq030rst9eI4SqtC2OvMytyAQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>没有问题，我们继续下一步，来到ik分词器的配置目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;mydata&#x2F;elasticsearch&#x2F;plugins&#x2F;ik&#x2F;config&#x2F;</span><br></pre></td></tr></table></figure>

<p>修改它的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim IKAnalyzer.cfg.xml</span><br></pre></td></tr></table></figure>

<p>修改内容如下，将定制的文本地址配置进去即可：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tsiaYGUf1UmD6zrc4MdzwGcIYxheBH9aKhfIWOuIxjsn1DqX6wKKJRKniaxdFa0zjY6kC23T2WopzdAw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>配置完成后一定要重启elasticsearch，此时我们来测试一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;乔碧萝殿下。&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;乔碧萝&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;殿下&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Spring Boot 整合 elasticsearch</strong></p>
<p>前面介绍了elasticsearch的一些基础知识，接下来我们来看看如何在SpringBoot应用中使用elasticsearch。</p>
<p>想要通过Java程序操作elasticsearch，我们也需要发送请求给elasticsearch进行操作，这里我们使用ElasticSearch-Rest-Client对elasticsearch进行操作。</p>
<p>首先引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;7.4.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>因为SpringBoot管理了elasticsearch的依赖版本，所以我们需要指定一下elasticsearch的版本与其一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">  &lt;elasticsearch.version&gt;7.4.2&lt;&#x2F;elasticsearch.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>

<p>然后编写一个配置类，向容器中注册一个操作elasticsearch的组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class GuliMailElasticSearchConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RestHighLevelClient esRestClient() &#123;</span><br><span class="line">        return new RestHighLevelClient(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        new HttpHost(&quot;www.ithui.top&quot;, 9200, &quot;http&quot;)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们就可以通过它操作 elasticsearch 了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">class User &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private String gender;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void index() throws IOException &#123;</span><br><span class="line">    IndexRequest indexRequest &#x3D; new IndexRequest(&quot;users&quot;);</span><br><span class="line">    indexRequest.id(&quot;1&quot;);</span><br><span class="line">    &#x2F;&#x2F; indexRequest.source(&quot;name&quot;,&quot;zhangsan&quot;,&quot;age&quot;,20,&quot;gender&quot;,&quot;男&quot;);</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setName(&quot;zhangsan&quot;);</span><br><span class="line">    user.setAge(20);</span><br><span class="line">    user.setGender(&quot;男&quot;);</span><br><span class="line">    String json &#x3D; JSON.toJSONString(user);</span><br><span class="line">    indexRequest.source(json, XContentType.JSON);</span><br><span class="line">    &#x2F;&#x2F; 执行保存操作</span><br><span class="line">    IndexResponse index &#x3D; client.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#x2F;&#x2F; 响应数据</span><br><span class="line">    System.out.println(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RestHighLevelClient提供了非常多的方式用于保存数据，但比较常用的是通过json数据直接保存，首先需要指定索引， <code>IndexRequest indexRequest = new IndexRequest(&quot;users&quot;);</code> 指定了users索引，然后指定数据id，接着指定数据值，最后使用client执行保存操作，然后可以拿到响应数据。</p>
<p>elasticsearch的其它简单操作，诸如：更新、删除等，都只需要转换一下调用方法即可，如更新操作，就需要使用client调用update方法，接下来我们看看Java程序该如何实现较为复杂的检索操作。</p>
<p>比如现在想聚合出年龄的分布情况，并求出每个年龄分布人群的平均薪资，就应该这样进行编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void search() throws IOException &#123;</span><br><span class="line">    &#x2F;&#x2F; 创建检索请求</span><br><span class="line">    SearchRequest searchRequest &#x3D; new SearchRequest(&quot;bank&quot;);</span><br><span class="line">    &#x2F;&#x2F; 指定需要检索的索引</span><br><span class="line">    &#x2F;&#x2F; searchRequest.indices(&quot;bank&quot;);</span><br><span class="line">    &#x2F;&#x2F; 指定检索条件</span><br><span class="line">    SearchSourceBuilder builder &#x3D; new SearchSourceBuilder();</span><br><span class="line">    &#x2F;&#x2F; 查询条件</span><br><span class="line">    builder.query(QueryBuilders.matchQuery(&quot;address&quot;,&quot;mill&quot;));</span><br><span class="line">    &#x2F;&#x2F; 聚合条件</span><br><span class="line">    builder.aggregation(AggregationBuilders.terms(&quot;ageAgg&quot;).field(&quot;age&quot;));</span><br><span class="line">    builder.aggregation(AggregationBuilders.avg(&quot;balanceAvg&quot;).field(&quot;balance&quot;));</span><br><span class="line">    searchRequest.source(builder);</span><br><span class="line">    &#x2F;&#x2F; 执行检索请求</span><br><span class="line">    SearchResponse searchResponse &#x3D; client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#x2F;&#x2F; 分析结果</span><br><span class="line">    System.out.println(searchResponse.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这些语法我们在最开始接触elasticsearch的时候都已经了解过了，只不过这里是一个链式的方法调用而已。</p>
<p><strong>Nginx</strong></p>
<p>首先拉取 nginx 的镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:1.10</span><br></pre></td></tr></table></figure>

<p>然后随意地启动一个 nginx 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name nginx -d nginx:1.10</span><br></pre></td></tr></table></figure>

<p>启动该 nginx 实例的目的是将 nginx 中的配置文件复制出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container cp nginx:&#x2F;etc&#x2F;nginx .</span><br></pre></td></tr></table></figure>

<p>这样当前目录下就会产生一个nginx文件夹，将其先重命名为conf，然后再创建一个nginx文件夹，并将conf文件夹移动进去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv nginx conf</span><br><span class="line">mkdir nginx</span><br><span class="line">mv conf&#x2F; nginx&#x2F;</span><br></pre></td></tr></table></figure>

<p>然后正式启动一个新的 nginx 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name nginx \</span><br><span class="line">        -v &#x2F;mydata&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html \</span><br><span class="line">        -v &#x2F;mydata&#x2F;nginx&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx \</span><br><span class="line">        -v &#x2F;mydata&#x2F;nginx&#x2F;conf:&#x2F;etc&#x2F;nginx \</span><br><span class="line">                -d nginx:1.10</span><br></pre></td></tr></table></figure>

<p>将刚才准备好的 nginx 文件夹与 nginx 容器内的文件夹作一个一一映射。</p>
<p>索引=数据库   类型=数据表  属性=表字段   文档=一条条的数据</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">ElasticSearch</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/04/17/26.1.ElasticSearch/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/8/">Next &amp;raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2021 swx
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 50%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 50%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">杂谈</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">经历</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">与人沟通</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">项目合作</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">搜索技巧</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">百度</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">谷歌</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">书</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">收藏</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">打包</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">swagger</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">springfox</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">mybatis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Portainer.io</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Typora</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">快捷键</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">压缩算法</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">PBOOTCMS</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Eclipse</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">新环境</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">软件</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">软件说明</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">WebRTC</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">类型转换</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">JVM</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">接口</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">抽象类</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">内部类</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">if</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">逻辑判断</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">for循环</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Tomcat</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">http</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">vite</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">WEB</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">servlet</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">JSP</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">JPA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">json</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">数据库</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">SQL</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">小技巧</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">小科普</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">git</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Gitee</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">hexo</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">node.js</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">ElasticSearch</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">基础概念</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">面向对象</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">mysql</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">索引</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">锁</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">事务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Navicat</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">JQuery</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">mqtt</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">代理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">工具类代码</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">轮子</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">消息中间件</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">设计规范</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">编程规范</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">RESTful</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">HATEOAS</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">java概述</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">历史版本</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">安装</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">MySQL基础概念</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">HTML</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">日志</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">PO-BO-VO，DTO-DAO与POJO</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">spring</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">maven</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">C</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">IDEA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">插件</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">微信</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Redis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">ngnix</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">MyBatis-Plus</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">npm</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">vue</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">SpringBoot</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">一起加油吧！</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>
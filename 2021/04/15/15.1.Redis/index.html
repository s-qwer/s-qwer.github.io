<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Redis | swx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Redis简介Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的APIRedis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API 从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Piv">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis">
<meta property="og:url" content="https://s-qwer.github.io/2021/04/15/15.1.Redis/index.html">
<meta property="og:site_name" content="swx">
<meta property="og:description" content="Redis简介Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的APIRedis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API 从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Piv">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143052942.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143205630.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143234917.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143248752.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143315774.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143402387.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143424416.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143434276.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144531362.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144617185.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144629940.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144646383.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144705822.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144737833.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144756360.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144805631.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906144817763.png">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://common.cnblogs.com/images/copycode.gif">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/v2-746b4b4a1e45bb5e0bb9f25818e9b04c_720w.jpg">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/v2-238e48f3a03e90c7387e3707826a3dad_720w.jpg">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/a2cc7cd98d1001e966f1ceae81048fe955e79756.jpeg">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/20180919143214879">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702061910379-1864468139.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702055737295-275210721.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702083502806-654371890.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702083119402-1566927058.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702161757716-63017960.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702090136855-2087712548.png">
<meta property="og:image" content="https://s-qwer.github.io/15.1.Redis/1323607-20200702081155517-145733708.png">
<meta property="article:published_time" content="2021-04-15T05:28:54.000Z">
<meta property="article:modified_time" content="2021-12-13T06:11:34.420Z">
<meta property="article:author" content="swx">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s-qwer.github.io/15.1.Redis/image-20210906143052942.png">
  
    <link rel="alternate" href="/atom.xml" title="swx" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">swx</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://s-qwer.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-15.1.Redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/15/15.1.Redis/" class="article-date">
  <time class="dt-published" datetime="2021-04-15T05:28:54.000Z" itemprop="datePublished">2021-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Redis
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h1><p>Redis是一个开源的使用ANSI <a target="_blank" rel="noopener" href="http://baike.baidu.com/view/1219.htm">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value<a target="_blank" rel="noopener" href="http://baike.baidu.com/view/1088.htm">数据库</a>，并提供多种语言的APIRedis是一个开源的使用ANSI <a target="_blank" rel="noopener" href="http://baike.baidu.com/view/1219.htm">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value<a target="_blank" rel="noopener" href="http://baike.baidu.com/view/1088.htm">数据库</a>，并提供多种语言的API</p>
<p>从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivotal赞助</p>
<p>Redis是 NoSQL（not only SQL）技术阵营中的一员，它通过多种键值数据类型来适应不同场景下的存储需求，借助一些高层级的接口使用其可以胜任，如缓存、队列系统的不同角色</p>
<p>Redis可以保存在内存中（性能非常好），也可以持久化在文件中</p>
<p>Redis的官网: <a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></p>
<p>redis的中文手册：<a target="_blank" rel="noopener" href="https://www.redis.com.cn/">https://www.redis.com.cn/</a></p>
<p>经常用的数据成缓存，所以用redis</p>
<p>特性：</p>
<p>1.Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用</p>
<p>2.Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储</p>
<p>3.Redis支持数据的备份，即master-slave模式的数据备份</p>
<p>优势：</p>
<p>1.性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s</p>
<p>2.丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作</p>
<p>3.原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行</p>
<p>4.丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性</p>
<h1 id="Redis下载及安装"><a href="#Redis下载及安装" class="headerlink" title="Redis下载及安装"></a>Redis下载及安装</h1><p>Redis版本说明</p>
<p>Redis原生只支持linux系统。Redis官方是不支持windows平台，windows版本是微软自己建立的分支，基于官方的redis源码上进行编译、发布、维护的，所以window平台上的redis版本都略低于官方版本</p>
<p>当前redis最新版本是6.0</p>
<p>可以直接在windows上下载，通过上传工具上传到linux系统，也可以在linux下直接复制最新稳定版本下载链接的网址，然后wget+网址（这种方式必须要求可以上网）</p>
<p><img src="/15.1.Redis/image-20210906143052942.png" alt="image-20210906143052942"></p>
<p>Redis安装：</p>
<p>1.将redis.tar.gz解压：tar -zxvf redis-3.2.8.tar.gz</p>
<p>mkdir redis  建一个目录</p>
<p>2.进入redis-3.2.8目录：cd redis-3.2.8</p>
<p>3.对redis进行编译:make  </p>
<p>4.安装到指定的目录：make PREFIX=/usr/local/redis install</p>
<p>如果安装redis是报下面的错误，是因为系统没有安装gcc环境，缺少依赖</p>
<p><img src="/15.1.Redis/image-20210906143205630.png" alt="image-20210906143205630"></p>
<p>解决方案：</p>
<p><img src="/15.1.Redis/image-20210906143234917.png" alt="image-20210906143234917"></p>
<p>安装完成后，对redis进行重新编译安装</p>
<p>redis安装完成后，我们进入目录bin中查看</p>
<p><img src="/15.1.Redis/image-20210906143248752.png" alt="image-20210906143248752"></p>
<p>redis-server          redis服务器</p>
<p>redis-cli           redis命令行客户端</p>
<p>redis-benchmark          redis性能测试工具</p>
<p>redis-check-aof         AOF文件修复工具</p>
<p>redis-check-rdb          RDB文件检索工具</p>
<p>redis客户端测试：</p>
<p>1.启动redis服务</p>
<p>./redis-server是可以启动的，但是有风险，只在测试环境下可以。正常启动需要加载配置文件</p>
<p>注意：我们需要将redis编译后的目录中的redis.conf文件copy到我们自己的redis目录中。 cp redis.conf /usr/local/redis </p>
<p>这个redis.conf文件是redis的配置文件</p>
<p><img src="/15.1.Redis/image-20210906143315774.png" alt="image-20210906143315774"></p>
<p>在输入</p>
<p><img src="/15.1.Redis/image-20210906143402387.png" alt="image-20210906143402387"></p>
<p>就可以启动</p>
<p>注意:前面是redis-server服务，后面redis.conf配置文件</p>
<p><img src="/15.1.Redis/image-20210906143424416.png" alt="image-20210906143424416"></p>
<p>Redis占用的端口是6379</p>
<p>可以通过redis-cli命令行客户端来测试redis是否启动成功</p>
<p><img src="/15.1.Redis/image-20210906143434276.png" alt="image-20210906143434276"></p>
<p>其他ip地址不能连接是因为配置文件中只允许回环地址127.0.0.1连接</p>
<p>windows版redis</p>
<p>github下载或者百度网盘找到.msi的安装包，按步骤安装。</p>
<p>验证：</p>
<p>1、打开cmd窗口，输入redis-cli.exe -h 127.0.0.1 -p 6379后回车，出现127.0.0.1：6379说明redis安装且连接成功</p>
<p>2.试下是否能够存储成功：set key1 value1       get key1</p>
<p>3.设置redis密码：</p>
<p>​    查看密码：config get requirepass</p>
<p>​    设置密码：config set requirepass 123456</p>
<p>​    除去密码：config set requirepass ‘’</p>
<p>4.带密码登录，不然提示没有权限</p>
<p>redis-cli.exe -h 127.0.0.1 -p 6379 -a 密码</p>
<p>redis-cli.exe -h 127.0.0.1 -p 6379后进行操作提示没有权限时，  auth 密码</p>
<p>以上为设置临时密码，也可以设置临时密码为root：</p>
<p>找到redis目录下redis-server.exe点击运行，再点击redis-cli.exe运行。输入config set requirepass root,回车即可</p>
<p>root 就是redis的临时密码。验证是否成功设置 ，输入auth root 如果返回OK就说明成功</p>
<p>设置永久的密码为root：</p>
<p>需要在redis.conf或redis.windows.conf中输入requirepass root，保存后，在该redis目录下的路径栏输入cmd，进入命令模式，输入<code>redis-server.exe redis.windows.conf</code>   打开redis</p>
<p>如果直接输入此命令不行，则将redis-server.exe直接拖进命令框中，即显示的是redis-server.exe的全路径 再跟上配置文件的命令   启动服务端</p>
<h1 id="Redis数据类型与常见操作"><a href="#Redis数据类型与常见操作" class="headerlink" title="Redis数据类型与常见操作"></a>Redis数据类型与常见操作</h1><p>redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）</p>
<h2 id="string类型常见操作"><a href="#string类型常见操作" class="headerlink" title="string类型常见操作"></a>string类型常见操作</h2><p>字符串类型是Redis中最为基础的数据存储类型，它在Redis中是二进制安全的，这便意味着该类型可以接受任何格式的数据，如JPEG图像数据或Json对象描述信息等。</p>
<p>在Redis中字符串类型的Value最多可以容纳的数据长度是512M</p>
<p>常见操作（小写也可）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">SET key value 	 </span><br><span class="line">设定该Key持有指定的字符串Value，如果该Key已经存在，则覆盖其原有值。返回值：总是返回&quot;OK&quot;</span><br><span class="line"></span><br><span class="line">GET key 	 </span><br><span class="line">获取指定Key的Value。如果与该Key关联的Value不是string类型，Redis将返回错误信息，因为GET命令只能用于获取string Value</span><br><span class="line">返回值：与该Key相关的Value，如果该Key不存在，则返回nil。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MSET key value [key value ...] 	 </span><br><span class="line">该命令原子性的完成参数中所有key&#x2F;value的设置操作，其具体行为可以看成是多次迭代执行SET命令。 </span><br><span class="line">返回值：该命令不会失败，始终返回OK。 </span><br><span class="line"></span><br><span class="line">MGET key [key ...]  </span><br><span class="line">返回所有指定Keys的Values，如果其中某个Key不存在，或者其值不为string类型，该Key的Value将返回nil。	</span><br><span class="line">返回值：返回一组指定Keys的Values的列表。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">SETNX key value  </span><br><span class="line">如果指定的Key不存在，则设定该Key持有指定字符串Value，此时其效果等价于SET命令。相反，如果该Key已经存在，该命令将不做任何操作并返回。</span><br><span class="line">返回值：1表示设置成功，否则0。（not exists）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MSETNX key value [key value ...] 	 </span><br><span class="line">该命令原子性的完成参数中所有key&#x2F;value的设置操作，其具体行为可以看成是多次迭代执行SETNX命令。然而这里需要明确说明的是，如果在这一批Keys中有任意一个Key已经存在了，那么该操作将全部回滚，即所有的修改都不会生效。</span><br><span class="line">返回值：1表示所有Keys都设置成功，0则表示没有任何Key被修改。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">APPEND key value  </span><br><span class="line">如果该Key已经存在，APPEND命令将参数Value的数据追加到已存在Value的末尾。如果该Key不存在，APPEND命令将会创建一个新的Key&#x2F;Value。</span><br><span class="line">返回值：追加后Value的长度。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DECR key	 </span><br><span class="line">将指定Key的Value原子性的递减1。如果该Key不存在，其初始值为0，在decr之后其值为-1。如果Value的值不能转换为整型值，如Hello，该操作将执行失败并返回相应的错误信息。（error）</span><br><span class="line">返回值：递减后的Value值。</span><br><span class="line"></span><br><span class="line">INCR key	 </span><br><span class="line">将指定Key的Value原子性的递增1。如果该Key不存在，其初始值为0，在incr之后其值为1。如果Value的值不能转换为整型值，如Hello，该操作将执行失败并返回相应的错误信息。</span><br><span class="line">返回值：递增后的Value值。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">DECRBY key decrement  </span><br><span class="line">将指定Key的Value原子性的减少decrement。如果该Key不存在，其初始值为0，在decrby之后其值为-decrement。如果Value的值不能转换为整型值，如Hello，该操作将执行失败并返回相应的错误信息。注意：该操作的取值范围是64位有符号整型。</span><br><span class="line">返回值：减少后的Value值。</span><br><span class="line"></span><br><span class="line">INCRBY key increment   </span><br><span class="line">将指定Key的Value原子性的增加increment。如果该Key不存在，其初始值为0，在incrby之后其值为increment。如果Value的值不能转换为整型值，如Hello，该操作将执行失败并返回相应的错误信息。注意：该操作的取值范围是64位有符号整型。</span><br><span class="line">返回值：增加后的Value值。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">GETSET key value	 </span><br><span class="line">原子性的设置该Key为指定的Value，同时返回该Key的原有值。和GET命令一样，该命令也只能处理string Value，否则Redis将给出相关的错误信息。</span><br><span class="line">返回值：返回该Key的原有值，如果该Key之前并不存在，则返回nil。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">STRLEN key	 </span><br><span class="line"></span><br><span class="line">返回指定Key的字符值长度，如果Value不是string类型，Redis将执行失败并给出相关的错误信息。</span><br><span class="line"></span><br><span class="line">返回值：指定Key的Value字符长度，如果该Key不存在，返回0。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SETEX key seconds value	 </span><br><span class="line"></span><br><span class="line">原子性完成两个操作，一是设置该Key的值为指定字符串，同时设置该Key在Redis服务器中的存活时间(秒数)。该命令主要应用于Redis被当做Cache服务器使用时。	 （expire，到期）</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SETRANGE key offset value  </span><br><span class="line"></span><br><span class="line">替换指定Key的部分字符串值。从offset开始，替换的长度为该命令第三个参数value的字符串长度，其中如果offset的值大于该Key的原有值Value的字符串长度，Redis将会在Value的后面补齐(offset - strlen(value))数量的0x00，之后再追加新值。如果该键不存在，该命令会将其原值的长度假设为0，并在其后添补offset个0x00后再追加新值。鉴于字符串Value的最大长度为512M，因此offset的最大值为536870911。最后需要注意的是，如果该命令在执行时致使指定Key的原有值长度增加，这将会导致Redis重新分配足够的内存以容纳替换后的全部字符串，因此就会带来一定的性能折损。</span><br><span class="line"></span><br><span class="line">返回值：修改后的字符串Value长度。</span><br><span class="line"></span><br><span class="line">GETRANGE key start end	 </span><br><span class="line"></span><br><span class="line">截取字符串。该命令在截取子字符串时，将以闭区间的方式同时包含start(0表示第一个字符)和end所在的字符，如果end值超过Value的字符长度，该命令将只是截取从start开始之后所有的字符数据。当end为-1时表示是最后一位，-4 -1表示从后数4位</span><br><span class="line"></span><br><span class="line">返回值：子字符串；</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SETBIT key offset value 	 </span><br><span class="line"></span><br><span class="line">设置在指定Offset上BIT的值，该值只能为1或0，在设定后该命令返回该Offset上原有的BIT值。如果指定Key不存在，该命令将创建一个新值，并在指定的Offset上设定参数中的BIT值。如果Offset大于Value的字符长度，Redis将拉长Value值并在指定Offset上设置参数中的BIT值，中间添加的BIT值为0。最后需要说明的是Offset值必须大于0。</span><br><span class="line"></span><br><span class="line">返回值：在指定Offset上的BIT原有值。</span><br><span class="line"></span><br><span class="line">GETBIT key offset 	 </span><br><span class="line"></span><br><span class="line">返回在指定Offset上BIT的值，0或1。如果Offset超过string value的长度，该命令将返回0，所以对于空字符串始终返回0。</span><br><span class="line"></span><br><span class="line">返回值：在指定Offset上的BIT值。 </span><br><span class="line"></span><br><span class="line">(布隆过滤器)</span><br><span class="line"></span><br><span class="line">a  97  0110 0001	</span><br><span class="line"></span><br><span class="line">A  65  0100 0001  其实只用 setbit key 2 0  就将a改为了A（从0开始计数）</span><br></pre></td></tr></table></figure>

<h2 id="list类型常见操作"><a href="#list类型常见操作" class="headerlink" title="list类型常见操作"></a>list类型常见操作</h2><p>在Redis中，List类型是按照插入顺序排序的字符串链表。和数据结构中的<strong>普通链表</strong>一样，我们可以在其头部(left)和尾部(right)添加新的元素。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表。与此相反，如果链表中所有的元素均被移除，那么该键也将会被从数据库中删除。List中可以包含的最大元素数量是4294967295。</p>
<p>从元素插入和删除的效率视角来看，如果我们是在链表的两头插入或删除元素，这将会是非常高效的操作，即使链表中已经存储了百万条记录，该操作也可以在常量时间内完成。然而需要说明的是，如果元素插入或删除操作是作用于链表中间，那将会是非常低效的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">常见操作</span><br><span class="line">LPUSH key value [value ...] 	 </span><br><span class="line"></span><br><span class="line">在指定Key所关联的List Value的头部插入参数中给出的所有Values。如果该Key不存在，该命令将在插入之前创建一个与该Key关联的空链表，之后再将数据从链表的头部插入。如果该键的Value不是链表类型，该命令将返回相关的错误信息。</span><br><span class="line"></span><br><span class="line">返回值：插入后链表中元素的数量。</span><br><span class="line"></span><br><span class="line">LPUSHX key value 	  （x相当于判断）</span><br><span class="line"></span><br><span class="line">仅有当参数中指定的Key存在时，该命令才会在其所关联的List Value的头部插入参数中给出的Value，否则将不会有任何操作发生。	</span><br><span class="line"></span><br><span class="line">返回值：插入后链表中元素的数量。 </span><br><span class="line"></span><br><span class="line">LRANGE key start stop 	 </span><br><span class="line"></span><br><span class="line">该命令的参数start和end都是0-based。即0表示链表头部(leftmost)的第一个元素。其中start的值也可以为负值，-1将表示链表中的最后一个元素，即尾部元素，-2表示倒数第二个并以此类推。该命令在获取元素时，start和end位置上的元素也会被取出。如果start的值大于链表中元素的数量，空链表将会被返回。如果end的值大于元素的数量，该命令则获取从start(包括start)开始，链表中剩余的所有元素。</span><br><span class="line"></span><br><span class="line">返回值：返回指定范围内元素的列表。</span><br><span class="line"></span><br><span class="line">这里的链表插入的头部插入相当于是栈：插入12345，输出时就会是54321</span><br><span class="line"></span><br><span class="line">lrange key 0 -1 表示返回这个链表的所有元素</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">LPOP key 	 （相当于把头部的那个元素移除）</span><br><span class="line"></span><br><span class="line">返回并弹出指定Key关联的链表中的第一个元素，即头部元素。如果该Key不存，返回nil。</span><br><span class="line"></span><br><span class="line">返回值：链表头部的元素。</span><br><span class="line"></span><br><span class="line">LLEN key	 </span><br><span class="line"></span><br><span class="line">返回指定Key关联的链表中元素的数量，如果该Key不存在，则返回0。如果与该Key关联的Value的类型不是链表，则返回相关的错误信息。</span><br><span class="line"></span><br><span class="line">返回值：链表中元素的数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">LREM key count value  </span><br><span class="line"></span><br><span class="line">在指定Key关联的链表中，删除前count个值等于value的元素。如果count大于0，从头向尾遍历并删除，如果count小于0，则从尾向头遍历并删除。</span><br><span class="line"></span><br><span class="line">如果count等于0，则删除链表中所有等于value的元素。如果指定的Key不存在，则直接返回0。	</span><br><span class="line"></span><br><span class="line">返回值：返回被删除的元素数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">LSET key index value </span><br><span class="line"></span><br><span class="line">设定链表中指定位置的值为新值，其中0表示第一个元素，即头部元素，-1表示尾部元素。如果索引值Index超出了链表中元素的数量范围，该命令将返回相关的错误信息。	 </span><br><span class="line"></span><br><span class="line">(对指定脚标的值进行设置)</span><br><span class="line"></span><br><span class="line">返回值：OK</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">LINDEX key index 	 </span><br><span class="line"></span><br><span class="line">该命令将返回链表中指定位置(index)的元素，index是0-based，表示头部元素，如果index为-1，表示尾部元素。如果与该Key关联的不是链表，该命令将返回相关的错误信息。	</span><br><span class="line"></span><br><span class="line">返回值：返回请求的元素，如果index超出范围，则返回nil。</span><br><span class="line"></span><br><span class="line">(读出指定脚标的值)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">LTRIM key start stop 	 </span><br><span class="line"></span><br><span class="line">该命令将仅保留指定范围内的元素，从而保证链接中的元素数量相对恒定。start和stop参数都是0-based，0表示头部元素。和其他命令一样，start和stop也可以为负值，-1表示尾部元素。如果start大于链表的尾部，或start大于stop，该命令不会报错，而是返回一个空的链表，与此同时该Key也将被删除。如果stop大于元素的数量，则保留从start开始剩余的所有元素。	 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">LINSERT key BEFORE|AFTER pivot value  </span><br><span class="line"></span><br><span class="line">该命令的功能是在pivot元素的前面或后面插入参数中的元素value。如果Key不存在，该命令将不执行任何操作。如果与Key关联的Value类型不是链表，相关的错误信息将被返回。	</span><br><span class="line"></span><br><span class="line">返回值：成功插入后链表中元素的数量，如果没有找到pivot，返回-1，如果key不存在，返回0。</span><br><span class="line"></span><br><span class="line">(在指定的某个value前或后插入一个新的value)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">RPUSH key value [value ...] 	 </span><br><span class="line"></span><br><span class="line">在指定Key所关联的List Value的尾部插入参数中给出的所有Values。如果该Key不存在，该命令将在插入之前创建一个与该Key关联的空链表，之后再将数据从链表的尾部插入。如果该键的Value不是链表类型，该命令将返回相关的错误信息。 </span><br><span class="line"></span><br><span class="line">返回值：插入后链表中元素的数量。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">RPUSHX key value </span><br><span class="line"></span><br><span class="line">仅有当参数中指定的Key存在时，该命令才会在其所关联的List Value的尾部插入参数中给出的Value，否则将不会有任何操作发生。</span><br><span class="line"></span><br><span class="line">返回值：插入后链表中元素的数量。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">RPOP key 	 </span><br><span class="line"></span><br><span class="line">返回并弹出指定Key关联的链表中的最后一个元素，即尾部元素，。如果该Key不存，返回nil。 </span><br><span class="line"></span><br><span class="line">返回值：链表尾部的元素。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">RPOPLPUSH source destination 	 </span><br><span class="line"></span><br><span class="line">原子性的从与source键关联的链表尾部弹出一个元素，同时再将弹出的元素插入到与destination键关联的链表的头部。如果source键不存在，该命令将返回nil，同时不再做任何其它的操作了。如果source和destination是同一个键，则相当于原子性的将其关联链表中的尾部元素移到该链表的头部。	</span><br><span class="line"></span><br><span class="line">返回值：返回弹出和插入的元素</span><br></pre></td></tr></table></figure>

<h2 id="hash类型常见操作"><a href="#hash类型常见操作" class="headerlink" title="hash类型常见操作"></a>hash类型常见操作</h2><p>Redis中的Hashes类型可以看成具有String Key和String Value的map容器。所以该类型非常适合于存储值对象的信息。如用户信息：Username、Password和Age等。每一个Hash可以存储4294967295个键值对。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">常见操作</span><br><span class="line">HSET key field value	 </span><br><span class="line"></span><br><span class="line">为指定的Key设定Field&#x2F;Value对，如果Key不存在，该命令将创建新Key以参数中的Field&#x2F;Value对，如果参数中的Field在该Key中已经存在，则用新值覆盖其原有值。</span><br><span class="line"></span><br><span class="line">返回值：1表示新的Field被设置了新值，0表示Field已经存在，用新值覆盖原有值。 </span><br><span class="line"></span><br><span class="line">HGET key field 	 </span><br><span class="line"></span><br><span class="line">返回指定Key中指定Field的关联值。	</span><br><span class="line"></span><br><span class="line">返回值：返回参数中Field的关联值，如果参数中的Key或Field不存，返回nil。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HSETNX key field value	 </span><br><span class="line"></span><br><span class="line">只有当参数中的Key或Field不存在的情况下，为指定的Key设定Field&#x2F;Value对，否则该命令不会进行任何操作。 </span><br><span class="line"></span><br><span class="line">返回值：1表示新的Field被设置了新值，0表示Key或Field已经存在，该命令没有进行任何操作。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HEXISTS key field 	 </span><br><span class="line"></span><br><span class="line">判断指定Key中的指定Field是否存在。	</span><br><span class="line"></span><br><span class="line">返回值：1表示存在，0表示参数中的Field或Key不存在。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HLEN key 	 </span><br><span class="line"></span><br><span class="line">获取该Key所包含的Field的数量。	返回Key包含的Field数量，如果Key不存在，返回0。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HDEL key field [field ...] 	 </span><br><span class="line"></span><br><span class="line">从指定Key的Hashes Value中删除参数中指定的多个字段，如果不存在的字段将被忽略。</span><br><span class="line"></span><br><span class="line">返回值：如果Key不存在，则将其视为空Hashes，并返回0，否则返回实际删除的Field数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HINCRBY key field increment 	 </span><br><span class="line"></span><br><span class="line">增加指定Key中指定Field关联的Value的值。如果Key或Field不存在，该命令将会创建一个新Key或新Field，并将其关联的Value初始化为0，之后再指定数字增加的操作。该命令支持的数字是64位有符号整型，即increment可以负数。返回值：运算后的值。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HGETALL key	 </span><br><span class="line"></span><br><span class="line">获取该键包含的所有Field&#x2F;Value。其返回格式为一个Field、一个Value，并以此类推。	</span><br><span class="line"></span><br><span class="line">返回值：Field&#x2F;Value的列表。</span><br><span class="line"></span><br><span class="line">HKEYS key 	 </span><br><span class="line"></span><br><span class="line">返回指定Key的所有Fields名。	</span><br><span class="line"></span><br><span class="line">返回值：Field的列表。</span><br><span class="line"></span><br><span class="line">HVALS key 	 </span><br><span class="line"></span><br><span class="line">返回指定Key的所有Values名。 </span><br><span class="line"></span><br><span class="line">返回值：Value的列表。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HMGET key field [field ...] 	 </span><br><span class="line"></span><br><span class="line">获取和参数中指定Fields关联的一组Values。如果请求的Field不存在，其值返回nil。如果Key不存在，该命令将其视为空Hash，因此返回一组nil。	</span><br><span class="line"></span><br><span class="line">返回值：返回和请求Fields关联的一组Values，其返回顺序等同于Fields的请求顺序。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">HMSET key field value [field value ...]	 </span><br><span class="line"></span><br><span class="line">逐对依次设置参数中给出的Field&#x2F;Value对。如果其中某个Field已经存在，则用新值覆盖原有值。如果Key不存在，则创建新Key，同时设定参数中的Field&#x2F;Value</span><br></pre></td></tr></table></figure>

<h2 id="set类型常见操作（不重复，可以完成交并差操作）"><a href="#set类型常见操作（不重复，可以完成交并差操作）" class="headerlink" title="set类型常见操作（不重复，可以完成交并差操作）"></a>set类型常见操作（不重复，可以完成交并差操作）</h2><p>在Redis中，我们可以将Set类型看作为没有排序的字符串集合。Set可包含的最大元素数量是4294967295。</p>
<p>Set类型在功能上还存在着一个非常重要的特性，即在服务器端完成多个Sets之间的聚合计算操作，如unions、intersections和differences。由于这些操作均在服务端完成，因此效率极高，而且也节省了大量的网络IO开销。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">常见操作</span><br><span class="line"></span><br><span class="line">SADD key member [member ...]	 </span><br><span class="line"></span><br><span class="line">如果在插入的过程用，参数中有的成员在Set中已经存在，该成员将被忽略，而其它成员仍将会被正常插入。如果执行该命令之前，该Key并不存在，该命令将会创建一个新的Set，此后再将参数中的成员陆续插入。</span><br><span class="line"></span><br><span class="line">返回值：本次操作实际插入的成员数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SCARD key	 </span><br><span class="line"></span><br><span class="line">获取Set中成员的数量。	</span><br><span class="line"></span><br><span class="line">返回值：返回Set中成员的数量，如果该Key并不存在，返回0。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SISMEMBER key member	 </span><br><span class="line"></span><br><span class="line">判断参数中指定成员是否已经存在于与Key相关联的Set集合中。	</span><br><span class="line"></span><br><span class="line">返回值：1表示已经存在，0表示不存在，或该Key本身并不存在。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SMEMBERS key	 </span><br><span class="line"></span><br><span class="line">获取与该Key关联的Set中所有的成员。</span><br><span class="line"></span><br><span class="line">返回值：返回Set中所有的成员。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SPOP  key 	 </span><br><span class="line"></span><br><span class="line">随机的移除并返回Set中的某一成员。 由于Set中元素的布局不受外部控制，因此无法像List那样确定哪个元素位于Set的头部或者尾部。	</span><br><span class="line"></span><br><span class="line">返回值：返回移除的成员，如果该Key并不存在，则返回nil。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SRANDMEMBER key 	 </span><br><span class="line"></span><br><span class="line">和SPOP一样，随机的返回Set中的一个成员，不同的是该命令并不会删除返回的成员。	</span><br><span class="line"></span><br><span class="line">返回值：返回随机位置的成员，如果Key不存在则返回nil。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SREM key member [member ...]	 </span><br><span class="line"></span><br><span class="line">从与Key关联的Set中删除参数中指定的成员，不存在的参数成员将被忽略，如果该Key并不存在，将视为空Set处理。	</span><br><span class="line"></span><br><span class="line">返回值：从Set中实际移除的成员数量，如果没有则返回0。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SMOVE source destination member	 </span><br><span class="line"></span><br><span class="line">原子性的将参数中的成员从source键移入到destination键所关联的Set中。如果该成员在source中并不存在，该命令将不会再执行任何操作并返回0，否则，该成员将从source移入到destination。如果此时该成员已经在destination中存在，那么该命令仅是将该成员从source中移出。</span><br><span class="line"></span><br><span class="line">返回值：1表示正常移动，0表示source中并不包含参数成员。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SDIFF key [key ...]	 </span><br><span class="line"></span><br><span class="line">返回参数中第一个Key所关联的Set和其后所有Keys所关联的Sets中成员的差异。如果Key不存在，则视为空Set。	</span><br><span class="line"></span><br><span class="line">返回值：差异结果成员的集合。</span><br><span class="line"></span><br><span class="line">SDIFFSTORE destination key [key ...] 	 </span><br><span class="line"></span><br><span class="line">该命令和SDIFF命令在功能上完全相同，两者之间唯一的差别是SDIFF返回差异的结果成员，而该命令将差异成员存储在destination关联的Set中。如果destination键已经存在，该操作将覆盖它的成员。	</span><br><span class="line"></span><br><span class="line">返回值：返回差异成员的数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SINTER key [key ...] 	 </span><br><span class="line"></span><br><span class="line">该命令将返回参数中所有Keys关联的Sets中成员的交集。因此如果参数中任何一个Key关联的Set为空，或某一Key不存在，那么该命令的结果将为空集。</span><br><span class="line"></span><br><span class="line">返回值：交集结果成员的集合。</span><br><span class="line"></span><br><span class="line">SINTERSTORE destination key [key ...]	 </span><br><span class="line"></span><br><span class="line">该命令和SINTER命令在功能上完全相同，两者之间唯一的差别是SINTER返回交集的结果成员，而该命令将交集成员存储在destination关联的Set中。如果destination键已经存在，该操作将覆盖它的成员。	</span><br><span class="line"></span><br><span class="line">返回值：返回交集成员的数量。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">SUNION key [key ...] 	 </span><br><span class="line"></span><br><span class="line">该命令将返回参数中所有Keys关联的Sets中成员的并集。	</span><br><span class="line"></span><br><span class="line">返回值：并集结果成员的集合。</span><br><span class="line"></span><br><span class="line">SUNIONSTORE destination key [key ...] 	 </span><br><span class="line"></span><br><span class="line">该命令和SUNION命令在功能上完全相同，两者之间唯一的差别是SUNION返回并集的结果成员，而该命令将并集成员存储在destination关联的Set中。如果destination键已经存在，该操作将覆盖它的成员。 </span><br><span class="line"></span><br><span class="line">返回值：返回并集成员的数量</span><br></pre></td></tr></table></figure>

<h2 id="sortedSet类型常见操作"><a href="#sortedSet类型常见操作" class="headerlink" title="sortedSet类型常见操作"></a>sortedSet类型常见操作</h2><p>Sorted-Sets和Sets类型极为相似，它们都是字符串的集合，都不允许重复的成员出现在一个Set中。它们之间的主要差别是Sorted-Sets中的每一个成员都会有一个分数(score)与之关联，Redis正是通过分数来为集合中的成员进行从小到大的排序。然而需要额外指出的是，尽管Sorted-Sets中的<strong>成员必须是唯一</strong>的，但是<strong>分数(score)却是可以重复</strong>的。</p>
<p>在Sorted-Set中添加、删除或更新一个成员都是非常快速的操作，由于Sorted-Sets中的成员在集合中的位置是有序的，因此，即便是访问位于集合中部的成员也仍然是非常高效的。事实上，Redis所具有的这一特征在很多其它类型的数据库中是很难实现的，换句话说，在该点上要想达到和Redis同样的高效，在其它数据库中进行建模是非常困难的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">常见操作</span><br><span class="line"></span><br><span class="line">ZADD key score member [score] [member] 	 </span><br><span class="line"></span><br><span class="line">添加参数中指定的所有成员及其分数到指定key的Sorted-Set中，在该命令中我们可以指定多组score&#x2F;member作为参数。如果在添加时参数中的某一成员已经存在，该命令将更新此成员的分数为新值，同时再将该成员基于新值重新排序。如果键不存在，该命令将为该键创建一个新的Sorted-Sets Value，并将score&#x2F;member对插入其中。</span><br><span class="line"></span><br><span class="line">返回值：本次操作实际插入的成员数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZINCRBY key increment member 	 </span><br><span class="line"></span><br><span class="line">该命令将为指定Key中的指定成员增加指定的分数。如果成员不存在，该命令将添加该成员并假设其初始分数为0，此后再将其分数加上increment。如果Key不存，该命令将创建该Key及其关联的Sorted-Sets，并包含参数指定的成员，其分数为increment参数。</span><br><span class="line"></span><br><span class="line">返回值：以字符串形式表示的新分数。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZCARD key 	 </span><br><span class="line"></span><br><span class="line">获取与该Key相关联的Sorted-Sets中包含的成员总数量。</span><br><span class="line"></span><br><span class="line">返回值：返回Sorted-Sets中的成员数量，如果该Key不存在，返回0。</span><br><span class="line"></span><br><span class="line">ZCOUNT key min max	 </span><br><span class="line"></span><br><span class="line">该命令用于获取***\*分数\*******\*(score)\****在min和max之间的成员数量。缺省情况下，min和max表示的范围是闭区间范围，即min &lt;&#x3D; score &lt;&#x3D; max内的成员将被返回。然而我们可以通过在min和max的前面添加&quot;(&quot;字符来表示开区间，如(min max表示min &lt; score &lt;&#x3D; max，而(min (max表示min &lt; score &lt; max。</span><br><span class="line"></span><br><span class="line">返回值：分数指定范围内成员的数量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZRANGE key start stop [WITHSCORES] 	 </span><br><span class="line"></span><br><span class="line">该命令返回***\*排名\****在参数start和stop指定范围内的成员，这里start和stop参数都是0-based，即0表示第一个成员，-1表示最后一个成员。如果start大于该Sorted-Set中的最大索引值，或start &gt; stop，此时一个空集合将被返回。如果stop大于最大索引值，该命令将返回从start到集合的最后一个成员。如果命令中带有可选参数WITHSCORES选项，该命令在返回的结果中将包含每个成员的分数值，如value1,score1,value2,score2...。　　	</span><br><span class="line"></span><br><span class="line">返回值：返回索引在start和stop之间的成员列表。</span><br><span class="line"></span><br><span class="line">ZREVRANGE key start stop [WITHSCORES]   </span><br><span class="line"></span><br><span class="line">该命令的功能和ZRANGE基本相同，唯一的差别在于顺序相反。	</span><br><span class="line"></span><br><span class="line">返回值：返回指定的成员列表。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count] 	 </span><br><span class="line"></span><br><span class="line">该命令将返回***\*分数\****在min和max范围内的成员，即满足表达式min &lt;&#x3D; score &lt;&#x3D; max的成员，其中返回的成员是按照其分数从低到高的顺序返回，如果成员具有相同的分数，则按成员的字典顺序返回。可选参数LIMIT用于限制返回成员的数量范围。可选参数offset表示从符合条件的第offset个成员开始返回，同时返回count个成员。</span><br><span class="line"></span><br><span class="line">返回值：返回分数在指定范围内的成员列表。</span><br><span class="line"></span><br><span class="line">ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count] 	 </span><br><span class="line"></span><br><span class="line">该命令除了排序方式是基于从高到低的分数排序之外，其它功能和参数含义均与ZRANGEBYSCORE相同。	</span><br><span class="line"></span><br><span class="line">返回值：返回分数在指定范围内的成员列表。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZRANK key member 	 </span><br><span class="line"></span><br><span class="line">该命令将返回参数中指定***\*成员的位置值\****（按分数由低到高的顺序），其中0表示第一个成员，它是Sorted-Set中分数最低的成员。</span><br><span class="line"></span><br><span class="line">返回值：如果该成员存在，则返回它的位置索引值。否则返回nil。</span><br><span class="line"></span><br><span class="line">ZREVRANK key member 	 </span><br><span class="line"></span><br><span class="line">该命令的功能和ZRANK基本相同，唯一的差别在于顺序相反	</span><br><span class="line"></span><br><span class="line">返回值：如果该成员存在，则返回它的位置索引值。否则返回nil。 </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZSCORE key member	 </span><br><span class="line"></span><br><span class="line">获取指定成员的分数。	</span><br><span class="line"></span><br><span class="line">返回值：如果该成员存在，以字符串的形式返回其分数，否则返回nil。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ZREM key member [member ...]	 </span><br><span class="line"></span><br><span class="line">该命令将移除参数中指定的成员，其中不存在的成员将被忽略。如果与该Key关联的Value不是Sorted-Set，相应的错误信息将被返回。</span><br><span class="line"></span><br><span class="line">返回值：实际被删除的成员数量。</span><br><span class="line"></span><br><span class="line">ZREMRANGEBYRANK key start stop 	 </span><br><span class="line"></span><br><span class="line">删除索引位置位于start和stop之间的成员，start和stop都是0-based，即0表示分数最低的成员，-1表示最后一个成员，即分数最高的成员。 	</span><br><span class="line"></span><br><span class="line">返回值：被删除的成员数量。</span><br><span class="line"></span><br><span class="line">ZREMRANGEBYSCORE key min max 	 </span><br><span class="line"></span><br><span class="line">删除分数在min和max之间的所有成员，即满足表达式min &lt;&#x3D; score &lt;&#x3D; max的所有成员。对于min和max参数，可以采用开区间的方式表示，具体规则参照ZCOUNT。 </span><br><span class="line"></span><br><span class="line">返回值：被删除的成员数量</span><br></pre></td></tr></table></figure>

<h2 id="Key通用操作"><a href="#Key通用操作" class="headerlink" title="Key通用操作"></a>Key通用操作</h2><p>l KEYS pattern     </p>
<p>获取所有匹配pattern参数（正则）的Keys。需要说明的是，在我们的正常操作中应该尽量避免对该命令的调用，因为对于大型数据库而言，该命令是非常耗时的，对Redis服务器的性能打击也是比较大的。pattern支持glob-style的通配符格式，如*表示任意一个或多个字符，?表示任意字符，[abc]表示方括号中任意一个字母。    匹配模式的键列表。</p>
<p>l DEL key [key …]     </p>
<p>从数据库删除中参数中指定的keys，如果指定键不存在，则直接忽略。还需要另行指出的是，如果指定的Key关联的数据类型不是String类型，而是List、Set、Hashes和Sorted Set等容器类型，该命令删除每个键的时间复杂度为O(M)，其中M表示容器中元素的数量。而对于String类型的Key，其时间复杂度为O(1)。</p>
<p>返回值：实际被删除的Key数量。</p>
<p>l EXISTS key      </p>
<p>判断指定键是否存在。    </p>
<p>返回值：1表示存在，0表示不存在。</p>
<p>l MOVE key db      </p>
<p>将当前数据库中指定的键Key移动到参数中指定的数据库中。如果该Key在目标数据库中已经存在，或者在当前数据库中并不存在，该命令将不做任何操作并返回0。     </p>
<p>返回值：移动成功返回1，否则0。</p>
<p>在redis.conf文件中定义了redis的默认库的数量</p>
<p><img src="/15.1.Redis/image-20210906144531362.png" alt="image-20210906144531362"></p>
<p>我们可以使用select 数值 来进行库的切换: select  10.</p>
<p>l RENAME key newkey      </p>
<p>为指定的键重新命名，如果参数中的两个Keys的名字相同，或者是源Key不存在，该命令都会返回相关的错误信息。如果newKey已经存在，则直接覆盖。  </p>
<p>l RENAMENX key newkey     </p>
<p>如果新值不存在，则将参数中的原值修改为新值。其它条件和RENAME一致。</p>
<p>返回值：1表示修改成功，否则0。</p>
<p>l PERSIST key     </p>
<p>如果Key存在过期时间，该命令会将其过期时间消除，使该Key不再有超时，而是可以持久化存储。    </p>
<p>返回值：1表示Key的过期时间被移除，0表示该Key不存在或没有过期时间。</p>
<p>l EXPIRE key seconds      </p>
<p>该命令为参数中指定的Key设定超时的秒数，在超过该时间后，Key被自动的删除。如果该Key在超时之前被修改，与该键关联的超时将被移除。 </p>
<p>返回值：1表示超时被设置，0则表示Key不存在，或不能被设置。</p>
<p>l EXPIREAT key timestamp  </p>
<p>该命令的逻辑功能和EXPIRE完全相同，唯一的差别是该命令指定的超时时间是绝对时间，而不是相对时间。该时间参数是Unix timestamp格式的，即从1970年1月1日开始所流经的秒数。    </p>
<p>返回值：1表示超时被设置，0则表示Key不存在，或不能被设置。 </p>
<p>l TTL key      </p>
<p>获取该键所剩的超时描述。 </p>
<p>返回值：返回所剩描述，如果该键不存在或没有超时设置，则返回-1。</p>
<p>l RANDOMKEY     </p>
<p>从当前打开的数据库中随机的返回一个Key。    </p>
<p>返回值：返回的随机键，如果该数据库是空的则返回nil。</p>
<p>l TYPE key      </p>
<p>获取与参数中指定键关联值的类型，该命令将以字符串的格式返回。    </p>
<p>返回值：返回的字符串为string、list、set、hash和zset，如果key不存在返回none</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>Redis 事务可以一次执行多个命令， 并且带有以下两个重要的保证：</p>
<p>l 事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p>
<p>l 事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p>
<p>一个事务从开始到执行会经历以下三个阶段：</p>
<p>开始事务。MULTI</p>
<p>命令入队。执行的redis的操作</p>
<p>执行事务。EXEC</p>
<p>事务常用命令</p>
<p>l MULTI</p>
<p>Redis Multi 命令用于标记一个事务块的开始。</p>
<p>事务块内的多条命令会按照先后顺序被放进一个队列当中，最后由 EXEC 命令原子性(atomic)地执行。</p>
<p>返回值:总是返回OK</p>
<p>l EXEC</p>
<p>Redis Exec 命令用于执行所有事务块内的命令</p>
<p>返回值: 事务块内所有命令的返回值，按命令执行的先后顺序排列。 当操作被打断时，返回空值 nil 。</p>
<p>l DISCARD</p>
<p>Redis Discard 命令用于取消事务，放弃执行事务块内的所有命令。</p>
<p>返回值: 总是返回 OK 。</p>
<p>l WATCH</p>
<p>Redis Watch 命令用于监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断</p>
<p>l UNWATCH</p>
<p>Redis Unwatch 命令用于取消 WATCH 命令对所有 key 的监视</p>
<p>在exec执行后所产生的错误中，即使事务中有某个/某些命令在执行时产生了错误，事务中的其他命令仍然会继续执行。Redis在<strong>事务失败时不进行回滚</strong>，而是继续执行余下的命令。</p>
<p>Redis的这种设计原则是：Redis命令只会因为错误的语法而失败(这些问题不能在入队时发现)，或是命令用在了错误类型的键上面</p>
<p>失败的命令不是Redis所致，而是由编程错误造成的，这样错误应该在开发的过程中被发现，生产环境中不应出现的错误。</p>
<p>就是在程序的运行环境中不应该出现语法的错误。而Redis能够保证正确的命令一定会被执行</p>
<p>实际做法：</p>
<p>（1）确认实际需求是否需要事务支持，如果需要则在对应方法上加上@Transaction注解</p>
<p>（2）如果不需要事务支持则将enableTransactionSupport设置为false</p>
<p>大佬推荐：</p>
<p>在 Spring 里配置两个单独的 RedisTemplate 是很好的做法：其中一个 RedisTemplates 的事务设为 false，用于大多数 Redis 操作，另一个 RedisTemplates 的事务已激活，仅用于 Redis 事务。当然必须要声明 PlatformTransactionManager 和 @Transactional，以防返回垃圾数值</p>
<h1 id="nodejs应用redis"><a href="#nodejs应用redis" class="headerlink" title="nodejs应用redis"></a>nodejs应用redis</h1><p>1.安装 redis 依赖包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redis --save</span><br></pre></td></tr></table></figure>

<p>2.连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var redis &#x3D; require(&#39;redis&#39;),</span><br><span class="line">    config &#x3D; require(&#39;..&#x2F;config&#39;),</span><br><span class="line">    dbConfig &#x3D; config.redis,</span><br><span class="line">    RDS_PORT &#x3D; dbConfig.port,     &#x2F;&#x2F;端口号</span><br><span class="line">    RDS_HOST &#x3D; dbConfig.host,     &#x2F;&#x2F;服务器IP</span><br><span class="line">    RDS_PWD &#x3D; dbConfig.pass,      &#x2F;&#x2F;密码</span><br><span class="line">    RDS_OPTS &#x3D; &#123;auth_pass: RDS_PWD&#125;,</span><br><span class="line">    client &#x3D; redis.createClient(RDS_PORT, RDS_HOST, RDS_OPTS);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">client.on(&#39;ready&#39;,function(res)&#123;</span><br><span class="line">    console.log(&#39;ready&#39;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.on(&#39;end&#39;,function(err)&#123;</span><br><span class="line">    console.log(&#39;end&#39;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.on(&#39;error&#39;, function (err) &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.on(&#39;connect&#39;,function()&#123;</span><br><span class="line">    console.log(&#39;redis connect success!&#39;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.使用</p>
<ul>
<li>字符串（string）（一个字符串类型的值最大长度为512 M） get,set,mget,mset,incr(计数器++),decr(–)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">client.set(&#39;name&#39;, &#39;swx&#39;, function (err, res) &#123;</span><br><span class="line">    &#x2F;&#x2F; todo..</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.get(&#39;name&#39;, function (err, res) &#123;</span><br><span class="line">    &#x2F;&#x2F; todo...           </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>哈希（hash） 可用来存储对象,一个Redis 列表中最多可存储232-1(40亿)个元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">client.hmset(&quot;hosts&quot;, &quot;mjr&quot;, &quot;1&quot;, &quot;another&quot;, &quot;23&quot;, &quot;home&quot;, &quot;1234&quot;);</span><br><span class="line"></span><br><span class="line">client.hgetall(&quot;hosts&quot;, function (err, obj) &#123;</span><br><span class="line">    console.dir(obj);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.hmset(key2, &#123;</span><br><span class="line">    &quot;0123456789&quot;: &quot;abcdefghij&quot;, &#x2F;&#x2F; NOTE: key and value will be coerced to strings </span><br><span class="line">    &quot;some manner of key&quot;: &quot;a type of value&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>列表（lists）（一个Redis 列表中最多可存储232-1(40亿)个元素）</li>
</ul>
<p>对于lists,使用send_command进行操作;</p>
<p>队列操作</p>
<p>lpush(首位添加),rpush(末位添加),lset(修改首位值),lindex(删除首位元素),lpop(删除末位元素)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">client.send_command(&#39;lset&#39;,[&#39;mylist&#39;,0,1], function(err,data) &#123;</span><br><span class="line">    console.log(data);          &#x2F;&#x2F; OK</span><br><span class="line">&#125;)</span><br><span class="line">client.send_command(&#39;lpush&#39;,[&#39;mylist&#39;, &#39;one&#39;], function(err, data) &#123;</span><br><span class="line">    console.log(dada);          &#x2F;&#x2F;OK </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 使用命令行获取对应的索引下的结果</span><br><span class="line">&#x2F;&#x2F; lindex mylist 0    &#39;one&#39;</span><br><span class="line">&#x2F;&#x2F; lindex mylist 1   &#39;1&#39;</span><br><span class="line">&#x2F;&#x2F; lindex mylist 2   &#39;xxx&#39;</span><br><span class="line">&#x2F;&#x2F; lindex mylist 3   &#39;xxx&#39;</span><br></pre></td></tr></table></figure>

<p>集合（sets）</p>
<p>sets 集合处理; 业务中用lodash进行交并补也是一个不错的选择。</p>
<p>常见操作: sadd、smembers、sinter(交)、sunion(并)、sdiff(补)、smove</p>
<p>集合中不允许重复成员的存在。当多次添加一个元素时，其结果会设置单个成员多次。一个Redis 集合中最多可包含232-1(40亿)个元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let db1 &#x3D; [&#39;mysql&#39;,&#39;redis&#39;];</span><br><span class="line">let db2 &#x3D; [&#39;mongo&#39;,&#39;redis&#39;];</span><br><span class="line">client.sadd(&#39;db1&#39;,db1, function(err,data) &#123;</span><br><span class="line">    client.smembers(&#39;db1&#39;, function(err,data) &#123;</span><br><span class="line">        console.log(toString.call(data));               &#x2F;&#x2F; [object Array]</span><br><span class="line">        console.log(&#39;smemers:&#39; + data);                 &#x2F;&#x2F; 获取set中的成员, [&#39;redis,mysql]  </span><br><span class="line">    &#125;)</span><br><span class="line">    client.sadd(&#39;db2&#39;, db2, function(err, data) &#123;</span><br><span class="line">        client.sinter(&#39;db1&#39;,&#39;db2&#39;, function(err,data) &#123;</span><br><span class="line">            console.log(&#39;sinter:&#39; + data)                    &#x2F;&#x2F;交集: sinter:redis</span><br><span class="line">        &#125;);</span><br><span class="line">        client.sunion(&#39;db1&#39;,&#39;db2&#39;, function(err,data) &#123;</span><br><span class="line">            console.log(&#39;sunion:&#39; + data)                    &#x2F;&#x2F; 并集: sunion:mongo,mysql,redis</span><br><span class="line">        &#125;);</span><br><span class="line">        client.sdiff(&#39;db1&#39;,&#39;db2&#39;, function(err,data) &#123;</span><br><span class="line">            console.log(&#39;SDIFF:&#39; + data)                     &#x2F;&#x2F; 补集: SDIFF:mysql</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>有序集合(SortedSets)  zadd(设置元素), zrange(获取范围内的元素),zrank(获取指定元素的排名，从0开始), zscore(获取指定元素的score，用户指定的score)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">client.zadd(table, score, id, function (err, res) &#123;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;删除单个</span><br><span class="line">client.zrem(table, id, function (err, res) &#123;</span><br><span class="line"></span><br><span class="line">));</span><br><span class="line">	&#x2F;&#x2F; 删除多个</span><br><span class="line">client.zrem(table, arr, function (err, res) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">	&#x2F;&#x2F; 从大到小 查询    </span><br><span class="line">client.zrevrange(table, 0, -1, function (err, res) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>事务(multi命令): 批量执行所有的命令，并统一返回结果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">client.multi()</span><br><span class="line">    .set(&#39;xiao&#39;,&#39;xing&#39;)</span><br><span class="line">    .get(&#39;xiao&#39;)</span><br><span class="line">    .exec(function(err,replies) &#123;</span><br><span class="line">        console.log(replies);         &#x2F;&#x2F; [ &#39;OK&#39;, &#39;xing&#39; ]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>订阅发布模式</li>
</ul>
<p>redis的订阅发布模式可用来做类似kafka的消息推送;</p>
<p>使用list + redis的订阅发布模式可以构建一个不错的消息队列;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let sub &#x3D; redis.createClient(6379, &#39;127.0.0.1&#39;);   &#x2F;&#x2F; 监听消费者</span><br><span class="line">let pub &#x3D; redis.createClient(6379, &#39;127.0.0.1&#39;);   &#x2F;&#x2F; 生产者</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 在sub开始监听时允许触发subscribe事件进行操作,类似连接数据库的connect事件</span><br><span class="line">sub.on(&#39;subscribe&#39;, function(channel, count) &#123;</span><br><span class="line">    console.log(&#96;$&#123;channel&#125;:$&#123;count&#125;&#96;);               &#x2F;&#x2F;  test channel:1</span><br><span class="line">    pub.publish(&#39;test channel&#39;, &#39;channel message test&#39;)</span><br><span class="line">&#125;)</span><br><span class="line">sub.on(&#39;message&#39;, function(channel, message) &#123;</span><br><span class="line">    console.log(&#96;$&#123;channel&#125;-message:$&#123;JSON.stringify(message)&#125;&#96;)    &#x2F;&#x2F; test channel-message:&quot;channel message test&quot;</span><br><span class="line">&#125;)</span><br><span class="line">sub.subscribe(&#39;test channel&#39;);</span><br></pre></td></tr></table></figure>

<ul>
<li>对整个redis的所有客户端操作进行监听 （monitor事件可以监听到redis收到的所有客户端命令）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">client.monitor(function(err, res) &#123;</span><br><span class="line">    console.log(res);   &#x2F;&#x2F; ok</span><br><span class="line">&#125;)</span><br><span class="line">client.on(&quot;monitor&quot;, function (time, args) &#123;</span><br><span class="line">    console.log(time + &quot;: &quot; + util.inspect(args));             &#x2F;&#x2F; 1556285641.395573: [ &#39;lindex&#39;, &#39;myset&#39;, &#39;2&#39; ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h1 id="java客户端jedis"><a href="#java客户端jedis" class="headerlink" title="java客户端jedis"></a>java客户端jedis</h1><p>Jedis介绍与快速入门</p>
<p>通过java来操作redis：使用jedis</p>
<p><img src="/15.1.Redis/image-20210906144617185.png" alt="image-20210906144617185"></p>
<p>搭建jedis环境：</p>
<p>新建一个javaproject，复制jar包到lib下，右键addpath构建路径</p>
<p><img src="/15.1.Redis/image-20210906144629940.png" alt="image-20210906144629940"></p>
<p>编写代码</p>
<p><img src="/15.1.Redis/image-20210906144646383.png" alt="image-20210906144646383"></p>
<p>程序执行报错：</p>
<p><img src="/15.1.Redis/image-20210906144705822.png" alt="image-20210906144705822"></p>
<p>原因:</p>
<p>1.redis服务器是否开启：linux上加载redis-server和redis.conf查看开启</p>
<p>2.linux的防火墙是否关闭：service iptables stop  关了之后在重启redis服务器</p>
<p>3.在redis.conf配置文件中 bind 127.0.0.1 代表的是外部不可以访问redis（可以把它注释掉，前面加#）</p>
<p>通过以上操作，错误信息不一样了：</p>
<p><img src="/15.1.Redis/image-20210906144737833.png" alt="image-20210906144737833"></p>
<p>原因：是我们没有设置密码</p>
<p>我们需要在redis.conf文件中设置密码admin：查找到requirepass，将前面的#删掉，然后将后面的改为admin，：wq保存退出</p>
<p><img src="/15.1.Redis/image-20210906144756360.png" alt="image-20210906144756360"></p>
<p><img src="/15.1.Redis/image-20210906144805631.png" alt="image-20210906144805631"></p>
<p>有密码的情况下，在命令行下连接redis需加上-a：</p>
<p><img src="/15.1.Redis/image-20210906144817763.png" alt="image-20210906144817763"></p>
<p>string类型常见操作</p>
<p>//string操作</p>
<p><em><strong>*public*</strong></em> <em><strong>*class*</strong></em> JedisDemo2 {</p>
<p>​    Jedis jedis;</p>
<p>​    @Before</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> createJedis() {</p>
<p>​        jedis = <em><strong>*new*</strong></em> Jedis(“192.168.19.128”);</p>
<p>​        // 设置密码</p>
<p>​        jedis.auth(“admin”);</p>
<p>​    }</p>
<p>​    // 演示 set get</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test1() {</p>
<p>​        jedis.set(“username”, “tom”);        </p>
<p>​        String value = jedis.get(“username”);</p>
<p>​        System.****<em>out*</em>***.println(value);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //演示mset mget</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test2(){</p>
<p>​        jedis.mset(“password”,”123”,”age”,”20”);</p>
<p>​        </p>
<p>​        List<String> values = jedis.mget(“username”,”password”,”age”);</p>
<p>​        </p>
<p>​        System.****<em>out*</em>***.println(values);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //演示 append  setrange getrange</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test3(){</p>
<p>​        //jedis.append(“username”,” is boy”);</p>
<p>​        </p>
<p>​        //jedis.setrange(“username”, 7,”girl”);</p>
<p>​        System.****<em>out*</em>***.println(jedis.get(“username”));</p>
<p>​        </p>
<p>​        </p>
<p>​        System.****<em>out*</em>***.println(jedis.getrange(“username”, 7, -1));</p>
<p>​    }</p>
<p>}</p>
<p>list类型常见操作：</p>
<p>//list操作</p>
<p><em><strong>*public*</strong></em> <em><strong>*class*</strong></em> JedisDemo3 {</p>
<p>​    Jedis jedis;</p>
<p>​    @Before</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> createJedis() {</p>
<p>​        jedis = <em><strong>*new*</strong></em> Jedis(“192.168.19.128”);</p>
<p>​        // 设置密码</p>
<p>​        jedis.auth(“admin”);</p>
<p>​    }</p>
<p>​    // 演示lpush lrange</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test1() {</p>
<p>​        jedis.lpush(“names”, “tom”, “james”, “张三”, “李四”);</p>
<p>​        List<String> names = jedis.lrange(“names”, 0, -1);</p>
<p>​        System.****<em>out*</em>***.println(names);</p>
<p>​    }</p>
<p>​    // lset</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test2() {</p>
<p>​        // jedis.lset(“names”, 1, “王五”);</p>
<p>​        // List<String> names = jedis.lrange(“names”, 0, -1);</p>
<p>​        // System.out.println(names);</p>
<p>​        String value = jedis.lindex(“names”, 1);</p>
<p>​        System.****<em>out*</em>***.println(value);</p>
<p>​    }</p>
<p>​    // linsert</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test3() {</p>
<p>​        jedis.linsert(“names”, LIST_POSITION.****<em>BEFORE*</em>***, “james”, “fox”);</p>
<p>​        List<String> names = jedis.lrange(“names”, 0, -1);</p>
<p>​        System.****<em>out*</em>***.println(names);</p>
<p>​    }</p>
<p>​    </p>
<p>​    // lrem</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test4(){</p>
<p>​        jedis.lrem(“names”, 1, “tom”);</p>
<p>​        List<String> names = jedis.lrange(“names”, 0, -1);</p>
<p>​        System.****<em>out*</em>***.println(names);</p>
<p>​    }</p>
<p>}</p>
<p>hash类型常见操作</p>
<p>//hash操作</p>
<p><em><strong>*public*</strong></em> <em><strong>*class*</strong></em> JedisDemo4 {</p>
<p>​    Jedis jedis;</p>
<p>​    @Before</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> createJedis() {</p>
<p>​        jedis = <em><strong>*new*</strong></em> Jedis(“192.168.19.128”);</p>
<p>​        // 设置密码</p>
<p>​        jedis.auth(“admin”);</p>
<p>​    }</p>
<p>​    // 演示hset hget</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test1() {</p>
<p>​        jedis.hset(“user”, “username”, “tom”);</p>
<p>​        String value = jedis.hget(“user”, “username”);</p>
<p>​        System.****<em>out*</em>***.println(value);</p>
<p>​    }</p>
<p>​    // 演示hmset hmget</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test2() {</p>
<p>​        Map&lt;String, String&gt; hash = <em><strong>*new*</strong></em> HashMap&lt;String, String&gt;();</p>
<p>​        hash.put(“password”, “123”);</p>
<p>​        hash.put(“sex”, “male”);</p>
<p>​        jedis.hmset(“user”, hash);</p>
<p>​        List<String> values = jedis.hmget(“user”, “username”, “password”, “sex”);</p>
<p>​        System.****<em>out*</em>***.println(values);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //演示 hgetall hkeys kvals</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test3(){</p>
<p>​        Map&lt;String, String&gt; map = jedis.hgetAll(“user”);</p>
<p>​        <em><strong>*for*</strong></em>(String key:map.keySet()){</p>
<p>​            System.****<em>out*</em>***.println(key+”  “+map.get(key));</p>
<p>​        }</p>
<p>​        </p>
<p>​        Set<String> keys = jedis.hkeys(“user”);</p>
<p>​        System.****<em>out*</em>***.println(keys);</p>
<p>​        </p>
<p>​        List<String> values = jedis.hvals(“user”);</p>
<p>​        System.****<em>out*</em>***.println(values);</p>
<p>​    }</p>
<p>​    </p>
<p>//    演示hdel</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test4(){</p>
<p>​        jedis.hdel(“user”, “username”,”password”);</p>
<p>​        Map&lt;String, String&gt; map = jedis.hgetAll(“user”);</p>
<p>​        <em><strong>*for*</strong></em>(String key:map.keySet()){</p>
<p>​            System.****<em>out*</em>***.println(key+”  “+map.get(key));</p>
<p>​        }</p>
<p>​    }</p>
<p>}</p>
<p>set类型常见操作</p>
<p>//set操作</p>
<p><em><strong>*public*</strong></em> <em><strong>*class*</strong></em> JedisDemo5 {</p>
<p>​    Jedis jedis;</p>
<p>​    @Before</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> createJedis() {</p>
<p>​        jedis = <em><strong>*new*</strong></em> Jedis(“192.168.19.128”);</p>
<p>​        // 设置密码</p>
<p>​        jedis.auth(“admin”);        </p>
<p>​    }</p>
<p>​    </p>
<p>​    //演示sadd smembers</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test1(){</p>
<p>​        jedis.sadd(“language1”,”java”,”c++”,”ruby”,”python”);</p>
<p>​        </p>
<p>​        Set<String> smembers = jedis.smembers(“language1”);</p>
<p>​        System.****<em>out*</em>***.println(smembers);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //演示srem</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test2(){</p>
<p>​        jedis.srem(“language1”, “java”);</p>
<p>​        Set<String> smembers = jedis.smembers(“language1”);</p>
<p>​        System.****<em>out*</em>***.println(smembers);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //差集 sdiff</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test3(){</p>
<p>​        jedis.sadd(“language1”,”java”,”c++”,”ruby”,”python”);</p>
<p>​        jedis.sadd(“language2”,”ios”,”c++”,”c#”,”android”);</p>
<p>​        </p>
<p>​        Set<String> sdiff = jedis.sdiff(“language1”,”language2”);</p>
<p>​        System.****<em>out*</em>***.println(sdiff);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //交集</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test4(){</p>
<p>​        jedis.sadd(“language1”,”java”,”c++”,”ruby”,”python”);</p>
<p>​        jedis.sadd(“language2”,”ios”,”c++”,”c#”,”android”);</p>
<p>​        Set<String> sinter = jedis.sinter(“language1”,”language2”);</p>
<p>​        System.****<em>out*</em>***.println(sinter);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //并集</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test5(){</p>
<p>​        jedis.sadd(“language1”,”java”,”c++”,”ruby”,”python”);</p>
<p>​        jedis.sadd(“language2”,”ios”,”c++”,”c#”,”android”);</p>
<p>​        Set<String> sunion = jedis.sunion(“language1”,”language2”);</p>
<p>​        System.****<em>out*</em>***.println(sunion);</p>
<p>​    }</p>
<p>​    </p>
<p>}</p>
<p>sortedSet类型常见操作</p>
<p>//sortedset操作</p>
<p><em><strong>*public*</strong></em> <em><strong>*class*</strong></em> JedisDemo6 {</p>
<p>​    Jedis jedis;</p>
<p>​    @Before</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> createJedis() {</p>
<p>​        jedis = <em><strong>*new*</strong></em> Jedis(“192.168.19.128”);</p>
<p>​        // 设置密码</p>
<p>​        jedis.auth(“admin”);</p>
<p>​    }</p>
<p>​    // 演示zadd zrange zrangeByScore</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test1() {</p>
<p>​        Map&lt;String, Double&gt; sm = <em><strong>*new*</strong></em> HashMap&lt;String, Double&gt;();</p>
<p>​        sm.put(“张三”, 70.0);</p>
<p>​        sm.put(“李四”, 80.0);</p>
<p>​        sm.put(“王五”, 90.0);</p>
<p>​        sm.put(“赵六”, 60.0);</p>
<p>​        jedis.zadd(“zkey”, sm);</p>
<p>​        Set<String> set = jedis.zrange(“zkey”, 0, -1);</p>
<p>​        System.****<em>out*</em>***.println(set);</p>
<p>​        // 根据分数获取</p>
<p>​        Set<String> set1 = jedis.zrangeByScore(“zkey”, 70.0, 90.0);</p>
<p>​        System.****<em>out*</em>***.println(set1);</p>
<p>​    }</p>
<p>​    // 获取分数元素 zrangeWithScores</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test2() {</p>
<p>​        Map&lt;String, Double&gt; sm = <em><strong>*new*</strong></em> HashMap&lt;String, Double&gt;();</p>
<p>​        sm.put(“张三”, 70.0);</p>
<p>​        sm.put(“李四”, 80.0);</p>
<p>​        sm.put(“王五”, 90.0);</p>
<p>​        sm.put(“赵六”, 60.0);</p>
<p>​        jedis.zadd(“zkey”, sm);</p>
<p>​        Set<Tuple> zws = jedis.zrangeWithScores(“zkey”, 0, -1);</p>
<p>​        <em><strong>*for*</strong></em> (Tuple t : zws) {</p>
<p>​            System.****<em>out*</em>***.println(t.getScore() + “  “ + t.getElement());</p>
<p>​        }</p>
<p>​    }</p>
<p>​    // zrank</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test3() {</p>
<p>​        Map&lt;String, Double&gt; sm = <em><strong>*new*</strong></em> HashMap&lt;String, Double&gt;();</p>
<p>​        sm.put(“张三”, 70.0);</p>
<p>​        sm.put(“李四”, 80.0);</p>
<p>​        sm.put(“王五”, 90.0);</p>
<p>​        sm.put(“赵六”, 60.0);</p>
<p>​        jedis.zadd(“zkey”, sm);</p>
<p>​        Long num = jedis.zrank(“zkey”, “赵六”);</p>
<p>​        System.****<em>out*</em>***.println(num);</p>
<p>​    }</p>
<p>​    // zscore</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test4() {</p>
<p>​        Map&lt;String, Double&gt; sm = <em><strong>*new*</strong></em> HashMap&lt;String, Double&gt;();</p>
<p>​        sm.put(“张三”, 70.0);</p>
<p>​        sm.put(“李四”, 80.0);</p>
<p>​        sm.put(“王五”, 90.0);</p>
<p>​        sm.put(“赵六”, 60.0);</p>
<p>​        jedis.zadd(“zkey”, sm);</p>
<p>​        Double zscore = jedis.zscore(“zkey”, “张三”);</p>
<p>​        System.****<em>out*</em>***.println(zscore);</p>
<p>​    }</p>
<p>​    // zrem</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test5() {</p>
<p>​        Map&lt;String, Double&gt; sm = <em><strong>*new*</strong></em> HashMap&lt;String, Double&gt;();</p>
<p>​        sm.put(“张三”, 70.0);</p>
<p>​        sm.put(“李四”, 80.0);</p>
<p>​        sm.put(“王五”, 90.0);</p>
<p>​        sm.put(“赵六”, 60.0);</p>
<p>​        jedis.zadd(“zkey”, sm);</p>
<p>​        jedis.zrem(“zkey”, “李四”);</p>
<p>​        </p>
<p>​        Set<Tuple> zws = jedis.zrangeWithScores(“zkey”, 0, -1);</p>
<p>​        <em><strong>*for*</strong></em> (Tuple t : zws) {</p>
<p>​            System.****<em>out*</em>***.println(t.getScore() + “  “ + t.getElement());</p>
<p>​        }</p>
<p>​    }</p>
<p>}</p>
<p>key的常见操作</p>
<p>//key的通用操作</p>
<p><em><strong>*public*</strong></em> <em><strong>*class*</strong></em> JedisDemo7 {</p>
<p>​    Jedis jedis;</p>
<p>​    @Before</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> createJedis() {</p>
<p>​        jedis = <em><strong>*new*</strong></em> Jedis(“192.168.19.128”);</p>
<p>​        // 设置密码</p>
<p>​        jedis.auth(“admin”);</p>
<p>​    }</p>
<p>​    // keys patten</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test1(){</p>
<p>​        Set<String> keys = jedis.keys(“*”);</p>
<p>​        System.****<em>out*</em>***.println(keys);</p>
<p>​    }</p>
<p>​    </p>
<p>​    // del key</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test2(){</p>
<p>​        Long del = jedis.del(“user”);</p>
<p>​        System.****<em>out*</em>***.println(del);</p>
<p>​    }</p>
<p>​    </p>
<p>​    //关于key时间设置</p>
<p>​    @Test</p>
<p>​    <em><strong>*public*</strong></em> <em><strong>*void*</strong></em> test3(){</p>
<p>​        //jedis.expire(“username”, 200); //设置生命周期为200秒</p>
<p>​        jedis.persist(“username”);</p>
<p>​        Long ttl = jedis.ttl(“username”); //获取生命周期值</p>
<p>​        System.****<em>out*</em>***.println(ttl);</p>
<p>​        </p>
<p>​    }</p>
<p>}</p>
<h1 id="Redis数据持久化"><a href="#Redis数据持久化" class="headerlink" title="Redis数据持久化"></a>Redis数据持久化</h1><p>Redis将内存存储和持久化存储相结合，既可提供数据访问的高效性，又可保证数据存储的安全性</p>
<p>1.Redis数据持久化机制介绍</p>
<p>1). RDB持久化：该机制是指在指定的时间间隔内将<strong>内存中的数据集快照</strong>写入磁盘。  </p>
<p>2). AOF(append only file)持久化:该机制将以<strong>日志的形式记录服务器所处理的每一个写操作</strong>，在Redis服务器启动之初会读取该文件来重新构建数据库，以保证启动后数据库中的数据是完整的。</p>
<p>3). 同时应用AOF和RDB。 </p>
<p>4). 无持久化：可通过配置的方式禁用Redis服务器的持久化功能，这样我们就可以将Redis视为一个功能加强版的memcached了</p>
<p>2.Redis数据持久化配置与测试</p>
<p>l RDB快照方式:缺省情况下，Redis会将数据集的快照dump到dump.rdb文件中。此外，我们也可以通过配置文件来修改Redis服务器dump快照的频率，在打开redis.conf文件之后，我们搜索save，可以看到下面的配置信息：</p>
<p>Ø save 900 1        </p>
<p>#在900秒(15分钟)之后，如果至少有1个key发生变化，则dump内存快照。</p>
<p>Ø save 300 10       </p>
<p>#在300秒(5分钟)之后，如果至少有10个key发生变化，则dump内存快照。</p>
<p>Ø save 60 10000     </p>
<p>#在60秒(1分钟)之后，如果至少有10000个key发生变化，则dump内存快照。</p>
<p>注意:关于dump.rdb文件存储的位置：它的设置是在redis.conf文件中dir ./</p>
<p>dir ./这段配置指的是服务器启动时的当前路径（在哪启动服务器时，这个rdb文件就在哪创建）。</p>
<p>l AOF日志文件方式：</p>
<p>Ø AOF日志持久化机制的开启：需要手动设置，在redis.conf文件中</p>
<p>将appendonly  no  改为 appendonly  yes</p>
<p>Ø AOF同步方式的配置：</p>
<p>在Redis的配置文件中存在三种同步方式，它们分别是：</p>
<p>appendfsync  always   #每次有数据修改发生时都会写入AOF文件。</p>
<p>appendfsync  everysec  #每秒钟同步一次，该策略为AOF的缺省策略。</p>
<p>appendfsync  no      #从不同步。高效但是数据不会被持久化。</p>
<p>3.RDB与AOF对比总结</p>
<p>l RDB存在哪些优势呢？</p>
<p>1). 数据的备份和恢复非常方便，因为一个数据库只有一个持久化文件</p>
<p>2). 性能最大化。对于Redis的服务进程而言，在开始持久化时，它唯一需要做的只是fork出子进程，之后再由子进程完成这些持久化的工作，这样就可以极大的避免服务进程执行IO操作了。</p>
<p>3). 相比于AOF机制，如果数据集很大，RDB的启动效率会更高。</p>
<p>l RDB又存在哪些劣势呢？</p>
<p>1).系统一旦在定时持久化之前出现宕机现象，此前没有来得及写入磁盘的数据都将丢失。</p>
<p>2). 由于RDB是通过fork子进程来协助完成数据持久化工作的，因此，如果当数据集较大时，可能会导致整个服务器停止服务几百毫秒，甚至是1秒钟。</p>
<p>l AOF的优势有哪些呢？</p>
<p>1). 该机制可以带来更高的数据安全性，即数据持久性。Redis中提供了3种同步策略，即每秒同步、每修改同步和不同步。</p>
<p>2).对日志文件的写入操作采用的是append模式，因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容。</p>
<p>3). 如果日志过大，Redis可以自动启用rewrite机制迅速“瘦身”(也可手动触发aof的rewrite操作，命令： bgrewriteaof)</p>
<p>4). AOF日志格式清晰、易于理解，很容易用AOF日志文件完成数据的重建。  </p>
<p>l AOF的劣势有哪些呢？</p>
<p>1). 对于相同数量的数据集而言，AOF文件通常要大于RDB文件。</p>
<p>2). 根据同步策略的不同，AOF在运行效率上往往会慢于RDB。总之，每秒同步策略的效率是比较高的，同步禁用策略的效率和RDB一样高效。</p>
<h1 id="Redis数据的备份"><a href="#Redis数据的备份" class="headerlink" title="Redis数据的备份"></a>Redis数据的备份</h1><h3 id="RDB方式-默认"><a href="#RDB方式-默认" class="headerlink" title="RDB方式(默认)"></a>RDB方式(默认)</h3><p>RDB方式的持久化是通过快照（snapshotting）完成的，当符合一定条件时Redis会自动将内存中的所有数据进行快照并存储在硬盘上。进行快照的条件可以由用户在配置文件中自定义，由两个参数构成：时间和改动的键的个数。当在指定的时间内被更改的键的个数大于指定的数值时就会进行快照。RDB是Redis默认采用的持久化方式，在配置文件中已经预置了3个条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1    # 900秒内有至少1个键被更改则进行快照</span><br><span class="line">save 300 10   # 300秒内有至少10个键被更改则进行快照</span><br><span class="line">save 60 10000  # 60秒内有至少10000个键被更改则进行快照</span><br></pre></td></tr></table></figure>

<p>可以存在多个条件，条件之间是“或”的关系，只要满足其中一个条件，就会进行快照。 如果想要禁用自动快照，只需要将所有的save参数删除即可。</p>
<p>Redis默认会将快照文件存储在当前目录(可CONFIG GET dir来查看)的dump.rdb文件中，可以通过配置dir和dbfilename两个参数分别指定快照文件的存储路径和文件名。</p>
<p>Redis实现快照的过程</p>
<ul>
<li>Redis使用fork函数复制一份当前进程（父进程）的副本（子进程）；</li>
<li>父进程继续接收并处理客户端发来的命令，而子进程开始将内存中的数据写入硬盘中的临时文件；</li>
<li>当子进程写入完所有数据后会用该临时文件替换旧的RDB文件，至此一次快照操作完成。</li>
</ul>
<p>在执行fork的时候操作系统（类Unix操作系统）会使用写时复制（copy-on-write）策略，即fork函数发生的一刻父子进程共享同一内存数据，当父进程要更改其中某片数据时（如执行一个写命令），操作系统会将该片数据复制一份以保证子进程的数据不受影响，所以新的RDB文件存储的是执行fork一刻的内存数据。</p>
<p>Redis在进行快照的过程中不会修改RDB文件，只有快照结束后才会将旧的文件替换成新的，也就是说任何时候RDB文件都是完整的。这使得我们可以通过定时备份RDB文件来实现Redis数据库备份。RDB文件是经过压缩（可以配置rdbcompression参数以禁用压缩节省CPU占用）的二进制格式，所以占用的空间会小于内存中的数据大小，更加利于传输。</p>
<p>除了自动快照，还可以手动发送SAVE或BGSAVE命令让Redis执行快照，两个命令的区别在于，前者是由主进程进 行快照操作，会阻塞住其他请求，后者会通过fork子进程进行快照操作。Redis启动后会读取RDB快照文件，将数据从硬盘载入到内存。根据数据量大小与结构和服务器性能不同，这个时间也不同。通常将一个记录一千万个字符串 类型键、大小为1GB的快照文件载入到内存中需要花费20～30秒钟。通过RDB方式实现持久化，一旦Redis异常退出，就会丢失最后一次快照以后更改的所有数据。这就需要开发者根据具体的应用场合，通过组合设置自动快照条件的方式来将可能发生的数据损失控制在能够接受的范围。如果数据很重要以至于无法承受任何损失，则可以考虑使用AOF方式进行持久化。</p>
<h3 id="AOF方式"><a href="#AOF方式" class="headerlink" title="AOF方式"></a>AOF方式</h3><p>默认情况下Redis没有开启AOF(append only file)方式的持久化，可以在redis.conf中通过appendonly参数开启：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p>在启动时Redis会逐个执行AOF文件中的命令来将硬盘中的数据载入到内存中，载入的速度相较RDB会慢一些,开启AOF持久化后每执行一条会更改Redis中的数据的命令，Redis就会将该命令写入硬盘中的AOF文件。AOF文件的保存位置和RDB文件的位置相同，都是通过dir参数设置的，默认的文件名是appendonly.aof，可以通过appendfilename参数修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendfilename appendonly.aof</span><br></pre></td></tr></table></figure>

<p>配置redis自动重写AOF文件的条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100  # 当目前的AOF文件大小超过上一次重写时的AOF文件大小的百分之多少时会再次进行重写，如果之前没有重写过，则以启动时的AOF文件大小为依据</span><br><span class="line">auto-aof-rewrite-min-size 64mb   # 允许重写的最小AOF文件大小</span><br></pre></td></tr></table></figure>

<p>配置写入AOF文件后，要求系统刷新硬盘缓存的机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># appendfsync always   # 每次执行写入都会执行同步，最安全也最慢</span><br><span class="line">appendfsync everysec   # 每秒执行一次同步操作</span><br><span class="line"># appendfsync no       # 不主动进行同步操作，而是完全交由操作系统来做（即每30秒一次），最快也最不安全</span><br></pre></td></tr></table></figure>

<p>Redis允许同时开启AOF和RDB，既保证了数据安全又使得进行备份等操作十分容易。此时重新启动Redis后Redis会使用AOF文件来恢复数据，因为AOF方式的持久化可能丢失的数据更少</p>
<h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><p>通过持久化功能，Redis保证了即使在服务器重启的情况下也不会损失（或少量损失）数据。但是由于数据是存储在一台服务器上的，如果这台服务器的硬盘出现故障，也会导致数据丢失。为了避免单点故障，我们希望将数据库复制多个副本以部署在不同的服务器上，即使有一台服务器出现故障其他服务器依然可以继续提供服务。这就要求当一台服务器上的数据库更新后，可以自动将更新的数据同步到其他服务器上，Redis提供了复制（replication）功能可以自动 实现同步的过程。</p>
<h3 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h3><p>Redis主从结构支持一主多从</p>
<p>主节点：192.168.100.200</p>
<p>从节点：192.168.100.150</p>
<p>注意：所有从节点的配置都一样</p>
<p><strong>方式1：手动修改配置文件</strong></p>
<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">slaveof 192.168.100.200 6379 #指定master的ip和端口</span><br><span class="line"></span><br><span class="line"># If the master is password protected (using the &quot;requirepass&quot; configuration</span><br><span class="line"># directive below) it is possible to tell the slave to authenticate before</span><br><span class="line"># starting the replication synchronization process, otherwise the master will</span><br><span class="line"># refuse the slave request.</span><br><span class="line">#</span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line">masterauth 123456 #这是主机的密码</span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**方式2：动态设置**</span><br></pre></td></tr></table></figure>

<p>通过redis-cli 连接到从节点服务器，执行下面命令即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; slaveof 192.168.100.200 6379 </span><br></pre></td></tr></table></figure>

<p>注：slaveof no one 可以使当前数据库停止接收其他数据库的同步，转成主数据库</p>
<h3 id="优点及应用场景"><a href="#优点及应用场景" class="headerlink" title="优点及应用场景"></a>优点及应用场景</h3><p>读写分离通过复制可以实现读写分离以提高服务器的负载能力。在常见的场景中，读的频率大于写，当单机的Redis无法应付大量的读请求时（尤其是较耗资源的请求，比如SORT命令等）可以通过复制功能建立多个从数据库，主数据库只进行写操作，而从数据库负责读操作。</p>
<p>从数据库持久化持久化通常相对比较耗时，为了提高性能，可以通过复制功能建立一个（或若干个）从数据库，并在从数据库中启用持久化，同时在主数据库禁用持久化。当从数据库崩溃时重启后主数据库会自动将数据同步过来，所以无需担心数据丢失。而当主数据库崩溃时，需要在从数据库中使用SLAVEOF NO ONE命令将从数据库提升成主数据库继续服务，并在原来的主数据库启动后使用SLAVEOF命令将其设置成新的主数据库的从数据库，即可将数据同步回来。</p>
<h1 id="springboot项目里使用Redis做缓存"><a href="#springboot项目里使用Redis做缓存" class="headerlink" title="springboot项目里使用Redis做缓存"></a>springboot项目里使用Redis做缓存</h1><h2 id="Spring-Cache-操作Redis"><a href="#Spring-Cache-操作Redis" class="headerlink" title="Spring Cache 操作Redis"></a>Spring Cache 操作Redis</h2><p>当Spring Boot 结合Redis来作为缓存使用时，最简单的方式就是使用Spring Cache了，使用它我们无需知道Spring中对Redis的各种操作，仅仅通过它提供的@Cacheable 、@CachePut 、@CacheEvict 、@EnableCaching等注解就可以实现缓存功能。</p>
<h3 id="EnableCaching"><a href="#EnableCaching" class="headerlink" title="@EnableCaching"></a>@EnableCaching</h3><p>开启缓存功能，一般放在启动类上。</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p>使用该注解的方法当缓存存在时，会从缓存中获取数据而不执行方法，当缓存不存在时，会执行方法并把返回结果存入缓存中。<strong>一般使用在查询方法上</strong>，可以设置如下属性：</p>
<ul>
<li>value：缓存名称（必填），指定缓存的命名空间；</li>
<li>key：用于设置在命名空间中的缓存key值，可以使用SpEL表达式定义；</li>
<li>unless：条件符合则不缓存；</li>
<li>condition：条件符合则缓存。</li>
</ul>
<h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><p>使用该注解的方法每次执行时都会把返回结果存入缓存中。<strong>一般使用在新增方法上</strong>，可以设置如下属性：</p>
<ul>
<li>value：缓存名称（必填），指定缓存的命名空间；</li>
<li>key：用于设置在命名空间中的缓存key值，可以使用SpEL表达式定义；</li>
<li>unless：条件符合则不缓存；</li>
<li>condition：条件符合则缓存。</li>
</ul>
<h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><p>使用该注解的方法执行时会清空指定的缓存。<strong>一般使用在更新或删除方法上</strong>，可以设置如下属性：</p>
<ul>
<li>value：缓存名称（必填），指定缓存的命名空间；</li>
<li>key：用于设置在命名空间中的缓存key值，可以使用SpEL表达式定义；</li>
<li>condition：条件符合则缓存。</li>
</ul>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><ul>
<li>在pom.xml中添加项目依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--redis依赖配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改配置文件application.yml，添加Redis的连接配置；</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.6</span><span class="number">.139</span> <span class="comment"># Redis服务器地址</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span> <span class="comment"># Redis数据库索引（默认为0）</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span> <span class="comment"># Redis服务器连接端口</span></span><br><span class="line">    <span class="attr">password:</span> <span class="comment"># Redis服务器连接密码（默认为空）</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">1000ms</span> <span class="comment"># 连接超时时间</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在启动类上添加@EnableCaching注解启动缓存功能；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallTinyApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MallTinyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来在PmsBrandServiceImpl类中使用相关注解来实现缓存功能，可以发现我们获取品牌详情的方法中使用了@Cacheable注解，在修改和删除品牌的方法上使用了@CacheEvict注解；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PmsBrandService实现类</span></span><br><span class="line"><span class="comment"> * Created by macro on 2019/4/19.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PmsBrandServiceImpl</span> <span class="keyword">implements</span> <span class="title">PmsBrandService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PmsBrandMapper brandMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(value = RedisConfig.REDIS_KEY_DATABASE, key = &quot;&#x27;pms:brand:&#x27;+#id&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(Long id, PmsBrand brand)</span> </span>&#123;</span><br><span class="line">        brand.setId(id);</span><br><span class="line">        <span class="keyword">return</span> brandMapper.updateByPrimaryKeySelective(brand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(value = RedisConfig.REDIS_KEY_DATABASE, key = &quot;&#x27;pms:brand:&#x27;+#id&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = RedisConfig.REDIS_KEY_DATABASE, key = &quot;&#x27;pms:brand:&#x27;+#id&quot;, unless = &quot;#result==null&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PmsBrand <span class="title">getItem</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> brandMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以调用获取品牌详情的接口测试下效果，此时发现Redis中存储的数据有点像乱码，并且没有设置过期时间；</li>
</ul>
<p><img src="/15.1.Redis/v2-746b4b4a1e45bb5e0bb9f25818e9b04c_720w.jpg" alt="img"></p>
<h4 id="存储JSON格式数据"><a href="#存储JSON格式数据" class="headerlink" title="存储JSON格式数据"></a>存储JSON格式数据</h4><blockquote>
<p>此时我们就会想到有没有什么办法让Redis中存储的数据变成标准的JSON格式，然后可以设置一定的过期时间，不设置过期时间容易产生很多不必要的缓存数据。</p>
</blockquote>
<ul>
<li>我们可以通过给RedisTemplate设置JSON格式的序列化器，并通过配置RedisCacheConfiguration设置超时时间来实现以上需求，此时别忘了去除启动类上的@EnableCaching注解，具体配置类RedisConfig代码如下；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis配置类</span></span><br><span class="line"><span class="comment"> * Created by macro on 2020/3/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis数据库自定义key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span> String REDIS_KEY_DATABASE=<span class="string">&quot;mall&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisSerializer&lt;Object&gt; serializer = redisSerializer();</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(serializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setHashValueSerializer(serializer);</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisSerializer&lt;Object&gt; <span class="title">redisSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建JSON序列化器</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        serializer.setObjectMapper(objectMapper);</span><br><span class="line">        <span class="keyword">return</span> serializer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisCacheManager <span class="title">redisCacheManager</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//设置Redis缓存有效期为1天</span></span><br><span class="line">        RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer())).entryTtl(Duration.ofDays(<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisCacheManager(redisCacheWriter, redisCacheConfiguration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时我们再次调用获取商品详情的接口进行测试，会发现Redis中已经缓存了标准的JSON格式数据，并且超时时间被设置为了1天。</li>
</ul>
<p><img src="/15.1.Redis/v2-238e48f3a03e90c7387e3707826a3dad_720w.jpg" alt="img"></p>
<h2 id="使用Redis连接池"><a href="#使用Redis连接池" class="headerlink" title="使用Redis连接池"></a>使用Redis连接池</h2><blockquote>
<p>SpringBoot 1.5.x版本Redis客户端默认是Jedis实现的，SpringBoot 2.x版本中默认客户端是用Lettuce实现的，我们先来了解下Jedis和Lettuce客户端。</p>
</blockquote>
<h3 id="Jedis-vs-Lettuce"><a href="#Jedis-vs-Lettuce" class="headerlink" title="Jedis vs Lettuce"></a>Jedis vs Lettuce</h3><p>Jedis在实现上是直连Redis服务，多线程环境下非线程安全，除非使用连接池，为每个 RedisConnection 实例增加物理连接。</p>
<p>Lettuce是一种可伸缩，线程安全，完全非阻塞的Redis客户端，多个线程可以共享一个RedisConnection，它利用Netty NIO框架来高效地管理多个连接，从而提供了异步和同步数据访问方式，用于构建非阻塞的反应性应用程序。</p>
<h3 id="使用步骤-1"><a href="#使用步骤-1" class="headerlink" title="使用步骤"></a>使用步骤</h3><ul>
<li>修改application.yml添加Lettuce连接池配置，用于配置线程数量和阻塞等待时间；</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="number">0</span> <span class="comment">#redis数据库索引，默认为0</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span> <span class="comment"># 连接池最大连接数 默认为8，使用负值表示没有限制</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span> <span class="comment"># 连接池最大空闲连接数 默认8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span> <span class="comment"># 连接池最小空闲连接数 默认0  为了保证一直处于连接状态，我们设置为了1</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">-1</span> <span class="comment"># 连接池最大阻塞等待时间，负值表示没有限制 默认-1</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">6000</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span>  <span class="comment">#服务器地址</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span>  <span class="comment">#连接端口</span></span><br><span class="line">    <span class="attr">password:</span>   <span class="comment">#连接密码，默认为空</span></span><br></pre></td></tr></table></figure>

<ul>
<li>jedis的pom文件依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Lettuce的pom文件依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>如果你没添加以上依赖的话，启动应用的时候就会产生如下错误；</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.NoClassDefFoundError: org/apache/commons/pool2/impl/GenericObjectPoolConfig</span><br><span class="line">    at org.springframework.data.redis.connection.lettuce.LettucePoolingClientConfiguration<span class="variable">$LettucePoolingClientConfigurationBuilder</span>.&lt;init&gt;(LettucePoolingClientConfiguration.java:84) ~[spring-data-redis-2.1.5.RELEASE.jar:2.1.5.RELEASE]</span><br><span class="line">    at org.springframework.data.redis.connection.lettuce.LettucePoolingClientConfiguration.builder(LettucePoolingClientConfiguration.java:48) ~[spring-data-redis-2.1.5.RELEASE.jar:2.1.5.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration<span class="variable">$PoolBuilderFactory</span>.createBuilder(LettuceConnectionConfiguration.java:149) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration.createBuilder(LettuceConnectionConfiguration.java:107) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration.getLettuceClientConfiguration(LettuceConnectionConfiguration.java:93) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration.redisConnectionFactory(LettuceConnectionConfiguration.java:74) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration$$EnhancerBySpringCGLIB$<span class="variable">$5caa7e47</span>.CGLIB$redisConnectionFactory<span class="variable">$0</span>(&lt;generated&gt;) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration$$EnhancerBySpringCGLIB$$5caa7e47$$FastClassBySpringCGLIB$<span class="variable">$b8ae2813</span>.invoke(&lt;generated&gt;) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:244) ~[spring-core-5.1.5.RELEASE.jar:5.1.5.RELEASE]</span><br><span class="line">    at org.springframework.context.annotation.ConfigurationClassEnhancer<span class="variable">$BeanMethodInterceptor</span>.intercept(ConfigurationClassEnhancer.java:363) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]</span><br><span class="line">    at org.springframework.boot.autoconfigure.data.redis.LettuceConnectionConfiguration$$EnhancerBySpringCGLIB$<span class="variable">$5caa7e47</span>.redisConnectionFactory(&lt;generated&gt;) ~[spring-boot-autoconfigure-2.1.3.RELEASE.jar:2.1.3.RELEASE]</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_91]</span><br><span class="line">    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_91]</span><br><span class="line">    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_91]</span><br><span class="line">    at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_91]</span><br><span class="line">    at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:154) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]</span><br><span class="line">    ... 111 common frames omitted</span><br></pre></td></tr></table></figure>

<h2 id="自由操作Redis"><a href="#自由操作Redis" class="headerlink" title="自由操作Redis"></a>自由操作Redis</h2><blockquote>
<p>Spring Cache 给我们提供了操作Redis缓存的便捷方法，但是也有很多局限性。比如说我们想单独设置一个缓存值的有效期怎么办？我们并不想缓存方法的返回值，我们想缓存方法中产生的中间值怎么办？此时我们就需要用到RedisTemplate这个类了，接下来我们来讲下如何通过RedisTemplate来自由操作Redis中的缓存。</p>
</blockquote>
<p>默认情况下RedisTemplate模板只能支持字符串，我们自定义一个RedisTemplate，设置序列化器，这样我们可以很方便的操作实例对象。将RedisTemplate模板的设置放在RedisConfig类中</p>
<p>RedisTemplate默认为我们实现了几种操作数据类型的方法：</p>
<p><img src="/15.1.Redis/a2cc7cd98d1001e966f1ceae81048fe955e79756.jpeg" alt="img"></p>
<p>redisTemplate有两个方法经常用到,一个是opsForXXX一个是boundXXXOps,XXX是value的类型,前者获取到一个Opercation,但是没有指定操作的key,可以在一个连接(事务)内操作多个key以及对应的value;后者会获取到一个指定了key的operation,在一个连接内只操作这个key对应的value</p>
<p>也可以自己定义：</p>
<h3 id="RedisService"><a href="#RedisService" class="headerlink" title="RedisService"></a>RedisService</h3><blockquote>
<p>定义Redis操作业务类，在Redis中有几种数据结构，比如普通结构（对象），Hash结构、Set结构、List结构，该接口中定义了大多数常用操作方法。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redis操作Service</span></span><br><span class="line"><span class="comment"> * Created by macro on 2020/3/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RedisService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Object <span class="title">get</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">del</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">del</span><span class="params">(List&lt;String&gt; keys)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置过期时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取过期时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">getExpire</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否有该属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">hasKey</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按delta递增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按delta递减</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Hash结构中的属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Object <span class="title">hGet</span><span class="params">(String key, String hashKey)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向Hash结构中放入一个属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">hSet</span><span class="params">(String key, String hashKey, Object value, <span class="keyword">long</span> time)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向Hash结构中放入一个属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hSet</span><span class="params">(String key, String hashKey, Object value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接获取整个Hash结构</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Map&lt;Object, Object&gt; <span class="title">hGetAll</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接设置整个Hash结构</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">hSetAll</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接设置整个Hash结构</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hSetAll</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除Hash结构中的属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hDel</span><span class="params">(String key, Object... hashKey)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断Hash结构中是否有该属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">hHasKey</span><span class="params">(String key, String hashKey)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Hash结构中属性递增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">hIncr</span><span class="params">(String key, String hashKey, Long delta)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Hash结构中属性递减</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">hDecr</span><span class="params">(String key, String hashKey, Long delta)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Set结构</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Set&lt;Object&gt; <span class="title">sMembers</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向Set结构中添加属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">sAdd</span><span class="params">(String key, Object... values)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向Set结构中添加属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">sAdd</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否为Set中的属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Boolean <span class="title">sIsMember</span><span class="params">(String key, Object value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Set结构的长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">sSize</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除Set结构中的属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">sRemove</span><span class="params">(String key, Object... values)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取List结构中的属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Object&gt; <span class="title">lRange</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取List结构的长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">lSize</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引获取List中的属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Object <span class="title">lIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向List结构中添加属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">lPush</span><span class="params">(String key, Object value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向List结构中添加属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">lPush</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向List结构中批量添加属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">lPushAll</span><span class="params">(String key, Object... values)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向List结构中批量添加属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">lPushAll</span><span class="params">(String key, Long time, Object... values)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从List结构中移除属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RedisServiceImpl"><a href="#RedisServiceImpl" class="headerlink" title="RedisServiceImpl"></a>RedisServiceImpl</h3><blockquote>
<p>RedisService的实现类，使用RedisTemplate来自由操作Redis中的缓存数据。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redis操作实现类</span></span><br><span class="line"><span class="comment"> * Created by macro on 2020/3/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisServiceImpl</span> <span class="keyword">implements</span> <span class="title">RedisService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">del</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">del</span><span class="params">(List&lt;String&gt; keys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hGet</span><span class="params">(String key, String hashKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, hashKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hSet</span><span class="params">(String key, String hashKey, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, hashKey, value);</span><br><span class="line">        <span class="keyword">return</span> expire(key, time);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hSet</span><span class="params">(String key, String hashKey, Object value)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, hashKey, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hGetAll</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hSetAll</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">        <span class="keyword">return</span> expire(key, time);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hSetAll</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hDel</span><span class="params">(String key, Object... hashKey)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, hashKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hHasKey</span><span class="params">(String key, String hashKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, hashKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">hIncr</span><span class="params">(String key, String hashKey, Long delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, hashKey, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">hDecr</span><span class="params">(String key, String hashKey, Long delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, hashKey, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sMembers</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">sAdd</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">sAdd</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        expire(key, time);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">sIsMember</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">sSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">sRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lRange</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lPush</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lPush</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        Long index = redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">        expire(key, time);</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lPushAll</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().rightPushAll(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lPushAll</span><span class="params">(String key, Long time, Object... values)</span> </span>&#123;</span><br><span class="line">        Long count = redisTemplate.opsForList().rightPushAll(key, values);</span><br><span class="line">        expire(key, time);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RedisController"><a href="#RedisController" class="headerlink" title="RedisController"></a>RedisController</h3><blockquote>
<p>测试RedisService中缓存操作的Controller，大家可以调用测试下。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis测试Controller</span></span><br><span class="line"><span class="comment"> * Created by macro on 2020/3/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;RedisController&quot;, description = &quot;Redis测试&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisService redisService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PmsBrandService brandService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;测试简单缓存&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/simpleTest&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;PmsBrand&gt; <span class="title">simpleTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;PmsBrand&gt; brandList = brandService.list(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        PmsBrand brand = brandList.get(<span class="number">0</span>);</span><br><span class="line">        String key = <span class="string">&quot;redis:simple:&quot;</span> + brand.getId();</span><br><span class="line">        redisService.set(key, brand);</span><br><span class="line">        PmsBrand cacheBrand = (PmsBrand) redisService.get(key);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(cacheBrand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;测试Hash结构的缓存&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/hashTest&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;PmsBrand&gt; <span class="title">hashTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;PmsBrand&gt; brandList = brandService.list(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        PmsBrand brand = brandList.get(<span class="number">0</span>);</span><br><span class="line">        String key = <span class="string">&quot;redis:hash:&quot;</span> + brand.getId();</span><br><span class="line">        Map&lt;String, Object&gt; value = BeanUtil.beanToMap(brand);</span><br><span class="line">        redisService.hSetAll(key, value);</span><br><span class="line">        Map&lt;Object, Object&gt; cacheValue = redisService.hGetAll(key);</span><br><span class="line">        PmsBrand cacheBrand = BeanUtil.mapToBean(cacheValue, PmsBrand.class, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(cacheBrand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;测试Set结构的缓存&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/setTest&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Set&lt;Object&gt;&gt; setTest() &#123;</span><br><span class="line">        List&lt;PmsBrand&gt; brandList = brandService.list(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        String key = <span class="string">&quot;redis:set:all&quot;</span>;</span><br><span class="line">        redisService.sAdd(key, (Object[]) ArrayUtil.toArray(brandList, PmsBrand.class));</span><br><span class="line">        redisService.sRemove(key, brandList.get(<span class="number">0</span>));</span><br><span class="line">        Set&lt;Object&gt; cachedBrandList = redisService.sMembers(key);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(cachedBrandList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;测试List结构的缓存&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/listTest&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;List&lt;Object&gt;&gt; listTest() &#123;</span><br><span class="line">        List&lt;PmsBrand&gt; brandList = brandService.list(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        String key = <span class="string">&quot;redis:list:all&quot;</span>;</span><br><span class="line">        redisService.lPushAll(key, (Object[]) ArrayUtil.toArray(brandList, PmsBrand.class));</span><br><span class="line">        redisService.lRemove(key, <span class="number">1</span>, brandList.get(<span class="number">0</span>));</span><br><span class="line">        List&lt;Object&gt; cachedBrandList = redisService.lRange(key, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> CommonResult.success(cachedBrandList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="jedis实现缓存的实际操作："><a href="#jedis实现缓存的实际操作：" class="headerlink" title="jedis实现缓存的实际操作："></a>jedis实现缓存的实际操作：</h1><p>jedis的maven依赖（不用lettuce，因为会出现一直连接超时的情况）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;groupId&gt;io.lettuce&lt;&#x2F;groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;lettuce-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">            &lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>redis的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">@EnableCaching</span><br><span class="line">@Configuration</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template &#x3D; new RedisTemplate&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 配置连接工厂</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        &#x2F;&#x2F;使用StringRedisSerializer来序列化和反序列化redis的key值</span><br><span class="line">        template.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        template.setHashKeySerializer(new StringRedisSerializer());</span><br><span class="line">        &#x2F;&#x2F; 值采用json序列化</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer());</span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer());</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Primary注解指定默认缓存管理器</span><br><span class="line">     *</span><br><span class="line">     * @param template</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    @Primary</span><br><span class="line">    public CacheManager cacheManager(RedisTemplate&lt;String, Object&gt; template) &#123;</span><br><span class="line">        &#x2F;&#x2F; 基本配置</span><br><span class="line">        RedisCacheConfiguration defaultCacheConfiguration &#x3D; RedisCacheConfiguration</span><br><span class="line">                .defaultCacheConfig()</span><br><span class="line">                &#x2F;&#x2F; 设置key为String</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(template.getStringSerializer()))</span><br><span class="line">                &#x2F;&#x2F;设置value为json格式（重写了jackson2JsonRedisSerializer的配置）</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer()))</span><br><span class="line">                &#x2F;&#x2F; 不缓存null</span><br><span class="line">                .disableCachingNullValues()</span><br><span class="line">                &#x2F;&#x2F; 缓存数据保存1周</span><br><span class="line">                .entryTtl(Duration.ofDays(7));</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 一个redis缓存管理器</span><br><span class="line">        RedisCacheManager redisCacheManager &#x3D;</span><br><span class="line">                RedisCacheManager.RedisCacheManagerBuilder</span><br><span class="line">                        &#x2F;&#x2F; Redis 连接工厂</span><br><span class="line">                        .fromConnectionFactory(template.getConnectionFactory())</span><br><span class="line">                        &#x2F;&#x2F; 缓存配置</span><br><span class="line">                        .cacheDefaults(defaultCacheConfiguration)</span><br><span class="line">                        &#x2F;&#x2F; 配置同步修改或删除 put&#x2F;evict</span><br><span class="line">                        .transactionAware()</span><br><span class="line">                        .build();</span><br><span class="line">        return redisCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public CacheManager logisticsCacheManager(RedisTemplate&lt;String, Object&gt; template) &#123;</span><br><span class="line">        &#x2F;&#x2F; 基本配置</span><br><span class="line">        RedisCacheConfiguration defaultCacheConfiguration &#x3D; RedisCacheConfiguration</span><br><span class="line">                .defaultCacheConfig()</span><br><span class="line">                &#x2F;&#x2F; 设置key为String</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(template.getStringSerializer()))</span><br><span class="line">                &#x2F;&#x2F;设置value为json格式（重写了jackson2JsonRedisSerializer的配置）</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer()))</span><br><span class="line">                &#x2F;&#x2F; 不缓存null</span><br><span class="line">                .disableCachingNullValues()</span><br><span class="line">                &#x2F;&#x2F; 物流数据保存30天</span><br><span class="line">                .entryTtl(Duration.ofDays(30));</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 一个redis缓存管理器</span><br><span class="line">        RedisCacheManager redisCacheManager &#x3D;</span><br><span class="line">                RedisCacheManager.RedisCacheManagerBuilder</span><br><span class="line">                        &#x2F;&#x2F; Redis 连接工厂</span><br><span class="line">                        .fromConnectionFactory(template.getConnectionFactory())</span><br><span class="line">                        &#x2F;&#x2F; 缓存配置</span><br><span class="line">                        .cacheDefaults(defaultCacheConfiguration)</span><br><span class="line">                        &#x2F;&#x2F; 配置同步修改或删除 put&#x2F;evict</span><br><span class="line">                        .transactionAware()</span><br><span class="line">                        .build();</span><br><span class="line">        return redisCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer() &#123;</span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer &#x3D;</span><br><span class="line">                new Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        ObjectMapper objectMapper &#x3D; new ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.configure(MapperFeature.USE_ANNOTATIONS, false);</span><br><span class="line">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);</span><br><span class="line">        objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);</span><br><span class="line">        &#x2F;&#x2F; 此项必须配置，否则会报java.lang.ClassCastException: java.util.LinkedHashMap cannot be cast to XXX</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);</span><br><span class="line">        objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line">        return jackson2JsonRedisSerializer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis:</span><br><span class="line">  jedis:</span><br><span class="line">    pool:</span><br><span class="line">      #最大连接数, 不超过Redis实例的最大连接数(redis默认10000)</span><br><span class="line">      max-active: 18</span><br><span class="line">      max-wait: -1</span><br><span class="line">      max-idle: 8</span><br><span class="line">      min-idle: 1</span><br><span class="line">  timeout: 6000</span><br><span class="line">  host: 192.168.0.1</span><br><span class="line">  port: 6379</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">设置redis的缓存：</span><br><span class="line">@Cacheable(value &#x3D; &#123;&quot;userDTO&quot;&#125;, key &#x3D; &quot;#openid&quot;, sync &#x3D; true)</span><br><span class="line">public UserDTO getUserByOpenid(String openid) throws UserNotExistException &#123;</span><br><span class="line">	UserDTO userDTO &#x3D; userMapper.getUserByOpenid(openid);</span><br><span class="line">	System.out.println(userDTO);</span><br><span class="line">	if (null &#x3D;&#x3D; userDTO) &#123;</span><br><span class="line">		throw new UserNotExistException();</span><br><span class="line">	&#125;</span><br><span class="line">	return userDTO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Cacheable(value &#x3D; &#123;&quot;logistics&quot;&#125;, key &#x3D; &quot;#expressNo&quot;, cacheManager &#x3D; &quot;logisticsCacheManager&quot;, sync &#x3D; true)</span><br><span class="line"></span><br><span class="line">更改redis缓存：</span><br><span class="line">1.用注解会直接删掉缓存，下次还需要再查</span><br><span class="line">@CacheEvict(value &#x3D; &#123;&quot;userDTO&quot;&#125;, key &#x3D; &quot;#nodeRequestDTO.openid&quot;, condition &#x3D; &quot;#nodeRequestDTO.helmetColor &#x3D;&#x3D; &#39;yellow&#39;&quot;)</span><br><span class="line">@CacheEvict(value &#x3D; &#123;&quot;userDTO&quot;&#125;, key &#x3D; &quot;#companyReviewDTO.openid&quot;, condition &#x3D; &quot;#companyReviewDTO.reviewStatus &#x3D;&#x3D; &#39;2&#39;&quot;)</span><br><span class="line">2.自己写一个updateCacheInfo方法</span><br><span class="line">private void updateCacheInfo(UserDTO userDTO) &#123;</span><br><span class="line">	RedisCacheManager rcm &#x3D; (RedisCacheManager) cacheManager;</span><br><span class="line">	Cache cache &#x3D; rcm.getCache(&quot;userDTO&quot;);</span><br><span class="line">	cache.put(userDTO.getOpenid(), userDTO);</span><br><span class="line">&#125;</span><br><span class="line">在程序里将userDTO设置再更新</span><br><span class="line">userDTO.setRole(user.getRole());</span><br><span class="line">this.updateCacheInfo(userDTO);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@CacheEvict(value &#x3D; &#123;&quot;userDTO&quot;&#125;, key &#x3D; &quot;#userDTO.openid&quot;)</span><br><span class="line">改为：（直接删除了缓存）</span><br><span class="line">RedisCacheManager rcm &#x3D; (RedisCacheManager) cacheManager;</span><br><span class="line">Cache cache &#x3D; rcm.getCache(&quot;userDTO&quot;);</span><br><span class="line">cache.evict(user.getOpenid());</span><br></pre></td></tr></table></figure>

<p>个人理解：CacheManager和RedisTemplate都可以操纵redis的数据，规定key和value的存入和读取格式。（CacheManager更像是装饰后的对象，RedisTemplate更像是底层的对象）</p>
<p>设置缓存：CacheManager可以在配置类里设置多个，然后在注解里指定cacheManager。 也可以直接用redisService.set直接存入redis</p>
<p>更改缓存：可以利用注解更改。也可以用配置类定义好的CacheManager，从种获取到key并更改，删除。也可以直接用redisService操作</p>
<p>指定key和value的格式：</p>
<p>JdkSerializationRedisSerializer：当需要存储java对象时使用.</p>
<p>StringRedisSerializer：当需要存储string类型的字符串时使用.</p>
<p>JacksonJsonRedisSerializer：将对象序列化成json的格式存储在redis中,需要jackson-json工具的支持</p>
<p>opsForXXX和boundXXXOps的区别：</p>
<p>前者获取到一个Opercation,但是没有指定操作的key,可以在一个连接(事务)内操作多个key以及对应的value;</p>
<p>后者会获取到一个指定了key的operation,在一个连接内只操作这个key对应的value.</p>
<h1 id="关于redis中缓存的问题"><a href="#关于redis中缓存的问题" class="headerlink" title="关于redis中缓存的问题"></a>关于redis中缓存的问题</h1><h2 id="当数据库数据需要更改，怎么操作缓存"><a href="#当数据库数据需要更改，怎么操作缓存" class="headerlink" title="当数据库数据需要更改，怎么操作缓存"></a>当数据库数据需要更改，怎么操作缓存</h2><p>以下四种更新策略通过中途失败和多线程两种情况进行考虑：</p>
<h3 id="1-先更新数据库，再更新缓存"><a href="#1-先更新数据库，再更新缓存" class="headerlink" title="1.先更新数据库，再更新缓存"></a>1.先更新数据库，再更新缓存</h3><p>读到旧数据：数据库更新成功，缓存更新失败，会读取到旧的缓存数据</p>
<p>读到错误数据：多线程情况下，线程A比B先进来，A更新完数据库卡住了，线程B此时顺利执行完，A又活过来才去更新缓存，就会出现读到的缓存是A的缓存不是B的缓存，导致读到错误数据（特别是写操作远大于读操作的项目场景）</p>
<h3 id="2-先更新缓存，再更新数据库"><a href="#2-先更新缓存，再更新数据库" class="headerlink" title="2.先更新缓存，再更新数据库"></a>2.先更新缓存，再更新数据库</h3><p>读到错误数据：缓存更新成功，数据库更新失败，就会读取到错误的缓存数据</p>
<p>数据库更新不成功，缓存的数据应该也是不可以成功的</p>
<p>读到错误数据：多线程情况下，类似于1（也是特别是写操作远大于读操作的项目场景）</p>
<p><strong>读多写少的场景，上面2种方式也勉强还行</strong></p>
<h3 id="3-先删除缓存，再更新数据库"><a href="#3-先删除缓存，再更新数据库" class="headerlink" title="3.先删除缓存，再更新数据库"></a>3.先删除缓存，再更新数据库</h3><p>如果删除缓存成功，但是更新数据库不成功，情况正常</p>
<p>读到错误数据：多线程情况下，A删除缓存后，停住了，B读数据库，设置缓存，A才去更新数据库，导致数据库和缓存不一致，导致读到错误数据（<strong>特别是读操作远大于写操作的项目场景</strong>）</p>
<h3 id="4-先更新数据库，再删除缓存"><a href="#4-先更新数据库，再删除缓存" class="headerlink" title="4.先更新数据库，再删除缓存"></a>4.先更新数据库，再删除缓存</h3><p>读到错误数据：更新数据库成功，删除缓存失败，导致读到错误数据</p>
<p>读到错误数据：多线程情况下，A更新数据库，也删除缓存。B去读发现没有缓存，读到了数据，准备写的时候卡住了，C来更新数据库+删除缓存后，B活过来了，把读到的A数据存入到缓存，导致读到错误数据</p>
<p>对于3：也叫延时双删除策略，<strong>可以先删除缓存 ，再更新数据库，延时后再删除缓存</strong>，就是补一刀把后续的脏缓存数据删掉，这么具体的延时时间是多少，就得根据具体项目业务时间去衡量了</p>
<p>对于4：也叫Cache-Aside pattern，读操作实际上肯定比写操作快得多，所以发生上边描述的出现脏数据的场景的概率也是比较小</p>
<p>总结：</p>
<p>并发稍微低，那么我们可以用   先删除缓存，再更新数据库  再配上延时双删除策略</p>
<p>并发稍微高，那么我们可以用 Cache-Aside pattern ，  先更新数据库 ，再删除缓存 。</p>
<p>脏数据 在不适用 分布式锁 或者 其他能保证数据顺序的方法的情况下，都是存在的。只不过是出现这种脏数据的概率以及严重性，是否是项目的业务需求可以接收。</p>
<p>上面存在的问题，都是有额外的补救方法，如加锁，重试，消息队列等等</p>
<p>1、想要提高应用的性能，可以引入「缓存」来解决</p>
<p>2、引入缓存后，需要考虑缓存和数据库一致性问题，可选的方案有：「更新数据库 + 更新缓存」、「更新数据库 + 删除缓存」</p>
<p>3、更新数据库 + 更新缓存方案，在「并发」场景下无法保证缓存和数据一致性，且存在「缓存资源浪费」和「机器性能浪费」的情况发生</p>
<p>4、在更新数据库 + 删除缓存的方案中，「先删除缓存，再更新数据库」在「并发」场景下依旧有数据不一致问题，解决方案是「延迟双删」，但这个延迟时间很难评估，所以推荐用「先更新数据库，再删除缓存」的方案</p>
<p>5、在「先更新数据库，再删除缓存」方案下，为了保证两步都成功执行，需配合「消息队列」或「订阅变更日志」的方案来做，本质是通过「重试」的方式保证数据一致性</p>
<p>6、在「先更新数据库，再删除缓存」方案下，「读写分离 + 主从库延迟」也会导致缓存和数据库不一致，缓解此问题的方案是「延迟双删」，凭借经验发送「延迟消息」到队列中，延迟删除缓存，同时也要控制主从库延迟，尽可能降低不一致发生的概率</p>
<h1 id="缓存的名称"><a href="#缓存的名称" class="headerlink" title="缓存的名称"></a>缓存的名称</h1><h2 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h2><p>缓存穿透是指缓存和数据库中都没有的数据，而用户不断发起请求，如发起为id为“-1”的数据或id为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大</p>
<p>解决方案：</p>
<p>1.接口层增加校验，如用户鉴权校验，id做基础校验，id&lt;=0的直接拦截；<br>2.从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击</p>
<h2 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h2><p>缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>设置热点数据永远不过期。</li>
<li>加互斥锁</li>
</ol>
<p><img src="/15.1.Redis/20180919143214879" alt="img"></p>
<pre><code>      1）缓存中有数据，直接走上述代码13行后就返回结果了

     2）缓存中没有数据，第1个进入的线程，获取锁并从数据库去取数据，没释放锁之前，其他并行进入的线程会等待100ms，再重新去缓存取数据。这样就防止都去数据库重复取数据，重复往缓存中更新数据情况出现。

      3）当然这是简化处理，理论上如果能根据key值加锁就更好了，就是线程A从数据库取key1的数据并不妨碍线程B取key2的数据，上面代码明显做不到这点
</code></pre>
<h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><p>缓存雪崩是指缓存中数据大批量到过期时间，而查询数据量巨大，引起数据库压力过大甚至down机。和缓存击穿不同的是，缓存击穿指并发查同一条数据，缓存雪崩是不同数据都过期了，很多数据都查不到从而查数据库</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生。</li>
<li>如果缓存数据库是分布式部署，将热点数据均匀分布在不同高的缓存数据库中。</li>
<li>设置热点数据永远不过期</li>
</ol>
<h1 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h1><p>对于基本不会变的数据，为什么不选择redis存储而是要使用mysql呢？</p>
<p>答：为了应对复杂的业务逻辑，可能一个表会涉及到多个相关联的字段，需要在查询一个表的数据时候，将其他关系表的数据查询出来。而redis只能存kv值，无法应对复杂的业务场景，即使Redis的读取效率再高，我们也没法用。但对于某些没有关联少，且需要高频率读写的数据，就可以使用（比如秒杀活动，可以在redis中高速读写，当达到一定阈值之后，再更新到mysql的数据库来实现短时间内的高并发场景）。redis只能作为一个辅助工具（可以当数据库，也可以当缓存工具）存储来提高性能。</p>
<p>什么时候使用redis？</p>
<p>答：当数据多、并发量大的时候，架构中可以引入Redis，帮助提升架构的整体性能，减少Mysql(或其他数据库)的压力</p>
<p>因为Redis的性能十分优越，可以支持每秒十几万此的读/写操作，并且它还支持持久化、集群部署、分布式、主从同步等，Redis在高并发的场景下数据的安全和一致性，所以它经常用于两个场景：</p>
<p>1.缓存</p>
<p>经常会被查询，但是不经常被修改或者删除的数据；比如数据字典，业务数据中的热点数据；这样不仅提升查询效率，还可以减少数据库的压力；</p>
<p>经常被查询，实时性要求不高数据，比如网站的最新列表、排行榜之类的数据，只需要定时统计一次，然后把统计结果放到Redis中提供查询（请不要使用select top 10 from xxxx）。</p>
<p>缓存可以方便数据共享，比如我先用电脑网页打开X东，选了两件商品放到购物车里面，再登录手机APP，也是可以看到购物车里面的商品的。</p>
<p>判断数据是否适合缓存到Redis中，可以从几个方面考虑：会经常查询么？命中率如何？写操作多么？数据大小？</p>
<p>我们经常采用这样的方式将数据刷到Redis中：查询的请求过来，现在Redis中查询，如果查询不到，就查询数据库拿到数据，再放到缓存中，这样第二次相同的查询请求过来，就可以直接在Redis中拿到数据；不过要注意【缓存穿透】的问题。</p>
<p>缓存的刷新会比较复杂，通常是修改完数据库之后，还需要对Redis中的数据进行操作；代码很简单，但是需要保证这两步为同一事务，或最终的事务一致性</p>
<p>2.高速读写</p>
<p>常见的就是计数器，比如一篇文章的阅读量，不可能每一次阅读就在数据库里面update一次。</p>
<p>高并发的场景很适合使用Redis，比如双11秒杀，库存一共就一千件，到了秒杀的时间，通常会在极为短暂的时间内，有数万级的请求达到服务器，如果使用数据库的话，很可能在这一瞬间造成数据库的崩溃，所以通常会使用Redis（秒杀的场景会比较复杂，Redis只是其中之一，例如如果请求超过某个数量的时候，多余的请求就会被限流）。</p>
<p>这种高并发的场景，是当请求达到服务器的时候，直接在Redis上读写，请求不会访问到数据库；程序会在合适的时间，比如一千件库存都被秒杀，再将数据批量写到数据库中。</p>
<p>所以通常来说，在必要的时候引入Redis，可以减少MySQL（或其他）数据库的压力，两者不是替代的关系</p>
<h1 id="redis实现延迟队列"><a href="#redis实现延迟队列" class="headerlink" title="redis实现延迟队列"></a>redis实现延迟队列</h1><p>（在电商项目里有具体的实现方式）</p>
<h3 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h3><ul>
<li>在淘宝、京东等购物平台上下单，超过一定时间未付款，订单会自动取消。</li>
<li>打车的时候，在规定时间没有车主接单，平台会取消你的单并提醒你暂时没有车主接单。</li>
<li>点外卖的时候，如果商家在10分钟还没接单，就会自动取消订单。</li>
<li>收快递的时候，如果我们没有点确认收货，在一段时间后程序会自动完成订单。</li>
<li>在平台完成订单后，如果我们没有在规定时间评论商品，会自动默认买家不评论</li>
</ul>
<p>这类场景都可以用定时任务去轮询实现，但是当数据量过大的时候，高频轮询数据库会消耗大量的资源，此时用延迟队列来应对这类场景比较好。</p>
<p>需求功能：</p>
<ul>
<li>消息存储</li>
<li>过期延时消息实时获取</li>
<li>高可用性</li>
</ul>
<h3 id="消息延迟原理："><a href="#消息延迟原理：" class="headerlink" title="消息延迟原理："></a>消息延迟原理：</h3><p><img src="/15.1.Redis/1323607-20200702061910379-1864468139.png" alt="img"></p>
<p> 当用户发送一个消息请求给服务器后台的时候，服务器会检测这条消息是否需要进行延时处理，如果需要就放入到延时队列中，由延时任务检测器进行检测和处理，对于不需要进行延时处理的任务，服务器会立马对消息进行处理，并把处理后的结果返会给用户</p>
<p><img src="/15.1.Redis/1323607-20200702055737295-275210721.png" alt="img"></p>
<p> 对于在延时任务检测器内部的话，有查询延迟任务和执行延时任务两个职能，任务检测器会先去延时任务队列进行队列中信息读取，判断当前队列中哪些任务已经时间到期并将已经到期的任务输出执行（设置一个定时任务）</p>
<p>在redis中，我们可以使用 zset（sortedset）这个命令，用设置好的时间戳作为score进行排序，使用 zadd score1 value1 ….命令就可以一直往内存中生产消息。再利用 zrangebysocre 查询符合条件的所有待处理的任务，通过循环执行队列任务即可。也可以通过 zrangebyscore key min max withscores limit 0 1 查询最早的一条任务，来进行消费。</p>
<p><img src="/15.1.Redis/1323607-20200702083502806-654371890.png" alt="img"></p>
<p>（1）使用zrangebyscore来查询当前延时队列中所有任务，找出所有需要进行处理的延时任务，在依次进行操作。</p>
<p>（2）查找当前最早的一条任务，通过score值来判断任务执行的时候是否大于了当前系统的时候，比如说：最早的任务执行时间在3点，系统时间在2点58分，表示这个应该需要立马被执行。</p>
<h3 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h3><p>1.Redis zset支持高性能的 score 排序。<br>2.Redis是在内存上进行操作的，速度非常快。<br>3.Redis可以搭建集群，当消息很多时候，我们可以用集群来提高消息处理的速度，提高可用性。<br>4.Redis具有持久化机制，当出现故障的时候，可以通过AOF和RDB方式来对数据进行恢复，保证了数据的可靠性</p>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>队列最重要的就是保证消息被成功消费，所以需要Redis 实现 ACK</p>
<ul>
<li>需要在业务代码中处理消息失败的情况，回滚消息到原始等待队列。</li>
<li>Consumer 挂掉，仍然需要回滚消息到等待队列中。</li>
</ul>
<h3 id="其他实现延时队列的方法"><a href="#其他实现延时队列的方法" class="headerlink" title="其他实现延时队列的方法"></a>其他实现延时队列的方法</h3><h4 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h4><p>（1）通过 RabbitMQ 来实现延时队列</p>
<p>优点：消息持久化，分布式</p>
<p>缺点：延时相同的消息必须扔在同一个队列，每一种延时就需要建立一个队列。因为当后面的消息比前面的消息先过期，还是只能等待前面的消息过期，这里的过期检测是惰性的。</p>
<p>使用: </p>
<p>​    方法一：RabbitMQ 可以针对 Queue 设置 x-expires 或者针对 Message 设置 x-message-ttl ，来控制消息的生存时间（可以根据 Queue 来设置，也可以根据 message 设置）。</p>
<p>​    方法二：Queue 还可以配置 x-dead-letter-exchange 和 x-dead-letter-routing-key（可选）两个参数，如果队列内出现了 dead letter ，则按照这两个参数重新路由转发到指定的队列，此时就可以实现延时队列了。（我们可以用RabbitMQ的插件rabbitmq-delayed-message-exchange插件来实现延时队列。达到可投递时间时并将其通过 x-delayed-type 类型标记的交换机类型投递至目标队列。）</p>
<p><img src="/15.1.Redis/1323607-20200702083119402-1566927058.png" alt="img"></p>
<p>（2）RocketMQ实现延时队列</p>
<p>rocketmq在发送延时消息时，是先把消息按照延迟时间段发送到指定的队列中（把延时时间段相同的消息放到同一个队列中，保证了消息处理的顺序性，可以让同一个队列中消息延时时间是相同的，整个RocketMQ中延时消息时按照递增顺序排序，保证信息处理的先后顺序性。）。之后，通过一个定时器来轮询处理这些队列里的信息，判断是否到期。对于到期的消息会发送到相应的处理队列中，进行处理。</p>
<p>注意 ：目前RocketMQ只支持特定的延时时间段，1s,5s,10s,…2h，不能支持任意时间段的延时设置。</p>
<h3 id="Kafka实现延时队"><a href="#Kafka实现延时队" class="headerlink" title="Kafka实现延时队"></a>Kafka实现延时队</h3><p>Kafka基于时间轮自定义了一个用于实现延迟功能的定时器（SystemTimer），Kafka中的时间轮（TimingWheel）是一个存储定时任务的环形队列，可以进行相关的延时队列设置。</p>
<p><img src="/15.1.Redis/1323607-20200702161757716-63017960.png" alt="img"></p>
<h3 id="Netty实现延时队列"><a href="#Netty实现延时队列" class="headerlink" title="Netty实现延时队列"></a>Netty实现延时队列</h3><p>Netty也有基于时间轮算法来实现延时队列。Netty在构建延时队列主要用HashedWheelTimer，HashedWheelTimer底层数据结构是使用DelayedQueue，采用时间轮的算法来实现。</p>
<p><img src="/15.1.Redis/1323607-20200702090136855-2087712548.png" alt="img"></p>
<h3 id="DelayQueue来实现延时队列"><a href="#DelayQueue来实现延时队列" class="headerlink" title="DelayQueue来实现延时队列"></a>DelayQueue来实现延时队列</h3><p>优点：无界、延迟、阻塞队列</p>
<p>缺点：非持久化</p>
<p>介绍：JDK 自带的延时队列，没有过期元素的话，使用 poll() 方法会返回 null 值，超时判定是通过getDelay(TimeUnit.NANOSECONDS) 方法的返回值小于等于0来判断，并且不能存放空元素。</p>
<p>使用：getDelay 方法定义了剩余到期时间，compareTo 方法定义了元素排序规则。poll() 是非阻塞的获取数据，take() 是阻塞形式获取数据。实现 Delayed 接口即可使用延时队列。</p>
<p>注意：DelayQueue 实现了 Iterator 接口，但 iterator() 遍历顺序不保证是元素的实际存放顺序。</p>
<p>Java中有自带的DelayQueue数据类型，我们可以用这个来实现延时队列。DelayQueue是封装了一个PriorityQueue（优先队列），在向DelayQueue队列中添加元素时，会给元素一个Delay（延迟时间）作为排序条件，队列中最小的元素会优先放在队首，对于队列中的元素只有到了Delay时间才允许从队列中取出。这种实现方式是数据保存在内存中，可能面临数据丢失的情况，同时它是无法支持分布式系统的。</p>
<p><img src="/15.1.Redis/1323607-20200702081155517-145733708.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现 Delayed 定义延时队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sequence</span> <span class="keyword">implements</span> <span class="title">Delayed</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long time;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> time - System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.getDelay(TimeUnit.MILLISECONDS) &gt; o.getDelay(TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.getDelay(TimeUnit.MILLISECONDS) &lt; o.getDelay(TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scala-的-Await-amp-Future-（非java）"><a href="#Scala-的-Await-amp-Future-（非java）" class="headerlink" title="Scala 的 Await &amp; Future （非java）"></a>Scala 的 Await &amp; Future （非java）</h3><p>优点：消息实时性</p>
<p>缺点：非持久化</p>
<p>介绍：Scala 的 ExecutionContext 中使用Await 的 result(awaitable: Awaitable[T], atMost: Duration)方法可以根据传入的 atMost 间隔时间异步执行 awaitable。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://s-qwer.github.io/2021/04/15/15.1.Redis/" data-id="ckw61se07007foswdg85eh878" data-title="Redis" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/15/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8CSQL%E8%AF%AD%E5%8F%A5/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          数据库和SQL语句
        
      </div>
    </a>
  
  
    <a href="/2021/04/15/4.7.%E5%86%85%E9%83%A8%E7%B1%BB/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">内部类</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eclipse/" rel="tag">Eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitee/" rel="tag">Gitee</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HATEOAS/" rel="tag">HATEOAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/" rel="tag">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPA/" rel="tag">JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery/" rel="tag">JQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP/" rel="tag">JSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis-Plus/" rel="tag">MyBatis-Plus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="tag">MySQL基础概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Navicat/" rel="tag">Navicat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBOOTCMS/" rel="tag">PBOOTCMS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PO-BO-VO%EF%BC%8CDTO-DAO%E4%B8%8EPOJO/" rel="tag">PO-BO-VO，DTO-DAO与POJO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Portainer-io/" rel="tag">Portainer.io</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTful/" rel="tag">RESTful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB/" rel="tag">WEB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebRTC/" rel="tag">WebRTC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/for%E5%BE%AA%E7%8E%AF/" rel="tag">for循环</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/if/" rel="tag">if</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E6%A6%82%E8%BF%B0/" rel="tag">java概述</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mqtt/" rel="tag">mqtt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngnix/" rel="tag">ngnix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-js/" rel="tag">node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servlet/" rel="tag">servlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springfox/" rel="tag">springfox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vite/" rel="tag">vite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%8E%E4%BA%BA%E6%B2%9F%E9%80%9A/" rel="tag">与人沟通</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B9%A6/" rel="tag">书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8B%E5%8A%A1/" rel="tag">事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E9%83%A8%E7%B1%BB/" rel="tag">内部类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC/" rel="tag">历史版本</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95/" rel="tag">压缩算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="tag">基础概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E8%A3%85/" rel="tag">安装</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" rel="tag">小技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A7%91%E6%99%AE/" rel="tag">小科普</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BB%A3%E7%A0%81/" rel="tag">工具类代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag">微信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">快捷键</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%89%93%E5%8C%85/" rel="tag">打包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB/" rel="tag">抽象类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%A5%E5%8F%A3/" rel="tag">接口</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" rel="tag">搜索技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%B6%E8%97%8F/" rel="tag">收藏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%B0%E7%8E%AF%E5%A2%83/" rel="tag">新环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97/" rel="tag">日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">消息中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%99%BE%E5%BA%A6/" rel="tag">百度</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" rel="tag">类型转换</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E5%8E%86/" rel="tag">经历</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83/" rel="tag">编程规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/" rel="tag">设计规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%B7%E6%AD%8C/" rel="tag">谷歌</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AE%E5%AD%90/" rel="tag">轮子</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E8%AF%B4%E6%98%8E/" rel="tag">软件说明</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD/" rel="tag">逻辑判断</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E5%90%88%E4%BD%9C/" rel="tag">项目合作</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Eclipse/" style="font-size: 10px;">Eclipse</a> <a href="/tags/ElasticSearch/" style="font-size: 10px;">ElasticSearch</a> <a href="/tags/Gitee/" style="font-size: 10px;">Gitee</a> <a href="/tags/HATEOAS/" style="font-size: 10px;">HATEOAS</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/JPA/" style="font-size: 10px;">JPA</a> <a href="/tags/JQuery/" style="font-size: 10px;">JQuery</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/MyBatis-Plus/" style="font-size: 10px;">MyBatis-Plus</a> <a href="/tags/MySQL%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" style="font-size: 10px;">MySQL基础概念</a> <a href="/tags/Navicat/" style="font-size: 10px;">Navicat</a> <a href="/tags/PBOOTCMS/" style="font-size: 10px;">PBOOTCMS</a> <a href="/tags/PO-BO-VO%EF%BC%8CDTO-DAO%E4%B8%8EPOJO/" style="font-size: 10px;">PO-BO-VO，DTO-DAO与POJO</a> <a href="/tags/Portainer-io/" style="font-size: 10px;">Portainer.io</a> <a href="/tags/RESTful/" style="font-size: 10px;">RESTful</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/SpringBoot/" style="font-size: 10px;">SpringBoot</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Typora/" style="font-size: 10px;">Typora</a> <a href="/tags/WEB/" style="font-size: 10px;">WEB</a> <a href="/tags/WebRTC/" style="font-size: 10px;">WebRTC</a> <a href="/tags/for%E5%BE%AA%E7%8E%AF/" style="font-size: 10px;">for循环</a> <a href="/tags/git/" style="font-size: 20px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/if/" style="font-size: 10px;">if</a> <a href="/tags/java%E6%A6%82%E8%BF%B0/" style="font-size: 10px;">java概述</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mqtt/" style="font-size: 10px;">mqtt</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/ngnix/" style="font-size: 10px;">ngnix</a> <a href="/tags/node-js/" style="font-size: 20px;">node.js</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/servlet/" style="font-size: 10px;">servlet</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/springfox/" style="font-size: 10px;">springfox</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/vite/" style="font-size: 10px;">vite</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/%E4%B8%8E%E4%BA%BA%E6%B2%9F%E9%80%9A/" style="font-size: 10px;">与人沟通</a> <a href="/tags/%E4%B9%A6/" style="font-size: 10px;">书</a> <a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 10px;">事务</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 10px;">代理</a> <a href="/tags/%E5%86%85%E9%83%A8%E7%B1%BB/" style="font-size: 10px;">内部类</a> <a href="/tags/%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC/" style="font-size: 10px;">历史版本</a> <a href="/tags/%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95/" style="font-size: 10px;">压缩算法</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" style="font-size: 10px;">基础概念</a> <a href="/tags/%E5%AE%89%E8%A3%85/" style="font-size: 10px;">安装</a> <a href="/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">小技巧</a> <a href="/tags/%E5%B0%8F%E7%A7%91%E6%99%AE/" style="font-size: 10px;">小科普</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">工具类代码</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size: 10px;">微信</a> <a href="/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 20px;">快捷键</a> <a href="/tags/%E6%89%93%E5%8C%85/" style="font-size: 10px;">打包</a> <a href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB/" style="font-size: 10px;">抽象类</a> <a href="/tags/%E6%8E%A5%E5%8F%A3/" style="font-size: 10px;">接口</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">插件</a> <a href="/tags/%E6%90%9C%E7%B4%A2%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">搜索技巧</a> <a href="/tags/%E6%94%B6%E8%97%8F/" style="font-size: 10px;">收藏</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%96%B0%E7%8E%AF%E5%A2%83/" style="font-size: 10px;">新环境</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 10px;">杂谈</a> <a href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">消息中间件</a> <a href="/tags/%E7%99%BE%E5%BA%A6/" style="font-size: 10px;">百度</a> <a href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" style="font-size: 10px;">类型转换</a> <a href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size: 10px;">索引</a> <a href="/tags/%E7%BB%8F%E5%8E%86/" style="font-size: 10px;">经历</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83/" style="font-size: 10px;">编程规范</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/" style="font-size: 10px;">设计规范</a> <a href="/tags/%E8%B0%B7%E6%AD%8C/" style="font-size: 10px;">谷歌</a> <a href="/tags/%E8%BD%AE%E5%AD%90/" style="font-size: 10px;">轮子</a> <a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 10px;">软件</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E8%AF%B4%E6%98%8E/" style="font-size: 10px;">软件说明</a> <a href="/tags/%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD/" style="font-size: 10px;">逻辑判断</a> <a href="/tags/%E9%94%81/" style="font-size: 10px;">锁</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">面向对象</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%90%88%E4%BD%9C/" style="font-size: 10px;">项目合作</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/17/SpringBootSecurity/">SpringBootSecurity</a>
          </li>
        
          <li>
            <a href="/2021/12/16/SpringBootActuator/">SpringBootActuator</a>
          </li>
        
          <li>
            <a href="/2021/09/17/8.7.vite/">vite</a>
          </li>
        
          <li>
            <a href="/2021/09/03/%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BB%A3%E7%A0%81/">工具类代码</a>
          </li>
        
          <li>
            <a href="/2021/09/03/RPC/">RPC</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 swx<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>